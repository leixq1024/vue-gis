// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("require ../chunks/tslib.es6 ../intl ../core/arrayUtils ../core/reactiveUtils ../core/unitFormatUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/subclass ../layers/catalog/catalogUtils ../layers/support/layerUtils ../tables/AttributeTableTemplate ./Widget ./Attachments/support/attachmentUtils ./Editor/components/Prompt ./FeatureTable/ColumnMenuVisibleElements ./FeatureTable/FeatureTableViewModel ./FeatureTable/VisibleElements ./FeatureTable/support/tableUtils ../chunks/componentsUtils ./support/globalCss ./support/widgetUtils ./support/decorators/messageBundle ./support/decorators/vmEvent ./support/jsxFactory ../intl/substitute".split(" "),
function(t,d,c,Q,B,M,e,Z,aa,R,S,J,T,U,N,O,K,P,F,G,V,W,x,I,X,g,H){var L;c=L=class extends U{constructor(a,b){super(a,b);this._attachmentsInput=null;this._columnVisibilityActions=new Map;this.description=this.attachmentsList=null;this.disabled=!1;this.title=this.menuConfig=this.layers=null;this.viewModel=new P;this.visibleElements=new F;this._showDeletePrompt=this._showDeletePrompt.bind(this);this._onDeleteSelectionClick=this._onDeleteSelectionClick.bind(this)}initialize(){this.addHandles([B.watch(()=>
[this.viewModel.store.querying,this.viewModel.store.syncing,this.editingEnabled],()=>this.scheduleRender()),B.watch(()=>[this._effectiveVisibleElements,this._effectiveVisibleElements.columnDescriptions,this._effectiveVisibleElements.columnMenus,this._effectiveVisibleElements.columnMenuItems,this.columns.length],()=>{this.columns.forEach(a=>a.visibleElements=this._effectiveVisibleElements);this.refreshCellContent()},B.sync),B.watch(()=>this._effectiveVisibleElements.selectionColumn,a=>{this.grid&&
(this.grid.selectionColumnEnabled=a)},B.initial),B.on(()=>this.viewModel,"show-related-table",a=>this._onShowRelatedTable(a)),B.watch(()=>this.editingEnabled,()=>{const {attachmentsViewOptions:a}=this;this.clearPrompt();a&&(a.form?.reset(),a.candidates=null)})])}loadDependencies(){return Promise.all([V.loadCalciteComponents({action:()=>new Promise((a,b)=>t(["../chunks/calcite-action"],a,b)),alert:()=>new Promise((a,b)=>t(["../chunks/calcite-alert"],a,b)),button:()=>new Promise((a,b)=>t(["../chunks/calcite-button"],
a,b)),chip:()=>new Promise((a,b)=>t(["../chunks/calcite-chip"],a,b)),dropdown:()=>new Promise((a,b)=>t(["../chunks/calcite-dropdown"],a,b)),"dropdown-group":()=>new Promise((a,b)=>t(["../chunks/calcite-dropdown-group"],a,b)),"dropdown-item":()=>new Promise((a,b)=>t(["../chunks/calcite-dropdown-item"],a,b)),icon:()=>new Promise((a,b)=>t(["../chunks/calcite-icon"],a,b)),label:()=>new Promise((a,b)=>t(["../chunks/calcite-label"],a,b)),list:()=>new Promise((a,b)=>t(["../chunks/calcite-list"],a,b)),"list-item":()=>
new Promise((a,b)=>t(["../chunks/calcite-list-item"],a,b)),pagination:()=>new Promise((a,b)=>t(["../chunks/calcite-pagination"],a,b)),panel:()=>new Promise((a,b)=>t(["../chunks/calcite-panel"],a,b)),popover:()=>new Promise((a,b)=>t(["../chunks/calcite-popover"],a,b)),progress:()=>new Promise((a,b)=>t(["../chunks/calcite-progress"],a,b)),switch:()=>new Promise((a,b)=>t(["../chunks/calcite-switch"],a,b)),tooltip:()=>new Promise((a,b)=>t(["../chunks/calcite-tooltip"],a,b))}),O.loadPromptComponents(),
G.loadFieldColumnComponents()])}destroy(){this.drainRelatedTables();this.clearPrompt()}get _effectiveDescription(){const {description:a}=this;return null!=a?x.renderingSanitizer.sanitize("function"===typeof a?a():a):void 0}get _effectiveLayers(){const {layer:a,layers:b}=this;var f=b?.length?b.filter(G.isIFeatureTableSupportedLayer):[];f=f.length?f:[...this._viewLayers];a&&!f.includes(a)&&f.push(a);return f}get _effectiveTitle(){const {layer:a,messages:b,state:f,highlightIds:h,title:k,size:l}=this;
if(k)return x.renderingSanitizer.sanitize("function"===typeof k?k():k);if(!a)return b.noLayer;switch(f){case "disabled":return b.errorLayer;case "ready":case "loading":return b.loading;case "error":return b.errorData}return H.substitute(b.header,{title:x.renderingSanitizer.sanitize(a.title),count:l,selected:h.length})}get _effectiveVisibleElements(){return this.visibleElementsOverride??this.visibleElements}get _filteredTables(){const a=this.relatedTables.toArray(),b=1===a.length;return this.allRelatedTablesVisible?
a:b?[a[0]]:this._shouldShowAttachmentsView?a.slice(-1):a.slice(-2)}get _hasAttachmentsViewError(){return null!=this.attachmentsViewOptions.error}get _hasCustomMenuItems(){return!!this.menuConfig?.items?.length}get _hasDefaultMenuItems(){return!!(this._showClearSelectionAction||this._showDeleteSelectionAction||this._showExportSelectionToCSVAction||this._showRefreshDataAction||this._showZoomToSelectionAction||this._showSelectedRecordsShowSelectedAction||this._showSelectedRecordsShowAllAction||this._showColumnsVisibilityAction)}get _shouldShowGrid(){return this.allRelatedTablesVisible||
1===this.relatedTables.length&&!this._shouldShowAttachmentsView}get _shouldShowMenu(){const {header:a,menu:b}=this._effectiveVisibleElements;return!(!a||!b||!this._hasDefaultMenuItems&&!this._hasCustomMenuItems)}get _shouldShowAttachmentsView(){return!(null==this.attachmentsViewOptions.objectId&&!this.relatedTables.some(a=>null!=a.attachmentsViewOptions.objectId))}get _showClearSelectionAction(){return!(!this.highlightIds.length||!this._effectiveVisibleElements.menuItems?.clearSelection||this.relatedTables.length)}get _showColumnsVisibilityAction(){const {header:a,
menu:b,menuItems:f}=this._effectiveVisibleElements;return!(!(a&&b&&f?.toggleColumns)||this.showRelatedTableCallback||this.allRelatedTablesVisible||this._shouldShowAttachmentsView)}get _showDeleteSelectionAction(){return!(!(this.editingEnabled&&this.highlightIds.length&&this._effectiveVisibleElements.menuItems?.deleteSelection&&this.layer?.capabilities?.operations?.supportsDelete)||this.relatedTables.length)}get _showExportSelectionToCSVAction(){return!(!(this._effectiveVisibleElements.menuItems.exportSelectionToCSV&&
this.layer&&this.highlightIds.length)||this.relatedTables.length)}get _showLayerDropdown(){return!(!this._effectiveLayers.length||!this._effectiveVisibleElements.layerDropdown)}get _shouldShowNavigationBar(){const a=!!this.relatedTable||this._shouldShowAttachmentsView;return!this.tableParent&&a}get _showRefreshDataAction(){return!!this._effectiveVisibleElements.menuItems?.refreshData}get _showSelectedRecordsShowSelectedAction(){const a=this.objectIds.length,b=this.highlightIds.length;return!(!b||
!this._effectiveVisibleElements.menuItems?.selectedRecordsShowSelectedToggle||a&&b===a||this.relatedTables.length)}get _showSelectedRecordsShowAllAction(){return!(!this._effectiveVisibleElements.menuItems?.selectedRecordsShowAllToggle||!this.objectIds.length||this.relatedTables.length)}get _showZoomToSelectionAction(){return!(!this.view||!this.highlightIds.length||this.effectiveTable.layer?.isTable||!this._effectiveVisibleElements.menuItems?.zoomToSelection)}get _viewLayers(){const a=this.view?.map;
if(!a)return[];const b=new Set,f=k=>{!G.isIFeatureTableSupportedLayer(k)||J.isSubtypeGroupLayer(k)||b.has(k)||b.add(k)},h=k=>{S.isLayerFromCatalog(k)||"catalog-footprint"===k.type||(J.isKnowledgeGraphLayer(k)?(k.layers?.forEach(f),k.tables?.forEach(f)):G.isMapImageLayer(k)?(k.sublayers?.forEach(f),k.subtables?.forEach(f)):J.isSubtypeGroupLayer(k)?k.sublayers?.forEach(f):f(k))};a.allLayers.forEach(h);a.allTables.forEach(h);return[...b.values()]}get grid(){return this.viewModel.grid}get actionColumnConfig(){return this.viewModel.actionColumnConfig}set actionColumnConfig(a){this.viewModel.actionColumnConfig=
a}get activeFilters(){return this.viewModel.activeFilters}get activeSortOrders(){return this.viewModel.activeSortOrders}get allColumns(){return this.viewModel.allColumns}get allRelatedTablesVisible(){return this.viewModel.allRelatedTablesVisible}get attachmentsEnabled(){return this.viewModel.attachmentsEnabled}set attachmentsEnabled(a){this.viewModel.attachmentsEnabled=a}get attachmentsViewOptions(){return this.viewModel.attachmentsViewOptions}set attachmentsViewOptions(a){this.viewModel.attachmentsViewOptions=
a}get attributeTableTemplate(){return this.viewModel.attributeTableTemplate}set attributeTableTemplate(a){this.viewModel.attributeTableTemplate=a}get autoRefreshEnabled(){return this.viewModel.autoRefreshEnabled}set autoRefreshEnabled(a){this.viewModel.autoRefreshEnabled=a}get clearPrompt(){return this.viewModel.clearPrompt}set clearPrompt(a){this.viewModel.clearPrompt=a}get columnPerformanceModeEnabled(){return this.viewModel.columnPerformanceModeEnabled}set columnPerformanceModeEnabled(a){this.viewModel.columnPerformanceModeEnabled=
a}get columnReorderingEnabled(){return this.viewModel.columnReorderingEnabled}set columnReorderingEnabled(a){this.viewModel.columnReorderingEnabled=a}get columns(){return this.viewModel.columns}get editingEnabled(){return this.viewModel.editingEnabled}set editingEnabled(a){this.viewModel.editingEnabled=a}get effectiveSize(){return this.viewModel.effectiveSize}get effectiveTable(){return this.relatedTable||this}get filterGeometry(){return this.viewModel.filterGeometry}set filterGeometry(a){this.viewModel.filterGeometry=
a}get filterBySelectionEnabled(){return this.viewModel.filterBySelectionEnabled}set filterBySelectionEnabled(a){this.viewModel.filterBySelectionEnabled=a}get hiddenFields(){return this.viewModel.hiddenFields}set hiddenFields(a){this.viewModel.hiddenFields=a}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(a){this.viewModel.highlightEnabled=a}get highlightIds(){return this.viewModel.highlightIds}set highlightIds(a){this.viewModel.highlightIds=a}get icon(){return"table"}set icon(a){this._overrideIfSome("icon",
a)}get initialSize(){return this.viewModel.initialSize}set initialSize(a){this.viewModel.initialSize=a}get isQueryingOrSyncing(){return this.viewModel.isQueryingOrSyncing}get isSyncingAttachments(){return this.viewModel.isSyncingAttachments}get label(){return this.messages?.widgetLabel??""}set label(a){this._overrideIfSome("label",a)}get layer(){return this.viewModel.layer}set layer(a){this.viewModel.layer=a}get layerView(){return this.viewModel.layerView}get maxSize(){return this.viewModel.maxSize}set maxSize(a){this.viewModel.maxSize=
a}get messages(){return this.viewModel.messages}set messages(a){this.viewModel.messages=a}get messagesCommon(){return this.viewModel.messagesCommon}set messagesCommon(a){this.viewModel.messagesCommon=a}get messagesUnits(){return this.viewModel.messagesUnits}set messagesUnits(a){this.viewModel.messagesUnits=a}get messagesURIUtils(){return this.viewModel.messagesURIUtils}set messagesURIUtils(a){this.viewModel.messagesURIUtils=a}get multipleSelectionEnabled(){return this.viewModel.multipleSelectionEnabled}set multipleSelectionEnabled(a){this.viewModel.multipleSelectionEnabled=
a}get multiSortEnabled(){return this.viewModel.multiSortEnabled}set multiSortEnabled(a){this.viewModel.multiSortEnabled=a}get objectIds(){return this.viewModel.objectIds}set objectIds(a){this.viewModel.objectIds=a}get outFields(){return this.viewModel.outFields}set outFields(a){this.viewModel.outFields=a}get pageCount(){return this.viewModel.pageCount}get pageIndex(){return this.viewModel.pageIndex}set pageIndex(a){this.viewModel.pageIndex=a}get pageSize(){return this.viewModel.pageSize}set pageSize(a){this.viewModel.pageSize=
a}get paginationEnabled(){return this.viewModel.paginationEnabled}set paginationEnabled(a){this.viewModel.paginationEnabled=a}get prompt(){return this.viewModel.prompt}set prompt(a){this.viewModel.prompt=a}get relatedRecordsEnabled(){return this.viewModel.relatedRecordsEnabled}set relatedRecordsEnabled(a){this.viewModel.relatedRecordsEnabled=a}get relatedTable(){return this.viewModel.relatedTable}get relatedTables(){return this.viewModel.relatedTables}set relatedTables(a){this.viewModel.relatedTables=
a}get relationship(){return this.viewModel.relationship}get relationshipColumnConfigs(){return this.viewModel.relationshipColumnConfigs}set relationshipColumnConfigs(a){this.viewModel.relationshipColumnConfigs=a}get relationshipConfig(){return this.viewModel.relationshipConfig}set relationshipConfig(a){this.viewModel.relationshipConfig=a}get returnGeometryEnabled(){return this.viewModel.returnGeometryEnabled}set returnGeometryEnabled(a){this.viewModel.returnGeometryEnabled=a}get returnMEnabled(){return this.viewModel.returnMEnabled}set returnMEnabled(a){this.viewModel.returnMEnabled=
a}get returnZEnabled(){return this.viewModel.returnZEnabled}set returnZEnabled(a){this.viewModel.returnZEnabled=a}get rowHighlightIds(){return this.viewModel.rowHighlightIds}set rowHighlightIds(a){this.viewModel.rowHighlightIds=a}get selectionSource(){return this.viewModel.selectionSource}set selectionSource(a){this.viewModel.selectionSource=a}get showAllRelatedTables(){return this.viewModel.showAllRelatedTables}set showAllRelatedTables(a){this.viewModel.showAllRelatedTables=a}get showPrompt(){return this.viewModel.showPrompt}set showPrompt(a){this.viewModel.showPrompt=
a}get showRelatedTableCallback(){return this.viewModel.showRelatedTableCallback}set showRelatedTableCallback(a){this.viewModel.showRelatedTableCallback=a}get size(){return this.viewModel.size}get state(){return this.viewModel.state}get tableController(){return this.viewModel.tableController}set tableController(a){this.viewModel.tableController=a}get tableParent(){return this.viewModel.tableParent}set tableParent(a){this.viewModel.tableParent=a}get tableTemplate(){return this.viewModel.tableTemplate}set tableTemplate(a){this.viewModel.tableTemplate=
a}get tableTemplateOverride(){return this.viewModel.tableTemplateOverride}set tableTemplateOverride(a){this.viewModel.tableTemplateOverride=a}get timeExtent(){return this.viewModel.timeExtent}set timeExtent(a){this.viewModel.timeExtent=a}get timeZone(){return this.viewModel.timeZone}set timeZone(a){this.viewModel.timeZone=a}get view(){return this.viewModel.view}set view(a){this.viewModel.view=a}get visibleElementsOverride(){const {attachmentsViewOptions:a,relatedTable:b,tableController:f,visibleElements:h}=
this,{columnDescriptions:k,columnMenus:l,tooltips:p}=h,m=null!=a.objectId;if(b)return new F({columnDescriptions:k,columnMenus:l,tooltips:p,close:h.close,header:h.header,layerDropdown:h.layerDropdown,menu:h.menu,menuItems:h.menuItems,progress:h.progress,selectionColumn:!1,columnMenuItems:new K({sortAscending:!1,sortDescending:!1})});if(f){const q=f.relatedTable===this,n=f.allRelatedTablesVisible,r=q&&!n&&!m;return new F({columnDescriptions:k,columnMenus:l,tooltips:p,selectionColumn:q&&h.selectionColumn&&
!n&&!m,close:!1,header:!1,layerDropdown:!1,menu:!1,progress:!1,columnMenuItems:new K({sortAscending:r,sortDescending:r})})}return m?new F({columnDescriptions:k,columnMenus:l,tooltips:p,close:h.close,header:h.header,layerDropdown:h.layerDropdown,menu:h.menu,menuItems:h.menuItems,progress:h.progress,selectionColumn:!1,columnMenuItems:new K({sortAscending:!1,sortDescending:!1})}):null}clearSelectionFilter(){this.viewModel.clearSelectionFilter()}async deleteAttachments(a,b,f){null!=a&&b?.length&&(f?this._showDeleteAttachmentPrompt(a,
b):await this.viewModel.deleteAttachments(a,b))}deleteSelection(a){return this.highlightIds.length?a?(this._showDeletePrompt(),this.scheduleRender(),Promise.resolve()):this.viewModel.deleteSelection():Promise.resolve()}async downloadAttachmentById(a,b){return this.viewModel.downloadAttachmentById(a,b)}drainRelatedTables(){this.viewModel.drainRelatedTables()}exportSelectionToCSV(a){this.viewModel.exportSelectionToCSV(a)}filterBySelection(){this.viewModel.filterBySelection()}findColumn(a){return this.viewModel.findColumn(a)}goToPage(a){this.viewModel.goToPage(a)}hideColumn(a){this.grid?.hideColumn(a)}nextPage(){this.viewModel.nextPage()}previousPage(){this.viewModel.previousPage()}async refresh(){await this.viewModel.refresh()}refreshCellContent(){this.viewModel.refreshCellContent()}async saveAttachmentsViewForm(){await this.viewModel.saveAttachmentsViewForm()}showAllColumns(){this.viewModel.showAllColumns()}showColumn(a){this.grid?.showColumn(a)}sortColumn(a,
b){this.viewModel.sortColumn(a,b)}scrollLeft(){this.viewModel.scrollLeft()}scrollToBottom(){this.viewModel.scrollToBottom()}scrollToIndex(a){this.viewModel.scrollToIndex(a)}scrollToRow(a){this.viewModel.scrollToRow(a)}scrollToTop(){this.viewModel.scrollToTop()}toggleColumnVisibility(a){this.viewModel.toggleColumnVisibility(a)}zoomToSelection(){this.effectiveTable.viewModel.zoomToSelection()}render(){const {_effectiveVisibleElements:a,isQueryingOrSyncing:b,menuConfig:f,state:h}=this;return g.tsx("div",
{bind:this,class:this.classes("esri-feature-table",W.globalCss.widget)},g.tsx("calcite-panel",{bind:this,class:"esri-feature-table__content",closable:a.close,description:this._effectiveDescription,disabled:this.disabled||"disabled"===h&&!this._effectiveLayers?.length,heading:a.header?this._effectiveTitle:void 0,loading:"loading"===h,menuOpen:!!f?.open,overlayPositioning:"fixed",onCalcitePanelClose:k=>{k.target.closed=!1;this.emit("close")}},a.progress?g.tsx("calcite-progress",{type:b?"indeterminate":
"determinate"}):null,this._showLayerDropdown?this._renderLayerDropdown():null,this._renderColumnVisibilityAction(),this._renderHeaderMenuActions(),this._renderNavigationBar(),this._renderTables(),this._renderError()),this._renderPrompt())}_renderTables(){const {grid:a,relatedTables:b}=this,f=this.classes("esri-feature-table__table-container");if(b.length){const h=this.classes("esri-feature-table",this.allRelatedTablesVisible?"esri-feature-table__expanded":"esri-feature-table__collapsed",this._shouldShowAttachmentsView?
"esri-feature-table__table-container--attachments":void 0);return g.tsx("div",{class:f},g.tsx("calcite-panel",{overlayPositioning:"fixed"},g.tsx("div",null,[this._shouldShowGrid?g.tsx("div",{class:h},a?.render(),this._renderPagination()):void 0,...this._filteredTables.map(k=>{const l=b.indexOf(k);return g.tsx("div",{class:h,key:`related-${l}`},k.render())}),,])))}return null!=this.attachmentsViewOptions.objectId?g.tsx("div",{class:f},g.tsx("calcite-panel",{overlayPositioning:"fixed"},g.tsx("div",
null,[g.tsx("div",{class:this.classes("esri-feature-table","esri-feature-table__collapsed")},a?.render(),this._renderPagination()),this._renderAttachmentsView()]))):[g.tsx("div",{class:f},a?.render()),this._renderPagination()]}_renderPagination(){if(this.paginationEnabled)return g.tsx("calcite-pagination",{pageSize:1,startItem:this.pageIndex+1,totalItems:this.pageCount,onCalcitePaginationChange:a=>this.goToPage(a.target.startItem-1)})}_renderError(){const {messages:a}=this;return g.tsx("calcite-alert",
{autoClose:!0,autoCloseDuration:"fast",icon:"exclamation-mark-triangle",kind:"danger",label:a.errorOccured,open:this._hasAttachmentsViewError,slot:"alerts",onCalciteAlertClose:()=>{this.attachmentsViewOptions.error=null}},g.tsx("span",{slot:"message"},a.errorOccured))}_renderPrompt(){return this.prompt?g.tsx(O.Prompt,{...this.prompt,headingLevel:2}):void 0}_showDeletePrompt(){const {messages:a,messagesCommon:b}=this,f=H.substitute(a.deleteSelectionCount,{count:this.highlightIds.length});this.showPrompt({title:f,
message:a.deleteRecordsRemoved,context:"danger",actions:{primary:{label:b.delete,action:this._onDeleteSelectionClick},secondary:{label:a.keepRecords,action:()=>this.clearPrompt()}}})}_showDeleteAttachmentPrompt(a,b){const {messages:f,messagesCommon:h}=this,k=H.substitute(f.deleteAttachmentCount,{count:b.length});this.showPrompt({title:k,message:f.deleteAttachmentConfirmation,context:"danger",actions:{primary:{label:h.delete,action:async()=>{try{await this.deleteAttachments(a,b,!1)}finally{this.clearPrompt()}}},
secondary:{label:h.cancel,action:()=>this.clearPrompt()}}})}async _onDeleteSelectionClick(){try{await this.viewModel.deleteSelection()}finally{this.clearPrompt()}}_renderHeaderMenuAction(a){const {disabled:b,hidden:f,icon:h,text:k,clickFunction:l}=a;if(!f)return g.tsx("calcite-action",{disabled:b??this.menuConfig?.disabled,icon:h??void 0,key:k,onclick:()=>l(),slot:"header-menu-actions",text:k,textEnabled:!0,title:k})}_renderHeaderMenuActions(){return this._shouldShowMenu?[this._renderDefaultHeaderMenuActions(),
this._renderCustomHeaderMenuActions()]:[]}_renderDefaultHeaderMenuActions(){if(!this._hasDefaultMenuItems)return[];const {messages:a}=this;return[this._showRefreshDataAction&&{icon:"refresh",text:a.refreshData,clickFunction:()=>this.refresh()},this._showDeleteSelectionAction&&{icon:"trash",text:a.deleteSelection,clickFunction:()=>this.deleteSelection(!0)},this._showClearSelectionAction&&{icon:"clear-selection",text:a.clearSelection,clickFunction:()=>this.highlightIds?.removeAll()},this._showZoomToSelectionAction&&
{icon:"zoom-to-object",text:a.zoomToSelection,clickFunction:()=>this.zoomToSelection()},this._showSelectedRecordsShowSelectedAction&&{icon:"selection-filter",text:a.showSelected,clickFunction:()=>{const {objectIds:b}=this;b.removeAll();b.addMany(this.highlightIds.toArray())}},this._showSelectedRecordsShowAllAction&&{icon:"selection-x",text:a.showAllRecords,clickFunction:()=>this.objectIds.removeAll()},this._showExportSelectionToCSVAction&&{icon:"file-csv",text:a.exportSelectionCSV,clickFunction:()=>
this.exportSelectionToCSV()}].filter(Q.isSome).map(b=>b&&this._renderHeaderMenuAction(b))}_renderCustomHeaderMenuActions(){return this.menuConfig?.items?.map(({disabled:a,hidden:b,icon:f,label:h,clickFunction:k})=>this._renderHeaderMenuAction({hidden:"function"===typeof b?b():b,icon:f,text:h,disabled:a,clickFunction:l=>k(l)}))??[]}_renderColumnVisibilityAction(){if(!this._showColumnsVisibilityAction)return[];const {_columnVisibilityActions:a,_effectiveVisibleElements:b,effectiveTable:f,id:h,messages:k}=
this,l=f.columns.toArray(),p=k?.toggleColumns,m=[g.tsx("calcite-action",{afterCreate:q=>a.set(h,q),afterRemoved:()=>a.delete(h),appearance:"transparent",bind:this,disabled:f.menuConfig?.disabled,icon:"show-column",id:`${h}__toggle-columns-action`,slot:"header-actions-end",text:p},b.tooltips?g.tsx("calcite-tooltip",{closeOnClick:!0,overlayPositioning:"fixed",placement:"bottom-end",slot:"tooltip"},p):null)];f.menuConfig?.disabled||m.push(g.tsx("calcite-popover",{autoClose:!0,class:"esri-feature-table__menu-popover",
label:p,overlayPositioning:"fixed",placement:"top-end",pointerDisabled:!0,referenceElement:a.get(h)},g.tsx("calcite-list",{filterEnabled:!0,filterPlaceholder:k.toggleColumns,selectionMode:"multiple"},...l.map(q=>{const n="columns"in q&&q.columns?.length?q.columns.map(r=>this._renderColumnListItem({column:r,table:f,ignoreSelect:!0})):void 0;return this._renderColumnListItem({column:q,table:f,items:n})}))));return m}_renderColumnListItem(a){const {column:b,table:f,items:h,ignoreSelect:k}=a,{effectiveLabel:l,
fieldName:p,hidden:m}=b;return g.tsx("calcite-list-item",{key:`toggle-columns__item-${p}`,label:l,open:!(!h?.length||m)||void 0,selected:!m,value:p,onCalciteListItemSelect:q=>{k||f.toggleColumnVisibility(q.target.value)}},h)}_renderLayerDropdown(){const a=this.messages.selectALayer;return g.tsx("div",{class:"esri-feature-table__layer-switcher-menu",key:`${this.id}-layerDropdown`,slot:"header-actions-start"},g.tsx("calcite-dropdown",{bind:this,maxItems:5,overlayPositioning:"fixed",placement:"bottom-start"},
g.tsx("calcite-action",{icon:"layers",slot:"trigger",text:a,title:a}),g.tsx("calcite-dropdown-group",{selectionMode:"single"},this._effectiveLayers.map((b,f)=>this._renderLayerDropdownItem(b,f))??null)))}_renderLayerDropdownItem(a,b){return g.tsx("calcite-dropdown-item",{key:`dropdown-item-${b}`,label:a.title??"",selected:a===this.layer,value:a.id,onCalciteDropdownItemSelect:()=>{this.layer=a}},a.title)}_onRelatedNavigationItemClick(a){this.viewModel.drainRelatedTablesAboveIndex(a)}_collapseRelatedTable(a){this.viewModel.collapseRelatedTable(this.effectiveTable,
a)}_onShowRelatedTable(a){this.showRelatedTableCallback||(this._collapseRelatedTable(a),this._createRelatedTable(a))}async _createRelatedTable(a){const {editingEnabled:b,effectiveTable:f,paginationEnabled:h,pageSize:k,view:l,viewModel:p}=this,{layer:m,objectId:q,relatedLayer:n,relationshipId:r}=a;await m.load();a=this.attachmentsEnabled&&G.isIFeatureTableSupportedLayerWithAttachments(m);a=new L({layer:m,attachmentsEnabled:a,editingEnabled:b,paginationEnabled:h,pageSize:k,relatedRecordsEnabled:!0,
relationshipConfig:{objectId:q,relatedLayer:n,relationshipId:r},relationshipColumnConfigs:G.getRelationshipIdsToShow(m,r),tableController:this,tableParent:f,view:l,showRelatedTableCallback:u=>p.emit("show-related-table",u)});this.relatedTables.add(a);this.scheduleRender()}_renderAttachmentsView(){const {attachmentInfos:a,mode:b,objectId:f}=this.attachmentsViewOptions;return"file"!==b&&a.length&&null!=f?this._renderAttachmentsViewList():this._renderAttachmentsViewFilePane()}_renderAttachmentsViewFilePane(){const {attachmentsViewOptions:a,
isSyncingAttachments:b,messages:f,messagesUnits:h,viewModel:{supportsAddAttachments:k}}=this,{attachmentId:l,attachmentInfos:p,candidates:m,objectId:q}=a,n=p.find(y=>y.id===l);var r=p.length;const u=m?.length,w=n?g.tsx("calcite-label",{alignment:"center",key:"replace-file-node",scale:"l"},f.replaceFile):void 0,C=u?void 0:g.tsx("calcite-label",{alignment:"center",key:"message-node",scale:"m"},k?null==q?f.noFeature:f.dragAndDropToUpload:f.editingRestricted);var v=Array.from(m??[]).pop();v=v?g.tsx("calcite-label",
{key:"filename-node"},v.name):void 0;var z=k&&null!=q,A=z&&u;const D=g.tsx("input",{afterCreate:x.storeNode,afterRemoved:x.discardNode,afterUpdate:x.storeNode,bind:this,"data-node-ref":"_attachmentsInput",files:m,hidden:!0,name:"attachment",onchange:y=>this._onAttachmentsViewCandidateChange(y),type:"file"});z=z?g.tsx("calcite-button",{appearance:"outline-fill",bind:this,disabled:b,iconStart:"folder-open",key:"select-node",loading:!1,onclick:()=>{this._attachmentsInput?.click()},width:"full"},f.selectFile):
void 0;A=A?g.tsx("calcite-button",{appearance:"outline-fill",bind:this,disabled:b,iconStart:"save",key:"save-node",loading:b,onclick:()=>{this.saveAttachmentsViewForm()},width:"full"},n?f.updateAttachment:f.addAttachment):void 0;r=r||u?g.tsx("calcite-button",{appearance:"transparent",bind:this,disabled:b,key:"cancel-node",onclick:()=>{this._attachmentsInput&&(this._attachmentsInput.value="");a.reset();a.attachmentInfos?.length&&(a.mode="list")},width:"full"},this.messagesCommon.cancel):void 0;return[g.tsx("div",
{class:"esri-feature-table__attachments-view",key:"attachments-view"},g.tsx("div",{class:"esri-feature-table__attachments-view__content",key:"attachments-view-content"},g.tsx("div",{bind:this,class:"esri-feature-table__attachments-view__drop-area",ondragover:y=>y.preventDefault(),ondrop:this._onAttachmentsViewDrop},g.tsx("calcite-icon",{class:"esri-feature-table__attachments-view__icon",icon:"upload",scale:"l"}),w,C,g.tsx("form",{afterCreate:y=>a.form=y,afterRemoved:()=>a.form=null,bind:this,key:"attachments-form"},
g.tsx("fieldset",null,v,D,z,A,r)))),null!=q&&null!=n?g.tsx("div",{class:"esri-feature-table__attachments-view__information",key:"information"},this._renderAttachmentsViewThumbnail(n,200),g.tsx("label",{key:"file-label"},f.fileName),g.tsx("span",{key:"file-span"},n.name),g.tsx("label",{key:"size-label"},f.size),g.tsx("span",{key:"size-span"},M.formatFileSize(h,n.size??0))):void 0)]}_renderAttachmentsViewList(){const {attachmentsViewOptions:a,messages:b,messagesUnits:f,viewModel:{store:{syncingAttachmentEdits:h},
supportsDeleteAttachments:k,supportsUpdateAttachments:l}}=this,{attachmentInfos:p,objectId:m}=a;return g.tsx("calcite-list",{afterCreate:x.storeNode,afterRemoved:x.discardNode,afterUpdate:x.storeNode,bind:this,class:"esri-feature-table__attachments-view__list","data-node-ref":"attachmentsList",key:`attachments-list-${m}`,loading:h,ondragover:q=>q.preventDefault(),ondrop:this._onAttachmentsViewDrop,selectionMode:"multiple",onCalciteListChange:()=>this.scheduleRender()},...p?.map(q=>{const {id:n,name:r,
size:u,url:w}=q,C=M.formatFileSize(f,u??0);return g.tsx("calcite-list-item",{afterRemoved:()=>this.scheduleRender(),key:`attachment-${n}`,label:r,value:n},this._renderAttachmentsViewListThumbnail(q),g.tsx("span",{class:"esri-feature-table__attachments-view__list__filesize",slot:"actions-end",title:C},C),g.tsx("calcite-action",{appearance:"transparent",icon:"download-to",key:`download-attachment-${n}`,label:`${r}`,onclick:v=>{v.preventDefault();this.downloadAttachmentById(m??-1,n)},slot:"actions-end",
text:b.downloadAttachment,title:b.downloadAttachment}),l&&null!=m?g.tsx("calcite-action",{appearance:"transparent",disabled:!l,icon:"replace-image",key:`replace-attachment-${n}`,label:`${r}`,onclick:()=>{a.mode="file";a.attachmentId=n},slot:"actions-end",text:b.updateAttachment,title:b.updateAttachment}):void 0,g.tsx("calcite-action",{appearance:"transparent",icon:"launch",key:`launch-attachment-${n}`,label:`${r}`,onclick:()=>{w&&window.open(w,"_blank")},slot:"actions-end",text:b.viewAttachment,title:b.viewAttachment}),
k&&null!=m?g.tsx("calcite-action",{appearance:"transparent",class:"esri-feature-table__attachments-view__list-item--delete",disabled:!k,icon:"trash",key:`delete-attachment-${n}`,label:`${r}`,onclick:()=>{this.deleteAttachments(m,[n],!0)},slot:"actions-end",text:b.deleteAttachment,title:b.deleteAttachment}):void 0)}))}_renderAttachmentsViewListThumbnail(a){return g.tsx("div",{class:"esri-feature-table__attachments-view__list__thumbnail",slot:"content-start"},g.tsx("a",{href:a.url??"",rel:"noreferrer",
target:"_blank"},this._renderAttachmentsViewThumbnail(a)))}_renderAttachmentsViewThumbnail(a,b=64){const {contentType:f,name:h,size:k,url:l}=a;a=`${l}${l?.includes("?")?"\x26":"?"}w=${b}&s=${k}`;return this.viewModel.supportsResizeAttachments&&N.isSupportedImage(f)?g.tsx("img",{alt:h,key:`thumbnail-image-${h}`,src:a,title:h}):g.tsx("calcite-icon",{icon:N.getCalciteIconForAttachment(f),key:`thumbnail-icon-${h}`,scale:"l",textLabel:h,title:h})}_onAttachmentsViewCandidateChange({target:a}){this.attachmentsViewOptions.candidates=
a?.files}_onAttachmentsViewDrop(a){const {viewModel:b}=this;a.preventDefault();(b.supportsAddAttachments||b.supportsUpdateAttachments)&&this.attachmentsViewOptions.set({mode:"file",candidates:a.dataTransfer?.files})}_renderNavigationBar(){const {effectiveTable:a,messages:b,messagesCommon:f,relatedTable:h,relatedTables:k}=this;if(this._shouldShowNavigationBar){var {attachmentsList:l,attachmentsViewOptions:p,layer:m,viewModel:{supportsAddAttachments:q,supportsDeleteAttachments:n}}=a;if(m){var {attachmentInfos:r,
objectId:u}=p,w=null!=u,C=r.length,v=l?.selectedItems?.length??0,z=`${m.objectIdField}: ${u}`,A=H.substitute(b.selectedCount,{count:v}),D=H.substitute(b.attachmentsCount,{count:C});z=w?g.tsx("calcite-action",{bind:this,icon:"chevron-right",iconFlipRtl:!0,key:"navigation-feature",onclick:()=>a.scrollToRow(u),text:z,textEnabled:!0,title:z}):void 0;D=w?g.tsx("calcite-action",{icon:"chevron-right",iconFlipRtl:!0,key:"navigation-attachments-label",label:D,onclick:()=>{0<C&&(p.mode="list")},text:D,textEnabled:!0,
title:D}):void 0;A=w?g.tsx("calcite-chip",{closable:!0,closed:0===v,key:"navigation-chip",kind:"inverse",label:A,selected:!0,title:A,value:"selected",onCalciteChipClose:()=>l?.selectedItems?.forEach(E=>E.selected=!1)},A):void 0;var y=h?g.tsx("calcite-label",{layout:"inline"},b.showAllTables,g.tsx("calcite-switch",{checked:this.allRelatedTablesVisible,onCalciteSwitchChange:E=>this.showAllRelatedTables=!!E.target.checked})):void 0;v=w&&"list"===p.mode&&null!=u&&v&&n?g.tsx("calcite-action",{icon:"trash",
iconFlipRtl:!0,key:"attachments-trash-all",onclick:()=>{a.deleteAttachments(u,l?.selectedItems?.map(E=>E.value)??[],!0)},text:f.delete,textEnabled:!0,title:H.substitute(b.deleteAttachmentCount,{count:v})}):void 0;w=w&&"list"===p.mode&&q?g.tsx("calcite-action",{bind:this,icon:"plus",iconFlipRtl:!0,key:"attachments-add",onclick:()=>{p.attachmentId=null;p.mode="file"},text:b.addAttachment,textEnabled:!0,title:b.addAttachment}):void 0;return g.tsx("div",{class:"esri-feature-table__table-navigation",key:"table-nav"},
g.tsx("calcite-action",{icon:"move-up",iconFlipRtl:!0,key:"go-back",onclick:()=>{h&&this.drainRelatedTables();a.attachmentsViewOptions.objectId=null},text:this.layer?.title??"",textEnabled:!1,title:h?b.exitRelatedRecords:b.exitAttachments}),k.toArray().map((E,Y)=>this._renderRelatedTableNavigationAction(E,Y)),z,D,g.tsx("div",null,A,y,v,w))}}}_renderRelatedTableNavigationAction(a,b){const f=this._getLabelForRelatedTableNavigationAction(a);return g.tsx("calcite-action",{icon:"chevron-right",iconFlipRtl:!0,
key:b,onclick:()=>this._onRelatedNavigationItemClick(b),text:f,textEnabled:!0,title:a.layer?.title||""})}_getLabelForRelatedTableNavigationAction(a){const b=a.layer?.title;if(!b)return"";const {relatedTables:f}=this;return 1>=f.length?b:f.indexOf(a)!==f.length-1&&20<b.length?`${b.slice(0,20)}...`:b}};d.__decorate([e.property()],c.prototype,"_attachmentsInput",void 0);d.__decorate([e.property()],c.prototype,"_columnVisibilityActions",void 0);d.__decorate([e.property()],c.prototype,"_effectiveDescription",
null);d.__decorate([e.property()],c.prototype,"_effectiveLayers",null);d.__decorate([e.property()],c.prototype,"_effectiveTitle",null);d.__decorate([e.property()],c.prototype,"_effectiveVisibleElements",null);d.__decorate([e.property()],c.prototype,"_filteredTables",null);d.__decorate([e.property()],c.prototype,"_hasAttachmentsViewError",null);d.__decorate([e.property()],c.prototype,"_hasCustomMenuItems",null);d.__decorate([e.property()],c.prototype,"_hasDefaultMenuItems",null);d.__decorate([e.property()],
c.prototype,"_shouldShowGrid",null);d.__decorate([e.property()],c.prototype,"_shouldShowMenu",null);d.__decorate([e.property()],c.prototype,"_shouldShowAttachmentsView",null);d.__decorate([e.property()],c.prototype,"_showClearSelectionAction",null);d.__decorate([e.property()],c.prototype,"_showColumnsVisibilityAction",null);d.__decorate([e.property()],c.prototype,"_showDeleteSelectionAction",null);d.__decorate([e.property()],c.prototype,"_showExportSelectionToCSVAction",null);d.__decorate([e.property()],
c.prototype,"_showLayerDropdown",null);d.__decorate([e.property()],c.prototype,"_shouldShowNavigationBar",null);d.__decorate([e.property()],c.prototype,"_showRefreshDataAction",null);d.__decorate([e.property()],c.prototype,"_showSelectedRecordsShowSelectedAction",null);d.__decorate([e.property()],c.prototype,"_showSelectedRecordsShowAllAction",null);d.__decorate([e.property()],c.prototype,"_showZoomToSelectionAction",null);d.__decorate([e.property()],c.prototype,"_viewLayers",null);d.__decorate([e.property()],
c.prototype,"attachmentsList",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"grid",null);d.__decorate([e.property()],c.prototype,"actionColumnConfig",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"activeFilters",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"activeSortOrders",null);d.__decorate([e.property()],c.prototype,"allColumns",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"allRelatedTablesVisible",null);d.__decorate([e.property()],c.prototype,
"attachmentsEnabled",null);d.__decorate([e.property()],c.prototype,"attachmentsViewOptions",null);d.__decorate([e.property({type:T})],c.prototype,"attributeTableTemplate",null);d.__decorate([e.property()],c.prototype,"autoRefreshEnabled",null);d.__decorate([e.property()],c.prototype,"clearPrompt",null);d.__decorate([e.property()],c.prototype,"columnPerformanceModeEnabled",null);d.__decorate([e.property()],c.prototype,"columnReorderingEnabled",null);d.__decorate([e.property({readOnly:!0})],c.prototype,
"columns",null);d.__decorate([e.property()],c.prototype,"description",void 0);d.__decorate([e.property()],c.prototype,"disabled",void 0);d.__decorate([e.property()],c.prototype,"editingEnabled",null);d.__decorate([e.property()],c.prototype,"effectiveSize",null);d.__decorate([e.property()],c.prototype,"effectiveTable",null);d.__decorate([e.property()],c.prototype,"filterGeometry",null);d.__decorate([e.property()],c.prototype,"filterBySelectionEnabled",null);d.__decorate([e.property()],c.prototype,
"hiddenFields",null);d.__decorate([e.property()],c.prototype,"highlightEnabled",null);d.__decorate([e.property()],c.prototype,"highlightIds",null);d.__decorate([e.property()],c.prototype,"icon",null);d.__decorate([e.property()],c.prototype,"initialSize",null);d.__decorate([e.property()],c.prototype,"isQueryingOrSyncing",null);d.__decorate([e.property()],c.prototype,"isSyncingAttachments",null);d.__decorate([e.property()],c.prototype,"label",null);d.__decorate([e.property()],c.prototype,"layer",null);
d.__decorate([e.property()],c.prototype,"layers",void 0);d.__decorate([e.property()],c.prototype,"layerView",null);d.__decorate([e.property()],c.prototype,"maxSize",null);d.__decorate([e.property(),I.messageBundle("esri/widgets/FeatureTable/t9n/FeatureTable")],c.prototype,"messages",null);d.__decorate([e.property(),I.messageBundle("esri/t9n/common")],c.prototype,"messagesCommon",null);d.__decorate([e.property(),I.messageBundle("esri/core/t9n/Units")],c.prototype,"messagesUnits",null);d.__decorate([e.property(),
I.messageBundle("esri/widgets/support/t9n/uriUtils")],c.prototype,"messagesURIUtils",null);d.__decorate([e.property()],c.prototype,"menuConfig",void 0);d.__decorate([e.property()],c.prototype,"multipleSelectionEnabled",null);d.__decorate([e.property()],c.prototype,"multiSortEnabled",null);d.__decorate([e.property()],c.prototype,"objectIds",null);d.__decorate([e.property()],c.prototype,"outFields",null);d.__decorate([e.property()],c.prototype,"pageCount",null);d.__decorate([e.property()],c.prototype,
"pageIndex",null);d.__decorate([e.property()],c.prototype,"pageSize",null);d.__decorate([e.property()],c.prototype,"paginationEnabled",null);d.__decorate([e.property()],c.prototype,"prompt",null);d.__decorate([e.property()],c.prototype,"relatedRecordsEnabled",null);d.__decorate([e.property()],c.prototype,"relatedTable",null);d.__decorate([e.property()],c.prototype,"relatedTables",null);d.__decorate([e.property()],c.prototype,"relationship",null);d.__decorate([e.property()],c.prototype,"relationshipColumnConfigs",
null);d.__decorate([e.property()],c.prototype,"relationshipConfig",null);d.__decorate([e.property()],c.prototype,"returnGeometryEnabled",null);d.__decorate([e.property()],c.prototype,"returnMEnabled",null);d.__decorate([e.property()],c.prototype,"returnZEnabled",null);d.__decorate([e.property()],c.prototype,"rowHighlightIds",null);d.__decorate([e.property()],c.prototype,"selectionSource",null);d.__decorate([e.property()],c.prototype,"showAllRelatedTables",null);d.__decorate([e.property()],c.prototype,
"showPrompt",null);d.__decorate([e.property()],c.prototype,"showRelatedTableCallback",null);d.__decorate([e.property()],c.prototype,"size",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"state",null);d.__decorate([e.property({constructOnly:!0})],c.prototype,"tableController",null);d.__decorate([e.property({constructOnly:!0})],c.prototype,"tableParent",null);d.__decorate([e.property()],c.prototype,"tableTemplate",null);d.__decorate([e.property()],c.prototype,"tableTemplateOverride",null);
d.__decorate([e.property()],c.prototype,"title",void 0);d.__decorate([e.property()],c.prototype,"timeExtent",null);d.__decorate([e.property()],c.prototype,"timeZone",null);d.__decorate([e.property()],c.prototype,"view",null);d.__decorate([e.property({type:P}),X.vmEvent("cell-click cell-dblclick cell-pointerover cell-pointerout cell-keydown column-reorder show-related-table".split(" "))],c.prototype,"viewModel",void 0);d.__decorate([e.property({type:F,nonNullable:!0})],c.prototype,"visibleElements",
void 0);d.__decorate([e.property({type:F})],c.prototype,"visibleElementsOverride",null);return c=L=d.__decorate([R.subclass("esri.widgets.FeatureTable")],c)});