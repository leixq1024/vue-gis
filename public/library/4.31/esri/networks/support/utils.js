// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("require exports ../../request ../../core/Error ../../layers/support/featureQueryAll ../../portal/PortalItem ../../rest/support/FeatureSet".split(" "),function(n,g,p,q,r,l,t){async function m(a,b){return"Utility Network Layer"===a?({default:a}=await new Promise((e,h)=>n(["../UtilityNetwork"],k=>e(Object.freeze(Object.defineProperty({__proto__:null,default:k},Symbol.toStringTag,{value:"Module"}))),h)),new a({layerUrl:b})):null}g.getFeaturesFromLayers=async function(a,b){const e=a.layers,h=a.layerInfos,
k=a.returnGeometry||!1,u=a.outSpatialReference;await Promise.all(e.map(async c=>{await c.load()}));return(await Promise.all(e.map(async c=>{var f=h.find(v=>v.layerUrl===c.parsedUrl?.path);if(!f?.objectIds?.length)return{layer:c,featureSet:void 0};const d=c.createQuery();d.returnGeometry=k;d.outFields=f.outFields||["*"];d.outSpatialReference=u;d.gdbVersion=c.gdbVersion;d.objectIds=f.objectIds;b&&(d.where="1\x3d1");f=t.fromJSON(await r.queryAllJSON(c,d));return{layer:c,featureSet:f}}))).filter(c=>void 0!==
c.featureSet)};g.networkFromPortalItem=async function(a){a="portalItem"in a?a:{portalItem:a};!a.portalItem||a.portalItem instanceof l||(a={...a,portalItem:new l(a.portalItem)});a=a.portalItem;await a.load();if("Feature Service"!==a.type)throw new q("portal:unknown-item-type","Unknown item type '${type}'",{type:a.type});a=a.url;var b=await p(a,{responseType:"json",query:{f:"json"}});return b.data.type?.includes("Network Layer")?m(b.data.type,a):b.data.layers&&(b=b.data.layers.find(e=>e.type.includes("Network Layer")))?
m(b.type,`${a}/${b.id}`):null};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});