// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../renderers/PointCloudClassBreaksRenderer ../../renderers/PointCloudRenderer ../../renderers/PointCloudRGBRenderer ../../renderers/PointCloudStretchRenderer ../../renderers/PointCloudUniqueValueRenderer ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../core/Logger ../../core/colorUtils ../../core/Error ../../core/lang ../../intl/messages ../../layers/support/fieldUtils ../../renderers/support/RendererLegendOptions ../../renderers/support/utils ../../renderers/support/pointCloud/ColorUniqueValueInfo ../heuristics/outline ../heuristics/sizeRange ./support/regenerateUtils ./support/utils ../statistics/uniqueValues ../support/binningUtils ../support/utils ../support/adapters/support/layerUtils ../symbology/type".split(" "),
function(y,ia,ja,ka,la,T,ma,na,oa,pa,qa,ra,sa,U,ta,ua,V,r,I,W,J,X,z,Y,K,L,t,k,M,Z,A,v,F){async function N(a){if(!a?.layer||!a.field&&!a.valueExpression)throw new r("type-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(a.valueExpression&&!a.view)throw new r("type-renderer:missing-parameters","View is required when 'valueExpression' is specified");a.forBinning&&Z.verifyBinningParams(a,"type-renderer");const b={...a,layer:a.layer};b.symbolType=b.symbolType||
"2d";b.defaultSymbolEnabled??(b.defaultSymbolEnabled=!0);b.sortBy??(b.sortBy="count");b.sortEnabled??(b.sortEnabled=!0);b.statistics=I.clone(b.statistics);const c=null==b.numTypes?10:b.numTypes;var d=a.forBinning?v.binningCapableLayerTypes:v.featureCapableLayerTypes;a=v.createLayerAdapter(b.layer,d,a.forBinning);if(!a)throw new r("type-renderer:invalid-parameters","'layer' must be one of these types: "+v.getLayerTypeLabels(d).join(", "));await a.load(null!=b.signal?{signal:b.signal}:null);d=a.geometryType;
b.outlineOptimizationEnabled="polygon"===d?b.outlineOptimizationEnabled:!1;b.sizeOptimizationEnabled="point"===d||"multipoint"===d||"polyline"===d?b.sizeOptimizationEnabled:!1;if("mesh"===d)b.symbolType="3d-volumetric",b.colorMixMode=b.colorMixMode||"replace",b.edgesType=b.edgesType||"none";else{if("3d-volumetric-uniform"===b.symbolType&&"point"!==d)throw new r("type-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(b.symbolType.includes("3d-volumetric")&&
(!b.view||"3d"!==b.view.type))throw new r("type-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'");}d=await A.getFieldsList({field:b.field,field2:b.field2,field3:b.field3,valueExpression:b.valueExpression});if(d=k.verifyBasicFieldValidity(a,d,"type-renderer:invalid-parameters"))throw d;return{...b,layer:a,numTypes:c}}async function aa(a){await t.processRegenerateParams(a,"regenerate-type-renderer");
const b=await t.getRendererToUpdate(a);var c=t.getStyleType(b);if(!c||!["type","type-size"].includes(c))throw new r("regenerate-type-renderer:invalid-parameters","Renderer is invalid");const {field:d,field2:g,field3:h,valueExpression:l,valueExpressionTitle:m}=b;c=b.uniqueValueInfos.length;const {layer:e,forBinning:n,filter:p,view:G,signal:u}=a,B=t.hasOutlineVV(b),C=t.hasScaleDependentSizeVV(b);c=await N({layer:e,field:d,field2:g,field3:h,valueExpression:l,valueExpressionTitle:m,numTypes:c,outlineOptimizationEnabled:B,
sizeOptimizationEnabled:C,forBinning:n,filter:p,view:G,signal:u});return{...a,creatorParameters:c,renderer:b}}async function ba(a){if(!a?.layer||!a.field)throw new r("type-point-cloud-class-renderer:missing-parameters","'layer' and 'field' parameters are required");a={...a,layer:a.layer};a.statistics=I.clone(a.statistics);var b=[v.LayerType.PointCloudLayer],c=v.createLayerAdapter(a.layer,b);if(!c)throw new r("type-point-cloud-class-renderer:invalid-parameters","'layer' must be one of these types: "+
v.getLayerTypeLabels(b).join(", "));a.layer=c;a.density=a.density||25;a.size=a.size||"100%";if(!k.isValidPointSize(a.size))throw new r("type-point-cloud-class-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'");await c.load(null!=a.signal?{signal:a.signal}:null);b=await A.getFieldsList({field:a.field});if(c=k.verifyBasicFieldValidity(c,b,"type-point-cloud-class-renderer:invalid-parameters"))throw c;return a}async function O(a){let b=a.typeScheme,c=null;
var d=null;d=await k.getBasemapInfo(a.basemap,a.view);c=null!=d.basemapId?d.basemapId:null;d=null!=d.basemapTheme?d.basemapTheme:null;if(b)return{scheme:F.cloneScheme(b),basemapId:c,basemapTheme:d};if(a=F.getSchemes({numColors:a.numColors,basemapTheme:d,geometryType:a.geometryType,theme:a.theme,worldScale:a.worldScale,view:a.view}))b=a.primaryScheme,c=a.basemapId,d=a.basemapTheme;return{scheme:b,basemapId:c,basemapTheme:d}}function P(a,b){return a.label<b.label?-1:a.label>b.label?1:0}function Q(a,
b){return a.value<b.value?-1:a.value>b.value?1:0}function ca(a,b){let c=b.count-a.count;0===c&&(c=P(a,b));return c}function da(a,b){let c=b.count-a.count;0===c&&(c=Q(a,b));return c}function R(a,b,c){let d;"count"===b?(d=da,c&&"codedValues"in c&&c.codedValues&&(d=ca)):"value"===b&&(d=Q,c&&"codedValues"in c&&c.codedValues&&(d=P));d&&a.sort(d)}async function ea(a,b,c,d){var g=await W.fetchMessageBundle("esri/smartMapping/t9n/smartMapping");const {field:h,field2:l,field3:m}=b;a=a.uniqueValueInfos;var e=
b.layer,n=h?e.getField(h):null,p=n?e.getFieldDomain(n.name):null;const G=-1===b.numTypes?a.length:b.numTypes,u=e.geometryType;e=new U({field:h,field2:l,field3:m,fieldDelimiter:h&&l?A.fieldDelimiter:null});const B=[],C=[],w={value:null,domain:p,fieldInfo:n};a.forEach((f,H)=>{w.value=f.value;f.label=z.createUniqueValueLabel(w);f=f.value;(null===f||"string"===typeof f&&f.toLowerCase().includes("\x3cnull\x3e"))&&B.unshift(H)});for(var x of B)C.unshift(a.splice(x,1)[0]);!1!==b.sortEnabled&&R(a,b.sortBy,
p);fa(w,b,a);p=c?.opacity;x=await O({numColors:a.length,basemap:b.basemap,geometryType:u,typeScheme:b.typeScheme,worldScale:!!b.symbolType?.includes("3d-volumetric"),view:b.view});n=x.scheme;const S=n.colors.map(f=>f.clone()),D=k.getSymbolSizeFromScheme(n,u),E=k.getSymbolOutlineFromScheme(n,u,p);a.forEach((f,H)=>{w.value=f.value;f.label=z.createUniqueValueLabel(w);f.symbol=k.createSymbol(u,{type:b.symbolType,color:S[H],size:D,outline:E,meshInfo:{colorMixMode:b.colorMixMode,edgesType:b.edgesType}})});
b.valueExpression&&(e.valueExpression=b.valueExpression,e.valueExpressionTitle=b.valueExpressionTitle);b.legendOptions&&(e.legendOptions=new X(b.legendOptions));for(p=0;p<G;p++){const f=a[p];f&&e.addUniqueValueInfo({value:f.value,label:f.label,symbol:k.createSymbol(u,{type:b.symbolType,color:S[p].clone(),size:D,outline:E,meshInfo:{colorMixMode:b.colorMixMode,edgesType:b.edgesType}})})}b.defaultSymbolEnabled&&(e.defaultSymbol=k.createSymbol(u,{type:b.symbolType,color:n.noDataColor,size:D,outline:E,
meshInfo:{colorMixMode:b.colorMixMode,edgesType:b.edgesType}}),e.defaultLabel=g.other);for(var q of C)q.symbol=k.createSymbol(u,{type:b.symbolType,color:n.noDataColor,size:D,outline:E,meshInfo:{colorMixMode:b.colorMixMode,edgesType:b.edgesType}}),a.push(q);g=[];q=e.uniqueValueInfos?.length??0;q=q===a.length?-1:q;if(-1<q)for(;q<a.length;q++)g.push({...a[q]});c?.visualVariables?.length&&(e.visualVariables=c.visualVariables.map(f=>f.clone()));d?.minSize&&(e.visualVariables?e.visualVariables.push(d.minSize):
e.visualVariables=[d.minSize]);return{renderer:e,uniqueValueInfos:a,excludedUniqueValueInfos:g,typeScheme:F.cloneScheme(n),basemapId:x.basemapId,basemapTheme:x.basemapTheme}}function fa(a,b,c){const {field:d,numTypes:g,layer:h,view:l}=b;(b=d?h.getField(d):null)&&(A.isAnyDateField(b)||J.isTimeOnlyField(b))&&(c=c.filter((m,e)=>e<g).map(m=>m.value),c=J.isTimeOnlyField(b)?null:z.calculateDateFormatInterval(c),a.dateFormatOptions={fieldType:b.type,format:c?z.dateFormatIntervalOptions[c]:void 0},l&&(b=
h.layer,a.dateFormatOptions.timeZoneOptions={layerTimeZone:"preferredTimeZone"in b?b.preferredTimeZone:null,viewTimeZone:l.timeZone,datesInUnknownTimezone:"datesInUnknownTimezone"in b&&b.datesInUnknownTimezone}))}async function ha(a,b){a=a.uniqueValueInfos;b=(await O({numColors:a.length,basemap:"gray",theme:"point-cloud-class",geometryType:"point",typeScheme:b}))?.scheme;const c="point-cloud-class"===b?.theme,d=c?b.colors:V.createUniqueColors(b?.colors??[],a.length);R(a,"value");return a.map((g,h)=>
{const l=g.value;let m=null;c?(m=d[l])||(m=d[d.length-1]):m=d[h];return new Y({values:[l],color:m,label:g.label})})}y.createPCClassRenderer=async function(a){a=await ba(a);const b=null!=a.statistics?a.statistics:await M({layer:a.layer,field:a.field,signal:a.signal});return{renderer:new T({field:a.field,pointsPerInch:a.density??void 0,pointSizeAlgorithm:k.getPointSizeAlgorithm(a.size),colorUniqueValueInfos:await ha(b,a.typeScheme)})}};y.createRenderer=async function(a){a=await N(a);const {layer:b,
view:c,signal:d,filter:g}=a,h={layer:b,field:a.field,field2:a.field2,field3:a.field3,valueExpression:a.valueExpression,returnAllCodedValues:a.returnAllCodedValues,view:c,filter:g,signal:d},[l,m,e]=await Promise.all([null!=a.statistics?a.statistics:M(h),a.outlineOptimizationEnabled?K({layer:b,view:c,signal:d,filter:g}).catch(k.errorCallback):null,a.sizeOptimizationEnabled?L({layer:b,view:c,signal:d,filter:g}).catch(k.errorCallback):null]);return ea(l,a,m,e)};y.regenerateRenderer=async function(a){const {creatorParameters:b,
view:c,signal:d,filter:g,renderer:h}=await aa(a),{layer:l,outlineOptimizationEnabled:m,sizeOptimizationEnabled:e}=b,[n,p]=await Promise.all([m?K({layer:l,view:c,signal:d,filter:g}).catch(k.errorCallback):null,e?L({layer:l,view:c,signal:d,filter:g}).catch(k.errorCallback):null]);t.spliceVisualVariables(h,n?.visualVariables,t.findOutlineVVIndex);t.spliceVisualVariables(h,p?.minSize,t.findScaleDependentSizeVVIndex);return{renderer:h}};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});