// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../Color ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../core/Logger ../../core/colorUtils ../../core/Error ../../renderers/support/AuthoringInfo ../../renderers/support/HeatmapColorStop ../../renderers/support/heatmapUtils ./support/utils ../statistics/heatmapStatistics ../support/utils ../support/adapters/support/layerUtils ../symbology/heatmap".split(" "),
function(l,m,S,T,U,E,V,W,X,Y,Z,aa,F,t,u,h,G,v,H,I,e,n){async function J(a){if(!a?.layer||!a.view)throw new t("heatmap-renderer:missing-parameters","'layer' and 'view' parameters are required");a={...a,layer:a.layer,view:a.view};a.radius??(a.radius=null==a.blurRadius?18:G.gaussianBlurRadiusPxToKernelDensityRadiusPt(a.blurRadius));a.minRatio??(a.minRatio=.01);a.maxRatio??(a.maxRatio=1);a.fadeRatio??(a.fadeRatio=.2);a.fadeToTransparent??(a.fadeToTransparent=!0);var b=[e.LayerType.CSVLayer,e.LayerType.FeatureLayer,
e.LayerType.GeoJSONLayer,e.LayerType.KnowledgeGraphSublayer,e.LayerType.OGCFeatureLayer,e.LayerType.OrientedImageryLayer,e.LayerType.StreamLayer,e.LayerType.WFSLayer],d=e.createLayerAdapter(a.layer,b);if(!d)throw new t("heatmap-renderer:invalid-parameters","'layer' must be one of these types: "+e.getLayerTypeLabels(b).join(", "));a.layer=d;await d.load(null!=a.signal?{signal:a.signal}:null);b=await I.getFieldsList({field:a.field});if(d=v.verifyBasicFieldValidity(d,b,"heatmap-renderer:invalid-parameters"))throw d;
return a}async function K(a){let b=a.scheme,d=null;var c=null;c=await v.getBasemapInfo(a.basemap,a.view);d=null!=c.basemapId?c.basemapId:null;c=null!=c.basemapTheme?c.basemapTheme:null;if(b)return{scheme:n.cloneScheme(b),basemapId:d,basemapTheme:c};if(a=n.getSchemes({basemapTheme:c}))b=a.primaryScheme,d=a.basemapId,c=a.basemapTheme;return{scheme:b,basemapId:d,basemapTheme:c}}async function L(a,b){const {field:d,basemap:c,radius:k,fadeToTransparent:g,heatmapScheme:f,view:M}=b,{scheme:w,basemapId:N,
basemapTheme:O}=await K({basemap:c,scheme:f,view:M}),p=w.colors,x=p.length,y=null==a.min,z=y?[0,.04]:[a.min,a.max];let A;const B=b.fadeRatio??0,q=b.minRatio??0,P=((b.maxRatio??0)-q)/(x-1);b=p[0];const C=g?q:.01,r=[new h({ratio:0,color:new m([b.r,b.g,b.b,0])}),new h({ratio:.01,color:new m([b.r,b.g,b.b,0])}),new h({ratio:C,color:new m([b.r,b.g,b.b,C])})];F.createUniqueColors(p,x).forEach((Q,R)=>{r.push(new h({ratio:q+P*R,color:Q}))});g&&(D(r,B),A=new u({fadeRatio:B}));return{renderer:new E({authoringInfo:A,
radius:k,colorStops:r,field:d,minDensity:z[0],maxDensity:z[1]}),statistics:a,defaultValuesUsed:y,scheme:n.cloneScheme(w),basemapId:N,basemapTheme:O}}function D(a,b){const d=10*(1-b)+1,c=a.length-3,k=a[2].color.a;a.forEach((g,f)=>{2>=f||({color:g}=g,f=(f-3)/c,g.a=0===b?1:Math.min(Math.max(f*d+f+k,k),1))})}l.createRenderer=async function(a){a=await J(a);const b=a.statistics??await H({layer:a.layer,field:a.field,radius:a.radius,view:a.view,filter:a.filter,signal:a.signal});return L(b,a)};l.updateRenderer=
function(a){const {fadeRatio:b,renderer:d}=a;a=d.clone();const c=null==b?a?.authoringInfo?.fadeRatio||0:b;D(a.colorStops,c);a.authoringInfo?a.authoringInfo.fadeRatio=c:a.authoringInfo=new u({fadeRatio:c});return a};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});