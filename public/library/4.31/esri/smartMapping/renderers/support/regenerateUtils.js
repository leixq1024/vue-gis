// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/Error"],function(d,l){function g(a,b,c){return a?.authoringInfo?.visualVariables?.find(e=>"reference-size"===c?e.type===b&&"reference-size"===e.theme:e.type===b)}function n(a){return"color"===a.type}function t(a){return"opacity"===a.type}function p(a){return"size"===a.type&&"outline"!==a.target&&"$view.scale"!==a.valueExpression}function q(a){return"size"===a.type&&"outline"===a.target}function r(a){return"size"===a.type&&"$view.scale"===a.valueExpression&&"outline"!==
a.target&&Array.isArray(a.stops)}d.findColorVVIndex=function(a){return a?.findIndex(n)??-1};d.findOpacityVVIndex=function(a){return a?.findIndex(t)??-1};d.findOutlineVVIndex=function(a){return a?.findIndex(q)??-1};d.findScaleDependentSizeVVIndex=function(a){return a?.findIndex(r)??-1};d.findSizeVVIndex=function(a){return a?.findIndex(p)??-1};d.getAuthoringInfoVisualVariable=g;d.getRendererToUpdate=async function(a){const {layer:b,forBinning:c,renderer:e}=a;await b.load();a="featureReduction"in b?
b.featureReduction:null;a=e?.clone()??(c&&"binning"===a?.type?a?.renderer?.clone():"renderer"in b?b.renderer?.clone():null);if(!a)throw new l("get-renderer-to-update:invalid-parameters","renderer not available");return a};d.getStyleType=function(a){if(!a)return null;const b=a.type;var c="visualVariables"in a?a.visualVariables:null;const e=c?.find(n);c=c?.find(p);const f=a.authoringInfo,m=g(a,"color"),h=g(a,"size"),k=g(a,"size","reference-size");if("class-breaks"===b){if("univariate-color-size"===
f?.type)return"univariate-color-size";if(e)return c?h?.units?"color-size-age":m?.units?"color-age-size":"color-size":m?.units?"color-age":k?"color-size":"color-continuous";if(c)return h?.units?"size-age":"size-continuous";if(1<a.classBreakInfos.length)return"class-breaks-color"===f?.type?"color-class-breaks":"class-breaks-size"===f?.type?"size-class-breaks":null;if(k)return"size-continuous"}return"unique-value"===b?a.valueExpression?"predominance"===f?.type?"predominance":"relationship"===f?.type?
c||k?"relationship-size":"relationship":c||k?"type-size":"type":c?h?.units?"type-size-age":"type-size":k?"type-size":"type":"pie-chart"===b?"pie-chart":"dot-density"===b?"dot-density":null};d.hasOutlineVV=function(a){return!!a.visualVariables?.some(q)};d.hasScaleDependentSizeVV=function(a){return!!a.visualVariables?.some(r)};d.isColorVV=n;d.isOpacityVV=t;d.isOutlineVV=q;d.isScaleDependentSizeVV=r;d.isSizeVV=p;d.processRegenerateParams=async function(a,b){const {layer:c,view:e,forBinning:f,filter:m}=
a;if(!c||!e)throw new l(`${b}:missing-parameters`,"'layer' and 'view' parameters are required");await c.load();const h="featureReduction"in c?c.featureReduction:null;if(f){if("binning"!==h?.type)throw new l(`${b}:invalid-parameters`,"'layer' must have 'featureReduction' property defined with 'binning' type when 'forBinning' parameter is true");if(m)throw new l(`${b}:invalid-parameters`,"'filter' parameter is not supported when 'forBinning' parameter is true");}return a};d.spliceVisualVariables=function(a,
b,c){const e=a.visualVariables;c=c(e);!b||Array.isArray(b)&&!b.length||(Array.isArray(b)||(b=[b]),b=b.map(f=>f.clone()),e?-1<c?e.splice(c,1,...b):e.push(...b):a.visualVariables=b)};d.updateAuthoringInfoVisualVariable=function(a,b,c){b=b?.visualVariables.find(e=>e.type===c);(a=g(a,c))&&b&&(a.minSliderValue=b.minSliderValue,a.maxSliderValue=b.maxSliderValue,"size"===c&&"reference-size"===a.theme&&(a.sizeStops=b.sizeStops?.map(e=>e.clone()),a.referenceSizeScale=b.referenceSizeScale))};Object.defineProperty(d,
Symbol.toStringTag,{value:"Module"})});