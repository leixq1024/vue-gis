// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../core/colorUtils ../../../core/Error ../../../renderers/support/AuthoringInfo ../../../renderers/support/AuthoringInfoVisualVariable ../../../renderers/support/rasterRendererHelper ../../../renderers/visualVariables/ColorVariable ../../../renderers/visualVariables/OpacityVariable ../../../renderers/visualVariables/SizeVariable ../../../renderers/visualVariables/support/ColorStop ../../../renderers/visualVariables/support/OpacityStop ../../../renderers/visualVariables/support/SizeStop ../support/utils ../../renderers/support/utils ../../symbology/flow".split(" "),
function(r,w,l,x,n,t,y,z,A,B,u,v,C,p,q){async function D(a){a={...a};a.theme||(a.theme="flow-line");return C.processRasterRendererParameters(a)}async function E(a){let d=a.flowScheme,f=null;var b=null;b=await p.getBasemapInfo(null,a.view);f=null!=b.basemapId?b.basemapId:null;b=null!=b.basemapTheme?b.basemapTheme:null;if(d)return{scheme:q.cloneScheme(d),basemapId:f,basemapTheme:b};if(a=q.getSchemes({basemapTheme:b,theme:a.theme,hasSizeVariable:a.hasSizeVariable}))d=a.primaryScheme,f=a.basemapId,b=
a.basemapTheme;return{scheme:d,basemapId:f,basemapTheme:b}}async function F(a,d){d.flowRepresentation&&(a.flowRepresentation=d.flowRepresentation);const f=await E({theme:d.theme,flowScheme:d.flowScheme,view:d.view,hasSizeVariable:d.includeSizeVariable}),b=f.scheme;if(!b)throw new l("flow-renderer:insufficient-info","Unable to find flow scheme");a.flowSpeed=b.flowSpeed;a.density=b.density;a.trailLength=b.trailLength;a.trailWidth=b.trailWidth;a.trailCap=b.trailCap;a.color=b.color;const h=[];var g=[],
c=d.layer.rasterInfo;c=null==c?.statistics||"vector-magdir"!==c.dataType&&"vector-uv"!==c.dataType?{minMagnitude:0,maxMagnitude:10}:t.estimateMagnitudeRange(c.dataType,c.statistics);if(null==c?.minMagnitude||null==c.maxMagnitude)throw new l("flow-renderer:insufficient-info","stats not available");c={min:c.minMagnitude,max:c.maxMagnitude};var e={min:c.min,max:null!=c.max?c.max/2:null},k=p.getDataRange(e,null,null);e=p.createDataValues(k,e,null);if(d.includeColorVariable){const m=w.createUniqueColors(b.colors,
5);if(5>m.length)throw new l("flow-renderer:insufficient-info","Flow scheme does not have enough colors");k=new y({field:"Magnitude",stops:e.map((G,H)=>new B({value:G,color:m[H]}))});h.push(k);k=new n({type:"color",minSliderValue:c.min,maxSliderValue:c.max,theme:"high-to-low"});g.push(k)}d.includeOpacityVariable&&(e=new z({field:"Magnitude",stops:[new u({value:e[0],opacity:b.minOpacity}),new u({value:e[4],opacity:b.maxOpacity})]}),h.push(e),e=new n({type:"opacity",minSliderValue:c.min,maxSliderValue:c.max}),
g.push(e));d.includeSizeVariable&&(e=new A({field:"Magnitude",stops:[new v({value:c.min,size:b.minSize}),new v({value:c.max,size:b.maxSize})]}),h.push(e),e=new n({type:"size",minSliderValue:c.min,maxSliderValue:c.max,theme:"high-to-low"}),g.push(e));g=new x({type:"flow",visualVariables:g.length?g:void 0,flowTheme:b.theme});a.visualVariables=h;a.authoringInfo=g;a.legendOptions=d.legendOptions;return{renderer:a,visualVariables:h.map(m=>m.clone()),flowScheme:q.cloneScheme(b),basemapId:f.basemapId,basemapTheme:f.basemapTheme,
layerEffect:b.layerEffect,statistics:c}}r.createRenderer=async function(a){a=await D(a);const d=t.createFlowRenderer(a.layer.rasterInfo);if(null==d)throw new l("flow-renderer:not-supported","Only vector data is supported");return F(d,a)};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});