// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../assets ../../core/colorUtils ../../core/has ../../core/Error ../../core/Logger ../../core/screenUtils ./gfxUtils ./IconSymbol3DLayerResource ./ObjectSymbol3DLayerResource ./previewUtils ./renderUtils ./utils ./webStyleSymbolUtils".split(" "),function(A,P,Q,ha,R,W,w,C,X,Y,k,D,S,Z){function y(a){const b=a.outline;var d=null!=a.material?a.material.color:null;d=null!=d?d.toHex():null;if(null==b||"pattern"in b&&null!=b.pattern&&"style"===b.pattern.type&&"none"===b.pattern.style)return"fill"===
a.type&&"#ffffff"===d?{color:"#bdc3c7",width:.75}:null;a=w.pt2px(b.size)||0;return{color:"rgba("+(null!=b.color?b.color.toRgba():"255,255,255,1")+")",width:Math.min(a,K),style:"pattern"in b&&null!=b.pattern&&"style"===b.pattern.type?C.dekebabifyLineStyle(b.pattern.style):null,join:"butt",cap:"patternCap"in b?b.patternCap:"butt"}}async function aa(a,b){if(a.thumbnail?.url)return a.thumbnail.url;if("icon"===b.type&&b?.resource?.href)return S.getIconHref(b);b=P.getAssetUrl("esri/images/Legend/legend3dsymboldefault.png");
return a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)&&(a=await Z.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal},"webRef").catch(()=>null))&&"thumbnail"in a&&a.thumbnail?.url?a.thumbnail.url:b}function L(a,b=1){const d=a.a;a=Q.toHSV(a);const {r:g,g:r,b:u}=Q.toRGB({h:a.h,s:a.s/b,v:100-(100-a.v)/b});return[g,r,u,d]}function E(a){return"water"===a.type?null==a.color?null:a.color:null==a.material?.color?null:a.material.color}function f(a,b=0){var d=E(a);if(!d){if("fill"===
a.type)return null;b=k.adjustColorComponentBrightness(C.defaultThematicColor.r,b);return[b,b,b,100]}a=d.toRgba();for(d=0;3>d;d++)a[d]=k.adjustColorComponentBrightness(a[d],b);return a}async function T(a,b){a=a.style;return"none"===a?null:{type:"pattern",x:0,y:0,src:await C.getPatternUrlWithColor(P.getAssetUrl(`esri/symbols/patterns/${a}.png`),b.toCss(!0)),width:5,height:5}}function U(a){return a.outline?y(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}function M(a,b){a=E(a);if(!a)return null;let d;d="rgba("+
(k.adjustColorComponentBrightness(a.r,b)+",");d+=k.adjustColorComponentBrightness(a.g,b)+",";d+=k.adjustColorComponentBrightness(a.b,b)+",";return d+a.a+");"}function N(a,b){b=M(a,b);if(!b)return{};if("pattern"in a&&null!=a.pattern&&"style"===a.pattern.type&&"none"===a.pattern.style)return null;const d=Math.min(a.size?w.pt2px(a.size):.75,K);return{color:b,width:d,style:"pattern"in a&&null!=a.pattern&&"style"===a.pattern.type?C.dekebabifyLineStyle(a.pattern.style):null,cap:"cap"in a?a.cap:null,join:"join"in
a?"miter"===a.join?w.pt2px(2):a.join:null}}function F(a,b,d){d=null!=d?.75*d:0;return{type:"linear",x1:d?.25*d:0,y1:d?.5*d:0,x2:d||4,y2:d?.5*d:4,colors:[{color:a,offset:0},{color:b,offset:1}]}}function ba(a){const b=a.depth,d=a.height;a=a.width;return 0!==a&&0!==b&&0!==d&&a===b&&null!=a&&null!=d&&a<d}function ca(a,b,d){const g=[];if(!a)return g;switch(a.type){case "icon":switch(a.resource?.primitive??X.defaultPrimitive){case "circle":g.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:f(a,0),stroke:y(a)});
break;case "square":g.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[0,0]},{command:"L",values:[b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:f(a,0),stroke:y(a)});break;case "triangle":g.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:f(a,0),stroke:y(a)});break;case "cross":g.push({shape:{type:"path",path:[{command:"M",values:[.5*b,0]},{command:"L",values:[.5*
b,b]},{command:"M",values:[0,.5*b]},{command:"L",values:[b,.5*b]}]},stroke:U(a)});break;case "x":g.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[b,b]},{command:"M",values:[b,0]},{command:"L",values:[0,b]}]},stroke:U(a)});break;case "kite":g.push({shape:{type:"path",path:[{command:"M",values:[0,.5*b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,.5*b]},{command:"L",values:[.5*b,b]},{command:"Z",values:[]}]},fill:f(a,0),stroke:y(a)})}break;case "object":switch(a.resource?.primitive??
Y.defaultPrimitive){case "cone":var r=f(a,0);a=f(a,-.6);a=F(r,a,d?O:b);b=k.getConeShapes(b,d);g.push({shape:b[0],fill:a},{shape:b[1],fill:a});break;case "inverted-cone":d=f(a,0);a=f(a,-.6);a=F(d,a,b);b=k.getInvertedConeShapes(b);g.push({shape:b[0],fill:a},{shape:b[1],fill:d});break;case "cube":b=k.getCubeShapes(b,d);g.push({shape:b[0],fill:f(a,0)},{shape:b[1],fill:f(a,-.3)},{shape:b[2],fill:f(a,-.5)});break;case "cylinder":r=f(a,0);const u=f(a,-.6);r=F(r,u,d?O:b);b=k.getCylinderShapes(b,d);g.push({shape:b[0],
fill:r},{shape:b[1],fill:r},{shape:b[2],fill:f(a,0)});break;case "diamond":b=k.getDiamondShapes(b);g.push({shape:b[0],fill:f(a,-.3)},{shape:b[1],fill:f(a,0)},{shape:b[2],fill:f(a,-.3)},{shape:b[3],fill:f(a,-.7)});break;case "sphere":d=f(a,0);a=f(a,-.6);a=F(d,a);a.x1=0;a.y1=0;a.x2=.25*b;a.y2=.25*b;g.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:a});break;case "tetrahedron":b=k.getTetrahedronShapes(b),g.push({shape:b[0],fill:f(a,-.3)},{shape:b[1],fill:f(a,0)},{shape:b[2],fill:f(a,-.6)})}}return g}
function G(a){return(a="number"===typeof a?.size?a?.size:null)?w.pt2px(a):null}async function da(a,b){const d=G(b),g=b?.maxSize?w.pt2px(b.maxSize):null,r=b?.disableUpsampling??!1,u=[],t=[];let m=!1,q=0,c=0,h=0;a.symbolLayers.forEach(e=>{if("icon"===e.type||"object"===e.type){e&&"icon"===e.type&&(h=Math.max(e.size&&w.pt2px(e.size),h));var p="icon"===e.type?e.size&&w.pt2px(e.size):0,n=d||p?Math.ceil(Math.min(d||p,g||H)):x,v="icon"===e.type?e.angle:null;null!=b?.rotation&&(v=(v??0)+b.rotation);t.push(v);
if(e?.resource?.href){var z=aa(a,e).then(B=>{const I=e?.material?.color;var J="icon"===e.type?"multiply":"tint";return D.tintImageWithColor(B,n,I,J,r)}).then(B=>{const I=B.width,J=B.height;q=Math.max(q,I);c=Math.max(c,J);v&&(m=!0);return[{shape:{type:"image",x:0,y:0,width:I,height:J,src:B.url},fill:null,stroke:null}]});u.push(z)}else z=n,"icon"===e.type&&d&&(z=p/h*n),p="tall"===b?.symbolConfig||b?.symbolConfig?.isTall||("object"===e.type?ba(e):!1),q=Math.max(q,p?O:z),c=Math.max(c,z),v&&e.resource?.primitive&&
["square","triangle","x"].includes(e.resource?.primitive)&&(m=!0),u.push(Promise.resolve(ca(e,z,p)))}});const l=[];(await Promise.allSettled(u)).forEach(e=>{"fulfilled"===e.status?l.push(e.value):e.reason&&W.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",e.reason)});return D.renderSymbol(l,[q,c],{node:b?.node,scale:!1,opacity:b?.opacity,ariaLabel:b?.ariaLabel,rotations:t,useRotationSize:m})}function ea(a,b){const d=a.symbolLayers,g=[];a=S.isVolumetricSymbol(a);
const r=G(b),u=(b?.maxSize?w.pt2px(b.maxSize):null)||K;let t=0,m=0,q;d.forEach((c,h)=>{if(c&&("line"===c.type||"path"===c.type)){var l=[];switch(c.type){case "line":var e=N(c,0);if(null==e)break;var p=e?.width||0;0===h&&(q=p);c=Math.min(r||p,u);h=0===h?c:r?p/q*c:c;p=h>V/2?2*h:V;m=Math.max(m,h);t=Math.max(t,p);e.width=h;l.push({shape:{type:"path",path:[{command:"M",values:[0,.5*m]},{command:"L",values:[t,.5*m]}]},stroke:e});break;case "path":e=Math.min(r||x,u);h=f(c,0);p=f(c,-.2);var n=M(c,-.4);n=
n?{color:n,width:1}:{};if("quad"===c.profile){const v=c.width;c=c.height;c=k.getPathSymbolShapes(v&&c?v/c:1,0===c,0===v);n={...n,join:"bevel"};l.push({shape:c[0],fill:p,stroke:n},{shape:c[1],fill:p,stroke:n},{shape:c[2],fill:h,stroke:n})}else l.push({shape:k.shapes.pathSymbol3DLayer[0],fill:p,stroke:n},{shape:k.shapes.pathSymbol3DLayer[1],fill:h,stroke:n});t=m=Math.max(m,e)}g.push(l)}});return Promise.resolve(D.renderSymbol(g,[t,m],{node:b?.node,scale:a,opacity:b?.opacity,ariaLabel:b?.ariaLabel}))}
async function fa(a,b){const d="mesh-3d"===a.type;a=a.symbolLayers;var g=G(b);const r=b?.maxSize?w.pt2px(b.maxSize):null;g=g||x;const u=[];let t=0,m=0;var q=!1;for(let p=0;p<a.length;p++){var c=a.at(p);const n=[];if(!d||"fill"===c.type){switch(c.type){case "fill":q=Math.min(g,r||H);t=Math.max(t,q);m=Math.max(m,q);q=!0;if(d){var h=k.shapes.meshSymbol3DFill,l=M(c,-.4);l=l?{color:l,width:1,join:"round"}:{};n.push({shape:h[0],fill:f(c,0),stroke:l},{shape:h[1],fill:f(c,-.2),stroke:l},{shape:h[2],fill:f(c,
-.6),stroke:l})}else{h=f(c,0);l="pattern"in c?c.pattern:null;var e=y(c);c=E(c);null!=l&&"style"===l.type&&"solid"!==l.style&&c&&(h=await T(l,c));n.push({shape:k.shapes.fill[0],fill:h,stroke:e})}break;case "line":c=N(c,0);if(null==c)break;c={stroke:c,shape:k.shapes.fill[0]};t=Math.max(t,x);m=Math.max(m,x);n.push(c);break;case "extrude":h={join:"round",width:1,...N(c,-.4)};l=f(c,0);c=f(c,-.2);e=Math.min(g,r||H);const v=k.getExtrudeSymbolShapes(e);h.width=1;n.push({shape:v[0],fill:c,stroke:h},{shape:v[1],
fill:c,stroke:h},{shape:v[2],fill:l,stroke:h});c=.7*x+.5*e;t=Math.max(t,x);m=Math.max(m,c);break;case "water":q=E(c),c=L(q),h=L(q,2),l=L(q,3),e=k.getWaterSymbolShapes(),q=!0,n.push({shape:e[0],fill:c},{shape:e[1],fill:h},{shape:e[2],fill:l}),c=Math.min(g,r||H),t=Math.max(t,c),m=Math.max(m,c)}u.push(n)}}return D.renderSymbol(u,[t,m],{node:b?.node,scale:q,opacity:b?.opacity,ariaLabel:b?.ariaLabel})}const x=k.SymbolSizeDefaults.size,H=k.SymbolSizeDefaults.maxSize,K=k.SymbolSizeDefaults.maxOutlineSize,
V=k.SymbolSizeDefaults.lineWidth,O=k.SymbolSizeDefaults.tallSymbolWidth;A.getPatternDescriptor=T;A.getSizeFromOptions=G;A.getSymbolLayerFill=f;A.previewSymbol3D=function(a,b){if(0===a.symbolLayers.length)return Promise.reject(new R("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(a.type){case "point-3d":return da(a,b);case "line-3d":return ea(a,b);case "polygon-3d":case "mesh-3d":return fa(a,b)}return Promise.reject(new R("symbolPreview: swatchInfo3D","symbol not supported."))};
Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})});