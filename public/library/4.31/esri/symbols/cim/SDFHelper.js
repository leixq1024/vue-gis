// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../../core/floatRGBA","../../geometry/support/jsonUtils","./Rect","../../views/2d/engine/webgl/definitions"],function(y,J,K,L,z){function G(e,a=.5){switch(e.type){case "CIMPointSymbol":a=e.symbolLayers;if(!a||1!==a.length)return null;a=a[0];return"CIMVectorMarker"!==a.type?null:G(a);case "CIMVectorMarker":e=e.markerGraphics;if(!e||1!==e.length)return null;var b=e[0];if(!b)return null;e=b.geometry;if(!e)return null;b=b.symbol;return!b||"CIMPolygonSymbol"!==b.type&&"CIMLineSymbol"!==
b.type||b.symbolLayers?.some(g=>!!g.effects)?null:{type:"sdf",geom:e,sdfPaddingRatio:a,asFill:"CIMPolygonSymbol"===b.type}}}function H(e){let a=Infinity,b=-Infinity,g=Infinity,k=-Infinity;for(const c of e)for(const d of c)d[0]<a&&(a=d[0]),d[0]>b&&(b=d[0]),d[1]<g&&(g=d[1]),d[1]>k&&(k=d[1]);return[a,g,b,k]}function I(e){return e?e.rings?H(e.rings):e.paths?H(e.paths):K.isExtent(e)?[e.xmin,e.ymin,e.xmax,e.ymax]:null:null}y.buildSDF=function(e){var a=e.geom;var b=a?a.rings?a.rings:a.paths?a.paths:void 0!==
a.xmin&&void 0!==a.ymin&&void 0!==a.xmax&&void 0!==a.ymax?[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]]:null:null;a=Infinity;var g=-Infinity,k=Infinity;var c=-Infinity;for(var d of b)for(var l of d)l[0]<a&&(a=l[0]),l[0]>g&&(g=l[0]),l[1]<k&&(k=l[1]),l[1]>c&&(c=l[1]);c=new L(a,k,g-a,c-k);l=z.defaultSdfTextureSize;a=z.spritePadding;d=Math.floor(.5*(l*e.sdfPaddingRatio-a));l-=2*(d+a);var f=l/Math.max(c.width,c.height);a=Math.round(c.width*f)+2*d;g=Math.round(c.height*
f)+2*d;k=[];for(var u of b)if(u&&1<u.length){b=[];for(var m of u){let [v,x]=m;v-=c.x;x-=c.y;v*=f;x*=f;v+=d-.5;x+=d-.5;e.asFill?b.push([v,x]):b.push([Math.round(v),Math.round(x)])}if(e.asFill){var h=b.length-1;b[0][0]===b[h][0]&&b[0][1]===b[h][1]||b.push(b[0])}k.push(b)}m=a*g;u=Array(m);b=d*d+1;for(c=0;c<m;++c)u[c]=b;for(var t of k)for(b=t.length,c=1;c<b;++c){f=t[c-1];h=t[c];var p=void 0,n=void 0;f[0]<h[0]?(p=f[0],n=h[0]):(p=h[0],n=f[0]);var r=void 0,q=void 0;f[1]<h[1]?(r=f[1],q=h[1]):(r=h[1],q=f[1]);
var A=Math.floor(p)-d;n=Math.floor(n)+d;r=Math.floor(r)-d;q=Math.floor(q)+d;0>A&&(A=0);n>a&&(n=a);0>r&&(r=0);q>g&&(q=g);p=h[0]-f[0];const v=h[1]-f[1],x=p*p+v*v;for(;A<n;A++)for(let F=r;F<q;F++){var B=A+.5,C=F+.5,w=(B-f[0])*p+(C-f[1])*v;let D;0>w?(D=f[0],w=f[1]):w>x?(D=h[0],w=h[1]):(w/=x,D=f[0]+w*p,w=f[1]+w*v);B=(B-D)*(B-D)+(C-w)*(C-w);C=(g-F-1)*a+A;B<u[C]&&(u[C]=B)}}for(t=0;t<m;++t)u[t]=Math.sqrt(u[t]);if(e.asFill)for(var E of k)for(t=E.length,k=1;k<t;++k)for(m=E[k-1],b=E[k],m[0]<b[0]?(c=m[0],f=b[0]):
(c=b[0],f=m[0]),m[1]<b[1]?(n=m[1],h=b[1]):(n=b[1],h=m[1]),c=Math.floor(c),f=Math.floor(f)+1,n=Math.floor(n),h=Math.floor(h)+1,c<d&&(c=d),f>a-d&&(f=a-d),n<d&&(n=d),h>g-d&&(h=g-d);n<h;++n)if(m[1]>n!==b[1]>n){q=n+.5;r=(g-n-1)*a;for(p=c;p<f;++p)p+.5<(b[0]-m[0])*(q-m[1])/(b[1]-m[1])+m[0]&&(u[r+p]=-u[r+p]);for(q=d;q<c;++q)u[r+q]=-u[r+q]}E=2*d;t=u.length;k=new Uint8Array(4*t);for(m=0;m<t;++m)J.packFloatRGBA(.5-u[m]/E,k,4*m);return{data:k,width:a,height:g,sdfPaddingRatio:e.sdfPaddingRatio,sdfDecodeCoeff:2*
d/l}};y.getExtent=I;y.getSDFDimensions=function(e,a){const [b,g,k,c]=I(e);e=k-b;const d=c-g;var l=z.defaultSdfTextureSize;const f=z.spritePadding;a=Math.floor(.5*(l*a-f));l=(l-2*(a+f))/Math.max(e,d);return{pixelDimensions:[e,d],texelDimensions:[Math.round((Math.round(e*l)+2*a)/l),Math.round((Math.round(d*l)+2*a)/l)]}};y.getSDFInfo=G;y.getSDFMetrics=function(e,a,b,g,k,c,d){const [l,f,u,m]=e;if(u<l||m<f)return{frameSizeRatio:0,anchorX:0,anchorY:0,widthRatio:1,sdfPaddingRatio:.5};var h=u-l,t=m-f,p=Math.max(h,
t);e=.5;null!=c&&null!=b&&(d||null==a||(c*=(a.ymax-a.ymin)/b),c/=c+p,.45<c&&1>c&&(e=Math.min(c+.1,.99)));d=z.defaultSdfTextureSize;var n=z.spritePadding;c=Math.floor(.5*(d*e-n));p=(d-2*(c+n))/p;d=Math.round(h*p);n=Math.round(t*p)+2*c;t=1;a&&(t=n*(1-e)/((a.ymax-a.ymin)*p));let r=0,q=0;h=1;g&&(k?a&&b&&0<a.ymax-a.ymin&&(h=(a.xmax-a.xmin)/(a.ymax-a.ymin),r=g.x/(b*h),q=g.y/b):(r=g.x,q=g.y));a&&(r=.5*(a.xmax+a.xmin)+r*(a.xmax-a.xmin),q=.5*(a.ymax+a.ymin)+q*(a.ymax-a.ymin));r=(r-l)*p+c;q=(q-f)*p+c;a=r/(d+
2*c)-.5;g=q/n-.5;k&&b&&(a*=b*h,g*=b);return{frameSizeRatio:t,anchorX:a,anchorY:g,widthRatio:h,sdfPaddingRatio:e}};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});