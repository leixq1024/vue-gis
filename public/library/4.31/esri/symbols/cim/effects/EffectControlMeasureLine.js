// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../../../geometry/support/coordsUtils ../CIMCursor ../enums".split(" "),function(bd,Ud,Vd,Wd,ib,h){class Ma{static local(){null===Ma.instance&&(Ma.instance=new Ma);return Ma.instance}execute(d,b,c,g,e){return new Xd(d,b,c)}}Ma.instance=null;class Xd{constructor(d,b,c){this._defaultPointSize=20;this._inputGeometries=d;this._geomUnitsPerPoint=c;this._rule=b.rule??h.GeometricEffectControlMeasureLineRule.FullGeometry;
this._defaultSize=this._defaultPointSize*c}next(){for(var d;d=this._inputGeometries.next();)if(d=this._processGeom(Vd.collectMultipath(d)),d?.length)return Ud.GeometryCursor.fromJSONCIM({paths:d});return null}_clone(d){return[d[0],d[1]]}_mid(d,b){return[(d[0]+b[0])/2,(d[1]+b[1])/2]}_mix(d,b,c,g){return[d[0]*b+c[0]*g,d[1]*b+c[1]*g]}_add(d,b){return[d[0]+b[0],d[1]+b[1]]}_add2(d,b,c){return[d[0]+b,d[1]+c]}_sub(d,b){return[d[0]-b[0],d[1]-b[1]]}_dist(d,b){return Math.sqrt((d[0]-b[0])*(d[0]-b[0])+(d[1]-
b[1])*(d[1]-b[1]))}_norm(d){return Math.sqrt(d[0]*d[0]+d[1]*d[1])}_normalize(d,b=1){b/=this._norm(d);d[0]*=b;d[1]*=b}_leftPerpendicular(d){const b=d[0];d[0]=-d[1];d[1]=b}_leftPerp(d){return[-d[1],d[0]]}_rightPerpendicular(d){const b=-d[0];d[0]=d[1];d[1]=b}_rightPerp(d){return[d[1],-d[0]]}_dotProduct(d,b){return d[0]*b[0]+d[1]*b[1]}_crossProduct(d,b){return d[0]*b[1]-d[1]*b[0]}_rotateDirect(d,b,c){const g=d[0]*c+d[1]*b;d[0]=d[0]*b-d[1]*c;d[1]=g}_makeCtrlPt(d){d=[d[0],d[1]];ib.setId(d,1);return d}_addAngledTicks(d,
b,c,g){const e=this._sub(c,b);this._normalize(e);var a=this._crossProduct(e,this._sub(g,b));g=0<a?this._rightPerp(e):this._leftPerp(e);a=Math.abs(a)/2;const l=[];l.push([b[0]+(g[0]-e[0])*a,b[1]+(g[1]-e[1])*a]);l.push(b);l.push(c);l.push([c[0]+(g[0]+e[0])*a,c[1]+(g[1]+e[1])*a]);d.push(l)}_addBezier2(d,b,c,g,e){if(0===e--)d.push(g);else{var a=this._mid(b,c);c=this._mid(c,g);var l=this._mid(a,c);this._addBezier2(d,b,a,l,e);this._addBezier2(d,l,c,g,e)}}_addBezier3(d,b,c,g,e,a){if(0===a--)d.push(e);else{var l=
this._mid(b,c),n=this._mid(c,g);g=this._mid(g,e);c=this._mid(l,n);n=this._mid(n,g);var E=this._mid(c,n);this._addBezier3(d,b,l,c,E,a);this._addBezier3(d,E,n,g,e,a)}}_add90DegArc(d,b,c,g,e){g=e??0<this._crossProduct(this._sub(c,b),this._sub(g,b));e=this._mid(b,c);const a=this._sub(e,b);g?this._leftPerpendicular(a):this._rightPerpendicular(a);e[0]+=a[0];e[1]+=a[1];this._addBezier3(d,b,this._mix(b,.33333,e,.66667),this._mix(c,.33333,e,.66667),c,4)}_addArrow(d,b,c){var g=b[0],e=b[1],a=b[b.length-1],l=
this._sub(g,e),n=this._norm(l);this._normalize(l);const E=Math.abs(this._crossProduct(l,this._sub(a,e)));a=this._dotProduct(l,this._sub(a,e));a<.05*n?a=.05*n:a>.95*n&&(a=.95*n);n=.5*E;var ra=this._leftPerp(l);a=[e[0]+l[0]*a,e[1]+l[1]*a];var F=b.length-1;e=[];e.push(c?[-ra[0],-ra[1]]:ra);var v=[-l[0],-l[1]];for(c=1;c<F-1;c++){l=this._sub(b[c+1],b[c]);this._normalize(l);var da=this._dotProduct(l,v);ra=this._crossProduct(l,v);da=Math.sqrt((1+da)/2);v=this._sub(l,v);this._normalize(v);v[0]/=da;v[1]/=
da;e.push(0>ra?[-v[0],-v[1]]:v);v=l}e.push(this._rightPerp(v));for(F=e.length-1;0<F;F--)d.push([b[F][0]+e[F][0]*n,b[F][1]+e[F][1]*n]);d.push([a[0]+e[0][0]*n,a[1]+e[0][1]*n]);d.push([a[0]+e[0][0]*E,a[1]+e[0][1]*E]);d.push(g);d.push([a[0]-e[0][0]*E,a[1]-e[0][1]*E]);d.push([a[0]-e[0][0]*n,a[1]-e[0][1]*n]);for(g=1;g<e.length;g++)d.push([b[g][0]-e[g][0]*n,b[g][1]-e[g][1]*n])}_addDash(d,b,c){const g=this._norm(c)/7;this._normalize(c);let e=[];for(let a=0;7>=a;a++)e.push([b[0]+c[0]*a*g,b[1]+c[1]*a*g]),a&
1&&(d.push(e),e=[])}_cp2(d,b,c){return 2<=d.length?d[1]:this._add2(d[0],b*this._defaultSize,c*this._defaultSize)}_cp3(d,b,c,g){if(3<=d.length)return d[2];c=this._mix(d[0],1-c,b,c);d=this._sub(b,d[0]);this._normalize(d);this._rightPerpendicular(d);return[c[0]+d[0]*g*this._defaultSize,c[1]+d[1]*g*this._defaultSize]}_arrowPath(d){if(2<d.length)return d;const b=d[0];d=this._cp2(d,-4,0);const c=this._sub(b,d);this._normalize(c);const g=this._rightPerp(c);return[b,d,[b[0]+(g[0]-c[0])*this._defaultSize,
b[1]+(g[1]-c[1])*this._defaultSize]]}_arrowLastSeg(d){var b=d[0];const c=this._cp2(d,-4,0);if(3<=d.length)b=d[d.length-1];else{d=this._sub(b,c);this._normalize(d);const g=this._rightPerp(d);b=[b[0]+(g[0]-d[0])*this._defaultSize,b[1]+(g[1]-d[1])*this._defaultSize]}return[c,b]}_processGeom(d){if(!d)return null;const b=[];for(const c of d){const g=1<c.length&&Wd.getPathLength(c)<this._defaultSize;if(!c||0===c.length||g)continue;const e=c.length;let a=c[0];switch(this._rule){case h.GeometricEffectControlMeasureLineRule.PerpendicularFromFirstSegment:const l=
this._cp2(c,0,-1),n=this._cp3(c,l,.5,4),E=[];E.push(n);E.push(this._mid(a,l));b.push(E);break;case h.GeometricEffectControlMeasureLineRule.ReversedFirstSegment:const ra=this._cp2(c,0,-1);b.push([ra,a]);break;case h.GeometricEffectControlMeasureLineRule.PerpendicularToSecondSegment:if(3>c.length)return[];const F=this._cp2(c,-4,1),v=this._cp3(c,F,.882353,-1.94),da=[];da.push(this._mid(F,v));da.push(a);b.push(da);break;case h.GeometricEffectControlMeasureLineRule.SecondSegmentWithTicks:if(3>c.length)return[];
const Na=this._cp2(c,-4,1),Db=this._cp3(c,Na,.882353,-1.94),sa=this._sub(Db,Na);let jb;jb=0<this._crossProduct(sa,this._sub(a,Na))?this._rightPerp(sa):this._leftPerp(sa);const kb=[];kb.push([Na[0]+(jb[0]-sa[0])/3,Na[1]+(jb[1]-sa[1])/3]);kb.push(Na);kb.push(Db);kb.push([Db[0]+(jb[0]+sa[0])/3,Db[1]+(jb[1]+sa[1])/3]);b.push(kb);break;case h.GeometricEffectControlMeasureLineRule.DoublePerpendicular:const nc=this._cp2(c,0,-1),Oa=this._cp3(c,nc,.5,3),Yd=this._mid(a,nc),ta=this._sub(Yd,Oa);this._normalize(ta);
const Eb=this._crossProduct(ta,this._sub(a,Oa));this._leftPerpendicular(ta);const oc=[];oc.push(a);oc.push([Oa[0]+ta[0]*Eb,Oa[1]+ta[1]*Eb]);b.push(oc);const pc=[];pc.push([Oa[0]-ta[0]*Eb,Oa[1]-ta[1]*Eb]);pc.push(nc);b.push(pc);break;case h.GeometricEffectControlMeasureLineRule.OppositeToFirstSegment:const cd=this._cp2(c,0,-1),Pa=this._cp3(c,cd,.5,3),Zd=this._mid(a,cd),ua=this._sub(Zd,Pa);this._normalize(ua);const Fb=this._crossProduct(ua,this._sub(a,Pa));this._leftPerpendicular(ua);const qc=[];qc.push([Pa[0]+
ua[0]*Fb,Pa[1]+ua[1]*Fb]);qc.push([Pa[0]-ua[0]*Fb,Pa[1]-ua[1]*Fb]);b.push(qc);break;case h.GeometricEffectControlMeasureLineRule.TriplePerpendicular:const Gb=this._cp2(c,0,-1),va=this._cp3(c,Gb,.5,4),O=this._mid(a,Gb),wa=this._sub(O,va);this._normalize(wa);const Hb=this._crossProduct(wa,this._sub(a,va));this._leftPerpendicular(wa);const rc=[];rc.push([va[0]+wa[0]*Hb*.8,va[1]+wa[1]*Hb*.8]);rc.push([O[0]+.8*(a[0]-O[0]),O[1]+.8*(a[1]-O[1])]);b.push(rc);b.push([va,O]);const sc=[];sc.push([va[0]-wa[0]*
Hb*.8,va[1]-wa[1]*Hb*.8]);sc.push([O[0]+.8*(Gb[0]-O[0]),O[1]+.8*(Gb[1]-O[1])]);b.push(sc);break;case h.GeometricEffectControlMeasureLineRule.HalfCircleFirstSegment:const Qa=this._cp2(c,0,-1),$d=this._cp3(c,Qa,.5,4),tc=this._mid(a,Qa);let P=this._sub(Qa,a);const uc=Math.cos(Math.PI/18),ae=Math.sin(Math.PI/18),vc=Math.sqrt((1+uc)/2),be=Math.sqrt((1-uc)/2),lb=[];let wc;0<this._crossProduct(P,this._sub($d,a))?(lb.push(a),P=this._sub(a,tc),wc=Qa):(lb.push(Qa),P=this._sub(Qa,tc),wc=a);this._rotateDirect(P,
vc,be);P[0]/=vc;P[1]/=vc;for(let f=1;18>=f;f++)lb.push(this._add(tc,P)),this._rotateDirect(P,uc,ae);lb.push(wc);b.push(lb);break;case h.GeometricEffectControlMeasureLineRule.HalfCircleSecondSegment:const xa=this._cp2(c,0,-1),ce=this._cp3(c,xa,1,-1);let ea=this._sub(a,xa);this._normalize(ea);const xc=this._crossProduct(ea,this._sub(ce,xa))/2;this._leftPerpendicular(ea);const dd=[xa[0]+ea[0]*xc,xa[1]+ea[1]*xc];ea=this._sub(xa,dd);const de=Math.cos(Math.PI/18);let yc=Math.sin(Math.PI/18);0<xc&&(yc=-yc);
const ed=[xa];for(let f=1;18>=f;f++)this._rotateDirect(ea,de,yc),ed.push(this._add(dd,ea));b.push(ed);break;case h.GeometricEffectControlMeasureLineRule.HalfCircleExtended:const Ra=this._cp2(c,0,-2),ya=this._cp3(c,Ra,1,-1);let Ib;if(4<=e)Ib=c[3];else{const f=this._sub(a,Ra);Ib=this._add(ya,f)}const fd=this._dist(Ra,ya)/2/.75,gd=this._sub(Ra,a);this._normalize(gd,fd);const hd=this._sub(ya,Ib);this._normalize(hd,fd);b.push([Ib,ya]);const zc=[this._clone(ya)];this._addBezier3(zc,ya,this._add(ya,hd),
this._add(Ra,gd),Ra,4);zc.push(a);b.push(zc);break;case h.GeometricEffectControlMeasureLineRule.OpenCircle:const id=this._cp2(c,-2,0),jd=this._sub(id,a),ee=Math.cos(Math.PI/18),fe=-Math.sin(Math.PI/18),kd=[id];for(let f=1;33>=f;f++)this._rotateDirect(jd,ee,fe),kd.push(this._add(a,jd));b.push(kd);break;case h.GeometricEffectControlMeasureLineRule.CoverageEdgesWithTicks:const fa=this._cp2(c,0,-1);let za;if(3<=e)za=c[2];else{const f=this._sub(fa,a),m=this._leftPerp(f);za=[a[0]+m[0]-.25*f[0],a[1]+m[1]-
.25*f[1]]}let Jb;if(4<=e)Jb=c[3];else{const f=this._mid(a,fa),m=this._sub(a,fa);this._normalize(m);this._leftPerpendicular(m);const q=this._crossProduct(m,this._sub(za,f));this._rightPerpendicular(m);Jb=[za[0]+m[0]*q*2,za[1]+m[1]*q*2]}const Q=this._sub(fa,a);let Sa,R;Sa=0<this._crossProduct(Q,this._sub(za,a))?this._rightPerp(Q):this._leftPerp(Q);R=[];R.push(za);R.push(a);R.push([a[0]+(Sa[0]-Q[0])/3,a[1]+(Sa[1]-Q[1])/3]);b.push(R);Sa=0<this._crossProduct(Q,this._sub(Jb,fa))?this._rightPerp(Q):this._leftPerp(Q);
R=[];R.push([fa[0]+(Sa[0]+Q[0])/3,fa[1]+(Sa[1]+Q[1])/3]);R.push(fa);R.push(Jb);b.push(R);break;case h.GeometricEffectControlMeasureLineRule.GapExtentWithDoubleTicks:const Kb=this._cp2(c,0,2),Ac=this._cp3(c,Kb,0,1);let Lb;if(4<=e)Lb=c[3];else{const f=this._sub(Kb,a);Lb=this._add(Ac,f)}this._addAngledTicks(b,a,Kb,this._mid(Ac,Lb));this._addAngledTicks(b,Ac,Lb,this._mid(a,Kb));break;case h.GeometricEffectControlMeasureLineRule.GapExtentMidline:const Bc=this._cp2(c,2,0),ld=this._cp3(c,Bc,0,1);let Cc;
if(4<=e)Cc=c[3];else{const f=this._sub(Bc,a);Cc=this._add(ld,f)}const Dc=[];Dc.push(this._mid(a,ld));Dc.push(this._mid(Bc,Cc));b.push(Dc);break;case h.GeometricEffectControlMeasureLineRule.Chevron:const md=this._cp2(c,-1,-1);let Ec;if(3<=e)Ec=c[2];else{const f=this._sub(md,a);this._leftPerpendicular(f);Ec=this._add(a,f)}b.push([md,this._makeCtrlPt(a),Ec]);break;case h.GeometricEffectControlMeasureLineRule.PerpendicularWithArc:const Ta=this._cp2(c,0,-2),nd=this._cp3(c,Ta,.5,-1),z=this._sub(Ta,a),S=
this._norm(z);z[0]/=S;z[1]/=S;const Aa=this._crossProduct(z,this._sub(nd,a));let Ua=this._dotProduct(z,this._sub(nd,a));Ua<.05*S?Ua=.05*S:Ua>.95*S&&(Ua=.95*S);const Mb=[a[0]+z[0]*Ua,a[1]+z[1]*Ua];let A=this._leftPerp(z),Va=[];Va.push([Mb[0]-A[0]*Aa,Mb[1]-A[1]*Aa]);Va.push([Mb[0]+A[0]*Aa,Mb[1]+A[1]*Aa]);b.push(Va);if(4<=e){const f=c[3];let m=this._dotProduct(z,this._sub(f,a));m<.1*S?m=.1*S:m>.9*S&&(m=.9*S);const q=[a[0]+z[0]*m,a[1]+z[1]*m],B=this._crossProduct(z,this._sub(f,a)),Fc=[];Fc.push([q[0]-
A[0]*B,q[1]-A[1]*B]);Fc.push([q[0]+A[0]*B,q[1]+A[1]*B]);b.push(Fc)}const od=[Ta[0]+A[0]*Aa,Ta[1]+A[1]*Aa];A=this._sub(Ta,od);const ge=Math.cos(Math.PI/18);let Gc=Math.sin(Math.PI/18);0>Aa&&(Gc=-Gc);Va=[a,Ta];for(let f=1;9>=f;f++)this._rotateDirect(A,ge,Gc),Va.push(this._add(od,A));b.push(Va);break;case h.GeometricEffectControlMeasureLineRule.ClosedHalfCircle:const Hc=this._cp2(c,2,0),pd=this._mid(a,Hc),qd=this._sub(Hc,pd),he=Math.cos(Math.PI/18),ie=Math.sin(Math.PI/18),rd=[a,Hc];for(let f=1;18>=f;f++)this._rotateDirect(qd,
he,ie),rd.push(this._add(pd,qd));b.push(rd);break;case h.GeometricEffectControlMeasureLineRule.TripleParallelExtended:const Ba=this._cp2(c,0,-2),Ic=this._cp3(c,Ba,1,-2),Ca=this._mid(a,Ba),T=this._sub(Ic,Ba);this._normalize(T);const sd=Math.abs(this._crossProduct(T,this._sub(Ca,Ba)))/2,Wa=this._dist(Ba,Ic),td=[Ba,a];td.push([a[0]+T[0]*Wa*.5,a[1]+T[1]*Wa*.5]);b.push(td);const Xa=[];Xa.push([Ca[0]-T[0]*sd,Ca[1]-T[1]*sd]);Xa.push([Ca[0]+T[0]*Wa*.375,Ca[1]+T[1]*Wa*.375]);ib.setId(Xa[Xa.length-1],1);Xa.push([Ca[0]+
T[0]*Wa*.75,Ca[1]+T[1]*Wa*.75]);b.push(Xa);b.push([Ba,Ic]);break;case h.GeometricEffectControlMeasureLineRule.ParallelWithTicks:const mb=this._cp2(c,3,0),Jc=this._cp3(c,mb,.5,-1),nb=this._sub(Jc,mb);this._normalize(nb);const ud=this._crossProduct(nb,this._sub(Jc,a));this._leftPerpendicular(nb);this._addAngledTicks(b,a,mb,Jc);this._addAngledTicks(b,this._mix(a,1,nb,ud),this._mix(mb,1,nb,ud),this._mid(a,mb));break;case h.GeometricEffectControlMeasureLineRule.Parallel:const ob=this._cp2(c,3,0),je=this._cp3(c,
ob,.5,-1),Kc=this._sub(ob,a);this._normalize(Kc);const Nb=this._leftPerp(Kc),Ob=this._crossProduct(Kc,this._sub(je,a));let pb=[a,ob];b.push(pb);pb=[];pb.push([a[0]+Nb[0]*Ob,a[1]+Nb[1]*Ob]);pb.push([ob[0]+Nb[0]*Ob,ob[1]+Nb[1]*Ob]);b.push(pb);break;case h.GeometricEffectControlMeasureLineRule.PerpendicularToFirstSegment:const Lc=this._cp2(c,3,0),ke=this._cp3(c,Lc,.5,-1),Pb=this._mid(a,Lc),Da=this._sub(Lc,a);this._normalize(Da);const Qb=this._crossProduct(Da,this._sub(ke,a));this._leftPerpendicular(Da);
const Mc=[];Mc.push([Pb[0]-Da[0]*Qb*.25,Pb[1]-Da[1]*Qb*.25]);Mc.push([Pb[0]+Da[0]*Qb*1.25,Pb[1]+Da[1]*Qb*1.25]);b.push(Mc);break;case h.GeometricEffectControlMeasureLineRule.ParallelOffset:const Ya=this._cp2(c,3,0),le=this._cp3(c,Ya,.5,-1),G=this._sub(Ya,a);this._normalize(G);const ha=this._crossProduct(G,this._sub(le,a));this._leftPerpendicular(G);const Nc=[];Nc.push([a[0]-G[0]*ha,a[1]-G[1]*ha]);Nc.push([Ya[0]-G[0]*ha,Ya[1]-G[1]*ha]);b.push(Nc);const Oc=[];Oc.push([a[0]+G[0]*ha,a[1]+G[1]*ha]);Oc.push([Ya[0]+
G[0]*ha,Ya[1]+G[1]*ha]);b.push(Oc);break;case h.GeometricEffectControlMeasureLineRule.OffsetOpposite:const Rb=this._cp2(c,3,0),me=this._cp3(c,Rb,.5,-1),Ea=this._sub(Rb,a);this._normalize(Ea);const Sb=this._crossProduct(Ea,this._sub(me,a));this._leftPerpendicular(Ea);const Pc=[];Pc.push([a[0]-Ea[0]*Sb,a[1]-Ea[1]*Sb]);Pc.push([Rb[0]-Ea[0]*Sb,Rb[1]-Ea[1]*Sb]);b.push(Pc);break;case h.GeometricEffectControlMeasureLineRule.OffsetSame:const Tb=this._cp2(c,3,0),ne=this._cp3(c,Tb,.5,-1),Fa=this._sub(Tb,a);
this._normalize(Fa);const Ub=this._crossProduct(Fa,this._sub(ne,a));this._leftPerpendicular(Fa);const Qc=[];Qc.push([a[0]+Fa[0]*Ub,a[1]+Fa[1]*Ub]);Qc.push([Tb[0]+Fa[0]*Ub,Tb[1]+Fa[1]*Ub]);b.push(Qc);break;case h.GeometricEffectControlMeasureLineRule.CircleWithArc:let ia=this._cp2(c,3,0);const Rc=this._cp3(c,ia,.5,-1);let Za,Vb;if(4<=e)Za=c[3],Vb=0<this._crossProduct(this._sub(Za,ia),this._sub(Rc,ia));else{Za=ia;Vb=0<this._crossProduct(this._sub(Za,a),this._sub(Rc,a));const f=24*this._geomUnitsPerPoint,
m=this._sub(Za,a);this._normalize(m,f);const q=Math.sqrt(2)/2;this._rotateDirect(m,q,Vb?q:-q);ia=this._add(a,m)}const vd=this._sub(ia,a),oe=Math.cos(Math.PI/18),pe=Math.sin(Math.PI/18),qb=[ia];for(let f=1;36>=f;f++)this._rotateDirect(vd,oe,pe),qb.push(this._add(a,vd));this._add90DegArc(qb,ia,Za,Rc,Vb);ib.setId(qb[qb.length-8],1);b.push(qb);break;case h.GeometricEffectControlMeasureLineRule.DoubleJog:let ja=this._cp2(c,-3,1),Ga=this._cp3(c,ja,-1,-.5),Y;if(4<=e)Y=c[3];else{const f=a;a=ja;Y=Ga;const m=
this._dist(a,f),q=this._dist(Y,f);let B=30*this._geomUnitsPerPoint;.5*m<B&&(B=.5*m);.5*q<B&&(B=.5*q);ja=this._mix(a,B/m,f,(m-B)/m);Ga=this._mix(Y,B/q,f,(q-B)/q)}const wd=this._mid(a,ja),xd=this._mid(Y,Ga),qe=this._dist(a,ja),re=this._dist(Ga,Y);let Wb=Math.min(qe,re)/8;Wb=Math.min(Wb,24*this._geomUnitsPerPoint);const ka=Math.cos(Math.PI/4);let C=this._sub(a,ja);this._normalize(C,Wb);0<this._crossProduct(C,this._sub(Y,ja))?this._rotateDirect(C,ka,-ka):this._rotateDirect(C,ka,ka);let H=[];H.push(ja);
H.push(this._add(wd,C));H.push(this._sub(wd,C));H.push(a);b.push(H);C=this._sub(Y,Ga);this._normalize(C,Wb);0>this._crossProduct(C,this._sub(a,Ga))?this._rotateDirect(C,ka,ka):this._rotateDirect(C,ka,-ka);H=[];H.push(Ga);H.push(this._add(xd,C));H.push(this._sub(xd,C));H.push(Y);b.push(H);break;case h.GeometricEffectControlMeasureLineRule.PerpendicularOffset:const Xb=this._cp2(c,-4,1),yd=this._cp3(c,Xb,.882353,-1.94),rb=this._sub(yd,Xb);0<this._crossProduct(rb,this._sub(a,Xb))?this._rightPerpendicular(rb):
this._leftPerpendicular(rb);const se=[rb[0]/8,rb[1]/8],te=this._sub(this._mid(Xb,yd),se);b.push([te,a]);break;case h.GeometricEffectControlMeasureLineRule.LineExcludingLastSegment:const zd=this._arrowPath(c),Ad=[];let Bd=zd.length-2;for(;Bd--;)Ad.push(zd[Bd]);b.push(Ad);break;case h.GeometricEffectControlMeasureLineRule.MultivertexArrow:const ue=this._arrowPath(c),Cd=[];this._addArrow(Cd,ue,!1);b.push(Cd);break;case h.GeometricEffectControlMeasureLineRule.CrossedArrow:const ve=this._arrowPath(c),
Dd=[];this._addArrow(Dd,ve,!0);b.push(Dd);break;case h.GeometricEffectControlMeasureLineRule.ChevronArrow:const [sb,Ed]=this._arrowLastSeg(c),$a=10*this._geomUnitsPerPoint,I=this._sub(a,sb),Yb=this._norm(I);this._normalize(I);const Zb=this._crossProduct(I,this._sub(Ed,sb));let ab=this._dotProduct(I,this._sub(Ed,sb));ab<.05*Yb?ab=.05*Yb:ab>.95*Yb-$a&&(ab=.95*Yb-$a);const $b=[sb[0]+I[0]*ab,sb[1]+I[1]*ab],ac=this._leftPerp(I),bc=[];bc.push([$b[0]+ac[0]*Zb+I[0]*$a,$b[1]+ac[1]*Zb+I[1]*$a]);bc.push(a);
bc.push([$b[0]-ac[0]*Zb+I[0]*$a,$b[1]-ac[1]*Zb+I[1]*$a]);b.push(bc);break;case h.GeometricEffectControlMeasureLineRule.ChevronArrowOffset:const [tb,Fd]=this._arrowLastSeg(c),J=this._sub(a,tb),cc=this._norm(J);this._normalize(J);const dc=this._crossProduct(J,this._sub(Fd,tb));let bb=this._dotProduct(J,this._sub(Fd,tb));bb<.05*cc?bb=.05*cc:bb>.95*cc&&(bb=.95*cc);const ub=[tb[0]+J[0]*bb,tb[1]+J[1]*bb];this._leftPerpendicular(J);const ec=[];ec.push([ub[0]+J[0]*dc*.5,ub[1]+J[1]*dc*.5]);ec.push(this._mid(ub,
a));ec.push([ub[0]-J[0]*dc*.5,ub[1]-J[1]*dc*.5]);b.push(ec);break;case h.GeometricEffectControlMeasureLineRule.PartialFirstSegment:const [vb,we]=this._arrowLastSeg(c),wb=this._sub(a,vb),fc=this._norm(wb);this._normalize(wb);let cb=this._dotProduct(wb,this._sub(we,vb));cb<.05*fc?cb=.05*fc:cb>.95*fc&&(cb=.95*fc);b.push([vb,[vb[0]+wb[0]*cb,vb[1]+wb[1]*cb]]);break;case h.GeometricEffectControlMeasureLineRule.Arch:const Sc=this._cp2(c,0,-1),gc=this._cp3(c,Sc,.5,1),Gd=this._sub(a,Sc),xe=this._mix(gc,1,
Gd,.55),ye=this._mix(gc,1,Gd,-.55),Tc=[a];this._addBezier2(Tc,a,xe,gc,4);this._addBezier2(Tc,gc,ye,Sc,4);b.push(Tc);break;case h.GeometricEffectControlMeasureLineRule.CurvedParallelTicks:const la=this._cp2(c,-4,1),xb=this._cp3(c,la,.882353,-1.94),Ha=this._sub(xb,la);0<this._crossProduct(Ha,this._sub(a,la))?this._rightPerpendicular(Ha):this._leftPerpendicular(Ha);const Uc=[Ha[0]/8,Ha[1]/8],Hd=this._sub(this._mid(la,xb),Uc),ze=this._sub(this._mix(la,.75,xb,.25),Uc),Ae=this._sub(this._mix(la,.25,xb,
.75),Uc),hc=[la];this._addBezier2(hc,la,ze,Hd,3);this._addBezier2(hc,Hd,Ae,xb,3);b.push(hc);for(let f=0;8>f;f++){const m=hc[2*f+1],q=[this._clone(m)];q.push(this._add(m,[Ha[0]/4,Ha[1]/4]));b.push(q)}break;case h.GeometricEffectControlMeasureLineRule.Arc90Degrees:const Vc=this._cp2(c,0,-1),Be=this._cp3(c,Vc,.5,1),Id=[Vc];this._add90DegArc(Id,Vc,a,Be);b.push(Id);break;case h.GeometricEffectControlMeasureLineRule.TipWithPerpendicularAndTicks:const [Wc,Jd]=this._arrowLastSeg(c),db=10*this._geomUnitsPerPoint,
K=this._sub(a,Wc),yb=this._norm(K);this._normalize(K);let U=this._crossProduct(K,this._sub(Jd,Wc)),zb=this._dotProduct(K,this._sub(Jd,Wc));zb<.05*yb?zb=.05*yb:zb>.95*yb-db&&(zb=.95*yb-db);const ma=this._leftPerp(K),Z=[a[0]-K[0]*db,a[1]-K[1]*db],na=.5*Math.max(yb-zb-db,db);U=Math.abs(U);const Ab=[];Ab.push([Z[0]+ma[0]*(U+na)-K[0]*na,Z[1]+ma[1]*(U+na)-K[1]*na]);Ab.push([Z[0]+ma[0]*U,Z[1]+ma[1]*U]);Ab.push([Z[0]-ma[0]*U,Z[1]-ma[1]*U]);Ab.push([Z[0]-ma[0]*(U+na)-K[0]*na,Z[1]-ma[1]*(U+na)-K[1]*na]);b.push(Ab);
b.push([Z,a]);break;case h.GeometricEffectControlMeasureLineRule.ConcentricCircles:const Kd=this._cp2(c,1,0),Ce=this._cp3(c,Kd,2,0),Xc=Math.cos(Math.PI/18),Yc=Math.sin(Math.PI/18);let Bb=this._dist(Kd,a),aa=[Bb,0],V=[];for(let f=0;36>=f;f++)V.push(this._add(a,aa)),this._rotateDirect(aa,Xc,Yc);b.push(V);if(4<=e){V=[];Bb=this._dist(c[3],a);aa=[Bb,0];for(let f=0;36>=f;f++)V.push(this._add(a,aa)),0===f&&(V.push(this._add(a,aa)),ib.setId(V[1],1)),this._rotateDirect(aa,Xc,Yc);b.push(V)}V=[];Bb=this._dist(Ce,
a);aa=[Bb,0];for(let f=0;36>=f;f++)V.push(this._add(a,aa)),this._rotateDirect(aa,Xc,Yc);b.push(V);break;case h.GeometricEffectControlMeasureLineRule.DoubleJogArrow:a=this._arrowPath(c)[0];const [De,Ld]=this._arrowLastSeg(c),t=this._sub(a,De),ic=this._norm(t);this._normalize(t);const Cb=Math.abs(this._crossProduct(t,this._sub(Ld,a)));let ba=Math.abs(this._dotProduct(t,this._sub(Ld,a)));ba<.05*ic?ba=.05*ic:ba>.95*ic&&(ba=.95*ic);const r=Math.max(Cb,ba),w=this._leftPerp(t);let L=[];const k=[a[0]-t[0]*
ba*.5+w[0]*Cb*.5,a[1]-t[1]*ba*.5+w[1]*Cb*.5];L.push([k[0],k[1]]);k[0]+=t[0]*r*.5+w[0]*r*.4;k[1]+=t[1]*r*.5+w[1]*r*.4;L.push([k[0],k[1]]);k[0]-=w[0]*r*.25;k[1]-=w[1]*r*.25;L.push([k[0],k[1]]);k[0]+=t[0]*r*.5+w[0]*r*.4;k[1]+=t[1]*r*.5+w[1]*r*.4;L.push([k[0],k[1]]);b.push(L);L=[];k[0]=a[0]-t[0]*ba*.5-w[0]*Cb*.5;k[1]=a[1]-t[1]*ba*.5-w[1]*Cb*.5;L.push([k[0],k[1]]);k[0]+=t[0]*r*.5-w[0]*r*.4;k[1]+=t[1]*r*.5-w[1]*r*.4;L.push([k[0],k[1]]);k[0]+=w[0]*r*.25;k[1]+=w[1]*r*.25;L.push([k[0],k[1]]);k[0]+=t[0]*r*
.5-w[0]*r*.4;k[1]+=t[1]*r*.5-w[1]*r*.4;L.push([k[0],k[1]]);b.push(L);break;case h.GeometricEffectControlMeasureLineRule.LinkedChevrons:const eb=this._cp2(c,-5,0),Ee=this._cp3(c,eb,-.2,1),M=this._sub(a,eb);this._normalize(M);const oa=this._leftPerp(M),x=Math.abs(this._crossProduct(M,this._sub(Ee,eb)));b.push([eb,a]);const jc=[];jc.push([a[0]-M[0]*x+oa[0]*x,a[1]-M[1]*x+oa[1]*x]);jc.push(a);jc.push([a[0]-M[0]*x-oa[0]*x,a[1]-M[1]*x-oa[1]*x]);b.push(jc);this._addDash(b,eb,[-M[0]*x+oa[0]*x,-M[1]*x+oa[1]*
x]);this._addDash(b,eb,[-M[0]*x-oa[0]*x,-M[1]*x-oa[1]*x]);break;case h.GeometricEffectControlMeasureLineRule.SegmentThenHalfCircle:const fb=this._cp2(c,2,0),Fe=this._cp3(c,fb,1.5,0);let Md;Md=4<=e?c[3]:this._cp3(c,fb,1.25,-.5);const D=this._sub(fb,a);this._normalize(D);const Nd=.5*this._dist(fb,Fe),Ge=0<this._crossProduct(D,this._sub(Md,a)),He=Math.cos(Math.PI/18);let Zc=Math.sin(Math.PI/18);Ge&&(Zc=-Zc);const Od=[a,fb];D[0]*=Nd;D[1]*=Nd;const Ie=this._add(fb,D);D[0]=-D[0];D[1]=-D[1];for(let f=1;18>=
f;f++)this._rotateDirect(D,He,Zc),Od.push(this._add(Ie,D));b.push(Od);break;case h.GeometricEffectControlMeasureLineRule.LineWithStraightTicks:const kc=this._cp2(c,-2,1),$c=this._cp3(c,kc,-1,-.5),Ia=this._sub($c,kc);this._normalize(Ia);const Pd=this._dotProduct(Ia,this._sub(kc,a)),Qd=this._dotProduct(Ia,this._sub($c,a));let Ja=[a];Ja.push([a[0]+Ia[0]*Pd,a[1]+Ia[1]*Pd]);Ja.push(kc);b.push(Ja);Ja=[a];Ja.push([a[0]+Ia[0]*Qd,a[1]+Ia[1]*Qd]);Ja.push($c);b.push(Ja);break;case h.GeometricEffectControlMeasureLineRule.DoubleCurve:const Ka=
this._cp2(c,-5,-1),La=this._cp3(c,Ka,2,0),Rd=Math.atan2(1,5),Sd=Math.cos(Rd),Td=Math.sin(Rd),pa=this._sub(Ka,a),gb=this._dist(a,Ka);this._normalize(pa);this._rotateDirect(pa,Sd,-Td);const qa=[a];qa.push([a[0]+pa[0]*gb*.5,a[1]+pa[1]*gb*.5]);ib.setId(qa[1],1);qa.push([a[0]+pa[0]*gb*.8,a[1]+pa[1]*gb*.8]);this._addBezier2(qa,qa[2],[a[0]+pa[0]*gb,a[1]+pa[1]*gb],Ka,3);const hb=this._sub(La,Ka),lc=this._dist(Ka,La);this._normalize(hb);this._rotateDirect(hb,Sd,-Td);this._addBezier2(qa,Ka,[La[0]-hb[0]*lc,
La[1]-hb[1]*lc],[La[0]-hb[0]*lc*.8,La[1]-hb[1]*lc*.8],3);qa.push(La);b.push(qa);break;case h.GeometricEffectControlMeasureLineRule.ParallelWithTicksByWidth:const W=this._cp2(c,0,-1),Je=this._cp3(c,W,.5,3),N=this._sub(W,a);this._normalize(N);const ca=this._crossProduct(N,this._sub(Je,a));this._leftPerpendicular(N);0<ca?(this._addAngledTicks(b,a,[a[0]+N[0]*ca,a[1]+N[1]*ca],W),this._addAngledTicks(b,W,[W[0]+N[0]*ca,W[1]+N[1]*ca],a)):(this._addAngledTicks(b,[a[0]+N[0]*ca,a[1]+N[1]*ca],a,W),this._addAngledTicks(b,
[W[0]+N[0]*ca,W[1]+N[1]*ca],a,W));break;case h.GeometricEffectControlMeasureLineRule.EnclosingRoundedRectangle:const mc=this._cp2(c,3,-2),p=[Math.min(a[0],mc[0]),Math.max(a[1],mc[1])],u=[Math.max(a[0],mc[0]),Math.min(a[1],mc[1])],ad=u[0]-p[0],y=Math.min(ad,p[1]-u[1])/10,X=[];X.push([p[0]+y+.75*(ad-2*y),p[1]]);X.push([u[0]-y,p[1]]);this._add90DegArc(X,[u[0]-y,p[1]],[u[0],p[1]-y],[u[0],p[1]]);X.push([u[0],u[1]+y]);this._add90DegArc(X,[u[0],u[1]+y],[u[0]-y,u[1]],u);X.push([p[0]+y,u[1]]);this._add90DegArc(X,
[p[0]+y,u[1]],[p[0],u[1]+y],[p[0],u[1]]);X.push([p[0],p[1]-y]);this._add90DegArc(X,[p[0],p[1]-y],[p[0]+y,p[1]],p);X.push([p[0]+y+.75*(ad-2*y),p[1]]);break;default:b.push(c)}}return b}}bd.EffectControlMeasureLine=Ma;Object.defineProperty(bd,Symbol.toStringTag,{value:"Module"})});