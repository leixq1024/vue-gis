// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("./CIMSymbolHelper ./rasterizingUtils ./Rect ./SDFHelper ./utils ../../views/2d/engine/webgl/definitions".split(" "),function(k,m,y,n,p,l){function q(b){if(!b)return null;const {data:e,width:c,height:a,sdfPaddingRatio:f,sdfDecodeCoeff:d}=n.buildSDF(b);return e?{size:[c,a],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,sdfPaddingRatio:f,sdfDecodeCoeff:d,anchorX:0,anchorY:0}:null}class z{constructor(b){this._resourceManager=b;this._cachedRasterizationCanvas=null}dispose(){this._cachedRasterizationCanvas=
null}get _canvas(){this._cachedRasterizationCanvas||(this._cachedRasterizationCanvas=document.createElement("canvas"));return this._cachedRasterizationCanvas}rasterizeJSONResource(b){switch(b.type){case "dash":b=p.normalizeDashTemplate(b.dashTemplate);const [e,c,a]=m.rasterizeDash1D(b);return{size:[c,a],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0};case "fill-style":const [f,d,g,h]=m.rasterizeFillStyle(this._canvas,b,l.patternFillRasterizationScale);return{size:[d,g],
image:new Uint32Array(f.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:h};case "sdf":return q(b);case "CIMHatchFill":case "CIMVectorMarker":case "CIMPictureMarker":return this._rasterizeCIMJSONResource(b)}}_rasterizeCIMJSONResource(b){switch(b.type){case "CIMHatchFill":return b=k.CIMSymbolHelper.fromCIMHatchFill(b,l.patternFillRasterizationScale),this._rasterizeCIMVectorMarker(b);case "CIMPictureMarker":return b=k.CIMSymbolHelper.fromCIMInsidePolygon(b),this._rasterizeCIMVectorMarker(b);
case "CIMVectorMarker":if("CIMMarkerPlacementInsidePolygon"===b.markerPlacement?.type)return b=k.CIMSymbolHelper.fromCIMInsidePolygon(b),this._rasterizeCIMVectorMarker(b);const e=n.getSDFInfo(b);return e&&!b.avoidSDFRasterization?q(e):this._rasterizeCIMVectorMarker(b,!1,l.rasterizedVectorMarkerMinSize)}}_rasterizeCIMVectorMarker(b,e=!0,c){e=e?y.fromExtent(b.frame):null;const [a,f,d,g,h]=k.CIMSymbolHelper.rasterize(this._canvas,b,e,this._resourceManager,!0,c);return a?{size:[f,d],image:new Uint32Array(a.buffer),
sdf:!1,simplePattern:!1,anchorX:g,anchorY:h}:null}rasterizeImageResource(b,e,c,a){this._canvas.width=b;this._canvas.height=e;var f=this._canvas.getContext("2d",{willReadFrequently:!0});c instanceof ImageData?f.putImageData(c,0,0):(c.setAttribute("width",`${b}px`),c.setAttribute("height",`${e}px`),f.drawImage(c,0,0,b,e));c=f.getImageData(0,0,b,e);c=new Uint8Array(c.data);if(a)for(var d of a)if(d&&d.oldColor&&4===d.oldColor.length&&d.newColor&&4===d.newColor.length){const [g,h,r,t]=d.oldColor,[u,v,
w,x]=d.newColor;if(g!==u||h!==v||r!==w||t!==x)for(a=0;a<c.length;a+=4)g===c[a]&&h===c[a+1]&&r===c[a+2]&&t===c[a+3]&&(c[a]=u,c[a+1]=v,c[a+2]=w,c[a+3]=x)}for(a=0;a<c.length;a+=4)d=c[a+3]/255,c[a]*=d,c[a+1]*=d,c[a+2]*=d;f=c;d=b;a=e;if(512<=d||512<=a){f=d/a;1<f?(d=512,a=Math.round(512/f)):(a=512,d=Math.round(512*f));f=new Uint8Array(4*d*a);const g=new Uint8ClampedArray(f.buffer);p.resampleHermite(c,b,e,g,d,a,!1)}return{size:[d,a],image:new Uint32Array(f.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}
return z});