// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../core/Logger ./animationDebugFlags ./defaultCIMValues ./enums ./SDFHelper ./utils ../../views/2d/engine/webgl/animations/instructions".split(" "),function(k,x,t,u,n,y,g,p){function q(b,a){let c=0,d=0;const e="Absolute"!==b.anchorPointUnits;b.anchorPoint&&(c=-b.anchorPoint.x,d=-b.anchorPoint.y);return{...a,transform:{type:"AnimatedTransform",relativeTranslation:e,absoluteScale:!1,translation:f([c,d]),rotation:f(0),scale:f(1),parent:a.transform}}}function v(b,a){switch(a.type){case "CIMSolidStroke":case "CIMSolidFill":return g.getProcessParam(b,
a,"Color");case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":return g.getProcessParam(b,a,"TintColor")}return[1,1,1,1]}function z(b,a,c){var {animations:d}=a;a=v(b,a);(d=d?.filter(e=>"CIMSymbolAnimationColor"===e.type)[0])&&(a=g.getProcessParam(b,d,"ToColor"));return{type:"AnimatedColor",color:f(a),opacity:f(1),parent:c}}function A(b,a,c){({animations:a}=a);return(a=a?.filter(d=>"CIMSymbolAnimationColor"===d.type)[0])?{type:"AnimatedColor",color:f([1,1,1,1]),opacity:{from:0,to:1,
timing:m(b,a?.animatedSymbolProperties)},parent:[1,1,1,1]}:c}function B(b,a,c){var {animations:d}=a;a=f(1);if(d=d?.filter(e=>"CIMSymbolAnimationTransparency"===e.type)[0])b=g.getProcessParam(b,d,"ToTransparency"),a=f({type:"Process",op:"Transparency",value:b});return{type:"AnimatedColor",color:f([1,1,1,1]),opacity:a,parent:c}}function C(b,a,c){({animations:a}=a);return(a=a?.filter(d=>"CIMSymbolAnimationTransparency"===d.type)[0])?{type:"AnimatedColor",color:f([1,1,1,1]),opacity:{from:0,to:1,timing:m(b,
a?.animatedSymbolProperties)},parent:[1,1,1,1]}:c}function m(b,a){if(!a)return{duration:1,startTimeOffset:0,repeatDelay:0,timeOriginSelector:p.TimeOrigin.Local,repeatType:n.AnimatedSymbolRepeatType.Loop,easing:n.AnimatedSymbolEasingType.Linear,playAnimation:1,reverseAnimation:0};const c=g.getProcessParam(b,a,"Duration");if(g.getProcessParam(b,a,"RandomizeStartTime")){var d=g.getProcessParam(b,a,"RandomizeStartSeed");d={type:"Process",op:"Random",min:0,max:c,seed:d}}else d=g.getProcessParam(b,a,"StartTimeOffset");
const e=g.getProcessParam(b,a,"RepeatDelay"),h=g.getProcessParam(b,a,"PlayAnimation");b=g.getProcessParam(b,a,"ReverseAnimation");const l=g.getValue(a.repeatType,u.defaultCIMValues.CIMAnimatedSymbolProperties.repeattype),r=l===n.AnimatedSymbolRepeatType.None?p.TimeOrigin.Local:p.TimeOrigin.Global;a=g.getValue(a.easing,u.defaultCIMValues.CIMAnimatedSymbolProperties.easing);return{duration:c,startTimeOffset:d,repeatDelay:e,timeOriginSelector:r,repeatType:l,easing:a,playAnimation:h,reverseAnimation:b}}
function D(b,a){var {animations:c}=a;if("CIMPictureMarker"!==a.type&&"CIMVectorMarker"!==a.type&&"CIMPointSymbol"!==a.type)return f(1);a="CIMPictureMarker"===a.type||"CIMVectorMarker"===a.type?g.getProcessParam(b,a,"Size"):g.getSize(a)||10;const d=c?.filter(e=>"CIMSymbolAnimationScale"===e.type)[0];return d?{from:1,to:g.getProcessParam(b,d,"ScaleFactor"),timing:m(b,d.animatedSymbolProperties)}:(c=c?.filter(e=>"CIMSymbolAnimationSize"===e.type)[0])?{from:1,to:{type:"Process",op:"Divide",left:g.getProcessParam(b,
c,"ToSize"),right:a},timing:m(b,c.animatedSymbolProperties)}:f(1)}function E(b,a){({animations:a}=a);a=a?.filter(e=>"CIMSymbolAnimationOffset"===e.type)[0];if(!a)return f([0,0]);const c=g.getProcessParam(b,a,"OffsetX"),d=g.getProcessParam(b,a,"OffsetY");return{from:[0,0],to:[c,d],timing:m(b,a.animatedSymbolProperties)}}function F(b,a){var {animations:c}=a;a:{switch(a.type){case "CIMPictureMarker":case "CIMVectorMarker":a=g.getProcessParam(b,a,"Rotation");break a}a=0}c=c?.filter(e=>"CIMSymbolAnimationRotation"===
e.type)[0];if(!c)return f(a);const d=g.getProcessParam(b,c,"ToRotation");return{from:a,to:d,timing:m(b,c.animatedSymbolProperties)}}function f(b){return{from:b,to:b,timing:{duration:1,startTimeOffset:0,repeatDelay:0,timeOriginSelector:p.TimeOrigin.Local,repeatType:n.AnimatedSymbolRepeatType.Loop,easing:n.AnimatedSymbolEasingType.Linear,playAnimation:1,reverseAnimation:0}}}function w(b){if(null==b||"object"!==typeof b)return!1;if(b.animations&&Array.isArray(b.animations)&&0<b.animations.length)return!0;
for(const a in b)if(w(b[a]))return!0;return!1}k.checkForAnimations=w;k.getAnimationParams=function(b,a,c){var d=c.transform;var e=E(b,a),h=F(b,a),l=D(b,a);d={type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!1,translation:e,rotation:h,scale:l,parent:d};e=c.fromColor;h=f(v(b,a));l=f(1);e={type:"AnimatedColor",color:h,opacity:l,parent:e};h=z(b,a,c.toColor);l=A(b,a,c.colorMix);const r=B(b,a,c.toOpacity);b=C(b,a,c.opacityMix);return{transform:d,fromColor:e,toColor:h,colorMix:l,toOpacity:r,
opacityMix:b,hasAnimations:c.hasAnimations||!!a.animations&&0<a.animations.length}};k.getFrameTranslation=function(b,a){const c=a?.5*-(a.xmin+a.xmax):0;a=a?.5*-(a.ymin+a.ymax):0;let d=0;var e=0;if("x"in b&&"y"in b)d=b.x+c,e=b.y+a;else if(b=y.getExtent(b))e=(b[1]+b[3])/2,d=(b[0]+b[2])/2+c,e+=a;return[d,e]};k.getStaticParam=f;k.handleAbsoluteAnchor=function(b,a){return"Absolute"!==b.anchorPointUnits?a:q(b,a)};k.handleAnchor=q;k.handleMarker=function(b,a,c){if("CIMCharacterMarker"===a.type)return x.getLogger("animationUtils").error("#handleMarker()",
"CIM character markers do not support animations"),c;const d=g.getProcessParam(b,a,"OffsetX"),e=g.getProcessParam(b,a,"OffsetY");if("CIMPictureMarker"===a.type)return{...c,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!0,translation:f([d,e]),rotation:f(0),scale:f(g.getProcessParam(b,a,"Size")),parent:c.transform}};var h=a.frame;h=h.ymax-h.ymin;return{...c,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!1,translation:f([d,e]),rotation:f(0),scale:f({type:"Process",
op:"Divide",left:g.getProcessParam(b,a,"Size"),right:h}),parent:c.transform}}};k.handleRelativeAnchor=function(b,a){return"Absolute"===b.anchorPointUnits?a:q(b,a)};k.shouldUseAnimatedPath=function(b){return t.animationDebugFlags.forceStaticPath?!1:t.animationDebugFlags.forceAnimatedPath||b.hasAnimations};k.translate=function(b,a,c){return{...b,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!1,translation:f([a,c]),rotation:f(0),scale:f(1),parent:b.transform}}};Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})});