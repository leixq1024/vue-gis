// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["require","exports","./defaultCIMValues"],function(V,f,x){function I(a){return"function"===typeof a}function J(a){let b=a.length;for(;b--;)if(!" /-,\n".includes(a.charAt(b)))return!1;return!0}function K(a,b){"string"!==typeof a&&(a=String(a));switch(b){case "LowerCase":return a.toLowerCase();case "Allcaps":return a.toUpperCase();default:return a}}function L(a){return a?[a[0],a[1],a[2],a[3]/255]:[0,0,0,0]}function M(a){return null!=a&&("CIMMarkerPlacementAlongLineRandomSize"===a.type||"CIMMarkerPlacementAlongLineSameSize"===
a.type||"CIMMarkerPlacementAlongLineVariableSize"===a.type||"CIMMarkerPlacementAtExtremities"===a.type||"CIMMarkerPlacementAtMeasuredUnits"===a.type||"CIMMarkerPlacementAtRatioPositions"===a.type||"CIMMarkerPlacementOnLine"===a.type||"CIMMarkerPlacementOnVertices"===a.type)}function E(a){if(!a)return null;switch(a.type){case "CIMPolygonSymbol":if(a.symbolLayers)for(const b of a.symbolLayers)if(a=E(b),null!=a)return a;break;case "CIMTextSymbol":return E(a.symbol);case "CIMSolidFill":return a.color}return null}
function F(a){if(a)switch(a.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(a=a.symbolLayers)for(const b of a)if(a=F(b),null!=a)return a;break;case "CIMTextSymbol":return F(a.symbol);case "CIMSolidStroke":return a.color}}function G(a){if(a)switch(a.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(a.symbolLayers)for(const b of a.symbolLayers)if(a=G(b),void 0!==a)return a;break;case "CIMTextSymbol":return G(a.symbol);case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return a.width}}
function y(a){return a?a.charAt(0).toLowerCase()+a.slice(1):a}function N(a){if(null==a)return!1;if(Array.isArray(a))return a.every(b=>N(b));switch(typeof a){case "string":return!!a;case "number":return!isNaN(a)}}function O(a,b){if("color"===b||"outlinecolor"===b||"backgroundcolor"===b||"borderlinecolor"===b||"tintcolor"===b)return[...x.defaultCIMColor[b]];const c=x.defaultCIMValues[a];if(!c)throw Error(`InternalError: default value for type ${a}.`);return c[b]}function P(a){return a.split(" ").map(b=>
Number(b))}function Q(a){return"string"===typeof a?P(a):a}function H(a){if(null==a)return"Normal";switch(a.type){case "CIMTextSymbol":return a.textCase??"Normal";case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":var b=a.symbolLayers;if(!b)break;for(var c of b)if("CIMVectorMarker"===c.type)return H(c);break;case "CIMVectorMarker":if(c=a.markerGraphics)for(b of c)if(b.symbol)return H(b.symbol)}return"Normal"}function R(a,b){return null!==b?(b=b.get(a))?b.name:a:a}function S(a,b,c,e,
g){return(c=c*Math.PI/180)?(Math.sin(c)*a+Math.cos(c)*b)*e+g:b*e+g}function T(a,b,c,e,g){return(c=c*Math.PI/180)?(Math.cos(c)*a-Math.sin(c)*b)*e+g:a*e+g}f.adjustTextCase=K;f.analyzeTextParts=function(a,b){const c=[];var e=0;let g=-1;do g=a.indexOf("[",e),g>=e&&(g>e&&(e=a.slice(e,g),c.push([e,null,J(e)])),e=g+1,g=a.indexOf("]",e),g>=e&&(g>e&&(e=a.slice(e,g),(e=b[e])&&c.push([null,e,!1])),e=g+1));while(-1!==g);e<a.length&&(a=a.slice(e),c.push([a,null,J(a)]));return c};f.applyParentTransform=function(a,
b,c,e,g,d,r=!0){const {infos:l}=d;d=1;let k=0;var t=0,h=0;let m=1;for(const {absoluteAnchorPoint:n,offsetX:p,offsetY:u,rotation:v,size:z,frameHeight:w,rotateClockWise:A,scaleSymbolsProportionally:B}of l)m=n?1:d,t=T(p,u,k,m,t),h=S(p,u,k,m,h),w&&(B||r)&&(d*=z/w),k=A?k-v:k+v;r=T(e,g,k,m,t);e=S(e,g,k,m,h);return{size:a*d,rotation:c?k-b:k+b,offsetX:r,offsetY:e}};f.assignTextValuesFromFeature=function(a,b,c,e){let g="",d=null;for(const r of b){const [l,k,t]=r;if(l)t?d=l:(d&&(g+=d,d=null),g+=l);else if(b=
k,null!=c&&(b=R(k,c)),b=a.attributes[b])d&&(g+=d,d=null),g+=b}return K(g,e)};f.attributesToFields=function(a){return(a?Object.keys(a):[]).map(b=>({name:b,alias:b,type:"string"===typeof a[b]?"esriFieldTypeString":"esriFieldTypeDouble"}))};f.colorToArray=function(a){return[a.r,a.g,a.b,a.a]};f.evaluateValueOrFunction=function(a,b,c,e){return I(a)?a(b,c,e):a};f.fromCIMFontDecoration=function(a){return a.underline?"underline":a.strikethrough?"line-through":"none"};f.fromCIMFontStyle=function(a){let b=
"normal",c="normal";a&&(a=a.toLowerCase(),a.includes("italic")?b="italic":a.includes("oblique")&&(b="oblique"),a.includes("bold")?c="bold":a.includes("light")&&(c="lighter"));return{style:b,weight:c}};f.fromCIMHorizontalAlignment=function(a){switch(a){default:return"left";case "Right":return"right";case "Center":return"center";case "Justify":return"center"}};f.fromCIMVerticalAlignment=function(a){switch(a){default:return"top";case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}};
f.getDefaultCIMValue=O;f.getEnum=(a,b)=>null==a?b:a;f.getFieldName=R;f.getFillColor=E;f.getFontStyle=function(a){if(!a)return"normal";switch(a.toLowerCase()){case "italic":return"italic";case "oblique":return"oblique";default:return"normal"}};f.getFontWeight=function(a){if(!a)return"normal";switch(a.toLowerCase()){case "bold":return"bold";case "bolder":return"bolder";case "lighter":return"lighter";default:return"normal"}};f.getNumericValue=(a,b=0)=>null==a||isNaN(a)?b:a;f.getProcessParam=function(a,
b,c){const e="Color"===c||"TintColor"===c||"ToColor"===c,g="Rotation"===c||"Angle"===c||"ToRotation"===c;let d=b[y(c)];null!=d&&(e?d=[d[0]/255,d[1]/255,d[2]/255,d[3]/255]:g&&(d*=Math.PI/180));null==d&&(d=O(b.type,c.toLowerCase()),null!=d&&(e?d=[d[0]/255,d[1]/255,d[2]/255,d[3]]:g&&(d*=Math.PI/180)));null!=b.primitiveName&&(a=a[b.primitiveName],null!=a&&(a=a[c],null!=a&&("string"===typeof a||"number"===typeof a||Array.isArray(a)?(d=a,null!=d&&(e?d=[d[0]/255,d[1]/255,d[2]/255,d[3]/255]:g&&(d*=Math.PI/
180))):(d={valueExpressionInfo:a,defaultValue:d},null!=d&&(e?d={type:"Process",op:"ArcadeColor",value:d}:g&&(d={type:"Process",op:"Divide",left:d,right:180/Math.PI}))))));if(null==d)throw Error(`Failed to derive a value or an expression for "${c}".`);return d};f.getSize=function(a){if(a)switch(a.type){case "CIMTextSymbol":return a.height;case "CIMPointSymbol":var b=0;if(a.symbolLayers)for(var c of a.symbolLayers)if(c)switch(c.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":a=
c.size??x.defaultCIMValues.CIMVectorMarker.size,a>b&&(b=a)}return b;case "CIMLineSymbol":case "CIMPolygonSymbol":c=0;if(a.symbolLayers)for(b of a.symbolLayers)if(b)switch(b.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":a=b.width;null!=a&&a>c&&(c=a);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":b.markerPlacement&&M(b.markerPlacement)&&(a=b.size??x.defaultCIMValues.CIMVectorMarker.size,a>
c&&(c=a));break;case "CIMPictureFill":a=b.height,null!=a&&a>c&&(c=a)}return c}};f.getStrokeColor=F;f.getStrokeWidth=G;f.getTextCasing=H;f.getTintColor=a=>a.tintColor?L(a.tintColor):[255,255,255,1];f.getValue=(a,b)=>null!=a?a:b;f.importGeometryEngine=function(){return new Promise((a,b)=>V(["../../geometry/geometryEngineJSON"],a,b))};f.isCIMFill=function(a){return null!=a&&("CIMGradientFill"===a.type||"CIMHatchFill"===a.type||"CIMPictureFill"===a.type||"CIMSolidFill"===a.type||"CIMWaterFill"===a.type)};
f.isCIMMarker=function(a){return"CIMVectorMarker"===a.type||"CIMPictureMarker"===a.type||"CIMBarChartMarker"===a.type||"CIMCharacterMarker"===a.type||"CIMPieChartMarker"===a.type||"CIMStackedBarChartMarker"===a.type};f.isCIMMarkerStrokePlacement=M;f.isCIMStroke=function(a){return"CIMGradientStroke"===a.type||"CIMPictureStroke"===a.type||"CIMSolidStroke"===a.type};f.isFeatureValueFn=I;f.isGeometryEngineRequired=a=>{if(!a)return!1;for(const b of a)switch(b.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":return!0}return!1};
f.isSVGImage=a=>a.includes("data:image/svg+xml");f.isValidCIMValue=N;f.mapCIMSymbolToGeometryType=function(a){if(!a)return null;switch(a.type){case "CIMPointSymbol":case "CIMTextSymbol":return"esriGeometryPoint";case "CIMLineSymbol":return"esriGeometryPolyline";case "CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}};f.normalizeAlpha=L;f.normalizeDashEffectTemplate=function(a){a?.dashTemplate&&(a.dashTemplate=Q(a.dashTemplate));return a};f.normalizeDashTemplate=Q;f.normalizePrimitiveOverrideProps=
function(a){return a.map(b=>({...b,propertyName:y(b.propertyName)}))};f.parseDashTemplate=P;f.resampleHermite=function(a,b,c,e,g,d,r=!0){const l=b/g;c/=d;const k=Math.ceil(l/2),t=Math.ceil(c/2);for(let n=0;n<d;n++)for(let p=0;p<g;p++){const u=4*(p+(r?d-n-1:n)*g);var h=0;let v=0,z=0,w=0,A=0,B=0,U=0;const W=(n+.5)*c;for(let C=Math.floor(n*c);C<(n+1)*c;C++){var m=Math.abs(W-(C+.5))/t;const X=(p+.5)*l;m*=m;for(let D=Math.floor(p*l);D<(p+1)*l;D++){let q=Math.abs(X-(D+.5))/k;h=Math.sqrt(m+q*q);-1<=h&&1>=
h&&(h=2*h*h*h-3*h*h+1,0<h&&(q=4*(D+C*b),U+=h*a[q+3],z+=h,255>a[q+3]&&(h=h*a[q+3]/250),w+=h*a[q],A+=h*a[q+1],B+=h*a[q+2],v+=h))}}e[u]=w/v;e[u+1]=A/v;e[u+2]=B/v;e[u+3]=U/z}};f.toCIMSymbolJSON=function(a){return a.data?.symbol??null};f.toLowerCaseProps=function(a){const b={};for(const c in a){const e=a[c];b[y(c)]=e}return b};f.uncapitalize=y;Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});