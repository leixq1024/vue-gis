/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import t from"../../Graphic.js";import{clone as s,C as r,r as i}from"../../core/lang.js";import o from"../../core/Error.js";import{m as a,h as n,a as l}from"../../chunks/handleUtils.js";import{r as p,d as c}from"../../chunks/maybe.js";import{throwIfAborted as u,debounce as m,whenOrAbort as d,ignoreAbortErrors as h}from"../../core/promiseUtils.js";import{watch as y,whenOnce as j,initial as f,syncAndInitial as g}from"../../core/reactiveUtils.js";import{a as b}from"../../chunks/uuid.js";import{property as k}from"../../core/accessorSupport/decorators/property.js";import"../../chunks/Logger.js";import{subclass as w}from"../../core/accessorSupport/decorators/subclass.js";import v from"../../layers/GraphicsLayer.js";import{v as S}from"../../chunks/layerUtils.js";import{g as I}from"../../chunks/helpMessageUtils.js";import{V as F}from"../../chunks/InputManager.js";import{S as M}from"../../chunks/SketchOptions.js";import U from"../../views/interactive/snapping/FeatureSnappingLayerSource.js";import{CreateFeaturesWorkflowData as V}from"./CreateFeaturesWorkflowData.js";import{c as _}from"../../chunks/asyncUtils.js";import{p as C}from"../../chunks/screenUtils.js";import{d as A}from"../../chunks/diffUtils.js";import{featureHasFields as T,fixFields as L,getDisplayFieldName as P}from"../../layers/support/fieldUtils.js";import{c as x,a as D}from"../../chunks/drapedUtils.js";import{m as E}from"../../chunks/lengthUtils.js";import{b as O,T as R}from"../../chunks/sizeVariableUtils.js";import{getRotationAngle as H,getSize as G}from"../../chunks/visualVariableUtils.js";import{t as z}from"../../symbols/support/jsonUtils.js";import{getDisplayedSymbol as B}from"../../symbols/support/symbolUtils.js";import{G as q}from"../../chunks/GraphicState.js";import{h as W,f as N}from"../../chunks/hitTestSelectUtils.js";import{g as Z}from"../../chunks/templateUtils.js";import Q from"./Workflow.js";import J from"../FeatureForm/FeatureFormViewModel.js";import K from"../Sketch/SketchViewModel.js";import"../../geometry.js";import"../../chunks/ensureType.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../core/JSONSupport.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/metadata.js";import"../../chunks/utils.js";import"../../chunks/ObservableBase.js";import"../../chunks/tracking.js";import"../../core/scheduling.js";import"../../chunks/reader.js";import"../../geometry/SpatialReference.js";import"../../chunks/unitUtils.js";import"../../chunks/jsonMap.js";import"../../config.js";import"../../chunks/assets.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/writer.js";import"../../geometry/Point.js";import"../../core/accessorSupport/decorators/cast.js";import"../../geometry/support/webMercatorUtils.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/coordsUtils.js";import"../../chunks/Axis.js";import"../../chunks/extentUtils.js";import"../../chunks/boundsUtils.js";import"../../chunks/aaBoundingRect.js";import"../../chunks/mathUtils.js";import"../../geometry/Polyline.js";import"../../chunks/typeUtils.js";import"../../geometry/support/jsonUtils.js";import"../../PopupTemplate.js";import"../../core/Clonable.js";import"../../core/Collection.js";import"../../core/Evented.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../popup/content.js";import"../../popup/content/AttachmentsContent.js";import"../../popup/content/Content.js";import"../../popup/content/CustomContent.js";import"../../popup/content/ExpressionContent.js";import"../../popup/ElementExpressionInfo.js";import"../../popup/content/FieldsContent.js";import"../../popup/FieldInfo.js";import"../../chunks/enumeration.js";import"../../popup/support/FieldInfoFormat.js";import"../../chunks/date.js";import"../../chunks/locale.js";import"../../chunks/datetime.js";import"../../popup/content/MediaContent.js";import"../../popup/content/BarChartMediaInfo.js";import"../../popup/content/mixins/ChartMediaInfo.js";import"../../popup/content/mixins/MediaInfo.js";import"../../popup/content/support/ChartMediaInfoValue.js";import"../../Color.js";import"../../chunks/colorUtils.js";import"../../popup/content/support/ChartMediaInfoValueSeries.js";import"../../chunks/chartMediaInfoUtils.js";import"../../popup/content/ColumnChartMediaInfo.js";import"../../popup/content/ImageMediaInfo.js";import"../../popup/content/support/ImageMediaInfoValue.js";import"../../popup/content/LineChartMediaInfo.js";import"../../popup/content/PieChartMediaInfo.js";import"../../popup/content/RelationshipContent.js";import"../../popup/support/RelatedRecordsInfoFieldOrder.js";import"../../popup/content/TextContent.js";import"../../popup/content/UtilityNetworkAssociationsContent.js";import"../../popup/support/UtilityNetworkAssociationType.js";import"../../popup/ExpressionInfo.js";import"../../popup/LayerOptions.js";import"../../popup/RelatedRecordsInfo.js";import"../../support/actions/ActionBase.js";import"../../core/Identifiable.js";import"../../support/actions/ActionButton.js";import"../../support/actions/ActionToggle.js";import"../../core/sql.js";import"../../intl.js";import"../../chunks/number.js";import"../../chunks/substitute.js";import"../../chunks/messages.js";import"../../symbols.js";import"../../symbols/CIMSymbol.js";import"../../symbols/Symbol.js";import"../../symbols/ExtrudeSymbol3DLayer.js";import"../../symbols/Symbol3DLayer.js";import"../../chunks/utils4.js";import"../../symbols/edges/Edges3D.js";import"../../chunks/materialUtils.js";import"../../chunks/opacityUtils.js";import"../../symbols/edges/SketchEdges3D.js";import"../../symbols/edges/SolidEdges3D.js";import"../../chunks/Symbol3DMaterial.js";import"../../chunks/vec3f64.js";import"../../symbols/FillSymbol.js";import"../../symbols/SimpleLineSymbol.js";import"../../symbols/LineSymbol.js";import"../../symbols/LineSymbolMarker.js";import"../../chunks/lineMarkers.js";import"../../symbols/FillSymbol3DLayer.js";import"../../symbols/patterns/LineStylePattern3D.js";import"../../symbols/patterns/StylePattern3D.js";import"../../chunks/utils5.js";import"../../chunks/colors.js";import"../../chunks/symbolLayerUtils3D.js";import"../../chunks/aaBoundingBox.js";import"../../symbols/Font.js";import"../../symbols/IconSymbol3DLayer.js";import"../../chunks/persistableUrlUtils.js";import"../../symbols/LabelSymbol3D.js";import"../../symbols/Symbol3D.js";import"../../chunks/collectionUtils.js";import"../../portal/Portal.js";import"../../core/Loadable.js";import"../../core/Promise.js";import"../../portal/PortalGroup.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../../symbols/LineSymbol3DLayer.js";import"../../symbols/LineStyleMarker3D.js";import"../../symbols/ObjectSymbol3DLayer.js";import"../../symbols/PathSymbol3DLayer.js";import"../../symbols/TextSymbol3DLayer.js";import"../../symbols/WaterSymbol3DLayer.js";import"../../symbols/support/StyleOrigin.js";import"../../chunks/Thumbnail.js";import"../../chunks/calloutUtils.js";import"../../symbols/callouts/Callout3D.js";import"../../symbols/callouts/LineCallout3D.js";import"../../symbols/support/Symbol3DVerticalOffset.js";import"../../symbols/LineSymbol3D.js";import"../../symbols/MarkerSymbol.js";import"../../symbols/MeshSymbol3D.js";import"../../symbols/PictureFillSymbol.js";import"../../chunks/urlUtils.js";import"../../symbols/PictureMarkerSymbol.js";import"../../symbols/PointSymbol3D.js";import"../../symbols/PolygonSymbol3D.js";import"../../symbols/SimpleFillSymbol.js";import"../../symbols/SimpleMarkerSymbol.js";import"../../symbols/TextSymbol.js";import"../../symbols/WebStyleSymbol.js";import"../../chunks/GraphicsCollection.js";import"../../layers/Layer.js";import"../../time/TimeExtent.js";import"../../chunks/timeUtils.js";import"../../layers/mixins/BlendLayer.js";import"../../chunks/jsonUtils.js";import"../../chunks/parser.js";import"../../chunks/utils2.js";import"../../chunks/mat4.js";import"../../chunks/common.js";import"../../layers/mixins/ScaleRangeLayer.js";import"../../chunks/ElevationInfo.js";import"../../chunks/unitConversionUtils.js";import"../../chunks/Queue.js";import"../../core/signal.js";import"../../views/interactive/sketch/SketchLabelOptions.js";import"../../views/interactive/sketch/SketchTooltipOptions.js";import"../../chunks/SketchTooltipVisibleElements.js";import"../../views/interactive/sketch/SketchValueOptions.js";import"../../chunks/angularMeasurementUtils.js";import"../../chunks/Cyclical.js";import"../../chunks/quantityUtils.js";import"../../chunks/vec2.js";import"../../chunks/vec2f64.js";import"../../chunks/vec3.js";import"../../chunks/projectVectorToVector.js";import"../../chunks/projectBuffer.js";import"../../chunks/geodesicConstants.js";import"../../chunks/projectPointToVector.js";import"../../geometry/projection.js";import"../../geometry/support/GeographicTransformation.js";import"../../geometry/support/GeographicTransformationStep.js";import"../../chunks/zscale.js";import"../../chunks/dehydratedPoint.js";import"../../geometry/support/geodesicUtils.js";import"../../chunks/ReactiveMap.js";import"./Edits.js";import"../../chunks/compilerUtils.js";import"../../chunks/defaults.js";import"../../chunks/defaultsJSON.js";import"../../chunks/utils12.js";import"../../symbols/support/cimSymbolUtils.js";import"../../chunks/utils7.js";import"../../chunks/enums2.js";import"../../chunks/LRUCache.js";import"../../chunks/MemCache.js";import"../../chunks/colorUtils2.js";import"../../chunks/vec4.js";import"../../chunks/vec4f64.js";import"../../chunks/projector.js";import"../../chunks/widgetUtils.js";import"../../chunks/mat2df32.js";import"../../chunks/mat2d.js";import"../../chunks/jsxFactory.js";import"../../chunks/jsxWidgetSupport.js";import"../../chunks/webStyleSymbolUtils.js";import"../../chunks/devEnvironmentUtils.js";import"../../chunks/styleUtils.js";import"../../chunks/UpdatingHandles.js";import"../../form/FormTemplate.js";import"../../form/ExpressionInfo.js";import"../../form/elements/GroupElement.js";import"../../form/elements/Element.js";import"../../form/support/elements.js";import"../../form/elements/AttachmentElement.js";import"../../form/elements/inputs/attachments/AttachmentInput.js";import"../../chunks/Input.js";import"../../form/elements/inputs/attachments/support/inputs.js";import"../../form/elements/inputs/attachments/AudioInput.js";import"../../chunks/utils8.js";import"../../form/elements/inputs/attachments/DocumentInput.js";import"../../form/elements/inputs/attachments/ImageInput.js";import"../../form/elements/inputs/attachments/SignatureInput.js";import"../../form/elements/inputs/attachments/VideoInput.js";import"../../form/elements/FieldElement.js";import"../../form/elements/support/inputs.js";import"../../form/elements/inputs/BarcodeScannerInput.js";import"../../form/elements/inputs/TextInput.js";import"../../form/elements/inputs/Input.js";import"../../form/elements/inputs/ComboBoxInput.js";import"../../form/elements/inputs/DatePickerInput.js";import"../../form/elements/inputs/DateTimeOffsetPickerInput.js";import"../../form/elements/inputs/DateTimePickerInput.js";import"../../form/elements/inputs/RadioButtonsInput.js";import"../../form/elements/inputs/SwitchInput.js";import"../../form/elements/inputs/TextAreaInput.js";import"../../form/elements/inputs/TextBoxInput.js";import"../../form/elements/inputs/TimePickerInput.js";import"../../chunks/domains.js";import"../../layers/support/CodedValueDomain.js";import"../../layers/support/Domain.js";import"../../layers/support/InheritedDomain.js";import"../../layers/support/RangeDomain.js";import"../../form/elements/RelationshipElement.js";import"../../form/elements/TextElement.js";import"../../chunks/formUtils.js";import"../../chunks/editableLayers.js";import"../../layers/catalog/catalogUtils.js";import"../../chunks/arcgisLayerUrl.js";import"../../layers/support/Subtype.js";import"../../chunks/featureFormUtils.js";import"../../chunks/utils3.js";import"../../chunks/basemapUtils.js";import"../../Basemap.js";import"../../chunks/loadAll.js";import"../../portal/PortalItem.js";import"../../portal/PortalItemResource.js";import"../../portal/PortalRating.js";import"../../support/BasemapStyle.js";import"../../chunks/writeUtils.js";import"../FeatureForm/FieldInput.js";import"../../chunks/featureUtils.js";import"../FeatureForm/EditableInput.js";import"../FeatureForm/InputBase.js";import"../../chunks/formUtils2.js";import"../../arcade.js";import"../../chunks/TimeOnly.js";import"../../chunks/UnknownTimeZone.js";import"../../chunks/ImmutableArray.js";import"../../layers/FeatureLayer.js";import"../../renderers/ClassBreaksRenderer.js";import"../../renderers/Renderer.js";import"../../renderers/support/AuthoringInfo.js";import"../../renderers/support/AuthoringInfoVisualVariable.js";import"../../chunks/colorRamps.js";import"../../rest/support/AlgorithmicColorRamp.js";import"../../rest/support/ColorRamp.js";import"../../rest/support/MultipartColorRamp.js";import"../../renderers/mixins/VisualVariablesMixin.js";import"../../renderers/visualVariables/ColorVariable.js";import"../../renderers/visualVariables/VisualVariable.js";import"../../renderers/visualVariables/support/ColorStop.js";import"../../renderers/visualVariables/OpacityVariable.js";import"../../renderers/visualVariables/support/OpacityStop.js";import"../../renderers/visualVariables/RotationVariable.js";import"../../renderers/visualVariables/SizeVariable.js";import"../../renderers/visualVariables/support/SizeStop.js";import"../../renderers/support/ClassBreakInfo.js";import"../../chunks/commonProperties.js";import"../../chunks/RendererLegendOptions.js";import"../../renderers/DictionaryRenderer.js";import"../../chunks/Version2.js";import"../../layers/support/FieldsIndex.js";import"../../chunks/OverrideHelper.js";import"../../chunks/quantizationUtils.js";import"../../renderers/DotDensityRenderer.js";import"../../renderers/support/AttributeColorInfo.js";import"../../renderers/HeatmapRenderer.js";import"../../renderers/support/HeatmapColorStop.js";import"../../chunks/heatmapUtils.js";import"../../renderers/PieChartRenderer.js";import"../../renderers/SimpleRenderer.js";import"../../renderers/UniqueValueRenderer.js";import"../../renderers/support/UniqueValue.js";import"../../renderers/support/UniqueValueClass.js";import"../../renderers/support/UniqueValueGroup.js";import"../../renderers/support/UniqueValueInfo.js";import"../../renderers/support/jsonUtils.js";import"../../chunks/MultiOriginJSONSupport.js";import"../../chunks/layerContainerType.js";import"../../core/workers/workers.js";import"../../core/workers/Connection.js";import"../../core/workers/RemoteClient.js";import"../../chunks/editsZScale.js";import"../../chunks/queryZScale.js";import"../../rest/support/FeatureSet.js";import"../../layers/support/Field.js";import"../../chunks/fieldType.js";import"../../layers/mixins/APIKeyMixin.js";import"../../chunks/ArcGISService.js";import"../../layers/mixins/CustomParametersMixin.js";import"../../chunks/EditBusLayer.js";import"../../layers/mixins/FeatureEffectLayer.js";import"../../layers/support/FeatureEffect.js";import"../../layers/support/FeatureFilter.js";import"../../rest/support/Query.js";import"../../chunks/DataLayerSource.js";import"../../chunks/FullTextSearch.js";import"../../chunks/spatialRelationships.js";import"../../rest/support/StatisticDefinition.js";import"../../layers/mixins/FeatureLayerBase.js";import"../../geometry/HeightModelInfo.js";import"../../chunks/commonProperties2.js";import"../../tables/AttributeTableTemplate.js";import"../../tables/elements/AttributeTableGroupElement.js";import"../../tables/elements/AttributeTableElement.js";import"../../tables/support/elements.js";import"../../tables/elements/AttributeTableAttachmentElement.js";import"../../tables/elements/AttributeTableFieldElement.js";import"../../tables/elements/AttributeTableRelationshipElement.js";import"../../chunks/featureLayerUtils.js";import"../../chunks/featureQueryAll.js";import"../../rest/support/AttachmentQuery.js";import"../../rest/support/RelationshipQuery.js";import"../../layers/support/GeometryFieldsInfo.js";import"../../layers/support/LayerFloorInfo.js";import"../../layers/support/Relationship.js";import"../../chunks/serviceCapabilitiesUtils.js";import"../../layers/mixins/FeatureReductionLayer.js";import"../../layers/support/AggregateField.js";import"../../layers/support/ExpressionInfo.js";import"../../chunks/FeatureReduction.js";import"../../layers/support/FeatureReductionBinning.js";import"../../layers/support/LabelClass.js";import"../../chunks/labelUtils.js";import"../../layers/support/FeatureReductionCluster.js";import"../../layers/support/FeatureReductionSelection.js";import"../../chunks/clusterUtils.js";import"../../chunks/MD5.js";import"../../layers/mixins/OperationalLayer.js";import"../../layers/mixins/OrderedLayer.js";import"../../chunks/OrderByInfo.js";import"../../layers/mixins/PortalLayer.js";import"../../chunks/portalItemUtils.js";import"../../layers/mixins/PublishableLayer.js";import"../../layers/support/PublishingInfo.js";import"../../layers/mixins/RefreshableLayer.js";import"../../layers/mixins/TemporalLayer.js";import"../../layers/support/TimeInfo.js";import"../../time/TimeInterval.js";import"../../layers/support/FeatureTemplate.js";import"../../layers/support/FeatureType.js";import"../../chunks/fieldProperties.js";import"../../chunks/labelingInfo.js";import"../../chunks/versionUtils.js";import"../../chunks/styleUtils2.js";import"../../support/popupUtils.js";import"../../chunks/AlphaCutoff.js";import"../../chunks/interfaces2.js";import"../FeatureForm/GroupInput.js";import"../FeatureForm/RelationshipInput.js";import"../../chunks/FeatureRelationshipViewModel.js";import"../../chunks/ReactiveSet.js";import"../../chunks/isSupportedObject.js";import"../../chunks/elevationInfoUtils.js";import"../../chunks/layerUtils2.js";import"../../chunks/keybindings.js";import"../../chunks/SnappingManager.js";import"../../chunks/normalizedPoint.js";import"../../chunks/Settings2.js";import"../../chunks/RightAngleSnappingHint.js";import"../../views/interactive/snapping/SnappingOptions.js";import"../../chunks/snappingUtils.js";import"../../chunks/plane.js";import"../../chunks/mat3f64.js";import"../../chunks/mat4f64.js";import"../../chunks/quatf64.js";import"../../chunks/mathUtils2.js";import"../../chunks/sphere.js";import"../../chunks/ray.js";import"../../chunks/mat3.js";import"../../chunks/geometry2dUtils.js";import"../../chunks/utils6.js";import"../../chunks/Version.js";import"../../chunks/viewUtils.js";import"../../chunks/screenUtils2.js";function X(e){return"update"===e.type}function Y(e){const t=e.sourceLayer;if(!t||"feature"!==t.type||!function(e){switch(e?.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":case"pie-chart":return!0;default:return!1}}(t.renderer))return{rotation:null,size:null};let s=null,r=null;const i=t.renderer.getVisualVariablesForType("rotation").filter((t=>(!t.axis||"heading"===t.axis)&&t.field&&!t.valueExpression&&null!=H(t,e)));1===i.length&&(s=function(e,t){const s="heading"===(e.axis||"heading")&&"arithmetic"===e.rotationType?-1:1,r=e.field,i=t.fields&&t.fields.filter((e=>e.name===r)),o=i&&1===i.length?i[0].type:"double",a={initial:0,current:0};return{field:r,fieldType:o,getDefault:()=>Promise.resolve(0),getValue:e=>(a.current=a.initial-s*e,$((a.current+360)%360,o)),setInitialValue:e=>{a.initial=e,a.current=0},isUpdatingInteractively:!1,rotationType:e.rotationType??"geographic"}}(i[0],t));const o=t.renderer.getVisualVariablesForType("size").filter((t=>t.field&&!t.useSymbolValue&&!t.valueExpression&&O(t)===R.RealWorldSize&&null!=G(t,e)));return 1===o.length&&(r=function(e,t){const s=e.field,r=e.axis,i=t.fields&&t.fields.filter((e=>e.name===s)),o=i&&1===i.length?i[0].type:"double",a={initial:0,current:0},n=E[e.valueUnit]??1;let l;return l="area"===e.valueRepresentation?e=>(e*n/2)**2*Math.PI:"radius"===e.valueRepresentation||"distance"===e.valueRepresentation?e=>e*n/2:e=>e*n,{field:s,fieldType:o,getDefault:async(e,t)=>$(l(await async function(e,t,s){if(null==t)return 0;const{symbol:r}=z(t);if(null==r||"web-style"===r.type||"cim"===r.type)return 0;const i=r.symbolLayers.at(0);if(!i)return 0;switch(i.type){case"icon":{const{computeIconLayerResourceSize:e}=await import("../../chunks/symbolLayerUtils.js");return i.size||Math.min(me.icon,(await e(i,me.icon))[0])||me.icon}case"text":return i.size||me.text;case"line":return i.size||me.line;case"object":{const{computeObjectLayerResourceSize:t}=await import("../../chunks/symbolLayerUtils.js");return function(e,t){switch(t){case"width":return e[0];case"depth":return e[1];case"height":return e[2];default:return e[2]||e[1]||e[0]}}(await t(i,e.scale/me.viewScaleSizeFactor),s)}case"path":return(null!=i.width?i.width:i.height)||e.scale/me.viewScaleSizeFactor;case"extrude":return i.size||e.scale/me.viewScaleSizeFactor;default:return 0}}(t,e,r)),o),getValue:(e,t)=>(a.initial||(a.initial=t.pixelSizeAt(t.center)),a.current=a.initial*e,$(a.current,o)),setInitialValue:e=>{a.initial=e,a.current=0},isUpdatingInteractively:!1,displayUnit:(p=e.valueUnit,"unknown"===p?null:p),axis:e.axis};var p}(o[0],t)),{rotation:s,size:r}}function $(e,t){switch(t){case"small-integer":case"integer":case"long":return Math.round(e);case"double":case"single":return e;default:return 0}}async function ee(e,t,s){const r=await B(e,{useSourceLayer:!0,ignoreGraphicSymbol:!0,webStyleCache:t,scale:s});null!=A(e.symbol,r)&&(e.symbol=r)}function te(e){return{...e.template?.prototype.attributes,...e.attributeOverrides}}async function se(e,s,r,i,o){const a=new t({sourceLayer:s,attributes:r}),{rotation:n,size:l}=Y(a);let p=await B(a,{useSourceLayer:!0,webStyleCache:i,scale:o}),c=!1;for(const t of[l,n])null!=t&&null==r[t.field]&&(r[t.field]=await t.getDefault(p,e.view),c=!0);switch(c&&(p=await B(a,{useSourceLayer:!0,webStyleCache:i,scale:o})),p?.type){case"simple-fill":case"polygon-3d":e.polygonSymbol=p;break;case"simple-line":case"line-3d":e.polylineSymbol=p;break;case"simple-marker":case"picture-marker":case"point-3d":case"cim":e.pointSymbol=p;break;case"mesh-3d":e.meshSymbol=p}re(e.tooltipOptions,l,n)}function re(e,t,s){e.visualVariables=null!=t||null!=s?{size:null!=t?{unit:t.displayUnit,axis:t.axis,valueType:t.fieldType}:null,rotation:null!=s?{valueType:s.fieldType,rotationType:s.rotationType??"geographic"}:null}:null}async function ie(e,t,s,i){switch(t.type){case"3d":return async function(e,t,s,i){if(0===e.length)return[];const{updatable:o,graphicsByLayer:a}=await s.async((async()=>{const{results:r}=await d(W(t,s),i),o=new Map;N(r).forEach((({graphic:e})=>(e=>{const t=e.layer,s=o.get(t);if(!s){const e=new Array;return o.set(t,e),e}return s})(e).push(e)));const a=e.filter((({capabilities:e,layer:t})=>e.update.enabled&&o.has(t)));return 0!==a.length&&s.stopPropagation(),{updatable:a,graphicsByLayer:o}}));return d(Promise.allSettled(o.map((async({layer:e})=>{const t=a.get(e),s=oe(e);if(t.every((e=>T(s,e))))return t;const o=[];for(const e of t){o.push(e.getObjectId());const t=Object.keys(e.attributes);r(s,t)}const n=e.createQuery();return n.returnGeometry=!1,n.objectIds=o,n.outFields=L(e.fieldsIndex,s),e.queryFeatures(n,{signal:i}).then((({features:e})=>e))}))),i)}(e,t,s,i);case"2d":return async function(e,t,s,r){if(0===e.length)return[];const{mapPoint:i}=s;if(null==i)return[];let o=null;const a=await s.async((async()=>{const{results:i}=await d(t.hitTest(s),r);if(0===i.length)return[];const a=new Set;o=N(i),o.forEach((({graphic:e})=>e&&a.add(e.layer)));const n=e.filter((e=>a.has(e.layer)&&e.supportsUpdateWorkflow));return n.length>0&&s.stopPropagation(),n}));return d(Promise.allSettled(a.map((async({layer:e})=>{const a=e.createQuery();a.returnGeometry=!1,a.outFields=oe(e);const n="renderer"in e?x({renderer:e.renderer,pointerType:s.pointerType}):0;a.geometry=D(i,n,t),a.outSpatialReference=t.spatialReference;const{features:l}=await e.queryFeatures(a,{signal:r});return o?.forEach((({graphic:t})=>{t.layer!==e||l.some((e=>e.getObjectId()===t.getObjectId()))||l.push(t)})),l}))),r)}(e,t,s,i)}}function oe(e){return L(e.fieldsIndex,[e.objectIdField,P({displayField:"displayField"in e?e.displayField:null,fields:e.fields})])}async function ae(e,t,s){const{sourceLayer:r}=e,i=r.createQuery();i.objectIds=[e.getAttribute(r.objectIdField)],i.outFields=["*"],i.returnM=r.capabilities.data.supportsM,i.returnZ=r.capabilities.data.supportsZ,"scene"===r.type&&null!=r.infoFor3D||(i.outSpatialReference=t);const o=await r.queryFeatures(i,{signal:s});return u(s),o.features[0]}async function ne(e){const{graphic:t,sketchViewModel:s,sourceLayer:r,visualVariables:i,webStyleCache:o}=e;let a=!1;const{rotation:n,size:l}=i;if([n,l].forEach((async e=>{if(null==e)return;const r=t.getAttribute(e.field);if(null!=r)e.setInitialValue(r);else{const r=await e.getDefault(t.symbol,s.view);e.setInitialValue(r),t.setAttribute(e.field,r),a=!0}})),a){const e="2d"===s.view?.type?s.view.scale:null;await ee(t,o,e)}const p={multipleSelectionEnabled:!1};return"point"===r.geometryType&&(p.enableRotation=null!=n,p.enableScaling=null!=l),re(s.tooltipOptions,l,n),s.layer.elevationInfo=r.elevationInfo,s.update(t,p)}async function le(e,t,s,r,i){if(null==t.geometry||"point"!==t.geometry?.type)return;const o=r.rotation,a=null==(n=s.toolEventInfo)||"rotate-start"!==n.type&&"rotate"!==n.type&&"rotate-stop"!==n.type?null:n;var n;if(null!=o&&null!=a){const{field:s,getValue:r}=o;"rotate-stop"===a.type?(o.isUpdatingInteractively=!1,o.setInitialValue(t.getAttribute(s))):(o.isUpdatingInteractively=!0,t.setAttribute(s,r(a.angle,e)))}const l=r.size,p=function(e){return null==e||"scale-start"!==e.type&&"scale"!==e.type&&"scale-stop"!==e.type?null:e}(s.toolEventInfo);if(null!=l&&null!=p){const{field:s,getValue:r}=l;"scale-stop"===p.type?(l.isUpdatingInteractively=!1,l.setInitialValue(t.getAttribute(s))):(l.isUpdatingInteractively=!0,t.setAttribute(s,r(p.xScale,e)))}await ee(t,i,"2d"===e.type?e.scale:null)}async function pe({feature:e,featureClone:t,visualVariableAttributes:s,sketchViewModel:r,view:i,onUpdate:o,webStyleCache:p,addUpdatingPromise:c,addHandle:u}){await ee(t,p,"2d"===i.type?i.scale:null);let d=null;if("2d"===r?.view?.type){const e=m((e=>ee(t,p,e)));d=y((()=>r?.view?.scale),(t=>e(t)))}const h=t.sourceLayer,f=ye(i,h);await ne({graphic:t,sketchViewModel:r,sourceLayer:h,visualVariables:s,webStyleCache:p});let g=null;f.then((e=>g=e)).catch((()=>{}));const b=s.size,k=s.rotation,w=y((()=>e.attributes),(async e=>{let s=!1;for(const r in e){const i=e[r];i!==t.getAttribute(r)&&(t.setAttribute(r,i),null==b||b.isUpdatingInteractively||b.field!==r||b.setInitialValue(i),null==k||k.isUpdatingInteractively||k.field!==r||k.setInitialValue(i),(null==g||g.requiredFields.includes(r))&&(s=!0))}s&&await ee(t,p,"2d"===i.type?i.scale:null)})),v=r.on("update",(async e=>{const t=e.graphics[0],a={graphic:t,sketchViewModel:r,sourceLayer:h,visualVariables:s,webStyleCache:p};if("complete"===e.state){if(null===i.activeTool)return ne(a);const e=new AbortController,t=l(e);return u(t),c(j((()=>null===i.activeTool),e.signal).then((()=>(e.abort(),ne(a)))))}await le(i,t,e,s,p),o(fe(t),e)})),S=r.on(["undo","redo"],(async e=>{o(fe(e.graphics[0]),e)}));return n([S,v,a((()=>r.cancel())),w,d])}async function ce(e,t,s){const r=e.view;e.layer.add(s);const i=t.sourceLayer,o=t.layer,l=t.getAttribute(o.objectIdField);let p=null;function c(e){p?.abort(),p=_((async t=>{const s=await ye(r,i);u(t),s.setVisibility?.(l,e)}))}return await async function(e,t){if("3d"===e.type){const s=new q({graphic:t}),r=e.trackGraphicState(s);await j((()=>s.displaying||s.error)),r.remove()}else await j((()=>t.visible))}(r,s),c(!1),n([ue(r,s,(e=>c(!e))),a((async()=>{c(!0);try{const e=await ye(r,i);await j((()=>!e.updating))}finally{e.layer.remove(s)}}))])}function ue(e,t,s){if("3d"===e.type){const r=new q({graphic:t});return n([e.trackGraphicState(r),y((()=>r.displaying),s)])}return y((()=>t.visible),s)}const me={icon:C(24),text:C(12),line:C(1),viewScaleSizeFactor:100};function de(e,t,s){let r=!1;return e.filter((e=>!!r||(r=e===t,r))).map((e=>s[e]()))}const he=e=>/-stop/.test(e)||/vertex-/.test(e),ye=(e,t)=>{const s="subtype-sublayer"===t.type?t.parent:t;return e.whenLayerView(s)};function je(e){return"createInteractiveEditSession"in e}function fe(e){const t=e.geometry;if("mesh"===t?.type){const r=e.cloneShallow();return r.attributes=s(e.attributes),r.geometry=t.cloneShallow(),r.geometry.transform=t.transform?.clone()??null,r}return e.clone()}function ge(e){const t=e.cursor;return e.cursor="progress",a((()=>e.cursor=t))}function be(e){const t=e?.layer;return"scene"===t?.type}var ke;const we=Symbol(),ve=Symbol(),Se=Symbol(),Ie=Symbol();let Fe=ke=class extends Q{constructor(e){super(e),this.type="create-features",this.createFeatureState="create-new",this.data=void 0,this.isNested=!1,this._getDrawMeshHelpMessage=void 0,this._featureFormHandle=null,this._visualVariableAttributes={rotation:null,size:null},this._featureFormViewModel=new J,this._sketchViewModel=null,this._attachmentFileInfos=new Map,this._highlightHandles=new Map,this._preventDefaultActionOnCancel=!1,this._lastActiveGraphics=[],this._isActive=!0,this._updateGraphicDebounced=m(((e,t,s)=>ee(e,t,s)))}initialize(){this.isNested&&(this._isActive=!1),this._initializeSketchViewModel()}destroy(){this._sketchViewModel.destroy()}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){if(this.pendingFeatures.some((e=>!!this.data.getEditsForPendingFeature(e)?.modified)))return!0;const{creationInfo:e,upload:t}=this.data,s=this._sketchViewModel,{activeComponent:r}=s,i=s.createGraphic?.geometry?.type;return!("polyline"!==i&&"polygon"!==i&&"multipoint"!==i||"draw-2d"!==r?.type&&"draw-3d"!==r?.type)&&r.drawOperation.committedVertices.length>0||!(!t||"pending"!==t.state&&"success"!==t.state)||!!e?.geometryToPlace}get helpMessage(){const{creationInfo:e,viewModel:t}=this.data;if("creating-features"!==this.stepId||!e)return;const s=e.layer.geometryType,r=this._sketchViewModel.createGraphic;if("mesh"===s){this._getDrawMeshHelpMessage||import("../../chunks/helpMessageUtils3d.js").then((e=>{this._getDrawMeshHelpMessage=e.getDrawMeshHelpMessage}));const{view:e}=t;return"3d"===e?.type?this._getDrawMeshHelpMessage?.(r,e):void 0}return I(s,r?.geometry)}get layer(){return this.data.creationInfo?.layer}get numPendingFeatures(){return this.pendingFeatures.length}get parent(){return this.data.parent}get parentLayer(){return this.parent?.data.editorItem.layer}get pendingFeatures(){return this.data.pendingFeatures}get keyboardCancellationEnabled(){return 0===this.numPendingFeatures}get reliesOnOwnerAdminPrivileges(){return this.data.editorItem?.capabilities.create.reliesOnOwnerAdminPrivileges??!1}get shouldShowAttachments(){return this.data.editorItem?.capabilities.create.attachments.enabled??!1}get shouldAllowAttachmentEditing(){return this.shouldShowAttachments}get sketchViewModel(){return this._sketchViewModel}get test(){}async enter(){this._isActive=!0,"awaiting-feature-creation-info"!==this.stepId&&this._setUpCreatingFeaturesStep()}exit(){this._isActive=!1,this.removeHandles([Se])}async updatePendingFeature(e,t){return this._preventDefaultActionOnCancel=!0,this._sketchViewModel.cancel(),i(this._lastActiveGraphics,e),this._startUpdating({feature:e,webStyleCache:t})}async start(){return await super.start(),S(this.data.creationInfo?.layer)?null:{enter:async()=>{},exit:async()=>{},viewModel:this._sketchViewModel}}static create(e){const{addAttachmentsCallback:t,applyEditsCallback:s,isNested:r,creationInfo:i,parent:o,snappingManager:a,startAt:n,viewModel:l}=e,p=e.sketchOptions??new M,c=i?.layer,u=c?l.findEditorItemForLayer(c):void 0,m=new ke({data:new V({creationInfo:i,editorItem:u,parent:o,sketchOptions:p,snappingManager:a,viewModel:l}),isNested:r,onCommit:async e=>{const{creationInfo:r}=e;if(!r)return;const i=e.pendingFeatures.toArray(),{layer:o}=r,a=o.capabilities?.editing.supportsGlobalId&&"globalIdField"in o,n=m._attachmentFileInfos;if(a){const e=function(e,t,s){const r=[],i=t.globalIdField;return e.forEach(((t,o)=>{e[o].attributes[i]??=b(),(s?.get(t)||[]).forEach((({file:e})=>r.push({feature:t,attachment:{globalId:b(),data:e}})))})),r.length?{addFeatures:e,addAttachments:r}:{addFeatures:e}}(i,o,n);return void await s(o,e,{globalIdUsed:!0})}const l=await s(o,{addFeatures:i});if(n.size>0){const e=l?.addFeatureResults??[];await t(o,function(e,t,s,r){const i=[];return t.forEach(((t,o)=>{if(!t.error){const a=e[o],n=r.get(a)||[];a.attributes[s.objectIdField]=t.objectId,n.forEach((({form:e})=>i.push({feature:a,attachment:e})))}})),i}(i,e,o,n))}}});return m._set("steps",this._createWorkflowSteps(m,n)),m}_fadeExistingFeatures(e){if("effect"in e){const t=e.effect;return e.effect="saturate(0.6) opacity(0.8)",a((()=>e.effect=t))}const t=e.opacity;return e.opacity=.7,a((()=>e.opacity=t))}_highlight(e){const t=this.data.viewModel.view;"3d"===t?.type&&this._highlightHandles.set(e,t.highlight(e))}_removeHighlight(e){p(this._highlightHandles.get(e)),this._highlightHandles.delete(e)}async _startCreating(e){this.removeHandles(ve);const{creationInfo:t}=this.data;if(!t)return;this.createFeatureState="create-new";const s=await async function(e,t,s){const r=t.layer,i=te(t);let o=null;const{view:n}=e,l="2d"===n?.type;if(await se(e,r,i,s,l?n.scale:null),l){const t=m((t=>se(e,r,i,s,t)));o=y((()=>n.scale),(e=>t(e)))}const{data:p,editing:c}=r.capabilities;return e.layer.elevationInfo=r.elevationInfo,null==t.geometryToPlace?await e.create(function(e){if(!e)throw new Error("no geometry type");return"multipatch"===e?"mesh":e}(r.geometryType),{graphicProperties:{attributes:i,sourceLayer:r},hasZ:p.supportsZ,defaultZ:(l?c.zDefault:null)??e.defaultCreateOptions.defaultZ}):await e.place(t.geometryToPlace,{graphicProperties:{attributes:i,sourceLayer:r}}),o??a()}(this._sketchViewModel,t,e);this.addHandles(s,ve)}async _startUpdating({feature:e,webStyleCache:t,initialFeature:s=e}){const{data:r,pendingFeatures:i}=this;i.includes(e)||r.addPendingFeature(e,s);const{_featureFormViewModel:o,_sketchViewModel:a}=this,{creationInfo:l,viewModel:c}=r,{attachmentsViewModel:u,layerInfos:m,view:d}=c;if(!d||!l)return;const h=l.layer,j=function(e,t){return e?.find((e=>e.layer===t))}(m,h),f=j?.formTemplate,g=d.spatialReference;if(o.set({arcadeEditType:"INSERT",feature:e,formTemplate:f,spatialReference:g,map:d.map}),"add"!==u.mode&&"edit"!==u.mode||c.activeWorkflow?.previous(),u.graphic=e,u.fileInfos.removeAll(),u.mode="view",(this._attachmentFileInfos.get(e)||[]).forEach((({file:e,form:t})=>u.addFile(e,t))),this._removeHighlight(e),await ee(e,t,"2d"===d.type?d.scale:null),this.removeHandles(ve),p(this._featureFormHandle),"2d"===d.type){const s=y((()=>d.scale),(s=>this._updateGraphicDebounced(e,t,s)));this.addHandles(s,ve)}const b=r.getEditsForPendingFeature(e);return this._featureFormHandle=n([o.on("value-change",(async()=>{b?.updateAttributes(o.getValues()),await ee(e,t,"2d"===d.type?d.scale:null)})),a.on(["update","undo","redo"],(e=>{("undo"===e.type||"redo"===e.type||"update"===e.type&&null!=e.toolEventInfo&&he(e.toolEventInfo.type))&&o.notifyFeatureGeometryChanged()})),y((()=>o.feature?.sourceLayer),(t=>e.sourceLayer=t))]),this.createFeatureState="update-pending",this._visualVariableAttributes=Y(e),S(h)?void 0:ne({graphic:e,sketchViewModel:a,sourceLayer:h,visualVariables:this._visualVariableAttributes,webStyleCache:t})}static _createWorkflowSteps(e,s="awaiting-feature-creation-info"){const{data:r}=e,i={"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",async setUp(){const{creationInfo:s,viewModel:i}=r,{view:o}=i;o&&(be(s)?e.addHandles(await async function({view:e,data:s,signal:r,next:i,cancel:o}){const{creationInfo:l}=s;if(!l)return a();if(!be(l))return a();const{layer:p}=l,c=null!=l.geometryToPlace;if(l.geometryToPlace=null,c)return o(),a();const{Upload:m}=await import("../../chunks/Upload.js");u(r);const d=new m;s.upload=d;let j=null;const f=()=>j?.remove(),g=n([y((()=>d.state),(s=>{switch(s){case"default":case"error":f();break;case"pending":f(),j=ge(e);break;case"success":{l.maxFeatures=1;const{result:s}=d;"georeferenced"===s?.type||"georeferenced-reprojected"===s?.type?(l.geometryToPlace=s.mesh,l.initialFeature=new t({attributes:te(l),geometry:s.mesh,sourceLayer:p}),e.goTo(l.initialFeature,{animate:!1}).catch(h)):l.geometryToPlace=s?.mesh,f(),i();break}}})),a((()=>{d.cancel(),f()}))]);return d.uploadTo(p),g}({view:o,data:r,next:()=>e.next(),cancel:()=>i.cancelWorkflow({warnIfNoWorkflow:!1})}),this.id):(r.parent&&s&&(e.addHandles(i.lockFeatureTemplatesViewModel(),this.id),i.featureTemplatesViewModel.layers=[s.layer]),e.addHandles(i.featureTemplatesViewModel.on("select",(({item:t})=>{t&&(r.creationInfo={...r.creationInfo,layer:t.layer,template:t.template},e.next())})),this.id)))},async tearDown(){e.removeHandles([this.id,ve])}}),"creating-features":()=>({id:"creating-features",async setUp(){e._isActive&&await e._setUpCreatingFeaturesStep()},async tearDown(t){const{viewModel:s}=r;t.canceled&&(e.removeHandles([Se,we,ve,Ie]),s.attachmentsViewModel.fileInfos.removeAll(),e._attachmentFileInfos.clear())}}),"adding-attachment":()=>({id:"adding-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:t}=r.viewModel,{graphic:s,fileInfos:i}=t;e._attachmentFileInfos.set(s,i.toArray()),t.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:t}=r.viewModel,{graphic:s,fileInfos:i}=t;e._attachmentFileInfos.set(s,i.toArray()),t.mode="view"}})},o=de(["awaiting-feature-creation-info","creating-features","adding-attachment","editing-attachment"],s,i);return function(e,t){e.viewModel.syncFeatureTemplates();const s=e.creationInfo;if("awaiting-feature-creation-info"===t[0].id&&s){const e=s.layer,r=Z(e);1===r.length&&"scene"!==e.type&&(s.template=r[0],t.shift())}return t}(r,o)}static _configureSketchViewModel(e,t){const{data:s}=e,{creationInfo:r,viewModel:o}=s,{view:l}=o,p=e._sketchViewModel;let u=null;const m=[];if(!l)return a();"2d"===l.type&&r&&m.push(e._fadeExistingFeatures(r.layer)),m.push(p.on("create",(s=>e._updatingHandles.addPromise((async s=>{if("cancel"===s.state){if(e._preventDefaultActionOnCancel)return void(e._preventDefaultActionOnCancel=!1);if(null==l.activeTool){if(e._lastActiveGraphics.length<1)return e._startCreating(t);const s=e._lastActiveGraphics.pop();return e._startUpdating({feature:s,webStyleCache:t})}return e._waitForActiveToolCleared().then((()=>e._startCreating(t)))}if("complete"===s.state&&s.graphic){const r=s.graphic.clone();return r.geometry=null,e._startUpdating({feature:s.graphic,webStyleCache:t,initialFeature:r})}})(s)))),p.on("update",(s=>e._updatingHandles.addPromise((async s=>{const{attachmentsViewModel:i}=o,{_featureFormViewModel:a}=e,n=s.graphics[0];if("complete"===s.state){n!==u&&(e._lastActiveGraphics.push(n),e._highlight(n)),u=null;const{hasPendingSubtypeChoice:p,submittable:c}=a;if(e.numPendingFeatures===r?.maxFeatures||p||!c){!c&&a.submit();const s=e._lastActiveGraphics.pop();return null===o.view?.activeTool?e._startUpdating({feature:s,webStyleCache:t}):e._waitForActiveToolCleared().then((()=>e._startUpdating({feature:s,webStyleCache:t})))}if("add"!==i.mode&&"edit"!==i.mode||o.activeWorkflow?.previous(),s.aborted&&e._preventDefaultActionOnCancel)return void(e._preventDefaultActionOnCancel=!1);if(e.addHandles([ge(l),l.on("click",(e=>e.preventDefault()))],we),await j((()=>!a.updating)),e.removeHandles(we),null!=o.view?.activeTool)return e._waitForActiveToolCleared().then((()=>{const s=e._lastActiveGraphics.pop();if(s)return e._startUpdating({feature:s,webStyleCache:t})}));e._startCreating(t)}"start"===s.state&&e._removeHighlight(n);const p=e._visualVariableAttributes;await le(l,n,s,p,t);const c=n.attributes,{rotation:m,size:d}=p;if(null!=m){const{field:e}=m;a.setValue(e,c[e])}if(null!=d){const{field:e}=d;a.setValue(e,c[e])}})(s)))),p.on("delete",(t=>(t=>{const r=t.graphics[0];s.removePendingFeature(r),i(e._lastActiveGraphics,r),u=r})(t))),l.on("immediate-click",(s=>e._updatingHandles.addPromise((async s=>{if(be(r))return;const{results:i}=await l.hitTest(s,{include:p.layer}),o=i.find((e=>"graphic"===e.type&&e.graphic.sourceLayer===r?.layer));if(!o)return;const a=o.graphic;if("transform"===p.activeTool||"reshape"===p.activeTool){if(p.updateGraphics.at(0)===a)return;const{submittable:s,hasPendingSubtypeChoice:r}=e._featureFormViewModel;if(!s||r)return;await e.updatePendingFeature(a,t)}})(s))),F.TOOL),a((()=>{e._preventDefaultActionOnCancel=!0,p.cancel()})),function(e,t){let s=null;const r=()=>e.snappingOptions.featureSources,i=()=>{null!=s&&(r().remove(s),s=c(s))};return n([y((()=>{const e=t.creationInfo?.layer,s=r().find((t=>t.layer===e));return{hasFeatureLayerSource:!!s,enabled:s?.enabled??!1}}),(({hasFeatureLayerSource:t,enabled:o})=>{if(!t)return i();s??=(s=new U({layer:e.layer}),r().add(s),s),s.enabled=o}),g),a(i)])}(p,s));const d=n(m);return p.addHandles(d),d}_initializeSketchViewModel(){const{data:e}=this,{view:t}=e.viewModel,s=new v({elevationInfo:e.creationInfo?.layer.elevationInfo,internal:!0,listMode:"hide"}),r=new K({layer:s,sketchOptions:e.sketchOptions,snappingManager:e.snappingManager,updateOnGraphicClick:!1,view:t});this._sketchViewModel=r,t?.map.add(s),this.addHandles(a((()=>{t?.destroyed||t?.map.remove(s),s.destroy()})))}async _setUpCreatingFeaturesStep(){if(this.hasHandles(Se))return;const{data:e}=this,{creationInfo:s,viewModel:r}=e,{attachmentsViewModel:i,view:l}=r;if(!l||!s?.layer)throw new o("missing-parameters","CreateFeaturesWorkflow requires a view and creationInfo.");this._preventDefaultActionOnCancel=!1;const{initialFeature:c,layer:u}=s,m=this._sketchViewModel,d=new Map,h=[];this._lastActiveGraphics=[],this._featureFormHandle=p(this._featureFormHandle),this._visualVariableAttributes={rotation:null,size:null},this.data.editorItem=r.findEditorItemForLayer(s.layer),function(e){e.filesEnabled=!0,e.mode="view",e.capabilities={editing:!0,operations:{add:!0,update:!0,delete:!0}}}(i),h.push(y((()=>i.mode),(e=>{switch(e){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}})));const j=ge(l);h.push(j);const g=S(s.layer);try{if(g){const e=c??new t({attributes:{...s.template?.prototype.attributes,...s.attributeOverrides},sourceLayer:u});await this._startUpdating({feature:e,webStyleCache:d})}else h.push(ke._configureSketchViewModel(this,d)),c?(m.layer.add(c),await this._startUpdating({feature:c,webStyleCache:d})):await this._startCreating(d)}finally{j.remove()}const b=a((()=>{for(const t of e.pendingFeatures)m.layer.remove(t),e.removePendingFeature(t)})),k=y((()=>l?.timeZone),(e=>this._featureFormViewModel.timeZone=e),f),w=a((()=>{be(s)&&r.cancelWorkflow({warnIfNoWorkflow:!1})}));this._featureFormHandle&&h.push(this._featureFormHandle),this.addHandles(h,this._handleKeys.beforeCommit),this.addHandles([a((()=>i.fileInfos.removeAll())),n(h),w,b,k],Se)}async _waitForActiveToolCleared(){const e=this.data.viewModel.view;if(null==e?.activeTool)return;const t=new AbortController;this.addHandles(l(t),Ie),await j((()=>null==e?.activeTool),t.signal),t.abort()}};e([k()],Fe.prototype,"createFeatureState",void 0),e([k()],Fe.prototype,"data",void 0),e([k({constructOnly:!0})],Fe.prototype,"isNested",void 0),e([k()],Fe.prototype,"featureFormViewModel",null),e([k()],Fe.prototype,"hasPendingEdits",null),e([k()],Fe.prototype,"_getDrawMeshHelpMessage",void 0),e([k()],Fe.prototype,"helpMessage",null),e([k()],Fe.prototype,"layer",null),e([k()],Fe.prototype,"parent",null),e([k()],Fe.prototype,"parentLayer",null),e([k()],Fe.prototype,"keyboardCancellationEnabled",null),e([k()],Fe.prototype,"reliesOnOwnerAdminPrivileges",null),e([k()],Fe.prototype,"shouldShowAttachments",null),e([k()],Fe.prototype,"shouldAllowAttachmentEditing",null),e([k()],Fe.prototype,"sketchViewModel",null),Fe=ke=e([w("esri.widgets.Editor.CreateFeaturesWorkflow")],Fe);const Me=Fe;export{ce as a,je as b,fe as c,de as d,Me as default,ie as e,ae as f,Y as g,X as h,he as i,be as j,pe as s,ee as u,ye as w};
