/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import t from"../../../core/Accessor.js";import{property as r}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/lang.js";import{L as s}from"../../../chunks/Logger.js";import{subclass as i}from"../../../core/accessorSupport/decorators/subclass.js";import{h as o,g as a,v as l}from"../../../chunks/layerUtils.js";import{f as n,c as p,b as d,i as c}from"../../../chunks/unitUtils.js";import{c as u}from"../../../chunks/infoFor3D.js";import{V as m}from"../../../chunks/ViewingMode.js";import{i as h}from"../../../chunks/featureUtils.js";import{o as y}from"../../../chunks/featureFormUtils.js";import"../../../core/Handles.js";import"../../../chunks/maybe.js";import"../../../chunks/metadata.js";import"../../../chunks/utils.js";import"../../../chunks/handleUtils.js";import"../../../chunks/ObservableBase.js";import"../../../chunks/tracking.js";import"../../../core/scheduling.js";import"../../../core/promiseUtils.js";import"../../../core/Error.js";import"../../../config.js";import"../../../chunks/ensureType.js";import"../../../kernel.js";import"../../../core/urlUtils.js";import"../../../core/JSONSupport.js";import"../../../request.js";import"../../../chunks/jsonMap.js";import"../../../chunks/assets.js";import"../../../chunks/date.js";import"../../../chunks/locale.js";import"../../../chunks/datetime.js";import"../../../chunks/number.js";import"../../../layers/support/fieldUtils.js";import"../../../core/sql.js";import"../../../intl.js";import"../../../chunks/substitute.js";import"../../../chunks/messages.js";import"../../../chunks/mathUtils.js";import"../../../geometry.js";import"../../../geometry/Extent.js";import"../../../geometry/Geometry.js";import"../../../chunks/reader.js";import"../../../geometry/SpatialReference.js";import"../../../chunks/writer.js";import"../../../geometry/Point.js";import"../../../core/accessorSupport/decorators/cast.js";import"../../../geometry/support/webMercatorUtils.js";import"../../../geometry/Multipoint.js";import"../../../chunks/zmUtils.js";import"../../../geometry/Polygon.js";import"../../../chunks/coordsUtils.js";import"../../../chunks/Axis.js";import"../../../chunks/extentUtils.js";import"../../../chunks/boundsUtils.js";import"../../../chunks/aaBoundingRect.js";import"../../../geometry/Polyline.js";import"../../../chunks/typeUtils.js";import"../../../geometry/support/jsonUtils.js";import"../../../chunks/utils3.js";import"../../../chunks/basemapUtils.js";import"../../../Basemap.js";import"../../../core/Collection.js";import"../../../core/Evented.js";import"../../../chunks/shared.js";import"../../../chunks/SimpleObservable.js";import"../../../chunks/collectionUtils.js";import"../../../core/Loadable.js";import"../../../core/Promise.js";import"../../../chunks/loadAll.js";import"../../../chunks/asyncUtils.js";import"../../../portal/Portal.js";import"../../../portal/PortalGroup.js";import"../../../portal/PortalQueryParams.js";import"../../../portal/PortalQueryResult.js";import"../../../portal/PortalUser.js";import"../../../portal/PortalFolder.js";import"../../../portal/PortalItem.js";import"../../../portal/PortalItemResource.js";import"../../../portal/PortalRating.js";import"../../../chunks/persistableUrlUtils.js";import"../../../support/BasemapStyle.js";import"../../../chunks/writeUtils.js";import"../../../chunks/utils2.js";import"../../../chunks/colorUtils.js";import"../../../chunks/screenUtils.js";import"../../../chunks/mat4.js";import"../../../chunks/common.js";import"../../../chunks/compilerUtils.js";import"../../../chunks/formUtils.js";let b=class extends t{constructor(e){super(e),this.layer=null}get attachments(){return{enabled:this._effectiveEnabled&&!!this._effectiveCapabilities?.data.supportsAttachment}}get create(){const{_effectiveCapabilities:e,layer:t}=this,r=this._createEnabled,s=r,i=t.capabilities?.operations.supportsAdd,o=!!e?.operations.supportsAdd;return{attachments:{enabled:r&&this.attachments.enabled},attributes:r,enabled:r,geometry:s,reliesOnOwnerAdminPrivileges:!i&&o}}get delete(){const{_effectiveCapabilities:e,layer:t}=this,r=t.capabilities?.operations.supportsDelete,s=!!e?.operations.supportsDelete;return{enabled:this._effectiveEnabled&&!!e?.operations.supportsDelete,reliesOnOwnerAdminPrivileges:!r&&s}}get reliesOnOwnerAdminPrivileges(){return this._effectiveEnabled&&!this.layer.editingEnabled||this.create.reliesOnOwnerAdminPrivileges||this.update.reliesOnOwnerAdminPrivileges||this.delete.reliesOnOwnerAdminPrivileges}get update(){const{_effectiveCapabilities:e,layer:t}=this,r=this._updateEnabled,s=!(!r||!e?.editing.supportsGeometryUpdate),i=t.capabilities?.operations.supportsUpdate,o=!!e?.operations.supportsUpdate,a=this.attachments.enabled,l=a&&this._canCreateOrUpdate;return{attachments:{enabled:a,create:l,update:l},attributes:r,enabled:r,geometry:s,reliesOnOwnerAdminPrivileges:!i&&o}}get _createEnabled(){return this._effectiveEnabled&&!!this._effectiveCapabilities?.operations.supportsAdd}get _updateEnabled(){return this._effectiveEnabled&&!!this._effectiveCapabilities?.operations.supportsUpdate}get _canCreateOrUpdate(){return!(!this._createEnabled&&!this._updateEnabled)}get _effectiveEnabled(){return o(this.layer)}get _effectiveCapabilities(){return a(this.layer)}};e([r()],b.prototype,"attachments",null),e([r()],b.prototype,"create",null),e([r()],b.prototype,"delete",null),e([r()],b.prototype,"layer",void 0),e([r()],b.prototype,"reliesOnOwnerAdminPrivileges",null),e([r()],b.prototype,"update",null),e([r()],b.prototype,"_createEnabled",null),e([r()],b.prototype,"_updateEnabled",null),e([r()],b.prototype,"_canCreateOrUpdate",null),e([r()],b.prototype,"_effectiveEnabled",null),e([r()],b.prototype,"_effectiveCapabilities",null),b=e([i("esri.layers.support.EditingCapabilities")],b);const g=b,f="esri.views.layers.support.editableLayerViews";let j=class extends g{constructor(e){super(e),this.layerInfo=null,this.layerView=null}get attachments(){const e=this.defaults.attachments.enabled,t=this.layerInfo;return{enabled:e&&!1!==t?.enabled}}get create(){const{attachments:e,defaults:t,layerInfo:r,layer:s,layerView:i}=this,o=t.create,a=!1!==r?.enabled&&!1!==r?.addEnabled,l=o.enabled&&a;return{attributes:l&&o.attributes,enabled:l,geometry:l&&o.geometry&&k(s,i),attachments:{enabled:e.enabled&&l&&!1!==r?.attachmentsOnCreateEnabled},reliesOnOwnerAdminPrivileges:o.reliesOnOwnerAdminPrivileges}}get defaults(){return new g({layer:this.layer})}get delete(){const{defaults:e,layerInfo:t}=this,r=e.delete,s=!1!==t?.enabled&&!1!==t?.deleteEnabled;return{enabled:r.enabled&&s,reliesOnOwnerAdminPrivileges:r.reliesOnOwnerAdminPrivileges}}get formTemplate(){const{layer:e,layerInfo:t}=this;return t?.formTemplate?t.formTemplate:e&&"formTemplate"in e?e.formTemplate:null}get relationship(){const{layer:e}=this,t=!(!h(e)||!e.relationships?.length),r=!!this.formTemplate?.elements?.some((e=>"relationship"===e.type));return{enabled:t&&r}}get update(){const{attachments:e,defaults:t,layerInfo:r,layer:s,layerView:i}=this,o=t.update,a=!1!==r?.enabled&&!1!==r?.updateEnabled,l=o.enabled&&a,n=l&&o.attributes&&!1!==r?.attributeUpdatesEnabled,p=l&&o.geometry&&!1!==r?.geometryUpdatesEnabled&&k(s,i),d=e.enabled&&!1!==r?.attachmentsOnUpdateEnabled;return{attributes:n,enabled:l,geometry:p,attachments:{enabled:d,create:d&&o.attachments.create,update:d&&o.attachments.update},reliesOnOwnerAdminPrivileges:o.reliesOnOwnerAdminPrivileges}}};function k(e,t){return"scene"!==e.type||null!=t&&"type"in t&&"scene-layer-3d"===t.type&&function(e,t){const{associatedLayer:r}=e,i=r?.infoFor3D;if(!i)return!1;const o=u(i);if(null==o||!i.queryFormats.includes(o))return s.getLogger(f).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because it does not support GLB queries.`),!1;const a=e.spatialReference,l=r.spatialReference;if(!n(a,l))return s.getLogger(f).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because its spatial reference (wkid:${a.wkid}) is different from its associated FeatureLayer's spatial reference (wkid:${l.wkid}).`),!1;const h=r.sourceJSON.sourceSpatialReference;if(null!=h&&!n(h,l))return s.getLogger(f).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because the spatial reference of its associated FeatureLayer's service (wkid:${l.wkid}) is different from its source spatial reference (wkid:${h.wkid}).`),!1;const{view:y}=t;if(t.destroyed||null==y)return!1;const b=y.spatialReference,{viewingMode:g}=y.state,j=p(a),k=g===m.Global;return j&&!k?(s.getLogger(f).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits in local viewing mode because its spatial reference (wkid:${a.wkid}) is geographic. Please consider changing the viewing mode to global.`),!1):!j&&k?(s.getLogger(f).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits in global viewing mode because its spatial reference (wkid:${a.wkid}) is projected. Please consider changing the viewing mode to local.`),!1):!!(n(a,b)||k&&d(b)&&c(a))||(s.getLogger(f).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because its spatial reference (wkid:${a.wkid}) does not match the view spatial reference (wkid:${b.wkid}).`),!1)}(e,t)}e([r()],j.prototype,"attachments",null),e([r()],j.prototype,"create",null),e([r()],j.prototype,"defaults",null),e([r()],j.prototype,"delete",null),e([r()],j.prototype,"formTemplate",null),e([r()],j.prototype,"layerInfo",void 0),e([r()],j.prototype,"layerView",void 0),e([r()],j.prototype,"relationship",null),e([r()],j.prototype,"update",null),j=e([i("esri.widgets.Editor.support.EditorEditingCapabilities")],j);const w=j;let v=class extends t{constructor(e){super(e),this.disabled=!1,this.layer=null,this.layerInfo=null,this.layerView=null}get _suspended(){return!!this.layerView?.suspended}get capabilities(){return new w({layer:this.layer,layerInfo:this.layerInfo,layerView:this.layerView})}get editable(){const{create:e,relationship:t,update:r,delete:{enabled:s}}=this.capabilities,i=e.attachments.enabled||r.attachments.enabled;return!this.disabled&&(e.enabled||r.enabled||i||s||t.enabled)}get formTemplate(){return this.capabilities.formTemplate}get hasInvalidFormTemplate(){return y(this.layer,this.formTemplate)}get isTable(){return l(this.layer)}get supportsCreateFeaturesWorkflow(){if(this.disabled)return!1;const{enabled:e,geometry:t}=this.capabilities.create;return this.isTable?e:e&&t}get supportsUpdateWorkflow(){const{capabilities:e}=this;return!this.disabled&&(e.update.enabled||e.update.attachments.enabled||e.delete.enabled)}get visible(){const{layer:e}=this,t=e.parent;return!this._suspended&&e.visible&&(!t||!("visible"in t)||t.visible)}};e([r()],v.prototype,"_suspended",null),e([r()],v.prototype,"capabilities",null),e([r()],v.prototype,"disabled",void 0),e([r()],v.prototype,"editable",null),e([r()],v.prototype,"formTemplate",null),e([r()],v.prototype,"hasInvalidFormTemplate",null),e([r()],v.prototype,"isTable",null),e([r()],v.prototype,"layer",void 0),e([r()],v.prototype,"layerInfo",void 0),e([r()],v.prototype,"layerView",void 0),e([r()],v.prototype,"supportsCreateFeaturesWorkflow",null),e([r()],v.prototype,"supportsUpdateWorkflow",null),e([r()],v.prototype,"visible",null),v=e([i("esri.widgets.Editor.support.EditorItem")],v);const U=v;export{U as default};
