/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../geometry.js";import"../intl.js";import t from"../core/Collection.js";import{J as i}from"../chunks/jsonMap.js";import{watch as o,initial as s,whenOnce as a}from"../core/reactiveUtils.js";import{u as l}from"../chunks/unitFormatUtils.js";import{r as n,addProxy as r,hasSameOrigin as p}from"../core/urlUtils.js";import{property as c}from"../core/accessorSupport/decorators/property.js";import{d as m}from"../chunks/ensureType.js";import"../core/lang.js";import{subclass as u}from"../core/accessorSupport/decorators/subclass.js";import{m as d}from"../chunks/unitUtils.js";import{g as h}from"../chunks/utils9.js";import{f as b}from"../rest/print.js";import y from"./Widget.js";import g from"../core/Accessor.js";import"../chunks/Logger.js";import _ from"./Print/PrintViewModel.js";import{l as f}from"../chunks/componentsUtils.js";import{g as k}from"../chunks/globalCss.js";import{H as v}from"../chunks/Heading.js";import{l as j}from"../chunks/legacyIcon.js";import{a as w,i as T}from"../chunks/widgetUtils.js";import{m as x}from"../chunks/messageBundle.js";import{t as C}from"../chunks/jsxFactory.js";import S from"../geometry/SpatialReference.js";import{f as I}from"../chunks/number.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../core/Error.js";import"../config.js";import"../chunks/reader.js";import"../core/Handles.js";import"../chunks/maybe.js";import"../chunks/metadata.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../core/scheduling.js";import"../core/promiseUtils.js";import"../chunks/assets.js";import"../request.js";import"../kernel.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../core/accessorSupport/decorators/cast.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/coordsUtils.js";import"../chunks/Axis.js";import"../chunks/extentUtils.js";import"../chunks/boundsUtils.js";import"../chunks/aaBoundingRect.js";import"../chunks/mathUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../chunks/date.js";import"../chunks/locale.js";import"../chunks/datetime.js";import"../chunks/substitute.js";import"../chunks/messages.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/asyncUtils.js";import"../chunks/ByteSizeUnit.js";import"../chunks/Cyclical.js";import"../chunks/quantityUtils.js";import"../chunks/screenUtils.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../chunks/floorFilterUtils.js";import"../chunks/visualVariableUtils.js";import"../Color.js";import"../chunks/colorUtils.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/content/UtilityNetworkAssociationsContent.js";import"../popup/support/UtilityNetworkAssociationType.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils4.js";import"../symbols/edges/Edges3D.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../chunks/vec3f64.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils5.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../core/Promise.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/compilerUtils.js";import"../chunks/lengthUtils.js";import"../chunks/sizeVariableUtils.js";import"../rest/geoprocessor.js";import"../rest/geoprocessor/GPOptions.js";import"../rest/support/JobInfo.js";import"../geometry/support/normalizeUtils.js";import"../chunks/normalizeUtilsCommon.js";import"../chunks/simplify.js";import"../chunks/utils10.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../layers/support/MapImage.js";import"../rest/support/ArealUnit.js";import"../chunks/networkEnums.js";import"../rest/support/DataFile.js";import"../rest/support/FeatureSet.js";import"../rest/support/LinearUnit.js";import"../rest/support/ParameterValue.js";import"../rest/support/RasterData.js";import"../rest/support/GPMessage.js";import"../chunks/layerViewUtils.js";import"../rest/support/PrintTemplate.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/domUtils.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/ReactiveMap.js";import"../rest/support/PrintParameters.js";import"../chunks/viewpointUtils.js";import"../Viewpoint.js";import"../Camera.js";import"../CameraLayout.js";import"../chunks/common.js";import"../chunks/mat2d.js";import"../chunks/mat2df64.js";import"../chunks/vec2.js";import"../chunks/vec2f64.js";import"../geometry/projection.js";import"../chunks/projectBuffer.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../chunks/zscale.js";import"../chunks/InputManager.js";import"../chunks/Queue.js";import"../core/signal.js";import"./Print/CustomTemplate.js";import"../chunks/MD5.js";import"./Print/TemplateOptions.js";let O=class extends g{constructor(e){super(e),this.state="pending",this.url=""}initialize(){this.addHandles(o((()=>[this.extension,this.name]),(()=>this._setFormattedFileName()),s))}_setFormattedFileName(){this.name&&this.extension&&(this.formattedName=this.count?`${this.name}(${this.count}).${this.extension}`:`${this.name}.${this.extension}`)}};e([c()],O.prototype,"count",void 0),e([c()],O.prototype,"error",void 0),e([c()],O.prototype,"extension",void 0),e([c()],O.prototype,"formattedName",void 0),e([c()],O.prototype,"name",void 0),e([c()],O.prototype,"portalItem",void 0),e([c()],O.prototype,"state",void 0),e([c()],O.prototype,"url",void 0),O=e([u("esri.widgets.Print.FileLink")],O);const $=O,L=t.ofType($),M="map-only";var E;!function(e){e.layout="layoutTab",e.mapOnly="mapOnlyTab",e.export="exportTab"}(E||(E={}));const F="esri-print",P=`${F}__advanced-options-button`,D={base:F,headerTitle:`${F}__header-title`,layoutTabList:`${F}__layout-tab-list`,layoutTab:`${F}__layout-tab`,layoutSection:`${F}__layout-section`,mapOnlySection:`${F}__map-only-section`,panelItemsCentered:`${F}__panel-items--centered`,loader:`${F}__loader`,advancedOptionsButton:P,advancedOptionsButtonContainer:`${P}-container`,advancedOptionsButtonTitle:`${P}-title`,advancedOptionsButtonIconOpened:`${P}-icon--opened`,advancedOptionsButtonIconClosed:`${P}-icon--closed`,advancedOptionsButtonIconClosed_RTL:`${P}-icon--closed-rtl`,swapButton:`${F}__swap-button`,printButton:`${F}__export-button`,printButtonSection:`${F}__export-button-section`,printButtonSectionDivider:`${F}__export-button-section--divider`,templateSelectContainer:`${F}__template-select-container`,templateSelectBlock:`${F}__template-select-block`,templateSelectIcon:`${F}__template-select-icon`,templateSelectError:`${F}__template-select-error`,templateSelectArrow:`${F}__template-select-arrow`,formSectionContainer:`${F}__form-section-container`,formCheckboxLabel:`${F}__form-checkbox-label`,advancedOptionsSection:`${F}__advanced-options-section`,advancedOptionsContainer:`${F}__advanced-options-container`,browseTemplateButtonContainer:`${F}__browse-template-button-container`,browseTemplateButtonContainerFilter:`${F}__browse-template-button-container-filter`,exportedFilesContainer:`${F}__export-panel-container`,exportedFilesTitle:`${F}__export-title`,exportedFile:`${F}__exported-file`,exportedFileLink:`${F}__exported-file-link`,exportedFileLinkTitle:`${F}__exported-file-link-title`,exportedFileLinkDescription:`${F}__exported-file-link-description`,exportedFilesEmpty:`${F}__exported-files-empty`,printWidgetContainer:`${F}__container`,content:`${F}__content`,panelContainer:`${F}__panel-container`,scaleInfoContainer:`${F}__scale-info-container`,scaleInputContainer:`${F}__scale-input-container`,scaleInput:`${F}__scale-input`,sizeContainer:`${F}__size-container`,panelError:`${F}__panel--error`,exportedFileError:`${F}__exported-file--error`,exportedFileLoader:`${F}__exported-file--loader`,exportSection:`${F}__export-section`,exportSectionCentered:`${F}__export-section--centered`,templateButtonContainer:`${F}__template-button-container`,templateDoneButton:`${F}__template-done-button`,templateSelectFlowItemContainer:`${F}__template-select-flow-item-container`,templateSelectFlowItemContent:`${F}__template-select-flow-item-content`,templateSelectFlowItemListHeading:`${F}__template-select-flow-item-list-heading`,srLabel:`${F}__sr-label`,invalidWkidText:`${F}__invalid-wkid-text`};function U(e){return e?.toLowerCase()===M}function B(e){const{state:t,extension:i}=e;switch(t){case"pending":return"spinner";case"error":return"exclamation-mark-circle";default:return i?.toLowerCase()?.includes("pdf")?"file-pdf":"file"}}const R=new i({inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"}),A=new Map([["a3-landscape","a3-landscape"],["a3-portrait","a3-portrait"],["a4-landscape","a4-landscape"],["a4-portrait","a4-portrait"],["letter-ansi-a-landscape","ansi-a-landscape"],["letter-ansi-a-portrait","ansi-a-portrait"],["tabloid-ansi-b-landscape","ansi-b-landscape"],["tabloid-ansi-b-portrait","ansi-b-portrait"]]);let N=class extends y{constructor(e,t){super(e,t),this._activeTabFocusRequested=!1,this._awaitingServerResponse=!1,this._exportedFileNameMap={},this._selectedTab=E.layout,this._pendingExportScroll=!1,this._rootNode=null,this._selectedTemplate=null,this._formats=[],this._showTemplates=!1,this._isValidSpatialReference=!0,this.allowedFormatsForSaving=null,this.browseTemplateButtonOnClick=null,this.exportedLinks=new L,this.headerVisible=!0,this.headingLevel=3,this.messagesCommon=null,this.messagesUnits=null,this.saveExportEnabled=!1,this.saveExportHidden=!0,this.saveAsButtonCallback=null,this.viewModel=new _,this._onInput=e=>{this._selectedTab===E.layout?this.templateOptions.title=e.target.value:this._selectedTab===E.mapOnly&&(this.templateOptions.fileName=e.target.value)},this._handleLinkClick=e=>{const t=e.currentTarget["data-item"];if(!t||"ready"!==t.state||!t.url)return;const i=h(this.viewModel.effectivePrintServiceUrl),o=t.url,s=document.createElement("a");if(s.target="_blank",s.href=o,s.rel="noreferrer",s.download=t.formattedName??"",!i)return s.click(),void e.stopPropagation();e.preventDefault();const a=new URL(o);a.searchParams.set("token",i),s.href=a.href,s.click(),s.href=o},this._focusOnTabChange=this._focusOnTabChange.bind(this)}initialize(){this.addHandles([o((()=>[this.templateOptions.format,this.viewModel.templatesInfo?.format]),(()=>{const{templatesInfo:e}=this.viewModel;if(!e)return;if(this._formats.length!==e.format.choiceList.length){const t=b.apiValues;this._formats=e.format.choiceList.map((e=>{const i=t.find((t=>new RegExp(`\\b${t}\\b`,"i").test(e)))??e;return{value:i,label:e===i?e.toUpperCase():e}})).sort(((e,t)=>e.label.localeCompare(t.label)))}const t=this._formats.some((({value:e})=>new RegExp(`\\b${e}\\b`,"i").test(this.templateOptions.format)));if(!e.format.defaultValue||t);else{const t=this._formats.find((({value:t})=>new RegExp(`\\b${t}\\b`,"i").test(e.format.defaultValue)))?.value;t&&(this.templateOptions.format=t)}})),o((()=>[this.templateOptions.id,this.viewModel.loaded]),(async()=>{const{layout:e}=this.templateOptions;this._selectedTab=U(e)?E.mapOnly:E.layout,this._selectedTab===E.layout&&this.viewModel.loaded&&(this._selectedTemplate=this.viewModel.getLayoutTemplateById(this.templateOptions.id))})),o((()=>this.templateOptions.dpi),(e=>{e<=0&&(this.templateOptions.dpi=1)})),o((()=>this.viewModel.view?.scale),(e=>{!e||this.templateOptions.scaleEnabled&&this.templateOptions.scale||(this.templateOptions.scale=e)}))]);for(const{name:e,extension:t}of this.exportedLinks)e&&t&&this._updateExportedFileNameMap(`${e}${t}`);const{height:e,width:t}=this.templateOptions;this.templateOptions.width=t||800,this.templateOptions.height=e||1100;const i=setTimeout((()=>{this._awaitingServerResponse=!0,this.scheduleRender()}),500);this.viewModel.load().then((()=>{clearTimeout(i),this._awaitingServerResponse=!1}))}loadDependencies(){return f({action:()=>import("../chunks/calcite-action.js"),block:()=>import("../chunks/calcite-block.js"),button:()=>import("../chunks/calcite-button.js"),checkbox:()=>import("../chunks/calcite-checkbox.js"),combobox:()=>import("../chunks/calcite-combobox.js"),"combobox-item":()=>import("../chunks/calcite-combobox-item.js"),flow:()=>import("../chunks/calcite-flow.js"),"flow-item":()=>import("../chunks/calcite-flow-item.js"),icon:()=>import("../chunks/calcite-icon.js"),input:()=>import("../chunks/calcite-input.js"),"input-number":()=>import("../chunks/calcite-input-number.js"),label:()=>import("../chunks/calcite-label.js"),list:()=>import("../chunks/calcite-list.js"),"list-item":()=>import("../chunks/calcite-list-item.js"),loader:()=>import("../chunks/calcite-loader.js"),switch:()=>import("../chunks/calcite-switch.js"),chip:()=>import("../chunks/calcite-chip.js"),popover:()=>import("../chunks/calcite-popover.js"),link:()=>import("../chunks/calcite-link.js")})}destroy(){this.viewModel.destroy()}get allowedFormats(){return this.viewModel.allowedFormats}set allowedFormats(e){this.viewModel.allowedFormats=e}get allowedLayouts(){return this.viewModel.allowedLayouts}set allowedLayouts(e){this.viewModel.allowedLayouts=e}get error(){return this.viewModel.error}get extraParameters(){return this.viewModel.extraParameters}set extraParameters(e){this.viewModel.extraParameters=e}get icon(){return"print"}set icon(e){this._overrideIfSome("icon",e)}get includeDefaultTemplates(){return this.viewModel.includeDefaultTemplates}set includeDefaultTemplates(e){this.viewModel.includeDefaultTemplates=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get outSpatialReference(){return this.viewModel.outSpatialReference}set outSpatialReference(e){this.viewModel.outSpatialReference=e}get portal(){return this.viewModel.portal}set portal(e){this.viewModel.portal=e}get showPrintAreaEnabled(){return this.viewModel.showPrintAreaEnabled}set showPrintAreaEnabled(e){this.viewModel.showPrintAreaEnabled=e}get printServiceUrl(){return this.viewModel.printServiceUrl}set printServiceUrl(e){this.viewModel.printServiceUrl=e}get templateCustomTextElements(){return this.viewModel.templateCustomTextElements}set templateCustomTextElements(e){this.viewModel.templateCustomTextElements=e}get templateOptions(){return this.viewModel.templateOptions}set templateOptions(e){this.viewModel.templateOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const{messages:e,templateOptions:t,viewModel:i,view:o}=this,{attributionEnabled:s,author:a,copyright:l,dpi:n,format:r,height:p,layout:c,layoutItem:u,legendEnabled:h,northArrowEnabled:b,scaleBarEnabled:y,scaleEnabled:g,scale:_,width:f}=t,T="ready"!==i.state||this._awaitingServerResponse||!(c||u),x=this._renderTitleOrFileNameSection(),I=C("div",{class:D.formSectionContainer},C("calcite-label",null,e.fileFormatTitle,C("calcite-combobox",{clearDisabled:!0,label:e.formatDefaultOption,maxItems:6,placeholder:e.formatDefaultOption,selectionMode:"single-persist",onCalciteComboboxChange:({target:e})=>{this.templateOptions.format=e.selectedItems[0]?.value??"pdf"}},this._formats.map((({value:e,label:t},i)=>C("calcite-combobox-item",{key:`file-format-${i}`,selected:e===this.templateOptions.format,textLabel:t,value:e})))))),O=C("calcite-label",{layout:"inline"},C("calcite-switch",{checked:this.showPrintAreaEnabled,onCalciteSwitchChange:e=>{this.showPrintAreaEnabled=!!e.target.checked}}),e.printPreview),$=C("div",null,C("div",{class:D.formSectionContainer},C("calcite-label",null,e.template,C("calcite-block",{class:D.templateSelectContainer,collapsible:!1,description:this._getPageSizeLabel(this._selectedTemplate),heading:this._getTemplateLabel(this._selectedTemplate,!0),key:"template-select-block",loading:"loading"===this._selectedTemplate?.state,onclick:()=>{this._showTemplates=!0}},C("calcite-icon",{class:D.templateSelectIcon,icon:(this._selectedTemplate?.layout?A.get(this._selectedTemplate.layout):null)||"custom-print",key:"template-select-icon",scale:"l",slot:"content-start"}),"error"===this._selectedTemplate?.state?C("calcite-icon",{class:D.templateSelectError,icon:"exclamation-mark-circle",key:"template-select-error",scale:"s",slot:"actions-end"}):null,C("calcite-icon",{class:D.templateSelectArrow,icon:w()?"chevron-left":"chevron-right",key:"template-select-arrow",scale:"s",slot:"actions-end"})))),O),L=C("div",{class:D.formSectionContainer},C("calcite-label",null,e.dpi,C("calcite-input-number",{bind:this,"data-input-name":"dpi",min:1,value:`${n}`,onCalciteInputNumberInput:this._handleDPIChange}))),M=C("div",{class:D.formSectionContainer},C("calcite-label",null,C("div",{class:D.srLabel},e.outSpatialReference,C("calcite-link",{href:"https://developers.arcgis.com/rest/services-reference/enterprise/using-spatial-references/",target:"_blank"},"(WKID)")),C("calcite-input-number",{bind:this,"data-input-name":"outSpatialReference",integer:!0,numberButtonType:"none",value:i.outSpatialReference?.wkid?.toString()??"",onCalciteInputNumberInput:({target:e})=>{const t=m(e.value);i.outSpatialReference=Number.isNaN(t)||null==t?null:new S({wkid:t}),this._isValidSpatialReference=!i.outSpatialReference||d(i.outSpatialReference)}}),this._isValidSpatialReference?null:C("div",{class:D.invalidWkidText,key:`out-sr-${i.outSpatialReference?.wkid}`},e.invalidWkid))),F=C("div",{class:this.classes(D.scaleInfoContainer,D.formSectionContainer)},C("calcite-label",{layout:"inline"},C("calcite-checkbox",{bind:this,checked:g,"data-option-name":"scaleEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.scale),C("div",{class:D.scaleInputContainer},C("calcite-input-number",{"aria-label":e.scaleLabel,"aria-valuenow":`${_}`,bind:this,class:D.scaleInput,"data-input-name":"scale",disabled:!g,value:`${_}`,onCalciteInputNumberInput:this._updateNumberInputValue}),C("calcite-button",{appearance:"outline","aria-label":e.reset,bind:this,disabled:!g,iconStart:"refresh",kind:"neutral",onclick:this._resetToCurrentScale}))),P=C("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:D.advancedOptionsContainer,key:"advanced-section-for-layout"},F,this._selectedTemplate?.layoutTemplateInfo?.layoutOptions?.hasAuthorText??1?C("div",{class:D.formSectionContainer,key:"author-info"},C("calcite-label",null,e.author,C("calcite-input",{bind:this,"data-input-name":"author",value:a??"",onCalciteInputInput:this._updateInputValue}))):null,this._selectedTemplate?.layoutTemplateInfo?.layoutOptions?.hasCopyrightText??1?C("div",{class:D.formSectionContainer,key:"copyright-text"},C("calcite-label",null,e.copyright,C("calcite-input",{bind:this,"data-input-name":"copyright",value:l??"",onCalciteInputInput:this._updateInputValue}))):null,L,M,this._renderCustomTextElementSection(),this._selectedTemplate?.layoutTemplateInfo?.layoutOptions?.hasLegend??1?C("div",{class:D.formSectionContainer,key:"legend-info"},C("calcite-label",{layout:"inline"},C("calcite-checkbox",{bind:this,checked:h,"data-option-name":"legendEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.legend)):null,this._selectedTemplate?.mapSurroundInfoOptions?.northArrow.length?C("div",{class:D.formSectionContainer,key:"north-arrow"},C("calcite-label",{layout:"inline"},C("calcite-checkbox",{bind:this,checked:b,"data-option-name":"northArrowEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.northArrow)):null,this._selectedTemplate?.mapSurroundInfoOptions?.scaleBar.length?C("div",{class:D.formSectionContainer,key:"scale-bar"},C("calcite-label",{layout:"inline"},C("calcite-checkbox",{bind:this,checked:y,"data-option-name":"scaleBarEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.scaleBar)):null),U=C("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:D.advancedOptionsContainer},F,L,M,C("div",{class:D.formSectionContainer},C("calcite-label",{layout:"inline"},C("calcite-checkbox",{bind:this,checked:s,"data-option-name":"attributionEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.attribution)),this._renderCustomTextElementSection()),B=this.exportedLinks.toArray(),R=this._renderExportedLink(B),N={[D.exportSectionCentered]:!B.length},V=this._selectedTab===E.layout?C("section",{"aria-labelledby":`${this.id}__layoutTab`,class:D.layoutSection,id:`${this.id}__layoutContent`,key:"esri-print__layoutContent",role:"tabpanel"},C("div",{class:D.panelContainer},this._selectedTemplate?.layoutTemplateInfo?.layoutOptions?.hasTitleText??1?x:null,$,this._selectedTab===E.layout?I:null,C("calcite-block",{"aria-label":e.advancedOptions,class:this.classes(D.panelContainer,D.advancedOptionsSection),collapsible:!0,disabled:!(c||u?.id),heading:e.advancedOptions,id:"advancedOptionsForLayout",key:"advanced-options-for-layout"},P))):this._selectedTab===E.mapOnly?C("section",{"aria-labelledby":`${this.id}__mapOnlyTab`,class:D.mapOnlySection,id:`${this.id}__mapOnlyContent`,key:"esri-print__mapOnlyContent",role:"tabpanel"},C("div",{class:D.panelContainer},x,I,C("div",null,C("div",{class:this.classes(D.sizeContainer,D.formSectionContainer)},C("calcite-label",null,e.width,C("calcite-input-number",{bind:this,"data-input-name":"width",value:`${f}`,onCalciteInputNumberInput:this._updateNumberInputValue})),C("calcite-label",null,e.height,C("calcite-input-number",{bind:this,"data-input-name":"height",value:`${p}`,onCalciteInputNumberInput:this._updateNumberInputValue})),C("button",{"aria-label":e.swap,bind:this,class:this.classes(k.widgetButton,D.swapButton,j.swap),onclick:this._switchInput,type:"button"})),O),C("calcite-block",{"aria-label":e.advancedOptions,class:this.classes(D.panelContainer,D.advancedOptionsSection),collapsible:!0,heading:e.advancedOptions,id:"advancedOptionsForMapOnly",key:"advanced-options-for-map-only"},U))):C("section",{"aria-labelledby":`${this.id}__exportTab`,class:this.classes(D.exportSection,N),id:`${this.id}__exportContent`,key:"esri-print__exportContent",role:"tabpanel"},C("div",{class:D.panelContainer},C("div",{afterUpdate:this._scrollExportIntoView,bind:this,class:D.exportedFilesContainer},0===B.length?C("div",{class:D.exportedFilesEmpty},C("calcite-icon",{icon:"file",scale:"l"}),C("div",null,C(v,{class:D.exportedFilesTitle,level:this.headingLevel},e.noExportedFiles),C("div",null,e.exportHint))):R))),H="2d"!==o?.type,z=C("div",{class:D.panelError},o?H?e.sceneViewError:e.serviceError:e.noViewError),W=B.some((({state:e})=>"pending"===e)),q=C("div",{class:D.content,key:"panel"},C("div",null,C("ul",{bind:this,class:D.layoutTabList,onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,role:"tablist"},C("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===E.layout}`,class:D.layoutTab,"data-tab-id":E.layout,id:`${this.id}__layoutTab`,role:"tab",tabIndex:0},e.layoutTab),C("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===E.mapOnly}`,class:D.layoutTab,"data-tab-id":E.mapOnly,id:`${this.id}__mapOnlyTab`,role:"tab",tabIndex:0},e.mapOnlyTab),C("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===E.export}`,class:D.layoutTab,"data-tab-id":E.export,id:`${this.id}__exportedFilesTab`,role:"tab",tabIndex:0},W?C("calcite-loader",{inline:!0,label:"loading",scale:"s"}):null,e.exportsTab)),V),this._selectedTab!==E.export?C("div",{class:this.classes(D.printButtonSection,!this.saveExportHidden&&this.portal?D.printButtonSectionDivider:null),key:"export-button-section"},!this.saveExportHidden&&this.portal?C("calcite-label",{layout:"inline"},C("calcite-checkbox",{bind:this,checked:this.saveExportEnabled,onCalciteCheckboxChange:e=>{this.saveExportEnabled=!!e.target.checked}}),e.saveExportToMyContent):null,C("calcite-button",{"aria-label":e.exportDescription,bind:this,class:this.classes(D.printButton),disabled:T||!(c||u?.id)&&!r,onclick:this._handlePrintMap,scale:"l",width:"full"},e.export)):null),G=C("calcite-flow",{key:"root-flow"},C("calcite-flow-item",{bind:this,key:"root-flow-item"},C("div",{class:D.printWidgetContainer},this.headerVisible?C("header",{class:D.headerTitle},e.export):null,this.error||H||!o?z:q)),this._renderChooseTemplateFlowItem()),J="initializing"===i.state,K=J?this._renderLoader():G,Q={[D.panelItemsCentered]:J};return C("div",{bind:this,class:this.classes(D.base,k.widget,k.panel,Q)},K)}_getPageSizeLabel(e){if(!e)return;const t=e.layoutTemplateInfo;if(!t)return;const i=R.fromJSON(t.pageUnits.toLowerCase());return`${I(t.pageSize[0])} x ${I(t.pageSize[1])} ${l(this.messagesUnits,i,"abbr")}`}_getTemplateLabel(e,t=!1){if(!e)return t?this.messages.selectTemplate:this.messages.untitled;const{label:i,layout:o,layoutItem:s,type:a}=e;if("print-service-template"===a)return this.messages[o];const l=i??o??s?.id;return l?.replaceAll("_"," ")??this.messages.untitled}_getPortalTemplates(){const{portalTemplateIds:e}=this.viewModel;return this.includeDefaultTemplates?this.viewModel.defaultTemplates.toArray().filter((({layout:t,layoutItem:i})=>!U(t)&&!!i?.id&&e.includes(i.id))):[]}_getDefaultTemplates(){const{portalTemplateIds:e}=this.viewModel;return this.includeDefaultTemplates?this.viewModel.defaultTemplates.toArray().filter((({layout:t,layoutItem:i})=>!(U(t)||i?.id&&e.includes(i.id)))):[]}_getPrintServiceTemplates(){return this.includeDefaultTemplates&&this._getDefaultTemplates().length?[]:this.viewModel.printServiceTemplates.toArray().filter((({layout:e})=>!U(e)))}_renderLayoutTemplates(e,t=!1,i=!1){return t&&e.sort(((e,t)=>(e.label??"")>(t.label??"")?1:-1)),e.map((e=>C("calcite-list-item",{description:this._getPageSizeLabel(e),key:`template-${e.id}-${e.id===this.templateOptions.id}`,label:this._getTemplateLabel(e),selected:e.id===this.templateOptions.id,title:e.description??"",value:e},C("calcite-icon",{icon:(e.layout?A.get(e.layout):null)||"custom-print",slot:"content-start"}),"loading"===e.state?C("calcite-loader",{inline:!0,key:`template-loader-${e.id}`,label:"loading",scale:"s",slot:"content-end"}):null,"error"===e?.state?C("calcite-icon",{class:D.templateSelectError,icon:"exclamation-mark-circle",key:`template-error-${e.id}`,scale:"s",slot:"content-end"}):null,i?C("calcite-action",{icon:"trash",onclick:()=>this.viewModel.removePortalTemplate(e),slot:"actions-end",text:"delete"}):null)))}_renderChooseTemplateFlowItem(){if(!this._showTemplates)return null;const{messages:e}=this,t=n.test(this.portal?.url),i=this.viewModel.browseTemplates.toArray(),o=this._getPortalTemplates(),s=this._getDefaultTemplates(),a=this._getPrintServiceTemplates(),l=i.length+o.length+s.length+a.length>15,r=this.browseTemplateButtonOnClick?C("calcite-button",{appearance:"outline",class:l?D.browseTemplateButtonContainerFilter:D.browseTemplateButtonContainer,iconStart:"folder",key:"browse-template-button",onclick:this.browseTemplateButtonOnClick,slot:l?"filter-actions-end":"default"},l?null:e.browseTemplates):null;return C("calcite-flow-item",{bind:this,closable:!1,heading:e.chooseTemplate,key:"template-flow-item",onCalciteFlowItemBack:e=>{e.preventDefault(),this._showTemplates=!1}},C("div",{class:D.templateSelectFlowItemContainer},C("div",{class:D.templateSelectFlowItemContent},l?null:r,C("calcite-list",{filterEnabled:l,filterProps:["label"],key:"template-list",selectionMode:"single-persist",onCalciteListChange:({target:e})=>this.viewModel.applyTemplate(e.selectedItems[0]?.value)},l?r:null,i.length?C("div",{key:"my-templates"},C("div",{class:D.templateSelectFlowItemListHeading},e.myTemplates,C("calcite-chip",{appearance:"outline",kind:"neutral",scale:"s",value:e.beta},e.beta)),this._renderLayoutTemplates(i,!0,!0)):null,o.length?C("div",{key:"org-templates"},C("div",{class:D.templateSelectFlowItemListHeading},e.organizationTemplates,t?C("calcite-chip",{appearance:"outline",kind:"neutral",scale:"s",value:e.beta},e.beta):null),this._renderLayoutTemplates(o)):null,i.length||o.length?s.length?C("div",{key:"default-templates"},C("div",{class:D.templateSelectFlowItemListHeading},e.defaultTemplates),this._renderLayoutTemplates(s,!0)):null:this._renderLayoutTemplates(s,!0),i.length||o.length?a.length?C("div",{key:"service-templates"},C("div",{class:D.templateSelectFlowItemListHeading},e.defaultTemplates),this._renderLayoutTemplates(a)):null:this._renderLayoutTemplates(a))),C("div",{class:D.templateButtonContainer},C("calcite-button",{class:D.templateDoneButton,onclick:()=>this._showTemplates=!1},this.messagesCommon.done))))}_renderCustomTextElementSection(){const{customTextElements:e}=this.templateOptions;return e?C("div",{class:D.formSectionContainer,key:"custom-text-elements"},e.map(((e,t)=>{const[i,o]=Object.entries(e)[0];return"date"===i?null:C("calcite-label",{key:`custom-text-elements-${i}-${t}`},i,C("calcite-input",{bind:this,"data-input-custom":!0,"data-input-name":i,value:o??"",onCalciteInputInput:this._updateInputValue}))}))):null}_renderTitleOrFileNameSection(){const{title:e,fileName:t,titlePlaceHolder:i,fileNamePlaceHolder:o}=this.messages,s=this._selectedTab===E.layout?e:t,a=this._selectedTab===E.layout?i:o,l=this._selectedTab===E.layout?this.templateOptions.title:this.templateOptions.fileName;return C("div",{class:D.formSectionContainer,key:s},C("calcite-label",null,s,C("calcite-input",{placeholder:a,value:l??"",onCalciteInputInput:this._onInput})))}_focusOnTabChange(e){if(!this._activeTabFocusRequested)return;const t=e.getAttribute("data-tab-id");("layoutTab"===t&&this._selectedTab===E.layout||"mapOnlyTab"===t&&this._selectedTab===E.mapOnly||"exportTab"===t&&this._selectedTab===E.export)&&(e.focus(),this._activeTabFocusRequested=!1)}_renderLoader(){const e={[D.loader]:this._awaitingServerResponse};return C("div",{class:this.classes(e),key:"loader"})}_updateExportedFileNameMap(e){void 0!==this._exportedFileNameMap[e]?this._exportedFileNameMap[e]++:this._exportedFileNameMap[e]=0}_createFileLink(e,t){const i=t||this.messages.untitled,o=e.format.toLowerCase(),s=o.includes("png")?"png":o,a=i+s;return this._updateExportedFileNameMap(a),new $({name:i,extension:s,count:this._exportedFileNameMap[a]})}_resetToCurrentScale(){this.templateOptions.scale=this.viewModel.view?.scale}_updateCustomTextElementValue(e,t,i){e.find((e=>{const[i]=Object.entries(e)[0];return i===t}))[t]=i}_updateInputValue(e){const t=e.target,i=t.getAttribute("data-input-name"),o=!!t["data-input-custom"],{templateOptions:s}=this;o?this._updateCustomTextElementValue(s.customTextElements,i,t.value):s[i]=t.value}_updateNumberInputValue(e){const t=e.target,i=t.getAttribute("data-input-name"),{templateOptions:o}=this,s=Number(t.value);if(a=s,!isNaN(a)&&a>0){var a;o[i]=s}else{const e=o[i];t.value=`${e}`}}_handleDPIChange(e){const{templateOptions:t}=this,i=t.dpi;this._updateNumberInputValue(e);const o=t.dpi,{height:s,width:a}=function(e,t,i,o){const s=i/t,a=o/t;return{width:Math.round(e*s),height:Math.round(e*a)}}(o,i,t.width,t.height);t.height=s,t.width=a}_handlePrintMap(){this._pendingExportScroll=!0;const{templateOptions:e,saveExportEnabled:t}=this,i=this.viewModel.toPrintTemplate(e),o=this._selectedTab===E.layout?i.layoutOptions?.titleText:e.fileName,s=this._createFileLink(i,o);this.exportedLinks.add(s),this.emit("submit",{link:s,saveExportEnabled:t}),this._selectedTab=E.export,this.viewModel.print(i).then((e=>{s.set({url:e&&e.url,state:"ready"})})).catch((e=>{s.set({error:e,state:"error"})})).then((()=>{this.emit("complete",{link:s,saveExportEnabled:t}),this.scheduleRender()}))}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]}_scrollExportIntoView(){if(!this._pendingExportScroll)return;this._pendingExportScroll=!1;const e=this._rootNode;if(!e)return;const{clientHeight:t,scrollHeight:i}=e,o=i-t;o>0&&(e.scrollTop=o)}_toggleInputValue(e){const t=e.target,i=t.getAttribute("data-option-name");this.templateOptions[i]=t.checked,"scaleEnabled"===i&&this._resetToCurrentScale()}_renderExportedLink(e){const t=this.messages,i=e.map((e=>{const{error:i,url:o,state:s}=e,l=e.formattedName??"",n="error"===s,c="pending"===s,m="ready"===s;let u=o||null;u&&(u=r(u));const d=p(o,location.href);let h;h=c?t.pending:m?t.ready:t.errorMessage;const b=n?"print-task:cim-symbol-unsupported"===i?.name?t.exportWebMapCIMError:t.exportWebMapError:"";return C("calcite-list-item",{"aria-label":h,key:l,title:b},C("div",{class:D.exportedFile,"data-item":e,onclick:this._handleLinkClick,slot:"content"},C("div",null,C("div",{class:D.exportedFileLinkTitle},l),C("div",{class:D.exportedFileLinkDescription},c?t.generatingExport:b||(d?t.ready:t.linkReady))),m?C("calcite-icon",{"aria-label":`${l}. ${t.linkReady}`,icon:d?"download-to":"launch",key:`${l}-end-icon`,scale:"s",slot:"content-end"}):null),c?C("calcite-loader",{class:D.exportedFileLoader,inline:!0,key:`${l}-loader`,label:t.generatingExport,scale:"m",slot:"content-start"}):C("calcite-icon",{icon:B(e),key:`${l}-start-icon`,scale:"s",slot:"content-start"}),c?null:this.saveAsButtonCallback&&!n&&this._isFormatAllowedForSaving(e.extension)?C("calcite-action",{"aria-label":`${b}`,icon:"ellipsis",id:`${l}-popover-button`,key:`${l}-action`,slot:"actions-end",text:`${b}`},C("calcite-popover",{autoClose:!0,key:`${l}-popover`,label:"Popover",offsetDistance:1,overlayPositioning:"fixed",pointerDisabled:!0,referenceElement:`${l}-popover-button`,scale:"s"},C("calcite-list",null,e.portalItem?C("calcite-list-item",{label:t.openItem,onCalciteListItemSelect:()=>{const t=e.portalItem;if(!t||!t.itemPageUrl)return;const i=document.createElement("a");i.target="_blank",i.href=t.itemPageUrl,i.rel="noreferrer",i.click()}},C("calcite-icon",{icon:"launch2",key:`${l}-launch-icon`,scale:"s",slot:"content-start"})):C("calcite-list-item",{label:t.saveAs,onCalciteListItemSelect:async()=>{this.saveAsButtonCallback&&(a((()=>e.portalItem)).then((e=>{e.itemPageUrl&&this.scheduleRender()})),await this.saveAsButtonCallback(e))}},C("calcite-icon",{icon:"save",key:`${l}-save-icon`,scale:"s",slot:"content-start"})),C("calcite-list-item",{label:this.messagesCommon.delete,onCalciteListItemSelect:()=>this.exportedLinks.remove(e)},C("calcite-icon",{icon:"trash",key:`${l}-delete-icon`,scale:"s",slot:"content-start"}))))):C("calcite-action",{"aria-label":`${b}`,icon:"x",key:`${l}-action`,onclick:()=>{this.exportedLinks.remove(e)},slot:"actions-end",text:`${b}`}))}));return C("calcite-list",{filterEnabled:e?.length>10},i)}_isFormatAllowedForSaving(e){return!this.allowedFormatsForSaving||"all"===this.allowedFormatsForSaving||!(!e||!this.allowedFormatsForSaving.includes(e))}_toggleLayoutPanel(e){const t=e.target;this._toggleTab(t.getAttribute("data-tab-id"))}_toggleTab(e,t=!0){if(this._selectedTab=e,this._selectedTab===E.mapOnly)this.templateOptions.reset(),this.templateOptions.layout=M;else if(this._selectedTab===E.layout){const e=this._selectedTemplate??this.viewModel.defaultTemplate;e?this.viewModel.applyTemplate(e):this.templateOptions.reset()}t&&(this._activeTabFocusRequested=!0)}_handleLayoutPanelKeyDown(e){const{key:t}=e,i=e.target.getAttribute("data-tab-id");if(T(t))return this._toggleTab(i),e.preventDefault(),void e.stopPropagation();if("ArrowLeft"===t||"ArrowRight"===t){switch(i){case E.layout:this._toggleTab("ArrowLeft"===t?E.export:E.mapOnly);break;case E.mapOnly:this._toggleTab("ArrowLeft"===t?E.layout:E.export);break;case E.export:this._toggleTab("ArrowLeft"===t?E.mapOnly:E.layout)}e.preventDefault(),e.stopPropagation()}}};e([c()],N.prototype,"_showTemplates",void 0),e([c()],N.prototype,"_isValidSpatialReference",void 0),e([c()],N.prototype,"allowedFormats",null),e([c()],N.prototype,"allowedFormatsForSaving",void 0),e([c()],N.prototype,"allowedLayouts",null),e([c()],N.prototype,"browseTemplateButtonOnClick",void 0),e([c()],N.prototype,"error",null),e([c({type:L})],N.prototype,"exportedLinks",void 0),e([c()],N.prototype,"extraParameters",null),e([c()],N.prototype,"headerVisible",void 0),e([c()],N.prototype,"headingLevel",void 0),e([c()],N.prototype,"icon",null),e([c()],N.prototype,"includeDefaultTemplates",null),e([c()],N.prototype,"label",null),e([c(),x("esri/widgets/Print/t9n/Print")],N.prototype,"messages",void 0),e([c(),x("esri/t9n/common")],N.prototype,"messagesCommon",void 0),e([c(),x("esri/core/t9n/Units")],N.prototype,"messagesUnits",void 0),e([c({type:S})],N.prototype,"outSpatialReference",null),e([c()],N.prototype,"portal",null),e([c()],N.prototype,"saveExportEnabled",void 0),e([c()],N.prototype,"saveExportHidden",void 0),e([c()],N.prototype,"showPrintAreaEnabled",null),e([c()],N.prototype,"printServiceUrl",null),e([c()],N.prototype,"saveAsButtonCallback",void 0),e([c()],N.prototype,"templateCustomTextElements",null),e([c()],N.prototype,"templateOptions",null),e([c()],N.prototype,"view",null),e([c({type:_})],N.prototype,"viewModel",void 0),N=e([u("esri.widgets.Print")],N);const V=N;export{V as default};
