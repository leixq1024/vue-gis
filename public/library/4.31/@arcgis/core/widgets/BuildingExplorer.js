/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{property as t}from"../core/accessorSupport/decorators/property.js";import{cast as s}from"../core/accessorSupport/decorators/cast.js";import"../core/lang.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import r from"./Widget.js";import o,{L as n}from"./BuildingExplorer/BuildingExplorerViewModel.js";import"../chunks/Logger.js";import{l}from"../chunks/componentsUtils.js";import{s as a,a as p,c as m}from"../chunks/widgetUtils.js";import{t as u}from"../chunks/jsxFactory.js";import{o as c}from"../core/promiseUtils.js";import{c as h}from"../chunks/mathUtils.js";import{watch as d,initial as j}from"../core/reactiveUtils.js";import{g as v}from"../chunks/globalCss.js";import{H as g}from"../chunks/Heading.js";import{m as y}from"../chunks/messageBundle.js";import"../chunks/ensureType.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/metadata.js";import"../core/Error.js";import"../config.js";import"../chunks/tracking.js";import"../intl.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/locale.js";import"../chunks/datetime.js";import"../chunks/number.js";import"../chunks/substitute.js";import"../chunks/messages.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/JSONSupport.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/maybe.js";import"../chunks/ObservableBase.js";import"../core/scheduling.js";import"../chunks/assets.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/asyncUtils.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/collectionUtils.js";import"../layers/BuildingSceneLayer.js";import"../chunks/CollectionFlattener.js";import"../chunks/loadAll.js";import"../core/Loadable.js";import"../chunks/MultiOriginJSONSupport.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../chunks/writer.js";import"../layers/Layer.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/coordsUtils.js";import"../chunks/Axis.js";import"../chunks/extentUtils.js";import"../chunks/boundsUtils.js";import"../chunks/aaBoundingRect.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../core/Identifiable.js";import"../time/TimeExtent.js";import"../chunks/timeUtils.js";import"../layers/buildingSublayers/BuildingComponentSublayer.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../Color.js";import"../chunks/colorUtils.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/content/UtilityNetworkAssociationsContent.js";import"../popup/support/UtilityNetworkAssociationType.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils4.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../chunks/vec3f64.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils5.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../portal/Portal.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../renderers/mixins/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/sizeVariableUtils.js";import"../chunks/visualVariableUtils.js";import"../chunks/compilerUtils.js";import"../chunks/lengthUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties.js";import"../symbols/support/jsonUtils.js";import"../chunks/layerUtils.js";import"../chunks/defaults.js";import"../chunks/defaultsJSON.js";import"../chunks/RendererLegendOptions.js";import"../renderers/DictionaryRenderer.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/Version2.js";import"../layers/support/FieldsIndex.js";import"../chunks/UnknownTimeZone.js";import"../chunks/OverrideHelper.js";import"../chunks/colorUtils2.js";import"../chunks/vec4.js";import"../chunks/common.js";import"../chunks/vec4f64.js";import"../chunks/utils7.js";import"../chunks/enums2.js";import"../chunks/quantizationUtils.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../chunks/heatmapUtils.js";import"../renderers/PieChartRenderer.js";import"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValue.js";import"../renderers/support/UniqueValueClass.js";import"../renderers/support/UniqueValueGroup.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../renderers/support/jsonUtils.js";import"../layers/FeatureLayer.js";import"../chunks/layerContainerType.js";import"../form/FormTemplate.js";import"../form/ExpressionInfo.js";import"../form/elements/GroupElement.js";import"../form/elements/Element.js";import"../form/support/elements.js";import"../form/elements/AttachmentElement.js";import"../form/elements/inputs/attachments/AttachmentInput.js";import"../chunks/Input.js";import"../form/elements/inputs/attachments/support/inputs.js";import"../form/elements/inputs/attachments/AudioInput.js";import"../chunks/utils8.js";import"../form/elements/inputs/attachments/DocumentInput.js";import"../form/elements/inputs/attachments/ImageInput.js";import"../form/elements/inputs/attachments/SignatureInput.js";import"../form/elements/inputs/attachments/VideoInput.js";import"../form/elements/FieldElement.js";import"../form/elements/support/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DatePickerInput.js";import"../form/elements/inputs/DateTimeOffsetPickerInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../form/elements/inputs/TimePickerInput.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../form/elements/RelationshipElement.js";import"../form/elements/TextElement.js";import"../chunks/formUtils.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../chunks/Queue.js";import"../core/workers/RemoteClient.js";import"../chunks/editsZScale.js";import"../chunks/queryZScale.js";import"../chunks/zscale.js";import"../rest/support/FeatureSet.js";import"../layers/support/Field.js";import"../chunks/fieldType.js";import"../layers/mixins/APIKeyMixin.js";import"../chunks/ArcGISService.js";import"../chunks/arcgisLayerUrl.js";import"../layers/mixins/BlendLayer.js";import"../chunks/jsonUtils.js";import"../chunks/parser.js";import"../chunks/utils2.js";import"../chunks/mat4.js";import"../layers/mixins/CustomParametersMixin.js";import"../chunks/EditBusLayer.js";import"../layers/mixins/FeatureEffectLayer.js";import"../layers/support/FeatureEffect.js";import"../layers/support/FeatureFilter.js";import"../rest/support/Query.js";import"../chunks/DataLayerSource.js";import"../chunks/FullTextSearch.js";import"../chunks/spatialRelationships.js";import"../rest/support/StatisticDefinition.js";import"../layers/mixins/FeatureLayerBase.js";import"../geometry/HeightModelInfo.js";import"../chunks/commonProperties2.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../tables/AttributeTableTemplate.js";import"../tables/elements/AttributeTableGroupElement.js";import"../tables/elements/AttributeTableElement.js";import"../tables/support/elements.js";import"../tables/elements/AttributeTableAttachmentElement.js";import"../tables/elements/AttributeTableFieldElement.js";import"../tables/elements/AttributeTableRelationshipElement.js";import"../chunks/featureLayerUtils.js";import"../chunks/featureQueryAll.js";import"../rest/support/AttachmentQuery.js";import"../rest/support/RelationshipQuery.js";import"../layers/support/GeometryFieldsInfo.js";import"../layers/support/LayerFloorInfo.js";import"../layers/support/Relationship.js";import"../chunks/serviceCapabilitiesUtils.js";import"../layers/support/Subtype.js";import"../layers/mixins/FeatureReductionLayer.js";import"../layers/support/AggregateField.js";import"../layers/support/ExpressionInfo.js";import"../chunks/FeatureReduction.js";import"../layers/support/FeatureReductionBinning.js";import"../layers/support/LabelClass.js";import"../chunks/labelUtils.js";import"../layers/support/FeatureReductionCluster.js";import"../layers/support/FeatureReductionSelection.js";import"../chunks/clusterUtils.js";import"../chunks/MD5.js";import"../layers/mixins/OperationalLayer.js";import"../layers/mixins/OrderedLayer.js";import"../chunks/OrderByInfo.js";import"../layers/mixins/PortalLayer.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/portalItemUtils.js";import"../geometry/projection.js";import"../chunks/projectBuffer.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../layers/mixins/PublishableLayer.js";import"../layers/support/PublishingInfo.js";import"../layers/mixins/RefreshableLayer.js";import"../layers/mixins/ScaleRangeLayer.js";import"../layers/mixins/TemporalLayer.js";import"../layers/support/TimeInfo.js";import"../time/TimeInterval.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"../chunks/fieldProperties.js";import"../chunks/labelingInfo.js";import"../chunks/versionUtils.js";import"../chunks/styleUtils2.js";import"../support/popupUtils.js";import"../chunks/AlphaCutoff.js";import"../chunks/interfaces2.js";import"../layers/buildingSublayers/BuildingSublayer.js";import"../chunks/capabilities.js";import"../chunks/I3SIndexInfo.js";import"../chunks/I3SLayerDefinitions.js";import"../chunks/I3SUtil.js";import"../chunks/mat4f64.js";import"../chunks/vec3.js";import"../chunks/projectVectorToVector.js";import"../chunks/projectPointToVector.js";import"../chunks/dehydratedPoint.js";import"../chunks/sphere.js";import"../chunks/ray.js";import"../chunks/mat3.js";import"../chunks/mat3f64.js";import"../chunks/plane.js";import"../chunks/quatf64.js";import"../chunks/vec2f64.js";import"../chunks/mathUtils2.js";import"../chunks/I3SBinaryReader.js";import"../chunks/VertexAttribute.js";import"../chunks/computeTranslationToOriginAndRotation.js";import"../chunks/edgeUtils.js";import"../chunks/floatRGBA.js";import"../chunks/DecodeSymbolColor.glsl.js";import"../chunks/interfaces3.js";import"../chunks/Matrix4PassUniform.js";import"../chunks/BindType.js";import"../chunks/RgbaFloatEncoding.glsl.js";import"../chunks/Float4DrawUniform.js";import"../chunks/NormalAttribute.glsl.js";import"../chunks/Matrix3DrawUniform.js";import"../chunks/orientedBoundingBox.js";import"../chunks/quat.js";import"../chunks/spatialReferenceEllipsoidUtils.js";import"../chunks/ViewingMode.js";import"../chunks/Attribute.js";import"../chunks/layerViewUtils.js";import"../chunks/popupUtils.js";import"../layers/buildingSublayers/BuildingGroupSublayer.js";import"../layers/mixins/SceneService.js";import"../chunks/originUtils.js";import"../chunks/multiOriginJSONSupportUtils.js";import"../chunks/jsonContext.js";import"../chunks/resourceUtils2.js";import"../chunks/resourceUtils.js";import"../chunks/saveUtils.js";import"../chunks/associatedFeatureServiceUtils.js";import"../layers/support/BuildingFilter.js";import"../chunks/BuildingFilterBlock.js";import"../layers/support/BuildingSummaryStatistics.js";import"../chunks/elevationInfoUtils.js";import"../chunks/filterUtils.js";import"./BuildingExplorer/BuildingNumericFilterViewModel.js";import"./BuildingExplorer/BuildingLevel.js";import"./BuildingExplorer/BuildingPhase.js";const b="esri-building-explorer",k={base:b,panelError:`${b}__panel--error`,loadingContainer:`${b}__loading-container`,content:`${b}__content`,section:`${b}__section`,levels:`${b}__levels`,phases:`${b}__phases`,disciplines:`${b}__disciplines`};var _;const f={expand:"expand",collapse:"collapse",hideSublayer:"hideSublayer",showSublayer:"showSublayer"},C="esri-building-disciplines-tree-node",S={base:C,label:`${C}__label`,level:e=>`${C}--level-${e}`};let L=_=class extends r{constructor(e){super(e),this.messages=f,this.toggleSiblingsVisibility=!1,this._toggledAll=!1,this._onCheckboxClick=e=>{e.stopPropagation(),(e.metaKey||e.ctrlKey)&&this.toggleSiblingsVisibility&&(this.node.toggleAllSiblingsVisibility(),this._toggledAll=!0)},this._onCheckboxToggle=e=>{this._toggledAll?this._toggledAll=!1:this.node.toggleVisibility(e.target.checked)}}loadDependencies(){return l({checkbox:()=>import("../chunks/calcite-checkbox.js"),label:()=>import("../chunks/calcite-label.js"),tree:()=>import("../chunks/calcite-tree.js"),"tree-item":()=>import("../chunks/calcite-tree-item.js")})}render(){const{node:e,messages:t}=this;if(e.isDiscipline&&!e.hasChildren)return u("div",{key:`${e.id}-empty`});const s=e.visible,i=!0===s,r=null===s,o=i?t?.hideSublayer:t?.showSublayer;return u("div",{class:S.base,key:e.id},u("calcite-tree-item",null,u("calcite-label",{class:S.label,layout:"inline"},u("calcite-checkbox",{checked:i,indeterminate:r,label:o,onclick:this._onCheckboxClick,title:o,onCalciteCheckboxChange:this._onCheckboxToggle}),e.title),this._renderedChildren))}get _renderedChildren(){const{node:e}=this;if(!e.hasChildren)return null;const{messages:t}=this,{toggleSiblingsVisibility:s}=this;return u("calcite-tree",{slot:"children"},this.node.children.toArray().reverse().map((e=>u(_,{messages:t,node:e,toggleSiblingsVisibility:s}))))}};e([t({type:n})],L.prototype,"node",void 0),e([t()],L.prototype,"messages",void 0),e([t({nonNullable:!0})],L.prototype,"toggleSiblingsVisibility",void 0),e([t()],L.prototype,"_renderedChildren",null),L=_=e([i("esri.widgets.BuildingExplorer.BuildingDisciplinesTree.BuildingDisciplinesNode")],L);const x=L,w={expand:"expand",collapse:"collapse",hideSublayer:"hideSublayer",showSublayer:"showSublayer"};let P=class extends r{constructor(e){super(e),this.toggleSiblingsVisibility=!1}loadDependencies(){return l({tree:()=>import("../chunks/calcite-tree.js")})}render(){const{vm:e}=this,t=this.toggleSiblingsVisibility,s=this.messages??w;return u("div",{class:"esri-building-disciplines-tree"},u("calcite-tree",{scale:"s",selectionMode:"none"},e.root.children.toArray().reverse().map((e=>u(x,{messages:s,node:e,toggleSiblingsVisibility:t})))))}};e([t()],P.prototype,"vm",void 0),e([t()],P.prototype,"messages",void 0),e([t()],P.prototype,"toggleSiblingsVisibility",void 0),P=e([i("esri.widgets.BuildingExplorer.BuildingDisciplinesTree.BuildingDisciplinesTree")],P);const U=P,I=Object.freeze(Object.defineProperty({__proto__:null,alphaLevelDependencyFactor:30,alphaSpreadFactor:10,levelHeightDefault:14,levelHoveredExtraHeight:30,levelHoveredExtraWidth:20,levelWidthConstant:40,levelWidthMax:80,levelWidthMin:30,levelWidthNominator:100,levelsMarginFactor:2,levelsPadding:20,levelsPointerAdjustment:.035},Symbol.toStringTag,{value:"Module"})),E="esri-building-level-picker",M={container:E,noLevel:`${E}--no-level`,animateLevel:`${E}--animate-level`,levelsContainer:`${E}__levels-container`,innerLevelsContainer:`${E}__inner-levels-container`,labelContainer:`${E}__label-container`,arrowUp:`${E}__arrow-up`,arrowDown:`${E}__arrow-down`},D="esri-building-level-picker-label",B={base:D,active:`${D}--active`,hover:`${D}--hover`,empty:`${D}--empty`,clearButton:`${D}__clear-button`},V={clearLevel:"",selectLevel:""};let A=class extends r{constructor(e,t){super(e,t),this.level=null,this.active=!1,this.hovering=!1,this.onClear=()=>{}}loadDependencies(){return l({fab:()=>import("../chunks/calcite-fab.js")})}render(){const e=this.messages??V;if(null==this.level)return u("div",{class:B.empty,title:e.selectLevel},e.selectLevel);const t=e.clearLevel;return u("div",{"aria-label":t,bind:this,class:this.classes(B.base,{[B.active]:this.active,[B.hover]:this.hovering}),onclick:this.onClear,title:t},u("span",null,this.level),u("calcite-fab",{appearance:"outline-fill",class:B.clearButton,disabled:!this.active,icon:"x",key:"clear-button",kind:"neutral",onclick:this.onClear,scale:"s"}))}};e([t()],A.prototype,"level",void 0),e([t({nonNullable:!0})],A.prototype,"active",void 0),e([t({nonNullable:!0})],A.prototype,"hovering",void 0),e([t()],A.prototype,"messages",void 0),e([t({nonNullable:!0})],A.prototype,"onClear",void 0),A=e([i("esri.widgets.BuildingExplorer.BuildingLevelPicker.Label")],A);const F="esri-building-level-picker-item",T={container:F,base:`${F}__base`,hover:`${F}--hover`,active:`${F}--active`};let R=class extends r{constructor(e,t){super(e,t),this.active=!1,this.hovering=!1,this.width=0,this.height=0,this.onSelect=()=>{},this.onFocus=()=>{},this.onBlur=()=>{},this._baseElement=null}render(){return u("div",{bind:this,class:this.classes(T.container,{[T.active]:this.active,[T.hover]:this.hovering}),key:this,styles:{height:`${this.height}px`}},this._renderBase())}focus(){null!=this._baseElement&&this._baseElement.focus()}_renderBase(){const e=this.width,t=.8*this.width;return u("div",{class:T.base,styles:{width:`${Math.round(e)}px`,height:`${Math.round(e)}px`}},u("button",{afterCreate:a,"aria-label":this.label,bind:this,class:"rect","data-node-ref":"_baseElement",onblur:this.onBlur,onclick:this.onSelect,onfocus:this.onFocus,styles:{width:`${Math.round(t)}px`,height:`${Math.round(t)}px`,transform:`translate(${p(this.container),-50}%, -50%) rotateX(66deg) rotateZ(45deg)`},tabIndex:-1,title:this.label??"",type:"button"}))}};e([t({nonNullable:!0})],R.prototype,"level",void 0),e([t({nonNullable:!0})],R.prototype,"active",void 0),e([t({nonNullable:!0})],R.prototype,"hovering",void 0),e([t({nonNullable:!0})],R.prototype,"width",void 0),e([t({nonNullable:!0})],R.prototype,"height",void 0),e([t({nonNullable:!0})],R.prototype,"onSelect",void 0),e([t({nonNullable:!0})],R.prototype,"onFocus",void 0),e([t({nonNullable:!0})],R.prototype,"onBlur",void 0),R=e([i("esri.widgets.BuildingExplorer.BuildingLevelPicker.LevelItem")],R);const $={selectLevel:"selectLevel",clearLevel:"clearLevel",nextLevel:"nextLevel",previousLevel:"previousLevel",currentLevel:"{{value}}"};let H=class extends r{constructor(e,t){super(e,t),this._levelHandlesKey="levelHandles",this._levelEventHandlesKey="levelEventHandles",this._levelWidgets=[],this._labelWidget=new A({onClear:()=>this.vm.clear()}),this._hoveredLevel=null,this._expandedLevelsHeight=void 0,this._normalizedPointerPosition=0,this._hovering=!1,this._containerPosTop=null,this._levelsContainer=null,this._onKeyDown=e=>{switch(e.key){case"ArrowDown":case"ArrowLeft":e.preventDefault(),e.stopPropagation(),this.vm.previous(),this._focusCurrentLevel();break;case"ArrowUp":case"ArrowRight":e.preventDefault(),e.stopPropagation(),this.vm.next(),this._focusCurrentLevel()}},this._onFocus=()=>{this._hoveredLevel=this._levels.length>0?this._levels[0]:null},this._onArrowUpClick=()=>{this.vm.next()},this._onArrowDownClick=()=>{this.vm.previous()},this._onPointerUp=()=>{if(window.getSelection()?.removeAllRanges(),null==this._hoveredLevel)return;const{vm:e}=this;e.enabled&&this._hoveredLevel===e.value?e.clear():e.select(this._hoveredLevel)},this._onPointerEnter=()=>{this._hovering||null==this._levelsContainer||(this._hovering=!0,this._containerPosTop=this._levelsContainer.getBoundingClientRect().top??0)},this._onPointerLeave=()=>{this._hovering&&(this._normalizedPointerPosition=0,this._hoveredLevel=null,this._hovering=!1)},this._onPointerMove=e=>{if(!this._hovering)return!1;if(window.getSelection()?.removeAllRanges(),null!=this._containerPosTop){const t=this._containerPosTop,s=40,i=this._expandedLevelsMargin;let r=this._levelsHeight,o=t+s+i;const n=this._levelHeight/2;o+=n,r-=n;let l=(e.clientY-o)/r;l+=.035,this._normalizedPointerPosition=l}return!1}}loadDependencies(){return l({action:()=>import("../chunks/calcite-action.js")})}postInitialize(){this.addHandles([d((()=>this._levelsContainer),(()=>this._onContainerChange()),j),d((()=>this._levels),(()=>this._createLevelWidgets()),j),d((()=>this.messages),(()=>{this._labelWidget.messages=this.messages??$}),j)])}destroy(){this._levelWidgets.forEach((e=>e.destroy())),this._labelWidget.destroy()}get _levels(){return this.vm.allowedValues}get _numLevels(){return this._levels.length}get _levelsHeight(){return Math.round(this._levelHeight*this._numLevels)}get _expandedLevelsMargin(){return Math.round(((this._expandedLevelsHeight??0)-this._levelsHeight)/2)}get _levelWidth(){const{levelWidthNominator:e,levelWidthConstant:t}=I,s=e/Math.sqrt(this._numLevels)+t;return Math.round(h(s,30,80))}get _levelHeight(){const e=28/Math.sqrt(this._numLevels);return Math.round(h(e,2,14))}get _gaussianFactor(){const e=this._numLevels;return e/Math.log(30*e)*10}get _levelClosestToPointer(){if(!this._hovering)return null;const e=this._numLevels-1,t=this._normalizedPointerPosition;return e>=0&&null!=t?this._levels[Math.round((1-t)*e)]:null}render(){const e=this._levelWidgets.length,t=e>1?this._levelWidgets.map((e=>e.render())):null,s=this._levelsHeight,i=s+80;return u("div",{class:this.classes(v.widget,M.container,{[M.animateLevel]:!this._hovering,[M.noLevel]:e<2}),key:this,onkeydown:this._onKeyDown},this._renderLabelContainer(),u("div",{afterCreate:e=>this._levelsContainer=e,class:M.levelsContainer,"data-node-ref":"",onfocus:this._onFocus,styles:{height:`${i}px`,marginBlockStart:"-20px",marginBlockEnd:"-20px"}},u("div",{class:M.innerLevelsContainer,styles:{height:`${s}px`,margin:"0",marginBlockStart:20-this._expandedLevelsMargin+"px"}},t)))}_renderLabelContainer(){const{hasPrevious:e,hasNext:t}=this.vm,s=this.messages??$,i=s.previousLevel,r=s.nextLevel;return u("div",{class:M.labelContainer,tabIndex:0},W({className:M.arrowUp,disabled:!t,icon:"chevron-up",onClick:this._onArrowUpClick,text:r}),this._labelWidget.render(),W({className:M.arrowDown,disabled:!e,icon:"chevron-down",onClick:this._onArrowDownClick,text:i}))}_updateComponents(){const e=this.messages??$,t=this.vm.enabled?this.vm.value:null,s=null!=this._hoveredLevel?this._hoveredLevel:t;this._levelWidgets.forEach((s=>{const i=this.vm.getValueLabel(s.level);s.label=null!=i?i:e.currentLevel?.replace("{{level}}",String(s.level)),s.active=s.level===t,s.hovering=s.level===this._hoveredLevel})),this._labelWidget.level=s,this._labelWidget.active=s===t,this._labelWidget.hovering=null!=this._hoveredLevel}_createLevelWidgets(){this._levelWidgets.forEach((e=>e.destroy())),this._levelWidgets=this._levels.map((e=>new R({level:e,onSelect:()=>this._onLevelToggle(e)}))),this.removeHandles(this._levelHandlesKey),this.addHandles([d((()=>{const{vm:e}=this;return[this.messages,e?.value,e?.enabled,this._hoveredLevel,this._hovering]}),(()=>this._updateComponents()),j),d((()=>[this._normalizedPointerPosition,this._hovering]),(()=>this._onPointerPositionChange()),j),d((()=>this._levelWidth),(e=>this._levelWidgets.forEach((t=>t.width=e))),j)],this._levelHandlesKey)}_onContainerChange(){const e=this._levelsContainer;null!=e&&(this.removeHandles(this._levelEventHandlesKey),this.addHandles([c(e,"pointerenter",this._onPointerEnter),c(e,"pointerover",this._onPointerEnter),c(e,"pointerleave",this._onPointerLeave),c(e,"pointerup",this._onPointerUp),c(e,"pointermove",this._onPointerMove)],this._levelEventHandlesKey))}_focusCurrentLevel(){const e=this._levelWidgets.find((e=>e.level===this.vm.value));e?.focus()}_onLevelToggle(e){const{vm:t}=this;t.enabled&&t.value===e?t.clear():t.select(e)}_onPointerPositionChange(){let e=0;this._levelWidgets.forEach(((t,s)=>{const{width:i,height:r}=this._getLevelWidgetSize(s);t.height=r,t.width=i,e+=r})),this._hoveredLevel=this._levelClosestToPointer;const t=this._expandedLevelsHeight;(null==t||Math.abs(t-e)>30)&&(this._expandedLevelsHeight=e)}_getLevelWidgetSize(e){const t={width:this._levelWidth,height:this._levelHeight};if(this._hovering){const s=this._getGaussianFactor(e,this._normalizedPointerPosition);t.width+=20*s,t.height+=30*s}return t}_getGaussianFactor(e,t){const s=this._numLevels-1,i=(s-e)/s,r=this._gaussianFactor*(i-t);return Math.exp(-(r**2))}};function W(e){return u("calcite-action",{appearance:"transparent",class:e.className,disabled:e.disabled,icon:e.icon,key:e.className,onclick:e.onClick,scale:"s",text:e.text,textEnabled:!1,title:e.text})}e([t()],H.prototype,"vm",void 0),e([t()],H.prototype,"messages",void 0),e([t()],H.prototype,"_levelWidgets",void 0),e([t()],H.prototype,"_labelWidget",void 0),e([t()],H.prototype,"_hoveredLevel",void 0),e([t()],H.prototype,"_levels",null),e([t()],H.prototype,"_numLevels",null),e([t({readOnly:!0})],H.prototype,"_levelsHeight",null),e([t()],H.prototype,"_expandedLevelsHeight",void 0),e([t({readOnly:!0})],H.prototype,"_expandedLevelsMargin",null),e([t({readOnly:!0})],H.prototype,"_levelWidth",null),e([t({readOnly:!0})],H.prototype,"_levelHeight",null),e([t({readOnly:!0})],H.prototype,"_gaussianFactor",null),e([t({readOnly:!0})],H.prototype,"_levelClosestToPointer",null),e([t({type:Number,range:{min:0,max:1}})],H.prototype,"_normalizedPointerPosition",void 0),e([t()],H.prototype,"_hovering",void 0),e([t()],H.prototype,"_containerPosTop",void 0),e([t()],H.prototype,"_levelsContainer",void 0),H=e([i("esri.widgets.BuildingExplorer.BuildingLevelPicker.BuildingLevelPicker")],H);const N=H,O="esri-building-phase-picker",z={base:`${O}`,phasesContainer:`${O}__phases-container`,phase:`${O}__phase`,phaseActive:`${O}__phase--active`,phaseCurrent:`${O}__phase--current`,divider:`${O}__divider`,dividerActive:`${O}__divider--active`,arrowLeft:`${O}__arrow-left`,arrowRight:`${O}__arrow-right`},q={nextPhase:"nextPhase",previousPhase:"previousPhase",currentPhase:"{{value}}"};let G=class extends r{constructor(e,t){super(e,t),this._phasesContainer=null,this._shouldScrollCurrentPhaseIntoView=!0,this._shouldFocusCurrentPhase=!1,this._onKeyDown=e=>{const{vm:t}=this;switch(e.key){case"ArrowDown":case"ArrowLeft":e.stopPropagation(),e.preventDefault(),t.previous(),this._shouldFocusCurrentPhase=!0;break;case"ArrowUp":case"ArrowRight":e.stopPropagation(),e.preventDefault(),t.next(),this._shouldFocusCurrentPhase=!0}},this._onArrowLeftClick=()=>{this.vm.previous()},this._onArrowRightClick=()=>{this.vm.next()},this._onPhasesContainerAfterCreate=e=>{this._phasesContainer=e,requestAnimationFrame(this._scrollOrFocusPhase)},this._scrollOrFocusPhase=()=>{const e=this._phasesContainer;if(this.destroyed||null==e)return;const t=e.querySelector(`.${z.phaseCurrent}`);if(t){if(this._shouldScrollCurrentPhaseIntoView){const s=e.offsetWidth,i=t.offsetLeft,r=t.offsetWidth;e.scrollLeft=-s/2+i+r/2,this._shouldScrollCurrentPhaseIntoView=!1}this._shouldFocusCurrentPhase&&(t.focus(),this._shouldFocusCurrentPhase=!1)}}}loadDependencies(){return l({action:()=>import("../chunks/calcite-action.js")})}initialize(){this.addHandles(d((()=>[this._currentPhase,this._phasesContainer,this.container]),(()=>{this._shouldScrollCurrentPhaseIntoView=!0,requestAnimationFrame(this._scrollOrFocusPhase)}),j))}get _phases(){return this.vm.allowedValues}get _currentPhase(){const{vm:e}=this;return e.enabled?e.value:null}render(){if(this._phases.length<2)return u("div",{key:"no-phases"});const{vm:e,messages:t}=this,{previousPhase:s,nextPhase:i}=t??q;return u("div",{class:this.classes(v.widget,z.base),key:this,onkeydown:this._onKeyDown},K({className:z.arrowLeft,disabled:!e.hasPrevious,icon:"chevron-left",onClick:this._onArrowLeftClick,text:s}),u("div",{afterCreate:this._onPhasesContainerAfterCreate,class:z.phasesContainer},this._renderPhaseButtons()),K({className:z.arrowRight,disabled:!e.hasNext,icon:"chevron-right",onClick:this._onArrowRightClick,text:i}))}_renderPhaseButtons(){const e=this._phases,t=this._currentPhase,s=[];for(let i=0;i<e.length;++i){const r=e[i],o={phase:r,active:null!=t&&r<=t,current:null!=t&&r===t};i>0&&s.push(this._renderDivider(o)),s.push(this._renderPhaseButton(o))}return s}_renderPhaseButton({phase:e,active:t,current:s}){const{vm:i}=this,r=i.getValueLabel(e);return u("button",{"aria-label":r,class:this.classes(z.phase,{[z.phaseActive]:t,[z.phaseCurrent]:s}),key:`phase-${e}`,onclick:()=>i.select(e),title:r,type:"button"},e)}_renderDivider({phase:e,active:t}){return u("div",{class:this.classes(z.divider,{[z.dividerActive]:t}),key:`phase-divider-${e}`})}};function K(e){return u("calcite-action",{appearance:"transparent",class:e.className,compact:!0,disabled:e.disabled,icon:e.icon,iconFlipRtl:!0,key:e.className,onclick:e.onClick,scale:"s",text:e.text,textEnabled:!1,title:e.text})}e([t({nonNullable:!0})],G.prototype,"vm",void 0),e([t()],G.prototype,"messages",void 0),e([t()],G.prototype,"_phases",null),e([t()],G.prototype,"_currentPhase",null),e([t()],G.prototype,"_phasesContainer",void 0),G=e([i("esri.widgets.BuildingExplorer.BuildingPhasePicker.BuildingPhasePicker")],G);const Q=G,J={levels:!0,phases:!0,disciplines:!0};let Z=class extends r{constructor(e,t){super(e,t),this._defaultViewModel=new o,this.viewModel=this._defaultViewModel,this.visibleElements={...J},this.headingLevel=3,this.messages=null,this.messagesCommon=null,this.toggleSiblingsVisibility=!1}loadDependencies(){return l({loader:()=>import("../chunks/calcite-loader.js")})}destroy(){this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}_castVisibleElements(e){return{...J,...e}}get icon(){return"organization"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}render(){const e=this.viewModel,t="disabled"===e.state||!e.isSupported;return u("div",{"aria-label":this.messages.widgetLabel,class:m(v.widget,k.base,v.panel,{[v.widgetDisabled]:t}),key:this},this._renderContent())}_renderContent(){const e=this.viewModel,t=this.messages;if(!e.isSupported)return u("p",{class:k.panelError},t.unsupported);if(!e.layers.length)return u("p",{class:k.panelError},t.noData);switch(e.state){case"loading":return this._renderLoadingIndicator();case"ready":return u("div",{class:k.content,key:"content"},this._renderLevelPickerSection(),this._renderPhasePickerSection(),this._renderDisciplinesSection());case"failed":return u("p",{class:k.panelError},t.failed);default:return null}}_renderLoadingIndicator(){const e=this.messagesCommon.loading;return u("div",{"aria-label":e,class:k.loadingContainer,key:"loading-container",role:"presentation",title:e},u("calcite-loader",{label:e,type:"indeterminate"}))}_renderLevelPickerSection(){const e=this.viewModel.level,t="ready"===e.state,s=e.allowedValues.length>1;if(!this.visibleElements.levels||!t||!s)return null;const i=this.messages?.level;return u("div",{class:m(k.section,k.levels),key:"levels"},u(g,{level:this.headingLevel},i?.title),u(N,{messages:i,vm:e}))}_renderPhasePickerSection(){const e=this.viewModel.phase,t="ready"===e.state,s=e.allowedValues.length>1;if(!this.visibleElements.phases||!t||!s)return null;const i=this.messages.phase;return u("div",{class:m(k.section,k.phases),key:"phases"},u(g,{level:this.headingLevel},i.title),u(Q,{messages:i,vm:e}))}_renderDisciplinesSection(){const e=this.viewModel.disciplines,t="ready"===e.state,s=e.root.hasChildren;if(!this.visibleElements.disciplines||!t||!s)return null;const i=this.messages?.disciplines;return u("div",{class:m(k.section,k.disciplines),key:"disciplines"},u(g,{level:this.headingLevel},i.title),u(U,{messages:i,toggleSiblingsVisibility:this.toggleSiblingsVisibility,vm:e}))}};e([t({type:o})],Z.prototype,"viewModel",void 0),e([t()],Z.prototype,"view",null),e([t()],Z.prototype,"layers",null),e([t()],Z.prototype,"visibleElements",void 0),e([s("visibleElements")],Z.prototype,"_castVisibleElements",null),e([t()],Z.prototype,"headingLevel",void 0),e([t()],Z.prototype,"icon",null),e([t()],Z.prototype,"label",null),e([t(),y("esri/widgets/BuildingExplorer/t9n/BuildingExplorer")],Z.prototype,"messages",void 0),e([t(),y("esri/t9n/common")],Z.prototype,"messagesCommon",void 0),e([t({nonNullable:!0})],Z.prototype,"toggleSiblingsVisibility",void 0),e([t()],Z.prototype,"uiStrings",void 0),Z=e([i("esri.widgets.BuildingExplorer")],Z);const X=Z;export{X as default};
