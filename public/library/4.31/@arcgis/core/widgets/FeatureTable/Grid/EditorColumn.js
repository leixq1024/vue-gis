/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as t}from"../../../chunks/tslib.es6.js";import{property as e}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/lang.js";import"../../../chunks/Logger.js";import{subclass as o}from"../../../core/accessorSupport/decorators/subclass.js";import n from"./Column.js";import{a as i}from"../../../chunks/uriUtils.js";import"../../../chunks/ensureType.js";import"../../../chunks/utils.js";import"../../../chunks/handleUtils.js";import"../../../chunks/metadata.js";import"../../../core/Error.js";import"../../../config.js";import"../../../chunks/tracking.js";import"../../../core/Evented.js";import"../../../core/Accessor.js";import"../../../core/Handles.js";import"../../../chunks/maybe.js";import"../../../chunks/ObservableBase.js";import"../../../core/scheduling.js";import"../../../core/promiseUtils.js";import"../../../core/reactiveUtils.js";import"../../../chunks/asyncUtils.js";import"../../../core/Collection.js";import"../../../chunks/shared.js";import"../../../chunks/SimpleObservable.js";import"../../../chunks/columnUtils.js";import"../../../chunks/componentsUtils.js";import"../../../chunks/assets.js";import"../../../request.js";import"../../../kernel.js";import"../../../core/urlUtils.js";import"../../../core/JSONSupport.js";import"../../../chunks/widgetUtils.js";const s="Escape";let r=class extends n{constructor(t){super(t),this.editInfo=null,this.cellValueValidatorFunction=({oldValue:t,value:e})=>t!==e,this.editable=!0,this.headerRenderFunction=t=>{const{root:e}=t,o=this.createHeaderContent();this.tableEditingEnabled&&!this.effectiveEditable&&o.prepend(this._lockIconNode),this.removeCellContent(e),e.appendChild(o)},this.inputRenderFunction=({root:t,column:e,rowData:o})=>{if(this.editInfo||!this.effectiveEditable||!o)return;const n=this.getCellValue(o),i=this.createInputElement({value:n});this._set("editInfo",{column:e,inputs:[i],root:t,rowData:o,oldValue:n});const s=document.createElement("div");s.appendChild(i),this.removeCellContent(t),t.appendChild(s),i.focus(),i instanceof HTMLInputElement&&i.select()},this.loadingMessage="",this.inputType="text",this.maxLength=null,this.onShowPromptCallback=()=>{},this.parseInputValueFunction=({inputs:t})=>t?.length||1!==t.length||Array.isArray(t[0].value)?null:t[0].value,this.renderFunction=t=>{const{root:e,rowData:o}=t,{editInfo:n}=this;if(n)return;const r=this.getCellValue(o),l=this.cellValueFormatFunction({root:e,rowData:o,value:r});let c=null;e.onclick=()=>e.focus(),e.ondblclick=()=>this.inputRenderFunction(t),e.ontouchend=()=>this.inputRenderFunction(t);const a=this.grid?.getSlotElementByName(e.slot),u=a?.parentElement;u&&!u.onkeydown&&(u.onkeydown=e=>{"Enter"!==e.key||this.editInfo||this.inputRenderFunction(t),e.key===s&&this.editInfo&&this.cancel()}),null!=r&&null!=l?e.title=l.toString():e.title&&e.removeAttribute("title"),c=l instanceof HTMLElement?l:i(this.messagesURIUtils,l),this.removeCellContent(e),c instanceof HTMLElement?e.appendChild(c):null!=c&&(e.innerHTML=c.toString())},this.required=!1,this.tableEditingEnabled=!1}get _lockIconNode(){return this.createCalciteIcon({icon:"lock",textLabel:this.messages?.editingPreventedColumn})}get effectiveEditable(){return this.tableEditingEnabled&&this.editable}get effectiveRequired(){return this.required}get editing(){return!!this.editInfo}get shouldShowPrompt(){return!1}cancel(){const{editInfo:t}=this;if(!t)return;const{column:e,root:o,rowData:n}=t;this.onEditComplete(),this.renderFunction({column:e,root:o,rowData:n})}createCalciteOption(t,e,o=!1){const n=document.createElement("calcite-option");return n.label=t,n.value=`${e}`,n.selected=o,n}createCalciteSelect(t,e){const{effectiveRequired:o,messages:n}=this;let i=!1;const s=e.map((({name:e,value:o})=>{const n=o===t;return n&&(i=!0),this.createCalciteOption(e,o,n)}));if(null!=t&&""!==t&&!i){const e=t.toString(),o=this.createCalciteOption(e,e);s.unshift(o)}o||s.unshift(this.createCalciteOption(`<${n?.noValue}>`,""));const r=document.createElement("calcite-select");return s.forEach((t=>r.appendChild(t))),r}createInputElement({value:t}){const{effectiveRequired:e,maxLength:o}=this,n=document.createElement("calcite-input");return null!=o&&(n.maxLength=o),n.required=e,n.value=t,n.addEventListener("calciteInputChange",(()=>this.onInputBlur(n))),n.onkeydown=t=>{t.key===s&&this.onInputBlur(n,!0)},n.onblur=()=>this.onInputBlur(n),n}createDateComponent(){const t=document.createElement("calcite-input-date-picker");return t.focusTrapDisabled=!0,t.overlayPositioning="fixed",t}createTimeComponent(){const t=document.createElement("calcite-input-time-picker");return t.overlayPositioning="fixed",t.placement="auto-start",t.step=1,t}createTimeZoneComponent(){const t=document.createElement("calcite-input-time-zone");return t.maxItems=4,t.overlayPositioning="fixed",t}onEditComplete(){this._set("editInfo",null),this.grid?.generateCellPartNames()}onInputBlur(t,e=!1){t.onblur=null,e?this.cancel():this.submit()}async submit(){const{editInfo:t}=this;if(!t)return void this.cancel();const{inputs:e,rowData:o,oldValue:n}=t,i=this.parseInputValueFunction({inputs:e});if(!this.cellValueValidatorFunction({value:i,oldValue:n}))return void this.cancel();const{root:s}=t,r=o.item.objectId,{fieldName:l}=this;s.textContent=this.loadingMessage,this.shouldShowPrompt?this.onShowPromptCallback({column:this,objectId:r,oldValue:n,value:i}):await this.updateItems({objectId:r,updates:[{fieldName:l,value:i}]})}async updateItems(t){const{store:e}=this;if(e)try{await e.updateItem(t),this.onEditComplete()}catch{this.cancel()}else this.cancel()}};t([e()],r.prototype,"_lockIconNode",null),t([e({readOnly:!0})],r.prototype,"editInfo",void 0),t([e()],r.prototype,"cellValueValidatorFunction",void 0),t([e()],r.prototype,"editable",void 0),t([e()],r.prototype,"effectiveEditable",null),t([e()],r.prototype,"effectiveRequired",null),t([e()],r.prototype,"editing",null),t([e()],r.prototype,"headerRenderFunction",void 0),t([e()],r.prototype,"inputRenderFunction",void 0),t([e({constructOnly:!0})],r.prototype,"loadingMessage",void 0),t([e()],r.prototype,"inputType",void 0),t([e()],r.prototype,"maxLength",void 0),t([e()],r.prototype,"onShowPromptCallback",void 0),t([e()],r.prototype,"parseInputValueFunction",void 0),t([e()],r.prototype,"renderFunction",void 0),t([e()],r.prototype,"required",void 0),t([e()],r.prototype,"shouldShowPrompt",null),t([e()],r.prototype,"tableEditingEnabled",void 0),r=t([o("esri.widgets.FeatureTable.Grid.EditorColumn")],r);const l=r;export{l as default};
