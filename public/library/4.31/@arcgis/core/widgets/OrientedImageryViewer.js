/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../intl.js";import{p as t}from"../chunks/a11yUtils.js";import s,{d as i}from"../core/Accessor.js";import{L as r}from"../chunks/Logger.js";import{d as o}from"../chunks/mathUtils.js";import{watch as a,syncAndInitial as n,initial as l,whenOnce as p,once as m}from"../core/reactiveUtils.js";import{property as c}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import{subclass as u}from"../core/accessorSupport/decorators/subclass.js";import{y as h,z as d,A as j,B as g,C as y,D as v}from"../layers/orientedImagery/transformations/worldToImage.js";import{R as k}from"../layers/ImageryTileLayer.js";import b from"./Widget.js";import w from"./OrientedImageryViewer/OrientedImageryViewerViewModel.js";import{IdentifiableMixin as f}from"../core/Identifiable.js";import I from"./LayerList.js";import"../core/Error.js";import M from"./LayerList/LayerListViewModel.js";import{l as C}from"../chunks/componentsUtils.js";import{g as S}from"../chunks/globalCss.js";import"../chunks/widgetUtils.js";import{t as _}from"../chunks/jsxFactory.js";import{m as T}from"../chunks/messageBundle.js";import{s as L}from"../chunks/substitute.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../config.js";import"../chunks/locale.js";import"../chunks/handleUtils.js";import"../chunks/datetime.js";import"../chunks/number.js";import"../chunks/messages.js";import"../core/promiseUtils.js";import"../chunks/maybe.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/JSONSupport.js";import"../chunks/utils.js";import"../core/Handles.js";import"../chunks/metadata.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../core/scheduling.js";import"../chunks/ensureType.js";import"../chunks/assets.js";import"../chunks/asyncUtils.js";import"../core/Collection.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/vec3f64.js";import"../chunks/vec3.js";import"../chunks/common.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../chunks/writer.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../chunks/reader.js";import"../geometry/Point.js";import"../core/accessorSupport/decorators/cast.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/coordsUtils.js";import"../chunks/Axis.js";import"../chunks/extentUtils.js";import"../chunks/boundsUtils.js";import"../chunks/aaBoundingRect.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../chunks/languageUtils.js";import"../chunks/TimeOnly.js";import"../chunks/UnknownTimeZone.js";import"../chunks/ImmutableArray.js";import"../chunks/shared2.js";import"../layers/support/Field.js";import"../chunks/enumeration.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../chunks/number2.js";import"../rest/support/Query.js";import"../chunks/DataLayerSource.js";import"../chunks/FullTextSearch.js";import"../core/Clonable.js";import"../chunks/spatialRelationships.js";import"../rest/support/StatisticDefinition.js";import"../time/TimeExtent.js";import"../chunks/timeUtils.js";import"../chunks/mat3f64.js";import"../chunks/mat4f64.js";import"../chunks/vec4f64.js";import"../chunks/mat3.js";import"../chunks/mat4.js";import"../geometry/projection.js";import"../chunks/projectBuffer.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../chunks/zscale.js";import"../chunks/vec32.js";import"../chunks/ElevationSourceDefinitions.js";import"../layers/ElevationLayer.js";import"../chunks/MultiOriginJSONSupport.js";import"../geometry/HeightModelInfo.js";import"../layers/Layer.js";import"../core/Loadable.js";import"../core/Promise.js";import"../layers/mixins/ArcGISCachedService.js";import"../layers/support/TileInfo.js";import"../layers/support/LOD.js";import"../chunks/TileKey.js";import"../chunks/TileInfoTilemapCache.js";import"../chunks/TilemapCache.js";import"../chunks/ByteSizeUnit.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/ArcGISService.js";import"../chunks/arcgisLayerUrl.js";import"../chunks/persistableUrlUtils.js";import"../layers/mixins/OperationalLayer.js";import"../chunks/layerContainerType.js";import"../chunks/commonProperties2.js";import"../chunks/ElevationInfo.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../chunks/unitConversionUtils.js";import"../chunks/lengthUtils.js";import"../tables/AttributeTableTemplate.js";import"../tables/elements/AttributeTableGroupElement.js";import"../tables/elements/AttributeTableElement.js";import"../tables/support/elements.js";import"../tables/elements/AttributeTableAttachmentElement.js";import"../tables/elements/AttributeTableFieldElement.js";import"../tables/elements/AttributeTableRelationshipElement.js";import"../chunks/opacityUtils.js";import"../layers/mixins/PortalLayer.js";import"../chunks/layerUtils.js";import"../portal/Portal.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/portalItemUtils.js";import"../chunks/LercDecoder.js";import"../chunks/WorkerHandle.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../chunks/Queue.js";import"../core/workers/RemoteClient.js";import"../layers/ImageryLayer.js";import"../PopupTemplate.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../Color.js";import"../chunks/colorUtils.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/content/UtilityNetworkAssociationsContent.js";import"../popup/support/UtilityNetworkAssociationType.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../layers/mixins/ArcGISImageService.js";import"../Graphic.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils4.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils5.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../rasterRenderers.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../renderers/mixins/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/sizeVariableUtils.js";import"../chunks/visualVariableUtils.js";import"../chunks/compilerUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties.js";import"../symbols/support/jsonUtils.js";import"../chunks/defaults.js";import"../chunks/defaultsJSON.js";import"../chunks/RendererLegendOptions.js";import"../renderers/FlowRenderer.js";import"../renderers/RasterColormapRenderer.js";import"../renderers/support/ColormapInfo.js";import"../chunks/colorRampUtils.js";import"../chunks/colorUtils2.js";import"../chunks/vec4.js";import"../renderers/RasterShadedReliefRenderer.js";import"../renderers/RasterStretchRenderer.js";import"../chunks/stretchRendererUtils.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValue.js";import"../renderers/support/UniqueValueClass.js";import"../renderers/support/UniqueValueGroup.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../renderers/VectorFieldRenderer.js";import"../geometry/support/normalizeUtils.js";import"../chunks/normalizeUtilsCommon.js";import"../chunks/simplify.js";import"../chunks/utils9.js";import"../chunks/utils10.js";import"../chunks/vectorFieldUtils.js";import"../layers/support/PixelBlock.js";import"../chunks/pixelRangeUtils.js";import"../chunks/utils12.js";import"../chunks/jsonUtils.js";import"../chunks/parser.js";import"../chunks/utils2.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/utils7.js";import"../chunks/enums2.js";import"../layers/support/DimensionalDefinition.js";import"../layers/support/RasterFunction.js";import"../layers/support/MosaicRule.js";import"../layers/support/FieldsIndex.js";import"../chunks/imageBitmapUtils.js";import"../layers/support/MultidimensionalSubset.js";import"../layers/support/RasterInfo.js";import"../layers/support/RasterBandInfo.js";import"../layers/support/RasterSensorInfo.js";import"../chunks/RasterJobHandler.js";import"../chunks/multidimensionalUtils.js";import"../chunks/RasterSymbolizer.js";import"../chunks/_commonjsHelpers.js";import"../chunks/stretchUtils.js";import"../chunks/rasterRendererHelper.js";import"../chunks/generateRendererUtils.js";import"../rest/imageService.js";import"../rest/support/FindImagesParameters.js";import"../rest/support/FindImagesResult.js";import"../rest/support/ImageInspectionInfo.js";import"../rest/support/CameraInfoMixin.js";import"../rest/support/ImageAngleParameters.js";import"../rest/support/ImageAngleResult.js";import"../rest/support/ImageAreaParameters.js";import"../rest/support/BaseImageMeasureParameters.js";import"../rest/support/ImageAreaResult.js";import"../rest/support/BaseImageMeasureResult.js";import"../rest/support/ImageBoundaryParameters.js";import"../rest/support/ImageBoundaryResult.js";import"../rest/support/ImageDistanceParameters.js";import"../rest/support/ImageDistanceResult.js";import"../rest/support/ImageGPSInfoParameters.js";import"../rest/support/ImageGPSInfoResult.js";import"../rest/support/CameraInfo.js";import"../rest/support/ImageGPSInfo.js";import"../rest/support/ImageHeightParameters.js";import"../rest/support/ImageHeightResult.js";import"../rest/support/ImageHistogramParameters.js";import"../rest/support/ImageIdentifyParameters.js";import"../rest/support/ImageIdentifyResult.js";import"../rest/support/FeatureSet.js";import"../rest/support/ImagePixelLocationParameters.js";import"../rest/support/ImagePixelLocationResult.js";import"../rest/support/ImagePointParameters.js";import"../rest/support/ImagePointResult.js";import"../rest/support/ImageSampleParameters.js";import"../rest/support/ImageSampleResult.js";import"../rest/support/ImageSample.js";import"../rest/support/ImageToMapMultirayParameters.js";import"../rest/support/ImageToMapParameters.js";import"../rest/support/ImageUrlParameters.js";import"../rest/support/ImageUrlResult.js";import"../rest/support/MapToImageParameters.js";import"../rest/support/MeasureAreaFromImageResult.js";import"../rest/support/MeasureFromImageParameters.js";import"../rest/support/MeasureLengthFromImageResult.js";import"../chunks/fetchRasterInfo.js";import"../chunks/executeForIds.js";import"../chunks/query.js";import"../chunks/pbfQueryUtils.js";import"../chunks/pbf.js";import"../chunks/OptimizedGeometry.js";import"../chunks/OptimizedFeature.js";import"../chunks/OptimizedFeatureSet.js";import"../chunks/queryZScale.js";import"../chunks/executeQueryJSON.js";import"../chunks/dataUtils.js";import"../layers/mixins/BlendLayer.js";import"../layers/mixins/CustomParametersMixin.js";import"../layers/mixins/RasterPresetRendererMixin.js";import"../renderers/support/RasterPresetRenderer.js";import"../layers/mixins/RefreshableLayer.js";import"../layers/mixins/ScaleRangeLayer.js";import"../layers/mixins/TemporalLayer.js";import"../layers/support/TimeInfo.js";import"../time/TimeInterval.js";import"../chunks/versionUtils.js";import"../support/popupUtils.js";import"../chunks/interfaces2.js";import"../layers/support/ElevationSampler.js";import"../chunks/ElevationTile.js";import"../chunks/ElevationSamplerData.js";import"../chunks/requestPresets.js";import"../layers/mixins/ImageryTileMixin.js";import"../chunks/RawBlockCache.js";import"../chunks/rasterProjectionHelper.js";import"../chunks/QueueProcessor.js";import"../chunks/ReactiveMap.js";import"../core/signal.js";import"../chunks/rasterFunctionHelper.js";import"../layers/support/rasterFunctionConstants.js";import"../chunks/focalStatUtils.js";import"../chunks/xmlUtilities.js";import"../chunks/GCSShiftTransform.js";import"../chunks/domUtils.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/UpdatingHandles.js";import"../geometry/geometryEngineAsync.js";import"../layers/GraphicsLayer.js";import"../chunks/GraphicsCollection.js";import"../layers/OrientedImageryLayer.js";import"../layers/FeatureLayer.js";import"../renderers/DictionaryRenderer.js";import"../chunks/Version2.js";import"../chunks/OverrideHelper.js";import"../chunks/quantizationUtils.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../chunks/heatmapUtils.js";import"../renderers/PieChartRenderer.js";import"../renderers/SimpleRenderer.js";import"../renderers/support/jsonUtils.js";import"../form/FormTemplate.js";import"../form/ExpressionInfo.js";import"../form/elements/GroupElement.js";import"../form/elements/Element.js";import"../form/support/elements.js";import"../form/elements/AttachmentElement.js";import"../form/elements/inputs/attachments/AttachmentInput.js";import"../chunks/Input.js";import"../form/elements/inputs/attachments/support/inputs.js";import"../form/elements/inputs/attachments/AudioInput.js";import"../chunks/utils8.js";import"../form/elements/inputs/attachments/DocumentInput.js";import"../form/elements/inputs/attachments/ImageInput.js";import"../form/elements/inputs/attachments/SignatureInput.js";import"../form/elements/inputs/attachments/VideoInput.js";import"../form/elements/FieldElement.js";import"../form/elements/support/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DatePickerInput.js";import"../form/elements/inputs/DateTimeOffsetPickerInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../form/elements/inputs/TimePickerInput.js";import"../form/elements/RelationshipElement.js";import"../form/elements/TextElement.js";import"../chunks/formUtils.js";import"../chunks/editsZScale.js";import"../layers/mixins/APIKeyMixin.js";import"../chunks/EditBusLayer.js";import"../layers/mixins/FeatureEffectLayer.js";import"../layers/support/FeatureEffect.js";import"../layers/support/FeatureFilter.js";import"../layers/mixins/FeatureLayerBase.js";import"../chunks/featureLayerUtils.js";import"../chunks/featureQueryAll.js";import"../rest/support/AttachmentQuery.js";import"../rest/support/RelationshipQuery.js";import"../layers/support/GeometryFieldsInfo.js";import"../layers/support/LayerFloorInfo.js";import"../layers/support/Relationship.js";import"../chunks/serviceCapabilitiesUtils.js";import"../layers/support/Subtype.js";import"../layers/mixins/FeatureReductionLayer.js";import"../layers/support/AggregateField.js";import"../layers/support/ExpressionInfo.js";import"../chunks/FeatureReduction.js";import"../layers/support/FeatureReductionBinning.js";import"../layers/support/LabelClass.js";import"../chunks/labelUtils.js";import"../layers/support/FeatureReductionCluster.js";import"../layers/support/FeatureReductionSelection.js";import"../chunks/clusterUtils.js";import"../chunks/MD5.js";import"../layers/mixins/OrderedLayer.js";import"../chunks/OrderByInfo.js";import"../layers/mixins/PublishableLayer.js";import"../layers/support/PublishingInfo.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"../chunks/fieldProperties.js";import"../chunks/labelingInfo.js";import"../chunks/styleUtils2.js";import"../chunks/AlphaCutoff.js";import"../geometry/Circle.js";import"../geometry/support/geodesicUtils.js";import"../geometry/Mesh.js";import"../chunks/axisAngleDegrees.js";import"../chunks/quat.js";import"../chunks/quatf64.js";import"../geometry/support/MeshComponent.js";import"../geometry/support/MeshMaterial.js";import"../geometry/support/MeshTexture.js";import"../chunks/imageUtils.js";import"../geometry/support/MeshTextureTransform.js";import"../geometry/support/MeshMaterialMetallicRoughness.js";import"../chunks/meshProperties.js";import"../geometry/support/MeshGeoreferencedVertexSpace.js";import"../geometry/support/MeshLocalVertexSpace.js";import"../geometry/support/MeshTransform.js";import"../chunks/MeshVertexAttributes.js";import"../chunks/meshVertexSpaceUtils.js";import"../chunks/triangulationUtils.js";import"../chunks/earcut.js";import"../chunks/Indices.js";import"../chunks/plane.js";import"../chunks/vec2f64.js";import"../chunks/mathUtils2.js";import"../chunks/deduplicate.js";import"../chunks/projectPointToVector.js";import"../chunks/vertexSpaceConversion.js";import"../chunks/spatialReferenceEllipsoidUtils.js";import"../chunks/computeTranslationToOriginAndRotation.js";import"../chunks/BufferView.js";import"../chunks/vec2.js";import"../chunks/vec42.js";import"../chunks/External.js";import"../chunks/infoFor3D.js";import"../layers/orientedImagery/transformations/imageToWorld.js";import"../chunks/ray.js";import"../chunks/sphere.js";import"../chunks/deepClone.js";import"../chunks/floorFilterUtils.js";import"../chunks/drawUtils.js";import"../chunks/InputManager.js";import"../Camera.js";import"../CameraLayout.js";import"../chunks/Cyclical.js";import"../views/SceneView.js";import"../Viewpoint.js";import"../chunks/projectBoundingRect.js";import"../chunks/boundedPlane.js";import"../chunks/lineSegment.js";import"../chunks/RenderCoordsHelper.js";import"../chunks/projectVectorToPoint.js";import"../chunks/projectVectorToVector.js";import"../chunks/dehydratedPoint.js";import"../chunks/dehydratedFeatureUtils.js";import"../chunks/ViewingMode.js";import"../chunks/scaleUtils.js";import"../views/View.js";import"../Map.js";import"../Basemap.js";import"../chunks/loadAll.js";import"../support/BasemapStyle.js";import"../chunks/writeUtils.js";import"../Ground.js";import"../chunks/CollectionFlattener.js";import"../chunks/editableLayers.js";import"../layers/catalog/catalogUtils.js";import"../chunks/basemapUtils.js";import"../chunks/collectionUtils2.js";import"../support/LayersMixin.js";import"../support/TablesMixin.js";import"../views/BasemapView.js";import"../views/Magnifier.js";import"../chunks/selectionUtils.js";import"../views/Theme.js";import"../chunks/ViewEvents.js";import"../chunks/IViewEvents.js";import"../chunks/interfaces.js";import"../chunks/screenUtils2.js";import"../views/input/Input.js";import"../views/input/gamepad/GamepadSettings.js";import"../views/input/gamepad/GamepadInputDevice.js";import"../views/navigation/Navigation.js";import"../views/navigation/gamepad/GamepadSettings.js";import"../chunks/heightModelInfoUtils.js";import"../chunks/projectionUtils.js";import"../views/BreakpointsOwner.js";import"../views/DOMContainer.js";import"../views/GroundView.js";import"../chunks/cameraUtils.js";import"../chunks/Intersector3.js";import"../chunks/intersectorUtils.js";import"../chunks/verticalOffsetUtils.js";import"../chunks/orientedBoundingBox.js";import"../chunks/Attribute.js";import"../chunks/frustum.js";import"../chunks/earthUtils.js";import"../chunks/ElevationProvider.js";import"../chunks/spatialReferenceSupport.js";import"../chunks/TerrainConst.js";import"../views/PopupView.js";import"../views/ViewAnimation.js";import"../chunks/RenderGeometry.js";import"../chunks/GridLocalOriginFactory.js";import"../chunks/Material.js";import"../chunks/interfaces3.js";import"../chunks/VertexAttribute.js";import"../chunks/StencilUtils.js";import"../chunks/Util.js";import"../chunks/triangle.js";import"../chunks/basicInterfaces.js";import"../chunks/Matrix4PassUniform.js";import"../chunks/BindType.js";import"../chunks/ShaderTechniqueConfiguration.js";import"../chunks/debugFlags2.js";import"../chunks/requestImageUtils.js";import"../chunks/enums.js";import"../chunks/Texture.js";import"../chunks/GLObjectType.js";import"../chunks/renderState.js";import"../chunks/RibbonLineMaterial.js";import"../chunks/sdfPrimitives.js";import"../chunks/doublePrecisionUtils.js";import"../chunks/floatRGBA.js";import"../chunks/Octree.js";import"../chunks/InterleavedLayout.js";import"../chunks/types.js";import"../chunks/RgbaFloatEncoding.glsl.js";import"../chunks/SceneLighting.js";import"../chunks/NormalAttribute.glsl.js";import"../chunks/VertexPosition.glsl.js";import"../chunks/Matrix3DrawUniform.js";import"../views/3d/webgl/RenderCamera.js";import"../chunks/weather.js";import"../views/3d/environment/CloudyWeather.js";import"../views/3d/environment/FoggyWeather.js";import"../views/3d/environment/RainyWeather.js";import"../views/3d/environment/SnowyWeather.js";import"../views/3d/environment/SunnyWeather.js";import"../chunks/ScreenSpacePass.glsl.js";import"../chunks/Float4DrawUniform.js";import"../chunks/MergedRenderer.js";import"../chunks/NestedMap.js";import"../chunks/glUtil.js";import"../chunks/VertexElementDescriptor.js";import"../views/3d/webgl.js";import"../views/3d/webgl/RenderNode.js";import"../chunks/HighlightDefaults.js";import"../chunks/VertexArrayObject2.js";import"../chunks/VertexArrayObject.js";import"../chunks/BufferObject.js";import"../chunks/HUDRenderStyle.js";import"../chunks/Intersector.js";import"../chunks/Scheduler.js";import"../chunks/debugFlags.js";import"../chunks/vec3f32.js";import"../chunks/Program.js";import"../chunks/ShadowCastVisualizeTechniqueConfiguration.js";import"../views/3d/environment/SunLighting.js";import"../webscene/SunLighting.js";import"../views/3d/environment/VirtualLighting.js";import"../webscene/VirtualLighting.js";import"../webscene/Environment.js";import"../chunks/lightingTypes.js";import"../webscene/background/Background.js";import"../webscene/background/ColorBackground.js";import"../chunks/ElevationUpdateEvent.js";import"../chunks/ElevationContext.js";import"../chunks/hydratedFeatures.js";import"../chunks/graphicUtils.js";import"../chunks/vec2f32.js";import"../chunks/RayIntersections.js";import"../chunks/HUDVisibility.glsl.js";import"../chunks/VerticalOffset.glsl.js";import"../chunks/dehydratedFeatures.js";import"../chunks/featureConversionUtils.js";import"../chunks/edgeUtils.js";import"../chunks/DecodeSymbolColor.glsl.js";import"../chunks/GeometryUtil.js";import"../chunks/LodResources.js";import"../chunks/DefaultMaterial.js";import"../chunks/GLTextureMaterial.js";import"../chunks/VertexColor.glsl.js";import"../chunks/Matrix4sPassUniform.js";import"../chunks/CameraSpace.glsl.js";import"../chunks/WebGLRequirements.js";import"../chunks/capabilities2.js";import"../chunks/ray2.js";import"../chunks/viewpointUtils2.js";import"../chunks/NormalFromDepth.glsl.js";import"../views/ui/UI.js";import"../chunks/themeUtils.js";import"../chunks/unitFormatUtils.js";import"../chunks/quantityUtils.js";import"../chunks/ZoomMomentumEstimator.js";import"../chunks/HUDMaterial.js";import"../chunks/labelFormatUtils.js";import"../chunks/NormalUtils.glsl.js";import"../chunks/fontUtils.js";import"../chunks/LodRenderer.js";import"../chunks/Intersector2.js";import"../chunks/FeaturePipelineRenderManager.js";import"../chunks/elevationInfoUtils.js";import"../chunks/hitTest.js";import"../chunks/LayerConstants.js";import"../chunks/intersectorUtilsConversions.js";import"../chunks/ElevationRange.js";import"../chunks/HighlightOptions.js";import"../chunks/hitTestSelectUtils.js";import"../chunks/terrainUtils.js";import"../views/3d/support/SceneViewPerformanceInfo.js";import"../chunks/LayerViewPerformanceInfo.js";import"../views/3d/support/LayerPerformanceInfo.js";import"../chunks/vec33.js";import"../chunks/wosrLoader.js";import"../chunks/ElevationQueryTileCache.js";import"../chunks/Normals.js";import"../chunks/TileStrategy.js";import"../chunks/TileKey2.js";import"../chunks/mat3f32.js";import"../chunks/RenderableTile.js";import"../chunks/config.js";import"../chunks/StyleDefinition.js";import"../chunks/enums3.js";import"../chunks/GeometryUtils.js";import"../chunks/TiledDisplayObject.js";import"../chunks/DisplayObject.js";import"../chunks/resources.js";import"../chunks/ShaderTechniqueRepository.js";import"../chunks/Blit.js";import"../views/3d/webgl/ManagedFBO.js";import"../chunks/testSVGPremultipliedAlpha.js";import"../chunks/RenderingContext.js";import"../chunks/ProgramCache.js";import"../chunks/screenshotUtils.js";import"../chunks/layerViewUtils.js";import"../views/ui/DefaultUI.js";import"./Attribution.js";import"./Attribution/AttributionViewModel.js";import"../chunks/accessibleHandler.js";import"./Compass.js";import"./Compass/CompassViewModel.js";import"../chunks/duration.js";import"../chunks/utils22.js";import"./support/GoTo.js";import"./NavigationToggle.js";import"./NavigationToggle/NavigationToggleViewModel.js";import"./Zoom.js";import"./Zoom/ZoomViewModel.js";import"../chunks/vmEvent.js";import"../views/MapView.js";import"../views/View2D.js";import"../chunks/ViewStateManager.js";import"../chunks/viewpointUtils.js";import"../chunks/mat2d.js";import"../chunks/mat2df64.js";import"../views/2d/ViewState.js";import"../chunks/mat2df32.js";import"../chunks/unitBezier.js";import"../chunks/rbush.js";import"../chunks/quickselect.js";import"../chunks/Tile.js";import"../chunks/util2.js";import"../chunks/definitions.js";import"../chunks/featureTechniqueUtils.js";import"../chunks/clippingUtils.js";import"../chunks/highlightGroupUtils.js";import"../chunks/Timeline.js";import"../chunks/utils6.js";import"../chunks/Version.js";import"../webmap/background/ColorBackground.js";import"../geometry/geometryEngine.js";import"../chunks/geometryEngineBase.js";import"../chunks/hydrated.js";import"../chunks/LayerListItem.js";import"../chunks/actionUtils.js";import"../chunks/layerListUtils.js";import"./LayerList/ListItem.js";import"../chunks/ActionSlider.js";import"./LayerList/ListItemPanel.js";import"./support/widget.js";import"../chunks/listUtils.js";import"../chunks/utils21.js";function O(e,t,s,i){return[[[s-e/Math.SQRT2,i-e/Math.SQRT2],[s+e/Math.SQRT2,i-e/Math.SQRT2],[s+t/Math.SQRT2,i-t/Math.SQRT2],[s-t/Math.SQRT2,i-t/Math.SQRT2]],[[s+e/Math.SQRT2,i-e/Math.SQRT2],[s+e/Math.SQRT2,i+e/Math.SQRT2],[s+t/Math.SQRT2,i+t/Math.SQRT2],[s+t/Math.SQRT2,i-t/Math.SQRT2]],[[s+e/Math.SQRT2,i+e/Math.SQRT2],[s-e/Math.SQRT2,i+e/Math.SQRT2],[s-t/Math.SQRT2,i+t/Math.SQRT2],[s+t/Math.SQRT2,i+t/Math.SQRT2]],[[s-e/Math.SQRT2,i+e/Math.SQRT2],[s-e/Math.SQRT2,i-e/Math.SQRT2],[s-t/Math.SQRT2,i-t/Math.SQRT2],[s-t/Math.SQRT2,i+t/Math.SQRT2]]]}function R(e,t,s){const[i,r,o,a]=e;return`M ${i.join(" ")} A ${t} ${t} 0 0 1 ${r.join(" ")} L ${o.join(" ")} A ${s} ${s} 0 0 0 ${a.join(" ")} Z`}const A="esri-oriented-imagery-viewer",P=`${A}__carousel`,U=`${A}__image-enhancement`,x=`${A}__navigation`,E=`${A}__image-overlays`,V={alert:`${A}__alert`,addCoverage:`${A}__body-additional-coverage`,addExpPoints:`${A}__body-additional-camera-locations`,body:`${A}__body`,carousel:`${A}__carousel`,carouselContainer:`${P}-container`,carouselContent:`${P}-content`,carouselItem:`${P}-item`,carouselItemWrapper:`${P}-item-wrapper`,close:`${A}__close`,currentCoverage:`${A}__body-current-coverage`,feature:`${x}-feature`,footprint:`${A}__body-footprint`,imageEnhancementToolContainer:`${U}-tool-container`,imageEnhancementTools:`${U}-tools`,imageEnhancementWrapper:`${U}-wrapper`,imageOverlays:E,imageOverlaysContainer:`${E}-container`,imageOverlaysNoResult:`${E}-no-result`,imageOverlaysIncreasedHeight:`${E}-increased-height`,imageOverlaysLayerList:`${E}-layer-list`,messageBox:`${A}__message-box`,navigationPathOffset0:`${x}-feature-path-stop-offset-0`,navigationPathOffset1:`${x}-feature-path-stop-offset-1`,navigationWrapper:`${x}-wrapper`,navigationZoomed:`${x}-wrapper--zoomed`,north:`${x}-pointer-north`,outerSector:`${x}-sector-outer`,overlaysSwitch:`${E}-switch`,pointer:`${x}-pointer`,rotateWithAnimation:`${x}-animate`,sector:`${x}-sector`,sectorCross:`${x}-sector-cross`,sectorDisabled:`${x}-sector-disabled`,sectorEnabled:`${x}-sector-enabled`,sectorSeparator:`${x}-sector-separator`,selectedFeaturePath:`${x}-feature-path`,submenu:`${A}__submenu`,viewer:`${A}__viewer`,viewerHidden:`${A}__viewer--hidden`,viewerContainer:`${A}__viewer-container`};let F=class extends s{constructor(){super(...arguments),this.closeButton=!0,this.coverageMenu=!0,this.imageEnhancement=!0,this.imageGallery=!0,this.imageOverlays=!0,this.mapImageConversionTool=!0,this.navigationTool=!0,this.title=!0,this.viewerTools=!0,this.showPopupsAction=!0}};e([c({type:Boolean,nonNullable:!0})],F.prototype,"closeButton",void 0),e([c({type:Boolean,nonNullable:!0})],F.prototype,"coverageMenu",void 0),e([c({type:Boolean,nonNullable:!0})],F.prototype,"imageEnhancement",void 0),e([c({type:Boolean,nonNullable:!0})],F.prototype,"imageGallery",void 0),e([c({type:Boolean,nonNullable:!0})],F.prototype,"imageOverlays",void 0),e([c({type:Boolean,nonNullable:!0})],F.prototype,"mapImageConversionTool",void 0),e([c({type:Boolean,nonNullable:!0})],F.prototype,"navigationTool",void 0),e([c({type:Boolean,nonNullable:!0})],F.prototype,"title",void 0),e([c({type:Boolean,nonNullable:!0})],F.prototype,"viewerTools",void 0),e([c({type:Boolean,nonNullable:!0})],F.prototype,"showPopupsAction",void 0),F=e([u("esri.widgets.OrientedImageryViewer.OrientedImageryViewerVisibleElements")],F);const B=F;let $=class extends M{_compileList(){const e=this.view?.map?.allLayers;if(!e)return;const t=e.filter(h);this._watchLayersListMode(t);const s=this._getViewableLayers(t);s?.length?(this._createNewItems(s),this._removeItems(s),this._sortItems(s)):this._removeAllItems()}};$=e([u("esri.widgets.OrientedImageryViewer.components.OverlayLayersListViewModel")],$);const D=$;let G=class extends I{constructor(){super(...arguments),this.viewModel=new D,this.selectionMode="multiple",this.visibilityAppearance=void 0}};e([c()],G.prototype,"viewModel",void 0),e([c()],G.prototype,"selectionMode",void 0),e([c()],G.prototype,"visibilityAppearance",void 0),G=e([u("esri.widgets.OrientedImageryViewer.components.OverlayLayersList")],G);const H=G;let N=class extends(f(b)){constructor(){super(...arguments),this.closed=!1,this.layerList=new H({selectionMode:"multiple"}),this.messages=null,this.showCameraLocations=!1,this.showMapFeatures=!1,this.viewModel=null}initialize(){a((()=>[this.view,this.layerList]),(([e,t])=>{t.view=e}),n)}loadDependencies(){return C({list:()=>import("../chunks/calcite-list.js"),"list-item":()=>import("../chunks/calcite-list-item.js"),panel:()=>import("../chunks/calcite-panel.js"),switch:()=>import("../chunks/calcite-switch.js")})}get view(){return this.viewModel?.view??null}_onCalcitePanelClose(e){e.stopPropagation(),this.closed=!0}_renderCameraLocationsSwitch(e){return _("calcite-list-item",{bind:this,label:this.messages?.overlayCameraLocations,onclick:this._toggleShowCameraLocations},_("calcite-switch",{bind:this,checked:e,class:V.overlaysSwitch,onchange:this._toggleShowCameraLocations,scale:"s",slot:"actions-end"}))}_renderOverlayMapFeatures(e){return _("calcite-list-item",{bind:this,label:this.messages?.overlayMapFeatures,onclick:this._toggleShowMapFeatures},_("calcite-switch",{bind:this,checked:e,class:V.overlaysSwitch,onchange:this._toggleShowMapFeatures,scale:"s",slot:"actions-end"}))}_renderList(e){return e?_("div",{class:V.imageOverlaysLayerList},this.layerList.render()):null}_renderPanel(){const{closed:e,showCameraLocations:t,showMapFeatures:s}=this;return _("calcite-panel",{bind:this,closable:!0,closed:e,heading:this.messages?.imageOverlays,onCalcitePanelClose:this._onCalcitePanelClose},_("calcite-list",null,this._renderCameraLocationsSwitch(t),this._renderOverlayMapFeatures(s)),this._renderList(s))}_toggleShowCameraLocations(e){e.stopPropagation(),this.showCameraLocations=!this.showCameraLocations}_toggleShowMapFeatures(e){e.stopPropagation(),this.showMapFeatures=!this.showMapFeatures}render(){const e=this.layerList.operationalItems.items.length,t=this.showMapFeatures&&0===e,s=this.showMapFeatures&&e>0,i={[S.widget]:!0,[V.imageOverlaysNoResult]:t,[V.imageOverlaysIncreasedHeight]:s,[V.imageOverlays]:!t&&!s};return _("div",{class:this.classes(i)},this._renderPanel())}};e([c()],N.prototype,"closed",void 0),e([c()],N.prototype,"layerList",void 0),e([c()],N.prototype,"messages",void 0),e([c()],N.prototype,"showCameraLocations",void 0),e([c()],N.prototype,"showMapFeatures",void 0),e([c()],N.prototype,"view",null),e([c()],N.prototype,"viewModel",void 0),N=e([u("esri.widgets.OrientedImageryViewer.components.ImageOverlays")],N);const Q=N,W="overlayed";let z=class extends b{constructor(e,t){super(e,t),this.galleryOpened=!1,this.imageEnhancementToolActive=!1,this.imageOverlaysOpened=!1,this.navigationToolActive=!1,this.viewModel=new w,this.messagesCommon=null,this.visibleElements=new B,this._navigationToolExpanded=!1,this._navigationTool=null,this._imageOverlays=new Q,this._warningTitleElement=null,this._actionItems=new Map,this._galleryController=new AbortController,this._galleryObserver=new IntersectionObserver(this._lazyLoadImage.bind(this)),this._createAndAddOverlayLayerVisibilityHandle=e=>{this.addHandles(a((()=>e.visible),(()=>{this.viewModel.toggleOverlayMapFeatures(e.id,e.visible)})),`${W}-${e.id}`)},this._createHandlesForOverlayMapFeatures=()=>{this.viewModel.removeAllOverlayMapFeatures();const{selectedItems:e}=this._imageOverlays.layerList;e.forEach(this._handleOverlayLayerSelect)},this._createOverlayLayersListChangeHandle=()=>{this.addHandles(this._imageOverlays.layerList.selectedItems.on("change",(({added:e,removed:t})=>{e.forEach(this._handleOverlayLayerSelect),t.forEach(this._handleOverlayLayerDeselect)})))},this._handleOverlayLayerDeselect=e=>{const t=e.layer;this.viewModel.removeOverlayedGraphicsOnImage(`${t.id}`),this.removeHandles(`${W}-${t.id}`)},this._handleOverlayLayerSelect=e=>{const t=e.layer;this.viewModel.overlayMapFeatures(t,this._imageOverlays.showMapFeatures),this._createAndAddOverlayLayerVisibilityHandle(t)},this._highlight=e=>{const t=e.target?.dataset.objectid;t&&this.viewModel.highlight(t)},this._removeHighlight=()=>this.viewModel.removeHighlight(),this._scaleNavigationTool=()=>{this._navigationToolExpanded=!this._navigationToolExpanded},this._toggleImageAttributes=()=>{this.viewModel.toggleImageAttributes()},this._loadImageFromGallery=this._loadImageFromGallery.bind(this),this._registerGalleryItem=this._registerGalleryItem.bind(this),this._unregisterGalleryItem=this._unregisterGalleryItem.bind(this),this._renderViewerContainer=this._renderViewerContainer.bind(this),this.loadImageFromSource=this.loadImageFromSource.bind(this),this.updateSuitabilities=this.updateSuitabilities.bind(this)}initialize(){this._createOverlayLayersListChangeHandle(),this.addHandles([a((()=>[this.viewModel?.bestFeatureAngle,this._navigationTool]),(([e,t])=>{t&&this._updateNavigationTool(t)}),l),a((()=>this.currentCoverageVisible),(e=>this._onCurrentCoverageVisibilityChange(e))),a((()=>this.isAdditionalCoverageVisible),(e=>this._onAdditionalCoverageVisibilityChange(e))),a((()=>this.isAdditionalPointSourcesVisible),(e=>this._onAdditionalCameraLocationsVisibility(e))),a((()=>this.viewModel),(()=>this._imageOverlays.viewModel=this.viewModel),n),a((()=>this.messages),(()=>this._imageOverlays.messages=this.messages),n),a((()=>[this.currentBestFeature,this._imageOverlays.showCameraLocations,this.viewModel.state]),(([e,t,s])=>{"image-loaded"===s&&this.viewModel.overlayCameraLocations(t)}),n),a((()=>[this.currentBestFeature,this._imageOverlays.showMapFeatures,this.viewModel.state]),((e,t)=>{t?.[1]!==e[1]&&this.viewModel.toggleAllOverlayMapFeatures(e[1]),e[0]&&e[0]!==t?.[0]&&p((()=>"image-loaded"===this.viewModel.state)).then(this._createHandlesForOverlayMapFeatures)}),l)])}loadDependencies(){return C({"action-bar":()=>import("../chunks/calcite-action-bar.js"),"action-group":()=>import("../chunks/calcite-action-group.js"),action:()=>import("../chunks/calcite-action.js"),label:()=>import("../chunks/calcite-label.js"),notice:()=>import("../chunks/calcite-notice.js"),panel:()=>import("../chunks/calcite-panel.js"),slider:()=>import("../chunks/calcite-slider.js"),tooltip:()=>import("../chunks/calcite-tooltip.js")})}destroy(){this._galleryController.abort(),this._galleryObserver.disconnect()}get activeLayer(){return i(r.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer}set activeLayer(e){i(r.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer=e}get currentBestFeature(){return this.viewModel.currentBestFeature}set currentBestFeature(e){this.viewModel.currentBestFeature=e}get currentCoverageVisible(){return this.viewModel.currentCoverageVisible}set currentCoverageVisible(e){this.viewModel.currentCoverageVisible=e}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get displayMessage(){return this.viewModel.displayMessage}get features(){return this.viewModel.features}get imagePointsInView(){return this.viewModel.imagePointsInView}get icon(){return"oriented-imagery-widget"}set icon(e){this._overrideIfSome("icon",e)}get imageGalleryEnabled(){return this.viewModel.imageGalleryEnabled}get invalidCameraHeading(){return this.viewModel.invalidCameraHeading}get isAdditionalCoverageVisible(){return this.viewModel.isAdditionalCoverageVisible}set isAdditionalCoverageVisible(e){this.viewModel.isAdditionalCoverageVisible=e}get isAdditionalPointSourcesVisible(){return this.viewModel.isAdditionalPointSourcesVisible}set isAdditionalPointSourcesVisible(e){this.viewModel.isAdditionalPointSourcesVisible=e}get mapImageConversionToolState(){return this.viewModel.mapImageConversionToolState}set mapImageConversionToolState(e){this.viewModel.mapImageConversionToolState=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get popupEnabled(){const{popupEnabled:e,state:t}=this.viewModel;return"image-loaded"===t&&e}get referencePoint(){return this.viewModel.referencePoint??null}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set determineWorkflowForFeature(e){this.viewModel.determineWorkflowForFeature=e}get determineWorkflowForFeature(){return this.viewModel.determineWorkflowForFeature}set updateFootprint(e){this.viewModel.updateFootprint=e}get updateFootprint(){return this.viewModel.updateFootprint}async _getThumbnailPixelBlockInternal(e,t){const{level:s,offset:i,size:o}=this._getMaxLevelRasterParameters(e);try{const{pixelBlock:r}=await e.fetchRawPixels(s,i,o,t);return r}catch(e){r.getLogger(this).warn("failed to create canvas with pixel data",e)}return null}_getMaxLevelRasterParameters(e){const{storageInfo:t,width:s,height:i}=e.rasterInfo,{maximumPyramidLevel:r,pyramidScalingFactor:o}=t,a=o??2;return{level:r,offset:{x:0,y:0},size:{width:Math.ceil(s/a**r),height:Math.ceil(i/a**r)}}}async _getThumbnailPixelBlock(e){const{signal:t}=this._galleryController;try{const{origin:s,pathname:i,searchParams:r}=new URL(e),o=await k.open({ioConfig:{customFetchParameters:Object.fromEntries(r),skipMapInfo:!0},url:`${s}${i}`,signal:t});return o?await this._getThumbnailPixelBlockInternal(o,{signal:t}):null}catch(e){r.getLogger(this).error("failed to create thumbnail",e)}return null}_handleBrightnessChange(e){this.viewModel.brightness=e.target.value??0}_handleContrastChange(e){this.viewModel.contrast=e.target.value??0}_handleSharpnessChange(e){this.viewModel.sharpness=e.target.value??0}_lazyLoadImage(e,t){e.forEach((async e=>{if(e.isIntersecting){const s=e.target,i=s.getAttribute("data-src"),a=s.getAttribute("data-rotation"),n=a?parseFloat(a)%360:null;if(!i)return;const l=await this._getThumbnailPixelBlock(i);if(!l)return;s.width=l.width,s.height=l.height;const p=s.getContext("2d");if(!p)return;const m=p.createImageData(s.width,s.height);if(m.data.set(l.getAsRGBA()),"number"==typeof n&&0!==n){const e=o(n),i=document.createElement("canvas"),a=i.getContext("2d");if(a){i.width=m.width,i.height=m.height,a.putImageData(m,0,0);const r=d(0,0,e),o=d(m.width,0,e),n=d(m.width,m.height,e),l=d(0,m.height,e),c=Math.max(r[0],o[0],n[0],l[0])-Math.min(r[0],o[0],n[0],l[0]),u=Math.max(r[1],o[1],n[1],l[1])-Math.min(r[1],o[1],n[1],l[1]),h=Math.min(s.width/c,s.height/u);return p.save(),p.clearRect(0,0,s.width,s.height),p.translate(s.width/2,s.height/2),p.rotate(e),p.scale(h,h),p.drawImage(i,-m.width/2,-m.height/2,m.width,m.height),p.restore(),t.unobserve(s)}r.getLogger(this).warn("oriented-imagery-viewer:image-gallery","failed to apply rotation on thumbnail")}p.putImageData(m,0,0),t.unobserve(s)}}))}_loadImageFromGallery(e){const{target:t}=e;if(!t)return;const s=t.getAttribute("data-objectid");s&&this.viewModel.currentBestFeature?.attributes.objectId!==Number(s)&&this.viewModel.selectBestFeature(s)}_onAdditionalCoverageVisibilityChange(e){this.viewModel.setAdditionalCoverageVisibility(e)}_onAdditionalCameraLocationsVisibility(e){this.viewModel.setAdditionalCameraLocationsVisibility(e)}_onCurrentCoverageVisibilityChange(e){this.viewModel.setCurrentCoverageVisibility(e)}_registerGalleryItem(e){this._galleryObserver.observe(e)}_renderActionTooltips(){return[...this._actionItems].map((([e,t])=>_("calcite-tooltip",{key:e,label:e,referenceElement:t},_("span",null,e))))}_renderBody(){return _("div",{class:V.body},this._renderViewerContainer(),this.invalidCameraHeading?[this._renderWarning(this.messages.invalidCameraHeadingWarningTitle),this._renderWarningTooltip(this.messages.invalidCameraHeadingWarningDescription)]:[this._renderImageGallery(),this._renderNavigation(),this._renderImageOverlays()],this._renderImageEnhancementTools())}_renderImageEnhancementAction(){const{state:e,mode:t}=this.viewModel;return _("calcite-action",{active:this.imageEnhancementToolActive,afterCreate:this._storeActionElement,bind:this,disabled:"default"!==t||"image-loaded"!==e,icon:"sliders-horizontal",onclick:this._toggleImageEnhancementToolState,text:this.messages.imageEnhancement})}_renderImageEnhancementTools(){const{imageEnhancementToolActive:e,viewModel:{brightness:t,contrast:s,sharpness:i,state:r}}=this;return e&&"image-loaded"===r?_("calcite-panel",{bind:this,class:V.imageEnhancementWrapper,closable:!0,closed:!e,heading:this.messages.imageEnhancement,key:this.messages.imageEnhancement,onCalcitePanelClose:this._toggleImageEnhancementToolState},_("div",{class:V.imageEnhancementTools},_("div",{class:V.imageEnhancementToolContainer},_("calcite-label",null,this.messages.brightness,_("calcite-slider",{bind:this,labelTicks:!0,max:10,min:-10,ticks:5,value:t,onCalciteSliderInput:this._handleBrightnessChange}))),_("div",{class:V.imageEnhancementToolContainer},_("calcite-label",null,this.messages.contrast,_("calcite-slider",{bind:this,labelTicks:!0,max:10,min:-10,ticks:5,value:s,onCalciteSliderInput:this._handleContrastChange}))),_("div",{class:V.imageEnhancementToolContainer},_("calcite-label",null,this.messages.sharpness,_("calcite-slider",{bind:this,labelTicks:!0,max:1,min:0,step:.1,ticks:.5,value:i,onCalciteSliderInput:this._handleSharpnessChange})))),_("calcite-action",{bind:this,icon:"reset",onclick:this._resetImageTools,slot:"header-actions-end",text:this.messagesCommon.reset})):null}_renderImageGallery(){const{container:e,galleryOpened:t,imageGalleryEnabled:s,viewModel:{thumbnails:i},invalidCameraHeading:r}=this;return s&&t&&e&&i?_("calcite-panel",{bind:this,class:V.carousel,closable:!0,closed:!t,disabled:r,heading:this.messages.imageGallery,key:this.messages.imageGallery,onCalcitePanelClose:this._toggleImageGallery},_("div",{class:V.carouselContainer},this._renderThumbnails(i))):null}_renderImageOverlaysAction(){const{viewModel:{state:e},imageOverlaysOpened:t,invalidCameraHeading:s}=this;return _("calcite-action",{active:t,afterCreate:this._storeActionElement,bind:this,disabled:"image-loaded"!==e||s,icon:"layers",onclick:this._toggleImageOverlays,text:this.messages.imageOverlays})}_renderImageOverlays(){const{imageOverlaysOpened:e,viewModel:{state:t}}=this;if(e&&"image-loaded"===t)return this._imageOverlays.closed&&(this._imageOverlays.closed=!1),m((()=>this._imageOverlays.closed)).then((()=>this.imageOverlaysOpened=!1)),_("div",{class:V.imageOverlaysContainer,key:this.messages.imageOverlays},this._imageOverlays.render())}_renderWarning(e){const{invalidCameraHeading:t,viewModel:{state:s}}=this;return t&&"image-loaded"===s?[_("calcite-notice",{class:V.alert,closable:!0,icon:"exclamation-mark-triangle-f",iconFlipRtl:!0,kind:"warning",open:!0,scale:"s"},_("div",{afterCreate:e=>this._storeWarningTitleElement(e),slot:"title"},e))]:null}_renderWarningTooltip(e){const{_warningTitleElement:t}=this;if(e?.length&&t)return _("calcite-tooltip",{closeOnClick:!0,referenceElement:t},e)}_renderMapImageConversionTool(){const{mapImageConversionToolState:e,viewModel:{state:t},invalidCameraHeading:s}=this;return _("calcite-action",{active:e,afterCreate:this._storeActionElement,bind:this,disabled:"image-loaded"!==t||s,icon:"image-pin",onclick:this._toggleMapImageConversionToolState,text:this.messages.mapImageConversionTool})}_renderNavigation(){const{viewModel:{sectorData:e,navigatorCurrentBestFeature:s,currentBestFeature:i,state:r}}=this;if(!this.container||!i)return null;let o,a,n,l,p;if(s){const{x:e,y:t,direction:i}=s,[r,m,c,u]=j[i];o=`M ${e} ${t} L ${r} ${m} A ${v[2]} ${v[2]} 0 0 1 ${c} ${u} Z`,a=e,l=t,n=j[i][4],p=j[i][5]}const m=e=>{const t=e.target.dataset?.sector;t&&this.viewModel.handleSectorClick(+t)},c=e=>{const t=e.target.dataset;if(!t)return;const{featureIndexInSector:s,sector:i}=t;s&&i&&this.viewModel.handleFeatureClick({sector:i,featureIndexInSector:+s})},u=e=>{e.removeEventListener("click",c)},h=i.attributes.objectId,d=e?.map((e=>e?.items)).filter(Boolean).flatMap((e=>e?.map((({x:e,y:t,objectID:s,featureIndexInSector:i,sector:r})=>_("circle",{afterRemoved:u,class:this.classes(V.feature,{selected:h===s}),cx:e,cy:t,"data-feature-index-in-sector":i,"data-sector":r,key:`${V.feature}-${s}`,onclick:c,r:g}))))),k=e=>{e.removeEventListener("click",m)},b=this.classes({[V.navigationWrapper]:!0,[V.navigationZoomed]:this._navigationToolExpanded});return this.navigationToolActive&&"image-loaded"===r?_("div",{bind:this,class:b,key:this.messages.navigationTool},_("svg",{afterCreate:e=>this._storeNavigationToolReference(e),class:t()?x:V.rotateWithAnimation,focusable:"false",height:y,role:"img",width:y,xmlns:"http://www.w3.org/2000/svg"},_("defs",null,_("linearGradient",{gradientUnits:"userSpaceOnUse",id:`${this.id}-coverage-fill`,x1:a,x2:n,y1:l,y2:p},_("stop",{class:V.navigationPathOffset0,offset:0}),_("stop",{class:V.navigationPathOffset1,offset:1}))),_("g",null,_("circle",{class:this.classes(V.sector,V.outerSector),cx:v[3],cy:v[3],onclick:this._scaleNavigationTool,r:v[3]}),_("circle",{class:V.sector,cx:v[3],cy:v[3],r:v[2]}),_("circle",{class:V.sector,cx:v[3],cy:v[3],r:v[1]}),_("circle",{class:V.sector,cx:v[3],cy:v[3],r:v[0]}),_("path",{class:V.pointer,d:"M 56.5 6.06217782649107 L 60 0 L 63.5 6.06217782649107 Z",key:`${V.pointer}-west`}),_("path",{class:this.classes(V.pointer,V.north),d:"M 113.93782217350893 56.5 L 120 60 L 113.93782217350893 63.5 Z",key:`${V.pointer}-north`}),_("path",{class:V.pointer,d:"M 56.5 113.93782217350893 L 60 120 L 63.5 113.93782217350893 Z",key:`${V.pointer}-east`}),_("path",{class:V.pointer,d:"M 6.06217782649107 56.5 L 0 60 L 6.06217782649107 63.5 Z",key:`${V.pointer}-south`}),_("path",{class:this.classes(V.sector,V.sectorSeparator),d:"M 23.937554159486076 23.937554159486076 L 96.06244584051393 96.06244584051393 M 23.937554159486076 96.06244584051393 L 96.06244584051393 23.937554159486076",key:V.sectorSeparator}),function(e,t,s){const[i,r,o,a]=[...e,0];return[...O(i,r,t,s).map((e=>R(e,i,r))),...O(r,o,t,s).map((e=>R(e,r,o))),...O(o,a,t,s).map((e=>R(e,o,a)))]}([v[2],v[1],v[0]],v[3],v[3]).map(((t,s)=>_("path",{afterRemoved:k,class:this.classes(V.sector,e?.[s]?.length?V.sectorEnabled:V.sectorDisabled),d:t,"data-sector":`${s}`,key:`${V.sector}-${s}`,onclick:m}))),_("path",{class:this.classes(V.sector,V.sectorCross),d:"M 56.4 56.4 L 63.53 63.53 M 63.53 56.4 L 56.4 63.53",key:V.sectorCross}),d,i.attributes.cameraPitch>=5&&o?_("path",{class:V.selectedFeaturePath,d:o,fill:`url(#${this.id}-coverage-fill)`,key:V.selectedFeaturePath}):null))):null}_renderNavigationToolAction(){const{state:e}=this.viewModel;return _("calcite-action",{active:this.navigationToolActive,afterCreate:this._storeActionElement,bind:this,disabled:"image-loaded"!==e||this.invalidCameraHeading,icon:"explore",onclick:this._toggleNavigationTool,text:this.messages.navigationTool})}_renderMenuBarContainer(){const{currentCoverageVisible:e,isAdditionalCoverageVisible:t,isAdditionalPointSourcesVisible:s,imageGalleryEnabled:i,invalidCameraHeading:r}=this;return _("calcite-action-bar",{expandDisabled:!0,layout:"horizontal",slot:"action-bar"},_("calcite-action-group",{expanded:!0},_("calcite-action",{active:e,afterCreate:this._storeActionElement,bind:this,class:V.currentCoverage,disabled:r,icon:"trapezoid-area",onclick:this._toggleCurrentCoverage,text:this.messages.currentFootprint}),_("calcite-action",{active:t,afterCreate:this._storeActionElement,bind:this,class:V.addCoverage,disabled:r,icon:"trapezoid-area",onclick:this._toggleAdditionalCoverage,text:this.messages.additionalFootprints}),_("calcite-action",{active:s,afterCreate:this._storeActionElement,bind:this,class:V.addExpPoints,disabled:r,icon:"circle-area",onclick:this._toggleAdditionalCameraLocations,text:this.messages.additionalCameraLocations})),_("calcite-action-group",{layout:"horizontal"},this.visibleElements.mapImageConversionTool?this._renderMapImageConversionTool():null,this.visibleElements.navigationTool?this._renderNavigationToolAction():null,this.visibleElements.imageEnhancement?this._renderImageEnhancementAction():null),_("calcite-action-group",null,_("calcite-action",{active:this.galleryOpened,afterCreate:this._storeActionElement,bind:this,disabled:!i||r,icon:"images",onclick:this._toggleImageGallery,text:this.messages.imageGallery,textEnabled:!0}),this.visibleElements.imageOverlays?this._renderImageOverlaysAction():null,this.visibleElements.showPopupsAction?this._renderPopupAction():null),this._renderActionTooltips())}_renderMessageBox(){const{messages:e,viewModel:{displayMessage:t}}=this;if(!t)return null;const{data:s,key:i,map:r}=t,o=`${r?L(e[i],r):e[i]}`;return _("span",{class:V.messageBox},s?`${o} ${s}`:o)}_renderPopupAction(){return _("calcite-action",{afterCreate:this._storeActionElement,bind:this,disabled:!this.popupEnabled,icon:"popup",onclick:this._toggleImageAttributes,text:this.messages.showPopups,textEnabled:!0})}_renderThumbnails(e){const{currentBestFeature:t}=this.viewModel;return t?_("div",{class:V.carouselContent},e.items.map((({url:e,objectId:s,rotation:i},r)=>_("div",{class:`${V.carouselItemWrapper}${t.attributes.objectId===s?"--selected":""}`,key:`${V.carouselItemWrapper}-${r}`},_("canvas",{afterCreate:this._registerGalleryItem,afterRemoved:this._unregisterGalleryItem,alt:`thumbnail-${s}`,class:V.carouselItem,"data-objectid":`${s}`,"data-rotation":`${i}`,"data-src":e,onclick:this._loadImageFromGallery,onmouseenter:this._highlight,onmouseleave:this._removeHighlight}))))):null}_renderViewerContainer(){return _("div",{class:V.viewerContainer},this._renderImageViewer(),this._renderPanoramicViewer(),this._renderMessageBox())}_renderImageViewer(){const{displayMessage:e,loadImageViewer:t,mode:s}=this.viewModel,i=null!=e||"default"!==s,r=this.classes({[V.viewer]:!i,[V.viewerHidden]:i});return _("calcite-panel",{afterCreate:t,bind:this,class:r})}_renderPanoramicViewer(){const{displayMessage:e,loadPanoramicViewer:t,mode:s}=this.viewModel,i=null!=e||"panoramic"!==s,r=this.classes({[V.viewer]:!i,[V.viewerHidden]:i});return _("calcite-panel",{afterCreate:t,bind:this,class:r})}_resetImageTools(){this.viewModel.sharpness=this.viewModel.brightness=this.viewModel.contrast=0}_storeActionElement(e){this._actionItems.set(e.text,e)}_storeNavigationToolReference(e){this._navigationTool=e}_storeWarningTitleElement(e){this._warningTitleElement=e}_toggleAdditionalCameraLocations(){this.isAdditionalPointSourcesVisible=!this.isAdditionalPointSourcesVisible}_toggleAdditionalCoverage(){this.isAdditionalCoverageVisible=!this.isAdditionalCoverageVisible}_toggleCurrentCoverage(){this.currentCoverageVisible=!this.currentCoverageVisible}_toggleImageEnhancementToolState(e){e.stopPropagation(),this.imageEnhancementToolActive=!this.imageEnhancementToolActive,this.imageEnhancementToolActive&&(this.galleryOpened&&(this.galleryOpened=!1),this.navigationToolActive&&(this.navigationToolActive=!1),this.imageOverlaysOpened&&(this.imageOverlaysOpened=!1))}_toggleImageOverlays(e){e.stopPropagation(),this.imageOverlaysOpened=!this.imageOverlaysOpened,this.imageOverlaysOpened&&(this.galleryOpened&&(this.galleryOpened=!1),this.navigationToolActive&&(this.navigationToolActive=!1),this.imageEnhancementToolActive&&(this.imageEnhancementToolActive=!1))}_toggleImageGallery(e){e.stopPropagation(),this.galleryOpened=!!this.imageGalleryEnabled&&!this.galleryOpened,this.galleryOpened&&(this.imageEnhancementToolActive&&(this.imageEnhancementToolActive=!1),this.navigationToolActive&&(this.navigationToolActive=!1),this.imageOverlaysOpened&&(this.imageOverlaysOpened=!1))}_toggleNavigationTool(){this.navigationToolActive=!this.navigationToolActive,this.navigationToolActive&&(this.galleryOpened&&(this.galleryOpened=!1),this.imageEnhancementToolActive&&(this.imageEnhancementToolActive=!1),this.imageOverlaysOpened&&(this.imageOverlaysOpened=!1))}_toggleMapImageConversionToolState(){this.mapImageConversionToolState=!this.mapImageConversionToolState}_unregisterGalleryItem(e){this._galleryObserver.unobserve(e)}_updateNavigationTool(e){const{previousFeatureAngle:t,bestFeatureAngle:s}=this.viewModel,i=(s-t+540)%360-180;e.style.setProperty("--oi-navigation-tool-rotation-from",`${t}deg`),e.style.setProperty("--oi-navigation-tool-rotation-to",`${t+i}deg`)}async loadBestImage(e){return this.viewModel.loadBestImage(e)}loadImageFromSource(e,t){return this.viewModel.loadImageFromSource(e,t)}async plotMapPoint(e){return this.viewModel.plotMapPoint(e)}plotReferencePointOnGround(e){this.viewModel.plotReferencePointOnGround(e)}plotReferencePointOnImage(e){this.viewModel.plotReferencePointOnImage(e)}resetImage(){this.viewModel.resetImage()}render(){const{viewModel:{state:e}}=this;return _("div",{class:this.classes(S.widget,A)},_("calcite-panel",{bind:this,heading:this.visibleElements.title?this.messages.title:void 0,loading:"image-loading"===e},this.visibleElements.coverageMenu?this._renderMenuBarContainer():null,this._renderBody()))}updateSuitabilities(e){this.viewModel.updateSuitabilities(e)}};e([c()],z.prototype,"activeLayer",null),e([c()],z.prototype,"currentBestFeature",null),e([c()],z.prototype,"currentCoverageVisible",null),e([c()],z.prototype,"disabled",null),e([c()],z.prototype,"features",null),e([c()],z.prototype,"imagePointsInView",null),e([c()],z.prototype,"galleryOpened",void 0),e([c()],z.prototype,"icon",null),e([c()],z.prototype,"imageEnhancementToolActive",void 0),e([c({readOnly:!0})],z.prototype,"imageGalleryEnabled",null),e([c()],z.prototype,"imageOverlaysOpened",void 0),e([c({readOnly:!0})],z.prototype,"invalidCameraHeading",null),e([c()],z.prototype,"isAdditionalCoverageVisible",null),e([c()],z.prototype,"isAdditionalPointSourcesVisible",null),e([c()],z.prototype,"mapImageConversionToolState",null),e([c()],z.prototype,"layer",null),e([c()],z.prototype,"navigationToolActive",void 0),e([c({type:w})],z.prototype,"viewModel",void 0),e([c(),T("esri/widgets/OrientedImageryViewer/t9n/OrientedImageryViewer")],z.prototype,"messages",void 0),e([c(),T("esri/t9n/common")],z.prototype,"messagesCommon",void 0),e([c({readOnly:!0})],z.prototype,"popupEnabled",null),e([c()],z.prototype,"referencePoint",null),e([c()],z.prototype,"view",null),e([c({type:B,nonNullable:!0})],z.prototype,"visibleElements",void 0),e([c()],z.prototype,"determineWorkflowForFeature",null),e([c()],z.prototype,"updateFootprint",null),e([c()],z.prototype,"_navigationToolExpanded",void 0),e([c()],z.prototype,"_navigationTool",void 0),e([c()],z.prototype,"_imageOverlays",void 0),e([c()],z.prototype,"_warningTitleElement",void 0),z=e([u("esri.widgets.OrientedImageryViewer")],z);const q=z;export{q as default};
