/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import"../intl.js";import{i as e,equalsShallow as t}from"../core/lang.js";import{n}from"./compilerUtils.js";import{t as r,r as a,L as i}from"./Logger.js";import{b as o}from"./formUtils.js";import{isTimeOnlyField as s,a as l,b as u,D as m,NumericRangeValidationError as p,TypeValidationError as d}from"../layers/support/fieldUtils.js";import{l as c}from"./layerUtils.js";import{i as f}from"./utils3.js";import{s as y}from"./substitute.js";const b=e=>"field"===e?.type,g=e=>"group"===e?.type,x=e=>"relationship"===e?.type,O=e=>"text"===e.type,T=e=>!g(e)&&null!=e.group,v=e=>e.reduce(((e,t)=>g(t)?[...e,...t.inputs]:[...e,t]),[]),h=e=>v(e).filter(b),j=e=>v(e).filter(x),F=e=>null!=e&&(N(e,"combo-box")||N(e,"radio-buttons")),N=(e,t)=>null!=e&&e.input?.type===t,V=e=>null!=e&&(N(e,"text-box")||N(e,"text-area")),L=({domain:e,inputType:t="text-box",dataType:n})=>"number"===n&&"text-box"===t&&(!e||"coded-value"!==e.type);function E(t){const{attributes:n,fieldsIndex:i,label:o,timeZone:s}=t;if(!n||"object"!=typeof n)return o;const l=Object.keys(n).filter((e=>r(o,e))),u=l.map((e=>n[e])),m=l.map((e=>i.get(e))).filter(e);return function(e,t){return a(a(e,(e=>`{${e.toLowerCase()}}`)),Object.fromEntries(Object.entries(t).map((([e,t])=>[e.toLowerCase(),t]))))}(o,w({values:u,fields:m,timeZone:s}))}const _="expression/";function U(e){const[t,n]=e.split(_);return""===t&&n?n:(i.getLogger("esri.widgets.FeatureForm/featureFormUtils").error("extractExpressionNameFromString:invalid-input",`The string ${e} is not a valid expression reference of the form '${_}/expressionName'`),"")}function A(e){return`${_}${e}`}function I(e){return`field/${e}`}function R(e){return e.startsWith(_)}function $(e){return e.startsWith("expr/")}function w(e){const{fields:t,values:n}=e,r=e.timeZone??void 0,a=t.map(((e,t)=>{let a=n[t];if(e.domain&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find((e=>e.code===a));t?.name&&(a=t.name)}return(f(e)||s(e))&&(a=l(e,a,{timeZone:r,...u(e)})),[e.name,a]}));return Object.fromEntries(a)}const D=e=>{const t={typeFieldName:null,types:[]};return e?("subtype-sublayer"===e.type?(t.typeFieldName=e.parent?.subtypeField,t.types=e.parent?.subtypes??[]):"subtype-group"===e.type||"feature"===e.type&&e.subtypes?.length?(t.typeFieldName=e.subtypeField,t.types=e.subtypes??[]):"types"in e&&e.types&&(t.typeFieldName=e.typeIdField,t.types=e.types.map((({id:e,name:t,domains:n})=>({code:e,name:t,domains:n})))),null!=t.typeFieldName&&(t.typeFieldName=e.getField(t.typeFieldName)?.name??t.typeFieldName),t):t};var Z;!function(e){e.TOO_SHORT="length-validation-error::too-short",e.TOO_LONG="length-validation-error::too-long"}(Z||(Z={}));const C={type:"number"},G={type:"number",intlOptions:{notation:"scientific"}};function S(e){return e>=1e7||e<=-1e7}const k=(e,t,n)=>{const{dataType:r,error:a,minLength:i,value:o,required:s}=e,l=t?.validationErrors;if(!l||!a)return null;if(s&&null===o)return l.cannotBeNull;if(a===m.VALUE_OUT_OF_RANGE||a===p.OUT_OF_RANGE){const{field:a,range:i}=e,o={type:"date",intlOptions:{timeZone:"date"===a.type&&n?n:void 0,...u(a)}},s=function(e,{validationErrors:t}){return null!=e.max&&null!=e.min?t.outsideRange:null!=e.max?t.outsideRangeMax:t.outsideRangeMin}(i,t);return y(s,i,{format:{max:"date"===r?o:null!=i.max&&S(i.max)?G:C,min:"date"===r?o:null!=i.min&&S(i.min)?G:C}})}return a===m.INVALID_CODED_VALUE?l.invalidCodedValue:a===d.INVALID_TYPE?l.invalidType:a===Z.TOO_SHORT?y(l.tooShort,{min:i}):(Z.TOO_LONG,null)},q=e=>{if(!e)return;const t=e.layer,n=t&&"geometryType"in t?t.geometryType:void 0,r=e.geometry?.type;return"polyline"===r||"polyline"===n?"line":"mesh"===r||"mesh"===n||"multipatch"===n?"cube":"multipoint"===r||"multipoint"===n?"point":r||n||"table"},H=e=>{const t=[];if(e.formTemplate){const{description:n,title:a}=e.formTemplate;e.fields?.forEach((e=>{const i=a&&r(a,e.name),o=n&&r(n,e.name);(i||o)&&t.push(e.name)}))}return t};function M(e,t){const n=t??("formTemplate"in e&&e.formTemplate);return!!n&&(n.elements?.filter(o)??[]).some((({fieldName:t})=>!e.fieldsIndex.get(t)))}function W(e,t){return null==e||t.onValue!==e&&t.offValue!==e}function z(e,t){switch(t.objectType){case"any":return!0;case"null":return null==e;case"code":return e===t.codedValue?.code;case"range":return null!=e&&null!=t.minValue&&null!=t.maxValue&&+e>=t.minValue&&+e<=t.maxValue;default:return n(t.objectType),!1}}function B(e,n,r){const a=c(e),i=a?.find((e=>e.code===r));if(!i)return!1;const o=a?.find((e=>e.code===n));return!t(i.defaultValues,o?.defaultValues)&&Object.values(i.defaultValues).some((e=>null!=e))}export{z as A,Z as L,V as a,F as b,b as c,H as d,g as e,x as f,w as g,O as h,N as i,v as j,T as k,k as l,q as m,L as n,M as o,E as p,D as q,A as r,B as s,I as t,R as u,W as v,U as w,$ as x,h as y,j as z};
