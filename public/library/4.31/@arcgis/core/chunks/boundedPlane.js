/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import"../core/lang.js";import{L as s}from"./Logger.js";import{a as i}from"./mathUtils.js";import{O as n,d as t}from"./ray.js";import{i as a,t as o,f as r}from"./mat4.js";import{c as e}from"./mat4f64.js";import{i as c,d as u,h as g,m as b,s as f,g as l,f as p,o as m,p as d,a as h,e as I,n as j,q as P}from"./vec3.js";import{f as N,a as v,c as w}from"./vec3f64.js";import{f as M}from"./aaBoundingRect.js";import{A as T}from"./Axis.js";import{c as y,p as A,d as S}from"./lineSegment.js";import{c as x,f as _,g as E,s as O,w as V,a as B,b as F,d as Y,i as q,e as C,h as L,j as R,p as k,k as U}from"./plane.js";const z=()=>s.getLogger("esri.views.3d.support.geometryUtils.boundedPlane"),G=class{constructor(){this.plane=x(),this.origin=w(),this.basis1=w(),this.basis2=w()}};function W(s=ps){return{plane:x(s.plane),origin:v(s.origin),basis1:v(s.basis1),basis2:v(s.basis2)}}function X(s,i=W()){return Z(s.origin,s.basis1,s.basis2,i)}function Z(s,i,n,t=W()){return c(t.origin,s),c(t.basis1,i),c(t.basis2,n),D(t),a=t,o="fromValues()",Math.abs(u(a.basis1,a.basis2)/(g(a.basis1)*g(a.basis2)))>1e-6&&z().warn(o,"Provided basis vectors are not perpendicular"),Math.abs(u(a.basis1,us(a)))>1e-6&&z().warn(o,"Basis vectors and plane normal are not perpendicular"),Math.abs(-u(us(a),a.origin)-a.plane[3])>1e-6&&z().warn(o,"Plane offset is not consistent with plane origin"),t;var a,o}function D(s){_(s.basis2,s.basis1,s.origin,s.plane)}function H(s,i,n){s!==n&&X(s,n);const t=f(F.get(),us(s),i);return l(n.origin,n.origin,t),n.plane[3]-=i,n}function J(s,i=W()){const n=(s[2]-s[0])/2,t=(s[3]-s[1])/2;return p(i.origin,s[0]+n,s[1]+t,0),p(i.basis1,n,0,0),p(i.basis2,0,t,0),Y(0,0,1,0,i.plane),i}function K(s,i,n){return!!q(s.plane,i,n)&&gs(s,n)}function Q(s,n,t){const a=ms.get();ls(s,n,a,ms.get());let o=Number.POSITIVE_INFINITY;for(const r of js){const e=fs(s,r,ds.get()),g=F.get();if(C(a,e,g)){const s=d(F.get(),n.origin,g),a=Math.abs(i(u(n.direction,s)));a<o&&(o=a,c(t,g))}}return o===Number.POSITIVE_INFINITY?ss(s,n,t):t}function $(s,i){return(i-s)/i}function ss(s,i,n){if(K(s,i,n))return n;const a=ms.get(),o=ms.get();ls(s,i,a,o);let r=Number.POSITIVE_INFINITY;for(const e of js){const u=fs(s,e,ds.get()),g=F.get();if(L(a,u,g)){const s=t(i,g);if(!R(o,g))continue;s<r&&(r=s,c(n,g))}}return ts(s,i.origin)<r&&is(s,i.origin,n),n}function is(s,i,n){const t=k(s.plane,i,F.get()),a=A(bs(s,s.basis1),t,-1,1,F.get()),o=A(bs(s,s.basis2),t,-1,1,F.get());return h(n,l(F.get(),a,o),s.origin),n}function ns(s,i,n){const{origin:t,basis1:a,basis2:o}=s,r=h(F.get(),i,t),e=U(a,r),c=U(o,r),u=U(us(s),r);return p(n,e,c,u)}function ts(s,i){const n=ns(s,i,F.get()),{basis1:t,basis2:a}=s,o=g(t),r=g(a),e=Math.max(Math.abs(n[0])-o,0),c=Math.max(Math.abs(n[1])-r,0),u=n[2];return e*e+c*c+u*u}function as(s,i){return Math.sqrt(ts(s,i))}function os(s,i){return R(s.plane,i)&&gs(s,i)}function rs(s,i){const n=-s.plane[3];return U(us(s),i)-n}function es(s,i,n){return s!==n&&X(s,n),a(Ps,i),o(Ps,Ps),b(n.basis1,s.basis1,Ps),b(n.basis2,s.basis2,Ps),b(E(n.plane),E(s.plane),Ps),b(n.origin,s.origin,i),O(n.plane,n.plane,n.origin),n}function cs(s,i,n,t){return s!==t&&X(s,t),r(Ns,i,n),b(t.basis1,s.basis1,Ns),b(t.basis2,s.basis2,Ns),D(t),t}function us(s){return E(s.plane)}function gs(s,i){const n=h(F.get(),i,s.origin),t=P(s.basis1),a=P(s.basis2),o=u(s.basis1,n),r=u(s.basis2,n);return-o-t<0&&o-t<0&&-r-a<0&&r-a<0}function bs(s,i){const n=ds.get();return c(n.origin,s.origin),c(n.vector,i),n}function fs(s,i,n){const{basis1:t,basis2:a,origin:o}=s,r=f(F.get(),t,i.origin[0]),e=f(F.get(),a,i.origin[1]);l(n.origin,r,e),l(n.origin,n.origin,o);const c=f(F.get(),t,i.direction[0]),u=f(F.get(),a,i.direction[1]);return f(n.vector,l(c,c,u),2),n}function ls(s,i,n,t){const a=us(s);_(a,i.direction,i.origin,n),_(E(n),a,i.origin,t)}const ps={plane:x(),origin:N(0,0,0),basis1:N(1,0,0),basis2:N(0,1,0)},ms=new n(x),ds=new n(y),hs=w(),Is=new n((()=>W())),js=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Ps=e(),Ns=e(),vs=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:G,altitudeAt:rs,axisAt:function(s,i,n,t){return function(s,i,n){switch(i){case T.X:c(n,s.basis1),j(n,n);break;case T.Y:c(n,s.basis2),j(n,n);break;case T.Z:c(n,us(s))}return n}(s,n,t)},cameraFrustumCoverage:$,closestPoint:ss,closestPointOnSilhouette:Q,copy:X,copyWithoutVerify:function(s,i){c(i.origin,s.origin),c(i.basis1,s.basis1),c(i.basis2,s.basis2),B(i.plane,s.plane)},create:W,distance:as,distance2:ts,distanceToSilhouette:function(s,i){let n=Number.NEGATIVE_INFINITY;for(const t of js){const a=fs(s,t,ds.get()),o=S(a,i);o>n&&(n=o)}return Math.sqrt(n)},elevate:H,equals:function(s,i){return I(s.basis1,i.basis1)&&I(s.basis2,i.basis2)&&I(s.origin,i.origin)},extrusionContainsPoint:os,fromAABoundingRect:J,fromValues:Z,getExtent:function(s,i){const n=s.basis1[0],t=s.basis2[1],[a,o]=s.origin;return M(a-n,o-t,a+n,o+t,i)},intersectRay:K,intersectRayClosestSilhouette:function(s,i,n){if(K(s,i,n))return n;const t=Q(s,i,F.get());return l(n,i.origin,f(F.get(),i.direction,m(i.origin,t)/g(i.direction))),n},normal:us,projectPoint:is,projectPointLocal:ns,rotate:cs,setAltitudeAt:function(s,i,n,t){const a=rs(s,i),o=f(hs,us(s),n-a);return l(t,i,o),t},setExtent:function(s,i,n){return J(i,n),H(n,rs(s,s.origin),n),n},transform:es,up:ps,updateUnboundedPlane:D,wrap:function(s,i,n){const t=Is.get();return t.origin=s,t.basis1=i,t.basis2=n,t.plane=V(0,0,0,0),D(t),t}},Symbol.toStringTag,{value:"Module"}));export{G as B,X as a,vs as b,W as c,$ as d,os as e,Z as f,J as g,as as h,K as i,us as n,cs as r,es as t,D as u};
