/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import e from"../config.js";import{version as t}from"../kernel.js";import{A as n,D as r,T as o,d as a}from"./TimeOnly.js";import{r as i}from"./Logger.js";import{isPromiseLike as s}from"../core/promiseUtils.js";import{I as u}from"./ImmutableArray.js";import l from"../geometry/Point.js";import{e as c,a as f}from"./shared2.js";import{f as d,p as m}from"./number2.js";import p from"../geometry/Extent.js";import h from"../geometry/Geometry.js";import y from"../geometry/Multipoint.js";import g from"../geometry/Polygon.js";import b from"../geometry/Polyline.js";import N from"../geometry/SpatialReference.js";import{i as S}from"./coordsUtils.js";import{fromJSON as C}from"../geometry/support/jsonUtils.js";import{g as T}from"./locale.js";import A from"../rest/support/Query.js";import{D as F}from"./datetime.js";class M{}var x;!function(e){e.AsyncNotEnabled="AsyncNotEnabled",e.ModulesNotSupported="ModulesNotSupported",e.CircularModules="CircularModules",e.CannotCompareDateAndTime="CannotCompareDateAndTime",e.NeverReach="NeverReach",e.UnsupportedHashType="UnsupportedHashType",e.InvalidParameter="InvalidParameter",e.FeatureSetDoesNotHaveSubtypes="FeatureSetDoesNotHaveSubtypes",e.UnexpectedToken="UnexpectedToken",e.Unrecognized="Unrecognized",e.UnrecognizedType="UnrecognizedType",e.MaximumCallDepth="MaximumCallDepth",e.BooleanConditionRequired="BooleanConditionRequired",e.TypeNotAllowedInFeature="TypeNotAllowedInFeature",e.KeyMustBeString="KeyMustBeString",e.WrongNumberOfParameters="WrongNumberOfParameters",e.CallNonFunction="CallNonFunction",e.NoFunctionInTemplateLiteral="NoFunctionInTemplateLiteral",e.NoFunctionInDictionary="NoFunctionInDictionary",e.NoFunctionInArray="NoFunctionInArray",e.AssignModuleFunction="AssignModuleFunction",e.LogicExpressionOrAnd="LogicExpressionOrAnd",e.LogicalExpressionOnlyBoolean="LogicalExpressionOnlyBoolean",e.FunctionNotFound="FunctionNotFound",e.InvalidMemberAccessKey="InvalidMemberAccessKey",e.UnsupportedUnaryOperator="UnsupportUnaryOperator",e.InvalidIdentifier="InvalidIdentifier",e.MemberOfNull="MemberOfNull",e.UnsupportedOperator="UnsupportedOperator",e.Cancelled="Cancelled",e.ModuleAccessorMustBeString="ModuleAccessorMustBeString",e.ModuleExportNotFound="ModuleExportNotFound",e.Immutable="Immutable",e.OutOfBounds="OutOfBounds",e.IllegalResult="IllegalResult",e.FieldNotFound="FieldNotFound",e.PortalRequired="PortalRequired",e.LogicError="LogicError",e.ArrayAccessorMustBeNumber="ArrayAccessMustBeNumber",e.KeyAccessorMustBeString="KeyAccessorMustBeString",e.WrongSpatialReference="WrongSpatialReference",e.CannotChangeTimeZoneTime="CannotChangeTimeZoneTime",e.CannotChangeTimeZoneDateOnly="CannotChangeTimeZoneDateOnly"}(x||(x={}));const Z={[x.TypeNotAllowedInFeature]:"Feature attributes only support dates, numbers, strings, guids.",[x.LogicError]:"Logic error - {reason}",[x.CannotCompareDateAndTime]:"Cannot compare date or dateonly with timeonly types",[x.NeverReach]:"Encountered unreachable logic",[x.AsyncNotEnabled]:"Async Arcade must be enabled for this script",[x.ModuleAccessorMustBeString]:"Module accessor must be a string",[x.ModuleExportNotFound]:"Module has no export with provided identifier",[x.ModulesNotSupported]:"Current profile does not support modules",[x.ArrayAccessorMustBeNumber]:"Array accessor must be a number",[x.FunctionNotFound]:"Function not found",[x.FieldNotFound]:"Key not found - {key}",[x.CircularModules]:"Circular module dependencies are not allowed",[x.Cancelled]:"Execution cancelled",[x.UnsupportedHashType]:"Type not supported in hash function",[x.IllegalResult]:"Value is not a supported return type",[x.PortalRequired]:"Portal is required",[x.InvalidParameter]:"Invalid parameter",[x.WrongNumberOfParameters]:"Call with wrong number of parameters",[x.Unrecognized]:"Unrecognized code structure",[x.UnrecognizedType]:"Unrecognized type",[x.WrongSpatialReference]:"Cannot work with geometry in this spatial reference. It is different to the execution spatial reference",[x.BooleanConditionRequired]:"Conditions must use booleans",[x.NoFunctionInDictionary]:"Dictionaries cannot contain functions.",[x.NoFunctionInArray]:"Arrays cannot contain functions.",[x.NoFunctionInTemplateLiteral]:"Template Literals do not expect functions by value.",[x.KeyAccessorMustBeString]:"Accessor must be a string",[x.KeyMustBeString]:"Object keys must be a string",[x.Immutable]:"Object is immutable",[x.UnexpectedToken]:"Unexpected token",[x.MemberOfNull]:"Cannot access property of null object",[x.MaximumCallDepth]:"Exceeded maximum function depth",[x.OutOfBounds]:"Out of bounds",[x.InvalidIdentifier]:"Identifier not recognized",[x.CallNonFunction]:"Expression is not a function",[x.InvalidMemberAccessKey]:"Cannot access value using a key of this type",[x.AssignModuleFunction]:"Cannot assign function to module variable",[x.UnsupportedUnaryOperator]:"Unsupported unary operator",[x.UnsupportedOperator]:"Unsupported operator",[x.LogicalExpressionOnlyBoolean]:"Logical expressions must be boolean",[x.LogicExpressionOrAnd]:"Logical expression can only be combined with || or &&",[x.CannotChangeTimeZoneTime]:"Cannot change the timezone of a Time",[x.CannotChangeTimeZoneDateOnly]:"Cannot change the timezone of a DateOnly",[x.FeatureSetDoesNotHaveSubtypes]:"FeatureSet does not have subtypes"};class k extends Error{constructor(...e){super(...e)}}class I extends k{constructor(e,t){super(_(t)+e.message,{cause:e}),this.loc=null,Error.captureStackTrace&&Error.captureStackTrace(this,I),t?.loc&&(this.loc=t.loc)}}class O extends Error{constructor(e,t,n,r){super("Execution error - "+_(n)+i(Z[t],r)),this.loc=null,this.declaredRootClass="esri.arcade.arcadeexecutionerror",Error.captureStackTrace&&Error.captureStackTrace(this,O),n?.loc&&(this.loc=n.loc)}}function _(e){return e&&e.loc?`Line : ${e.loc.start?.line}, ${e.loc.start?.column}: `:""}class R extends Error{constructor(e,t,n,r){super("Compilation error - "+_(n)+i(Z[t],r)),this.loc=null,this.declaredRootClass="esri.arcade.arcadecompilationerror",Error.captureStackTrace&&Error.captureStackTrace(this,R),n?.loc&&(this.loc=n.loc)}}class D extends Error{constructor(){super("Uncompilable code structures"),this.declaredRootClass="esri.arcade.arcadeuncompilableerror",Error.captureStackTrace&&Error.captureStackTrace(this,D)}}function w(e,t,n){return"esri.arcade.arcadeexecutionerror"===n.declaredRootClass||"esri.arcade.arcadecompilationerror"===n.declaredRootClass?null===n.loc&&t?.loc?new I(n,{cause:n}):n:("esri.arcade.featureset.support.featureseterror"===n.declaredRootClass||"esri.arcade.featureset.support.sqlerror"===n.declaredRootClass||n.declaredRootClass,t?.loc?new I(n,{cause:n}):n)}var v;!function(e){e.UnrecognizedUri="UnrecognizedUri",e.UnsupportedUriProtocol="UnsupportedUriProtocol"}(v||(v={}));const U={[v.UnrecognizedUri]:"Unrecognized uri - {uri}",[v.UnsupportedUriProtocol]:"Unrecognized uri protocol"};class j extends Error{constructor(e,t){super(i(U[e],t)),this.declaredRootClass="esri.arcade.arcademoduleerror",Error.captureStackTrace&&Error.captureStackTrace(this,j)}}class E{constructor(){}}function P(e,t,n){if(e instanceof E&&!(e instanceof z)){const r=new z;return r.fn=e,r.parameterEvaluator=n,r.context=t,r}return e}class L extends E{constructor(e){super(),this.fn=e}createFunction(e){return(...t)=>this.fn(e,{preparsed:!0,arguments:t})}call(e,t){return this.fn(e,t)}marshalledCall(e,t,n,r){return r(e,t,((t,o,a)=>{a=a.map((t=>t instanceof E&&!(t instanceof z)?P(t,e,r):t));const i=this.call(n,{args:a});return s(i)?i.then((e=>P(e,n,r))):i}))}}class z extends E{constructor(){super(...arguments),this.fn=null,this.context=null}createFunction(e){return this.fn.createFunction(this.context)}call(e,t){return this.fn.marshalledCall(e,t,this.context,this.parameterEvaluator)}marshalledCall(e,t,n){return this.fn.marshalledCall(e,t,this.context,this.parameterEvaluator)}}class J extends u{constructor(e,t,n,r,o,a){super(e),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=t,this._hasZ=n,this._hasM=r,this._cacheId=o,this._partId=a}get(e){if(void 0===this._lazyPt[e]){const t=this._elements[e];if(void 0===t)return;const n=this._hasZ,r=this._hasM;let o;o=n&&!r?new l(t[0],t[1],t[2],void 0,this._spRef):r&&!n?new l(t[0],t[1],void 0,t[2],this._spRef):n&&r?new l(t[0],t[1],t[2],t[3],this._spRef):new l(t[0],t[1],this._spRef),o.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+e.toString(),this._lazyPt[e]=o}return this._lazyPt[e]}equalityTest(e){return e===this||null!==e&&e instanceof J!=0&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}class B extends u{constructor(e,t,n,r,o){super(e),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=n,this._hasM=r,this._spRef=t,this._cacheId=o}get(e){if(void 0===this._lazyPath[e]){const t=this._elements[e];if(void 0===t)return;this._lazyPath[e]=new J(t,this._spRef,this._hasZ,this._hasM,this._cacheId,e)}return this._lazyPath[e]}equalityTest(e){return e===this||null!==e&&e instanceof B!=0&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}class Y{constructor(e){this.value=e}}class q{constructor(e){this.value=e}}const G={type:"VOID"},H=Symbol("BREAK"),K=Symbol("CONTINUE");function V(e,t,n){return""===t||null==t||t===n||t===n?e:e=e.split(t).join(n)}function W(e){return e instanceof E}function $(e){return e instanceof M}function Q(e){return!!(te(e)||re(e)||he(e)||ye(e)||ge(e)||ne(e)||null===e||e===G||"number"==typeof e)}function X(e,t){return void 0===e?t:e}function ee(e){return null==e?"":ie(e)||pe(e)?"Array":he(e)?"Date":ge(e)?"Time":ye(e)?"DateOnly":te(e)?"String":ne(e)?"Boolean":re(e)?"Number":"esri.arcade.Attachment"===e?.declaredClass?"Attachment":"esri.arcade.Portal"===e?.declaredClass?"Portal":"esri.arcade.Dictionary"===e?.declaredClass?"Dictionary":me(e)?"KnowledgeGraph":e instanceof M?"Module":se(e)?"Feature":e instanceof l?"Point":e instanceof g?"Polygon":e instanceof b?"Polyline":e instanceof y?"Multipoint":e instanceof p?"Extent":W(e)?"Function":ce(e)?"FeatureSet":de(e)?"FeatureSetCollection":e===G?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognized Type"}function te(e){return"string"==typeof e||e instanceof String}function ne(e){return"boolean"==typeof e}function re(e){return"number"==typeof e}function oe(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}function ae(e){return e instanceof h}function ie(e){return Array.isArray(e)}function se(e){return"esri.arcade.Feature"===e?.arcadeDeclaredClass}function ue(e){return"esri.Graphic"===e?.declaredClass}function le(e){return e instanceof A}function ce(e){return"esri.arcade.featureset.support.FeatureSet"===e?.declaredRootClass}function fe(e){return"esri.arcade.Dictionary"===e?.declaredClass}function de(e){return"esri.arcade.featureSetCollection"===e?.declaredRootClass}function me(e){return"esri.rest.knowledgeGraph.KnowledgeGraph"===e?.declaredClass}function pe(e){return e instanceof u}function he(e){return e instanceof n}function ye(e){return e instanceof r}function ge(e){return e instanceof o}function be(e){return null!=e&&"object"==typeof e}function Ne(e){return e instanceof Date}function Se(e,t,n,r,o){if(e.length<t||e.length>n)throw new O(r,x.WrongNumberOfParameters,o)}function Ce(e){return e<0?-Math.round(-e):Math.round(e)}function Te(e,t){return isNaN(e)||null==t||""===t?e.toString():(t=V(t,"‰",""),t=V(t,"¤",""),d(e,{pattern:t}))}function Ae(e,t){return null==t||""===t?e.toISOString(!0):e.toFormat(Fe(t),{locale:T(),numberingSystem:"latn"})}function Fe(e,t=!1){e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let n="";const r=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|Z{1,5}|.)/g;for(const o of e.match(r)||[])switch(o){case"D":n+="d";break;case"DD":n+="dd";break;case"DDD":n+="o";break;case"d":n+="c";break;case"ddd":n+="ccc";break;case"dddd":n+="cccc";break;case"M":n+="L";break;case"MM":n+="LL";break;case"MMM":n+="LLL";break;case"MMMM":n+="LLLL";break;case"YY":n+="yy";break;case"Y":case"YYYY":n+="yyyy";break;case"Q":n+="q";break;case"Z":n+="Z";break;case"ZZ":n+="ZZ";break;case"ZZZ":n+="ZZZ";break;case"ZZZZ":n+=t?"[ZZZZ]":"ZZZZ";break;case"ZZZZZ":n+=t?"[ZZZZZ]":"ZZZZZ";break;case"S":n+="'S'";break;case"SS":n+="'SS'";break;case"SSS":n+="u";break;case"A":case"a":n+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":n+=o;break;default:o.length>=2&&"["===o.slice(0,1)&&"]"===o.slice(-1)?n+=`'${o.slice(1,-1)}'`:n+=`'${o}'`}return n}function Me(e,t,n){switch(n){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function xe(e,t,r){if(null===e){if(null===t||t===G)return Me(null,null,r);if(re(t))return Me(0,t,r);if(te(t))return Me(0,Re(t),r);if(ne(t))return Me(0,Re(t),r);if(he(t))return Me(0,t.toNumber(),r);if(ge(t))return Me(e,t.toNumber(),r);if(ye(t))return Me(e,t.toNumber(),r)}if(e===G){if(null===t||t===G)return Me(null,null,r);if(re(t))return Me(0,t,r);if(te(t))return Me(0,Re(t),r);if(ne(t))return Me(0,Re(t),r);if(he(t))return Me(0,t.toNumber(),r);if(ge(t))return Me(e,t.toNumber(),r);if(ye(t))return Me(e,t.toNumber(),r)}else if(re(e)){if(re(t))return Me(e,t,r);if(ne(t))return Me(e,Re(t),r);if(null===t||t===G)return Me(e,0,r);if(te(t))return Me(e,Re(t),r);if(he(t))return Me(e,t.toNumber(),r);if(ge(t))return Me(e,t.toNumber(),r);if(ye(t))return Me(e,t.toNumber(),r)}else if(te(e)){if(te(t))return Me(ke(e),ke(t),r);if(he(t))return Me(Re(e),t.toNumber(),r);if(ge(t))return Me(Re(e),t.toNumber(),r);if(ye(t))return Me(Re(e),t.toNumber(),r);if(re(t))return Me(Re(e),t,r);if(null===t||t===G)return Me(Re(e),0,r);if(ne(t))return Me(Re(e),Re(t),r)}else if(he(e)){if(he(t))return e.timeZone!==t.timeZone&&(e.isUnknownTimeZone?e=n.arcadeDateAndZoneToArcadeDate(e,t.timeZone):t.isUnknownTimeZone&&(t=n.arcadeDateAndZoneToArcadeDate(t,e.timeZone))),Me(e.toNumber(),t.toNumber(),r);if(null===t||t===G)return Me(e.toNumber(),0,r);if(re(t))return Me(e.toNumber(),t,r);if(ne(t))return Me(e.toNumber(),Re(t),r);if(te(t))return Me(e.toNumber(),Re(t),r);if(ge(t))throw new O(null,x.CannotCompareDateAndTime,null);if(ye(t))return Me(e.toNumber(),t.toNumber(),r)}else if(ne(e)){if(ne(t))return Me(e,t,r);if(re(t))return Me(Re(e),Re(t),r);if(he(t))return Me(Re(e),t.toNumber(),r);if(ge(t))return Me(Re(e),t.toNumber(),r);if(ye(t))return Me(Re(e),t.toNumber(),r);if(null===t||t===G)return Me(Re(e),0,r);if(te(t))return Me(Re(e),Re(t),r)}else if(ye(e)){if(he(t))return Me(e.toNumber(),t.toNumber(),r);if(null===t||t===G)return Me(e.toNumber(),0,r);if(re(t))return Me(e.toNumber(),t,r);if(ne(t))return Me(e.toNumber(),Re(t),r);if(te(t))return Me(e.toNumber(),Re(t),r);if(ge(t))throw new O(null,x.CannotCompareDateAndTime,null);if(ye(t))return Me(e.toNumber(),t.toNumber(),r)}else if(ge(e)){if(he(t))throw new O(null,x.CannotCompareDateAndTime,null);if(null===t||t===G)return Me(e.toNumber(),0,r);if(re(t))return Me(e.toNumber(),t,r);if(ne(t))return Me(e.toNumber(),Re(t),r);if(te(t))return Me(e.toNumber(),Re(t),r);if(ge(t))return Me(e.toNumber(),t.toNumber(),r);if(ye(t))throw new O(null,x.CannotCompareDateAndTime,null)}return!!Ze(e,t)&&("<="===r||">="===r)}function Ze(e,t){if(e===t)return!0;if(null===e&&t===G||null===t&&e===G)return!0;if(he(e)&&he(t))return e.equals(t);if(ge(e)&&ge(t))return e.equals(t);if(ye(e)&&ye(t))return e.equals(t);if(e instanceof B)return e.equalityTest(t);if(e instanceof J)return e.equalityTest(t);if(e instanceof l&&t instanceof l){const n=e.cache._arcadeCacheId,r=t.cache._arcadeCacheId;if(null!=n)return n===r}if(be(e)&&be(t)){if(e._arcadeCacheId===t._arcadeCacheId&&void 0!==e._arcadeCacheId&&null!==e._arcadeCacheId)return!0;if(e._underlyingGraphic===t._underlyingGraphic&&void 0!==e._underlyingGraphic&&null!==e._underlyingGraphic)return!0}return!1}function ke(e,t){if(te(e))return e;if(null===e)return"";if(re(e))return Te(e,t);if(ne(e))return e.toString();if(he(e))return Ae(e,t);if(ge(e))return e.toFormat(t);if(ye(e))return e.toFormat(t);if(e instanceof h)return JSON.stringify(e.toJSON());if(ie(e)){const t=[];for(let n=0;n<e.length;n++)t[n]=_e(e[n]);return"["+t.join(",")+"]"}if(e instanceof u){const t=[];for(let n=0;n<e.length();n++)t[n]=_e(e.get(n));return"["+t.join(",")+"]"}return null!==e&&"object"==typeof e&&void 0!==e.castToText?e.castToText():W(e)?"object, Function":e===G?"":$(e)?"object, Module":""}function Ie(e){const t=[];if(!ie(e))return null;if(e instanceof u){for(let n=0;n<e.length();n++)t[n]=Re(e.get(n));return t}for(let n=0;n<e.length;n++)t[n]=Re(e[n]);return t}function Oe(e,t,n=!1){if(te(e))return e;if(null===e)return"";if(re(e))return Te(e,t);if(ne(e))return e.toString();if(he(e))return Ae(e,t);if(ge(e))return e.toFormat(t);if(ye(e))return e.toFormat(t);if(e instanceof h)return e instanceof p?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+ze(e.spatialReference)+"}":ze(e.toJSON(),((e,t)=>e.key===t.key?0:"spatialReference"===e.key?1:"spatialReference"===t.key||e.key<t.key?-1:e.key>t.key?1:0));if(ie(e)){const t=[];for(let r=0;r<e.length;r++)t[r]=_e(e[r],n);return"["+t.join(",")+"]"}if(e instanceof u){const t=[];for(let r=0;r<e.length();r++)t[r]=_e(e.get(r),n);return"["+t.join(",")+"]"}return null!==e&&"object"==typeof e&&void 0!==e.castToText?e.castToText(n):W(e)?"object, Function":e===G?"":$(e)?"object, Module":""}function _e(e,t=!1){if(null===e)return"null";if(ne(e)||re(e)||te(e))return JSON.stringify(e);if(e instanceof h)return Oe(e,null,t);if(e instanceof u)return Oe(e,null,t);if(Array.isArray(e))return Oe(e,null,t);if(he(e))return t?JSON.stringify(e.getTime()):JSON.stringify(Ae(e,""));if(ge(e))return JSON.stringify(e.toString());if(ye(e))return JSON.stringify(e.toString());if(null!==e&&"object"==typeof e){if(void 0!==e.castToText)return e.castToText(t)}else if(e===G)return"null";return"null"}function Re(e,t){return re(e)?e:null===e||""===e?0:he(e)||ye(e)||ge(e)?NaN:ne(e)?e?1:0:ie(e)||""===e||void 0===e?NaN:void 0!==t&&te(e)?(t=V(t,"‰",""),t=V(t,"¤",""),m(e,{pattern:t})):e===G?0:Number(e)}function De(e,t){if(he(e))return e;if(te(e)){const r=function(e,t){const n=/ (\d\d)/,r=a(t);let o=F.fromISO(e,{zone:r});return o.isValid||n.test(e)&&(e=e.replace(n,"T$1"),o=F.fromISO(e,{zone:t}),o.isValid)?o:null}(e,t);if(r)return n.dateTimeToArcadeDate(r)}return null}function we(e){return ne(e)?e:te(e)?"true"===(e=e.toLowerCase()):!!re(e)&&0!==e&&!isNaN(e)}function ve(e,t){return null==e?null:(null!==e.spatialReference&&void 0!==e.spatialReference||(e.spatialReference=t),e)}function Ue(e){if(null===e)return null;if(e instanceof l)return"NaN"===e.x||null===e.x||isNaN(e.x)?null:e;if(e instanceof g){if(0===e.rings.length)return null;for(const t of e.rings)if(t.length>0)return e;return null}if(e instanceof b){if(0===e.paths.length)return null;for(const t of e.paths)if(t.length>0)return e;return null}return e instanceof y?0===e.points.length?null:e:e instanceof p?"NaN"===e.xmin||null===e.xmin||isNaN(e.xmin)?null:e:null}function je(e,t){if(!e)return t;if(!e.domain)return t;let n=null,r=null;if(he(t))n=t.toNumber();else if(ye(t))n=t.toString();else if(ge(t))n=t.toStorageString();else if("string"===e.field.type||"esriFieldTypeString"===e.field.type)n=ke(t);else{if(null==t)return null;if(""===t)return t;n=Re(t)}for(let t=0;t<e.domain.codedValues.length;t++){const o=e.domain.codedValues[t];o.code===n&&(r=o)}return null===r?ke(t):r.name}function Ee(e,t){if(!e)return t;if(!e.domain)return t;let n=null;const r=ke(t);for(let t=0;t<e.domain.codedValues.length;t++){const o=e.domain.codedValues[t];o.name===r&&(n=o)}return null===n?t:n.code}function Pe(e,t,n=null,r=null){if(!t)return null;if(!t.fields)return null;let o,a,i=null;for(let n=0;n<t.fields.length;n++){const r=t.fields[n];r.name.toLowerCase()===e.toString().toLowerCase()&&(i=r)}if(null===i)throw new O(null,x.FieldNotFound,null,{key:e});let s=t.typeIdField,u="id",l=t.types;if(t.subtypeField&&(s=t.subtypeField,u="code",l=t.subtypes??[]),null===r&&n&&s)r=n.hasField(s)?n.field(s):null;else if(s&&null!==r){let e=!1;for(const t of l||[])if(r===t[u]){e=!0;break}if(!e)for(const t of l||[])if(r===t.name){r=t[u],e=!0;break}e||(r=null,n&&s&&(r=n.hasField(s)?n.field(s):null))}return null!=r&&l.some((e=>e[u]===r&&(o=e.domains?.[i.name],o&&"inherited"===o.type&&(o=Le(i.name,t),a=!0),!0))),a||o||(o=Le(e,t)),{field:i,domain:o}}function Le(e,t){let n;return t.fields.some((t=>(t.name.toLowerCase()===e.toLowerCase()&&(n=t.domain),!!n))),n}function ze(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});const n="boolean"==typeof t.cycles&&t.cycles,r=t.cmp&&(o=t.cmp,function(e){return function(t,n){const r={key:t,value:e[t]},a={key:n,value:e[n]};return o(r,a)}});var o;const a=[];return function e(t){if(t?.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===t)return;if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);let o,i;if(Array.isArray(t)){for(i="[",o=0;o<t.length;o++)o&&(i+=","),i+=e(t[o])||"null";return i+"]"}if(null===t)return"null";if(a.includes(t)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const s=a.push(t)-1,u=Object.keys(t).sort(r?.(t));for(i="",o=0;o<u.length;o++){const n=u[o],r=e(t[n]);r&&(i&&(i+=","),i+=JSON.stringify(n)+":"+r)}return a.splice(s,1),"{"+i+"}"}(e)}function Je(e){if(null===e)return null;const t=[];for(const n of e)n?.arcadeDeclaredClass&&"esri.arcade.Feature"===n.arcadeDeclaredClass?t.push(n.geometry()):t.push(n);return t}function Be(e,t){if(!(t instanceof l))throw new O(null,x.InvalidParameter,null);e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function Ye(e,t){if(ie(e)||pe(e)){let n=!1,r=!1,o=[],a=t;if(ie(e)){for(const t of e)Be(o,t);o.length>0&&(a=e[0].spatialReference,n=e[0].hasZ,r=e[0].hasM)}else if(e instanceof J)o=e._elements,o.length>0&&(n=e._hasZ,r=e._hasM,a=e.get(0).spatialReference);else{if(!pe(e))throw new O(null,x.InvalidParameter,null);for(const t of e.toArray())Be(o,t);o.length>0&&(a=e.get(0).spatialReference,n=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}return 0===o.length?null:(S(o)||(o=o.slice().reverse()),new g({rings:[o],spatialReference:a,hasZ:n,hasM:r}))}return e}function qe(e,t){if(ie(e)||pe(e)){let n=!1,r=!1,o=[],a=t;if(ie(e)){for(const t of e)Be(o,t);o.length>0&&(a=e[0].spatialReference,n=!0===e[0].hasZ,r=!0===e[0].hasM)}else if(e instanceof J)o=e._elements,o.length>0&&(n=e._hasZ,r=e._hasM,a=e.get(0).spatialReference);else if(pe(e)){for(const t of e.toArray())Be(o,t);o.length>0&&(a=e.get(0).spatialReference,n=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}return 0===o.length?null:new b({paths:[o],spatialReference:a,hasZ:n,hasM:r})}return e}function Ge(e,t){if(ie(e)||pe(e)){let n=!1,r=!1,o=[],a=t;if(ie(e)){for(const t of e)Be(o,t);o.length>0&&(a=e[0].spatialReference,n=!0===e[0].hasZ,r=!0===e[0].hasM)}else if(e instanceof J)o=e._elements,o.length>0&&(n=e._hasZ,r=e._hasM,a=e.get(0).spatialReference);else if(pe(e)){for(const t of e.toArray())Be(o,t);o.length>0&&(a=e.get(0).spatialReference,n=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}return 0===o.length?null:new y({points:o,spatialReference:a,hasZ:n,hasM:r})}return e}function He(e,t=!1){const n=[];if(null===e)return n;if(!0===ie(e)){for(let r=0;r<e.length;r++){const o=ke(e[r]);""===o&&!0!==t||n.push(o)}return n}if(e instanceof u){for(let r=0;r<e.length();r++){const o=ke(e.get(r));""===o&&!0!==t||n.push(o)}return n}if(Q(e)){const r=ke(e);return""===r&&!0!==t||n.push(r),n}return[]}let Ke=0;function Ve(e){return Ke++,Ke%100==0?(Ke=0,new Promise((t=>{setTimeout((()=>{t(e)}),0)}))):e}function We(e,t,n){switch(n){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function $e(e,t=null){return null==e?null:ne(e)||re(e)||te(e)?e:e instanceof h?!0===t?.keepGeometryType?e:e.toJSON():e instanceof u?e.toArray().map((e=>$e(e,t))):Array.isArray(e)?e.map((e=>$e(e,t))):Ne(e)?e:he(e)?e.toJSDate():ge(e)?e.toString():ye(e)?e.toJSDate():null!==e&&"object"==typeof e&&void 0!==e.castAsJson?e.castAsJson(t):null}async function Qe(e,t,n,r,o){const a=await Xe(e,t,n);o[r]=a}async function Xe(e,t=null,n=null){if(e instanceof u&&(e=e.toArray()),null==e)return null;if(Q(e)||e instanceof h||Ne(e)||he(e))return $e(e,n);if(Array.isArray(e)){const r=[],o=[];for(const a of e)null===a||Q(a)||a instanceof h||Ne(a)||he(a)?o.push($e(a,n)):(o.push(null),r.push(Qe(a,t,n,o.length-1,o)));return r.length>0&&await Promise.all(r),o}return null!==e&&"object"==typeof e&&void 0!==e.castAsJsonAsync?e.castAsJsonAsync(t,n):null}function et(e){return tt(e)?e.parent:e}function tt(e){return e&&"declaredClass"in e&&"esri.layers.support.SubtypeSublayer"===e.declaredClass}function nt(e,t,n){const r=et(e.fullSchema());return null===r?null:r.fields?Pe(t,r,e,n):null}function rt(e){const t=et(e.fullSchema());return null===t?null:t.fields?t.subtypeField?{subtypeField:t.subtypeField,subtypes:t.subtypes?t.subtypes.map((e=>({name:e.name,code:e.code}))):[]}:t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map((e=>({name:e.name,code:e.id}))):[]}:null:null}function ot(e,t,n,r){const o=et(e.fullSchema());if(null===o)return null;if(!o.fields)return null;const a=Pe(t,o,e,r);if(void 0===n)try{n=e.field(t)}catch(e){return null}return je(a,n)}function at(e,t,n,r){const o=et(e.fullSchema());if(null===o)return null;if(!o.fields)return null;if(void 0===n){try{n=e.field(t)}catch(e){return null}return n}return Ee(Pe(t,o,e,r),n)}function it(e){return e?.timeZone??"system"}function st(e){const t=et(e.fullSchema());if(null===t)return null;if(!t.fields)return null;const n=[];for(const e of t.fields)n.push(c(e));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField??"",geometryType:void 0===f[t.geometryType]?"":f[t.geometryType],fields:n}}function ut(r,o){return"system"===r&&(r=n.systemTimeZoneCanonicalName),{version:lt,engineVersion:t,timeZone:r,spatialReference:o instanceof N?o.toJSON():o,application:e.applicationName??"",engine:"web",locale:T()}}const lt="1.28",ct=Object.freeze(Object.defineProperty({__proto__:null,ImplicitResult:q,ReturnResult:Y,absRound:Ce,arcadeVersion:lt,autoCastArrayOfPointsToMultiPoint:Ge,autoCastArrayOfPointsToPolygon:Ye,autoCastArrayOfPointsToPolyline:qe,autoCastFeatureToGeometry:Je,binaryOperator:We,breakResult:H,castAsJson:$e,castAsJsonAsync:Xe,continueResult:K,defaultExecutingContext:ut,defaultTimeZone:it,defaultUndefined:X,equalityTest:Ze,featureDomainCodeLookup:at,featureDomainValueLookup:ot,featureFullDomain:nt,featureSchema:st,featureSubtypes:rt,fixNullGeometry:Ue,fixSpatialReference:ve,formatDate:Ae,formatNumber:Te,getDomain:Pe,getDomainCode:Ee,getDomainValue:je,getType:ee,greaterThanLessThan:xe,isArray:ie,isBoolean:ne,isDate:he,isDateOnly:ye,isDictionary:fe,isFeature:se,isFeatureSet:ce,isFeatureSetCollection:de,isFunctionParameter:W,isGeometry:ae,isGraphic:ue,isImmutableArray:pe,isInteger:oe,isJsDate:Ne,isKnowledgeGraph:me,isModule:$,isNumber:re,isObject:be,isQuery:le,isSimpleType:Q,isString:te,isSubtypeGrouplayer:function(e){return e&&"declaredClass"in e&&"esri.layers.SubtypeGroupLayer"===e.declaredClass},isSubtypeSublayer:tt,isTime:ge,multiReplace:V,parseGeometryFromJson:function(e,t){const n=JSON.parse(e);return n&&!n.spatialReference&&(n.spatialReference=t),C(n)},pcCheck:Se,stableStringify:ze,standardiseDateFormat:Fe,tick:Ve,toBoolean:we,toDate:De,toNumber:Re,toNumberArray:Ie,toString:ke,toStringArray:He,toStringExplicit:Oe,voidOperation:G},Symbol.toStringTag,{value:"Module"}));export{at as $,M as A,ve as B,E as C,P as D,x as E,Je as F,ge as G,ye as H,q as I,X as J,Ye as K,qe as L,Ge as M,L as N,we as O,it as P,De as Q,Y as R,z as S,He as T,V as U,oe as V,nt as W,Pe as X,rt as Y,ot as Z,je as _,Q as a,Ee as a0,Oe as a1,st as a2,Ne as a3,le as a4,Ve as a5,tt as a6,$e as a7,Xe as a8,J as a9,B as aa,ee as ab,Fe as ac,Ce as ad,Ue as ae,Ie as af,ut as ag,R as ah,ct as ai,D as aj,j as ak,v as al,ae as b,pe as c,ie as d,se as e,de as f,ce as g,fe as h,he as i,me as j,W as k,ue as l,ne as m,O as n,Ze as o,Se as p,H as q,K as r,w as s,te as t,re as u,G as v,Re as w,ke as x,xe as y,We as z};
