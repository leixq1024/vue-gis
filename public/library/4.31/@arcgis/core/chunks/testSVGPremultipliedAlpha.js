/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{P as e}from"./TiledDisplayObject.js";import{B as t}from"./BufferObject.js";import{T as r,c as s,U as i,j as n,k as a,d as o,P as E}from"./enums.js";import{F as _}from"./Program.js";import{a as u,T}from"./Texture.js";import{V as m}from"./VertexArrayObject.js";import{f as p}from"./maybe.js";class g{constructor(e,t,r,s,i,n,a,o,E){this.createQuery=e,this.deleteQuery=t,this.resultAvailable=r,this.getResult=s,this.disjoint=i,this.beginTimeElapsed=n,this.endTimeElapsed=a,this.createTimestamp=o,this.timestampBits=E}}let l=!1;function c(e,t){if(t.disjointTimerQuery)return null;let r=e.getExtension("EXT_disjoint_timer_query_webgl2");return r?new g((()=>e.createQuery()),(t=>{e.deleteQuery(t),l=!1}),(t=>e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE)),(t=>e.getQueryParameter(t,e.QUERY_RESULT)),(()=>e.getParameter(r.GPU_DISJOINT_EXT)),(t=>{l||(l=!0,e.beginQuery(r.TIME_ELAPSED_EXT,t))}),(()=>{e.endQuery(r.TIME_ELAPSED_EXT),l=!1}),(e=>r.queryCounterEXT(e,r.TIMESTAMP_EXT)),(()=>e.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT))):(r=e.getExtension("EXT_disjoint_timer_query"),r?new g((()=>r.createQueryEXT()),(e=>{r.deleteQueryEXT(e),l=!1}),(e=>r.getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT)),(e=>r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)),(()=>e.getParameter(r.GPU_DISJOINT_EXT)),(e=>{l||(l=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,e))}),(()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),l=!1}),(e=>r.queryCounterEXT(e,r.TIMESTAMP_EXT)),(()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT))):null)}class d{constructor(){this._result=!1}dispose(){this._program=p(this._program)}get result(){return null!=this._program&&(this._result=this._test(this._program),this.dispose()),this._result}}class h extends d{constructor(e){super(),this._rctx=e,this._program=e.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv = a_pos;\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor = texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(p){const g=this._rctx;if(!g.gl)return p.dispose(),!0;const l=new u(1);l.wrapMode=r.CLAMP_TO_EDGE,l.samplingMode=s.NEAREST;const c=new _(g,l),d=t.createVertex(g,i.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),h=new m(g,new Map([["a_pos",0]]),e,new Map([["geometry",d]])),w=new u;w.samplingMode=s.LINEAR,w.wrapMode=r.CLAMP_TO_EDGE;const A=new T(g,w,y);g.useProgram(p),g.bindTexture(A,0),p.setUniform1i("u_texture",0);const f=g.getBoundFramebufferObject(),{x:X,y:v,width:P,height:Q}=g.getViewport();g.bindFramebuffer(c),g.setViewport(0,0,1,1),g.setClearColor(0,0,0,0),g.setBlendingEnabled(!1),g.clear(n.COLOR),g.bindVAO(h),g.drawArrays(a.TRIANGLE_STRIP,0,4);const I=new Uint8Array(4);return c.readPixels(0,0,1,1,o.RGBA,E.UNSIGNED_BYTE,I),h.dispose(),c.dispose(),A.dispose(),g.setViewport(X,v,P,Q),g.bindFramebuffer(f),255!==I[0]}}const y=new Image;y.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",y.width=5,y.height=5,y.decode();export{h as S,d as W,c,l as h};
