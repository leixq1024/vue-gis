/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{S as e}from"./ScreenSpacePass.glsl.js";import{S as t,h as r,b as a,R as s,k as i,l as o}from"./StencilUtils.js";import{R as n}from"./RgbaFloatEncoding.glsl.js";import{c}from"./Matrix4PassUniform.js";import{N as l,g as p}from"./interfaces3.js";import{_ as u}from"./tslib.es6.js";import{p as m,S as h}from"./ShaderTechniqueConfiguration.js";import{n as d}from"./compilerUtils.js";import{m as f,b,d as g,p as _}from"./renderState.js";import{j as x}from"./enums.js";var y;!function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.Depth=3]="Depth",e[e.COUNT=4]="COUNT"}(y||(y={}));class F extends h{constructor(){super(...arguments),this.blitMode=y.None,this.hasOpacityFactor=!1}}u([m({count:y.COUNT})],F.prototype,"blitMode",void 0),u([m()],F.prototype,"hasOpacityFactor",void 0);class j extends l{constructor(){super(...arguments),this.opacity=1}}const O=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:j,build:function(i){const o=new t;o.include(e),o.fragment.uniforms.add(new r("tex",(e=>e.texture))),i.hasOpacityFactor&&o.fragment.uniforms.add(new c("opacity",(e=>e.opacity)));const l=i.blitMode===y.Depth;return l&&(o.fragment.uniforms.add(new a("nearFar",((e,t)=>t.camera.nearFar))),o.fragment.include(s),o.fragment.include(n)),o.fragment.main.add(p`
    ${l?p`
          float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
          fragColor = float2rgba(normalizedLinearDepth);`:p`
          fragColor = texture(tex, uv) ${i.hasOpacityFactor?"* opacity":""};`}`),o}},Symbol.toStringTag,{value:"Module"}));class C extends i{constructor(e,t,r){super(e,t,new o(O,(()=>Promise.resolve().then((()=>O)))),r)}initializePipeline(e){switch(e.blitMode){case y.None:case y.Depth:return f({colorWrite:g});case y.Alpha:return f({blending:_,colorWrite:g});default:d(e.blitMode);case y.PremultipliedAlpha:case y.COUNT:return f({blending:b,colorWrite:g})}}}class T{constructor(e,t=y.None){this._techniques=e,this._parameters=new j,this._configuration=new F,this._configuration.blitMode=t,e.precompile(C,this._configuration)}blit(e,t,r,a){e.bindFramebuffer(r.fbo),e.setClearColor(0,0,0,1),e.clear(x.COLOR),this._parameters.texture=t.getTexture();const s=this._techniques.acquire(C,this._configuration);e.bindTechnique(s,a,this._parameters),e.screen.draw(),s.release()}blend(e,t,r,a,s=1){this._configuration.hasOpacityFactor=s<1;const i=this._techniques.acquire(C,this._configuration);return i.compiled?(e.bindFramebuffer(r.fbo),this._parameters.texture=t.getTexture(),this._parameters.opacity=s,e.bindTechnique(i,a,this._parameters),e.screen.draw(),i.release(),!0):(i.release(),!1)}}export{T as B,F as C,y as a,j as b,C as c};
