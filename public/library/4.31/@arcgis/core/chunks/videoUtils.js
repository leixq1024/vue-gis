/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import e from"../geometry/Point.js";import t from"../geometry/Polygon.js";import r from"../geometry/Polyline.js";import n from"../layers/support/TelemetryData.js";import i from"../layers/support/VideoTimeExtent.js";const o="application/x-mpegURL",a={UASDatalinkLocalSet:1e4,PrecisionTimeStamp:10002,MissionId:10003,PlatformTailNumber:10004,PlatformHeadingAngle:10005,PlatformPitchAngle:10006,PlatformRollAngle:10007,PlatformTrueAirspeed:10008,PlatformIndicatedAirspeed:10009,PlatformDesignation:10010,ImageSourceSensor:10011,ImageCoordinateSystem:10012,SensorLatitude:10013,SensorLongitude:10014,SensorTrueAltitude:10015,SensorHorizontalFOV:10016,SensorVerticalFOV:10017,SensorAzimuthAngle:10018,SensorElevationAngle:10019,SensorRollAngle:10020,PlatformSlantRange:10021,TargetWidth:10022,FrameCenterLatitude:10023,FrameCenterLongitude:10024,FrameCenterElevation:10025,OffsetCorner1Latitude:10026,OffsetCorner1Longitude:10027,OffsetCorner2Latitude:10028,OffsetCorner2Longitude:10029,OffsetCorner3Latitude:10030,OffsetCorner3Longitude:10031,OffsetCorner4Latitude:10032,OffsetCorner4Longitude:10033,TargetLocationLatitude:10040,TargetLocationLongitude:10041,TargetLocationElevation:10042,TargetTrackGateWidth:10043,TargetTrackGateHeight:10044,TargetErrorEstimateHorizontal:10045,TargetErrorEstimateLateral:10046,GenericFlagData:10047,PlatformGroundSpeed:10056,PlatformGroundRange:10057,PlatformRemainingFuel:10058,PlatformCallSign:10059,SensorFOVName:10063,PlatformMagneticHeading:10064,LDSVersionNumber:10065,AlternatePlatformName:10070,EventStartTimeUTC:10072,VMTIDataSet:10074,SensorEllipsoidHeight:10075,OperationalMode:10077,CornerLatitudePoint1:10082,CornerLongitudePoint1:10083,CornerLatitudePoint2:10084,CornerLongitudePoint2:10085,CornerLatitudePoint3:10086,CornerLongitudePoint3:10087,CornerLatitudePoint4:10088,CornerLongitudePoint4:10089,SARMotionImageryMetadata:10095,SecurityClassification:20001,SecurityClassifyingAuthority:20002,SecurityClassifyingCountry:20003,SecuritySCI:20004,SecurityCaveats:20005,SecurityReleaseInstructions:20006,SecurityLDSVersion:20022,EsriVideoWidth:90001,EsriVideoHeight:90002,EsriFrameCenterLatitude:90050,EsriFrameCenterLongitude:90051,EsriCornerLatitudePt1:90052,EsriCornerLongitudePt1:90053,EsriCornerLatitudePt2:90054,EsriCornerLongitudePt2:90055,EsriCornerLatitudePt3:90056,EsriCornerLongitudePt3:90057,EsriCornerLatitudePt4:90058,EsriCornerLongitudePt4:90059,EsriFrameOutline:90060,EsriSensorPosition:90061,EsriHorizonPixelPack:90063,EsriGroundControlPoints:90064};function u(e){const{duration:t,end:r,start:n,timezone:o="UTC"}=e||{};return"number"!=typeof t?null:new i({duration:t||null,end:"number"==typeof r?new Date(r):null,start:"number"==typeof n?new Date(n):null,timezone:o})}function s(e,t){const r=[...t],n=r.findIndex((t=>t.equals(e)));return n>-1&&r.splice(n),r.push(e),r}function l(i){if(!i?.size)return new n;const o=function(t){if(!t?.size)return null;if(t.has(a.EsriSensorPosition)){const r=t.get(a.EsriSensorPosition)?.value;if(r)return e.fromJSON(r.geometry)}return t.has(a.SensorLongitude)&&t.has(a.SensorLatitude)&&t.has(a.SensorTrueAltitude)?new e({x:t.get(a.SensorLongitude)?.value,y:t.get(a.SensorLatitude)?.value,z:t.get(a.SensorTrueAltitude)?.value}):null}(i),u=function(t){return function(t){return t&&t.has(a.EsriFrameCenterLatitude)&&t.has(a.EsriFrameCenterLongitude)?new e({x:t.get(a.EsriFrameCenterLongitude).value,y:t.get(a.EsriFrameCenterLatitude).value,z:t.get(a.FrameCenterElevation).value}):null}(t)??function(t){return t&&t.has(a.FrameCenterLatitude)&&t.has(a.FrameCenterLongitude)?new e({x:t.get(a.FrameCenterLongitude)?.value,y:t.get(a.FrameCenterLatitude)?.value,z:t.get(a.FrameCenterElevation)?.value}):null}(t)}(i),s=function(e){if(!e)return null;const r=e.get(a.EsriFrameOutline)?.value;return r?t.fromJSON(r.geometry):function(e){if(!(e.has(a.EsriCornerLatitudePt1)&&e.has(a.EsriCornerLongitudePt1)&&e.has(a.EsriCornerLatitudePt2)&&e.has(a.EsriCornerLongitudePt2)&&e.has(a.EsriCornerLatitudePt3)&&e.has(a.EsriCornerLongitudePt3)&&e.has(a.EsriCornerLatitudePt4)&&e.has(a.EsriCornerLongitudePt4)))return null;const r=[e.get(a.EsriCornerLongitudePt1)?.value,e.get(a.EsriCornerLatitudePt1)?.value],n=[e.get(a.EsriCornerLongitudePt2)?.value,e.get(a.EsriCornerLatitudePt2)?.value],i=[e.get(a.EsriCornerLongitudePt3)?.value,e.get(a.EsriCornerLatitudePt3)?.value],o=[e.get(a.EsriCornerLongitudePt4)?.value,e.get(a.EsriCornerLatitudePt4)?.value];return new t({rings:[[r,n,i,o]]})}(e)??function(e){if(!(e.has(a.OffsetCorner1Latitude)&&e.has(a.OffsetCorner1Longitude)&&e.has(a.OffsetCorner2Latitude)&&e.has(a.OffsetCorner2Longitude)&&e.has(a.OffsetCorner3Latitude)&&e.has(a.OffsetCorner3Longitude)&&e.has(a.OffsetCorner4Latitude)&&e.has(a.OffsetCorner4Longitude)&&e.has(a.FrameCenterLatitude)&&e.has(a.FrameCenterLongitude)))return null;const r=e.get(a.FrameCenterLatitude)?.value,n=e.get(a.FrameCenterLongitude)?.value,i=r+e.get(a.OffsetCorner1Latitude)?.value,o=n+e.get(a.OffsetCorner1Longitude)?.value,u=r+e.get(a.OffsetCorner2Latitude)?.value,s=n+e.get(a.OffsetCorner2Longitude)?.value,l=r+e.get(a.OffsetCorner3Latitude)?.value,d=n+e.get(a.OffsetCorner3Longitude)?.value,g=r+e.get(a.OffsetCorner4Latitude)?.value,f=n+e.get(a.OffsetCorner4Longitude)?.value;return new t({rings:[[[o,i],[s,u],[d,l],[f,g]]]})}(e)}(i),l=function(e,t){if(!e||!t)return null;const n=[e.x,e.y,e.z??0],i=[t.x,t.y,t.z??0];return new r({paths:[[n,i]]})}(o,u);return new n({frameCenter:u,frameOutline:s,lineOfSight:l,sensorLocation:o})}function d(e){return e?.size?e.get(a.EsriGroundControlPoints)?.value??null??null:null}function g(e){return e?.size?e.get(a.EsriHorizonPixelPack)?.value??null:null}function f(e){if(!e)return o;let t="";const r=new RegExp(/\.(\w{3,4})(?:$|\?)/i),n=e?e.match(r):[];return n?.length?(t=n[0],"mp4"===t.toLowerCase().replaceAll(".","")?"video/mp4":o):o}function L(e){const t=e?.layers;return t?.length?t.map((e=>({layerId:e.id,posterUrl:e.poster,sourceType:e.serviceType,title:e.name,type:e.type||"Video Layer"}))):[]}export{g as a,d as b,l as c,L as d,s as e,f as g,u as r,a as v};
