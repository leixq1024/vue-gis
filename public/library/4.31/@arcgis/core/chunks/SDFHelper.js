/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{p as t}from"./floatRGBA.js";import{isExtent as o}from"../geometry/support/jsonUtils.js";import{R as n}from"./CIMSymbolHelper.js";import{d as r,s as a}from"./definitions.js";function i(t,o=.5){switch(t.type){case"CIMPointSymbol":{const o=t.symbolLayers;if(!o||1!==o.length)return null;const n=o[0];return"CIMVectorMarker"!==n.type?null:i(n)}case"CIMVectorMarker":{const n=t.markerGraphics;if(!n||1!==n.length)return null;const r=n[0];if(!r)return null;const a=r.geometry;if(!a)return null;const i=r.symbol;return!i||"CIMPolygonSymbol"!==i.type&&"CIMLineSymbol"!==i.type||i.symbolLayers?.some((t=>!!t.effects))?null:{type:"sdf",geom:a,sdfPaddingRatio:o,asFill:"CIMPolygonSymbol"===i.type}}}}function s(t){let o=1/0,n=-1/0,r=1/0,a=-1/0;for(const i of t)for(const t of i)t[0]<o&&(o=t[0]),t[0]>n&&(n=t[0]),t[1]<r&&(r=t[1]),t[1]>a&&(a=t[1]);return[o,r,n,a]}function e(t){return t?t.rings?s(t.rings):t.paths?s(t.paths):o(t)?[t.xmin,t.ymin,t.xmax,t.ymax]:null:null}function l(t,o){const[n,i,s,l]=e(t),f=s-n,m=l-i,c=r,h=a,u=Math.floor(.5*(c*o-h)),y=(c-2*(u+h))/Math.max(f,m),d=Math.round(f*y),x=Math.round(m*y);return{pixelDimensions:[f,m],texelDimensions:[Math.round((d+2*u)/y),Math.round((x+2*u)/y)]}}function f(t,o,n,i,s,e,l){const[f,m,c,h]=t;if(c<f||h<m)return{frameSizeRatio:0,anchorX:0,anchorY:0,widthRatio:1,sdfPaddingRatio:.5};const u=c-f,y=h-m,d=Math.max(u,y);let x=.5;if(null!=e&&null!=n){l||null==o||(e*=(o.ymax-o.ymin)/n);const t=e/(e+d),r=.1;t>.45&&t<1&&(x=Math.min(t+r,.99))}const M=r,g=a,p=Math.floor(.5*(M*x-g)),R=(M-2*(p+g))/d,b=Math.round(u*R)+2*p,w=Math.round(y*R)+2*p;let P=1;o&&(P=w*(1-x)/((o.ymax-o.ymin)*R));let C=0,I=0,S=1;i&&(s?o&&n&&o.ymax-o.ymin>0&&(S=(o.xmax-o.xmin)/(o.ymax-o.ymin),C=i.x/(n*S),I=i.y/n):(C=i.x,I=i.y)),o&&(C=.5*(o.xmax+o.xmin)+C*(o.xmax-o.xmin),I=.5*(o.ymax+o.ymin)+I*(o.ymax-o.ymin)),C-=f,I-=m,C*=R,I*=R,C+=p,I+=p;let j=C/b-.5,v=I/w-.5;return s&&n&&(j*=n*S,v*=n),{frameSizeRatio:P,anchorX:j,anchorY:v,widthRatio:S,sdfPaddingRatio:x}}function m(t){const o=(i=t.geom)?i.rings?i.rings:i.paths?i.paths:void 0!==i.xmin&&void 0!==i.ymin&&void 0!==i.xmax&&void 0!==i.ymax?[[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]:null:null;var i;const s=function(t){let o=1/0,r=-1/0,a=1/0,i=-1/0;for(const n of t)for(const t of n)t[0]<o&&(o=t[0]),t[0]>r&&(r=t[0]),t[1]<a&&(a=t[1]),t[1]>i&&(i=t[1]);return new n(o,a,r-o,i-a)}(o),e=r,l=a,f=Math.floor(.5*(e*t.sdfPaddingRatio-l)),m=e-2*(f+l),h=m/Math.max(s.width,s.height),u=Math.round(s.width*h)+2*f,y=Math.round(s.height*h)+2*f,d=[];for(const n of o)if(n&&n.length>1){const o=[];for(const r of n){let[n,a]=r;n-=s.x,a-=s.y,n*=h,a*=h,n+=f-.5,a+=f-.5,t.asFill?o.push([n,a]):o.push([Math.round(n),Math.round(a)])}if(t.asFill){const t=o.length-1;o[0][0]===o[t][0]&&o[0][1]===o[t][1]||o.push(o[0])}d.push(o)}const x=function(t,o,n,r){const a=o*n,i=new Array(a),s=r*r+1;for(let t=0;t<a;++t)i[t]=s;for(const a of t){const t=a.length;for(let s=1;s<t;++s){const t=a[s-1],e=a[s];let l,f,m,c;t[0]<e[0]?(l=t[0],f=e[0]):(l=e[0],f=t[0]),t[1]<e[1]?(m=t[1],c=e[1]):(m=e[1],c=t[1]);let h=Math.floor(l)-r,u=Math.floor(f)+r,y=Math.floor(m)-r,d=Math.floor(c)+r;h<0&&(h=0),u>o&&(u=o),y<0&&(y=0),d>n&&(d=n);const x=e[0]-t[0],M=e[1]-t[1],g=x*x+M*M;for(let r=h;r<u;r++)for(let a=y;a<d;a++){const s=r+.5,l=a+.5;let f,m,c=(s-t[0])*x+(l-t[1])*M;c<0?(f=t[0],m=t[1]):c>g?(f=e[0],m=e[1]):(c/=g,f=t[0]+c*x,m=t[1]+c*M);const h=(s-f)*(s-f)+(l-m)*(l-m),u=(n-a-1)*o+r;h<i[u]&&(i[u]=h)}}}for(let t=0;t<a;++t)i[t]=Math.sqrt(i[t]);return i}(d,u,y,f);return t.asFill&&function(t,o,n,r,a){for(const i of t){const t=i.length;for(let s=1;s<t;++s){const t=i[s-1],e=i[s];let l,f,m,c;t[0]<e[0]?(l=t[0],f=e[0]):(l=e[0],f=t[0]),t[1]<e[1]?(m=t[1],c=e[1]):(m=e[1],c=t[1]);let h=Math.floor(l),u=Math.floor(f)+1,y=Math.floor(m),d=Math.floor(c)+1;h<r&&(h=r),u>o-r&&(u=o-r),y<r&&(y=r),d>n-r&&(d=n-r);for(let i=y;i<d;++i){if(t[1]>i==e[1]>i)continue;const s=i+.5,l=(n-i-1)*o;for(let o=h;o<u;++o)o+.5<(e[0]-t[0])*(s-t[1])/(e[1]-t[1])+t[0]&&(a[l+o]=-a[l+o]);for(let t=r;t<h;++t)a[l+t]=-a[l+t]}}}}(d,u,y,f,x),{data:c(x,f),width:u,height:y,sdfPaddingRatio:t.sdfPaddingRatio,sdfDecodeCoeff:2*f/m}}function c(o,n){const r=2*n,a=o.length,i=new Uint8Array(4*a);for(let n=0;n<a;++n){const a=.5-o[n]/r;t(a,i,4*n)}return i}export{e as a,f as b,l as c,m as d,i as g};
