/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{a as t,c as r}from"./mathUtils.js";import{d as n,h as e,n as s,c,s as a,a as i,g as o,i as u,e as f,f as I}from"./vec3.js";import{c as N}from"./vec3f64.js";import"../core/lang.js";import{n as E}from"../core/scheduling.js";import{c as _}from"./mat3f64.js";import{c as m}from"./mat4f64.js";import{c as T}from"./quatf64.js";import{c as h}from"./vec2f64.js";import{c as S}from"./vec4f64.js";import{t as M}from"./mathUtils2.js";function g(t,r,e){const s=n(t,r)/n(t,t);return a(e,t,s)}function D(t,r){return n(t,r)/e(t)}function l(r,s){const c=n(r,s)/(e(r)*e(s));return-t(c)}function O(r,e,a){s(p,r),s(U,e);const i=n(p,U),o=t(i),u=c(p,p,U);return n(u,a)<0?2*Math.PI-o:o}const p=N(),U=N();class C{constructor(t){this._create=t,this._items=new Array,this._itemsPtr=0}get(){return 0===this._itemsPtr&&E((()=>this._reset())),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const t=2*this._itemsPtr;this._items.length>t&&(this._items.length=t),this._itemsPtr=0}static createVec2f64(){return new C(h)}static createVec3f64(){return new C(N)}static createVec4f64(){return new C(S)}static createMat3f64(){return new C(_)}static createMat4f64(){return new C(m)}static createQuatf64(){return new C(T)}get test(){}}const j=C.createVec2f64(),A=C.createVec3f64(),P=C.createVec4f64();C.createMat3f64();const F=C.createMat4f64(),v=C.createQuatf64();function w(t=It){return[t[0],t[1],t[2],t[3]]}function R(t=It[0],r=It[1],n=It[2],e=It[3]){return V(t,r,n,e,P.get())}function d(t,r){return V(r[0],r[1],r[2],r[3],t)}function y(t){return t}function V(t,r,n,e,s=w()){return s[0]=t,s[1]=r,s[2]=n,s[3]=e,s}function b(t,r,n){return u(n,t),n[3]=r,n}function X(t,r,n){const e=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],s=Math.abs(e-1)>1e-5&&e>1e-12?1/Math.sqrt(e):1;return n[0]=r[0]*s,n[1]=r[1]*s,n[2]=r[2]*s,n[3]=-(n[0]*t[0]+n[1]*t[1]+n[2]*t[2]),n}function q(t,r,n,e=w()){const s=n[0]-r[0],c=n[1]-r[1],a=n[2]-r[2],i=t[0]-r[0],o=t[1]-r[1],u=t[2]-r[2],f=c*u-a*o,I=a*i-s*u,N=s*o-c*i,E=f*f+I*I+N*N,_=Math.abs(E-1)>1e-5&&E>1e-12?1/Math.sqrt(E):1;return e[0]=f*_,e[1]=I*_,e[2]=N*_,e[3]=-(e[0]*t[0]+e[1]*t[1]+e[2]*t[2]),e}function L(t,r,e,c=0,a=Math.floor(e*(1/3)),o=Math.floor(e*(2/3))){if(e<3)return!1;r(k,c);let u=a,I=!1;for(;u<e-1&&!I;)r(z,u),u++,I=!f(k,z);if(!I)return!1;for(u=Math.max(u,o),I=!1;u<e&&!I;)r(B,u),u++,i(G,k,z),s(G,G),i(H,z,B),s(H,H),I=!f(k,B)&&!f(z,B)&&Math.abs(n(G,H))<Q;return I?(q(k,z,B,t),!0):(0!==c||1!==a||2!==o)&&L(t,r,e,0,1,2)}function x(t,r,n=!0){const e=r.length/3;return L(t,((t,n)=>I(t,r[3*n+0],r[3*n+1],r[3*n+2])),n?e-1:e)}const Q=.99619469809,k=N(),z=N(),B=N(),G=N(),H=N();function J(t,r,e){return r!==t&&d(t,r),t[3]=-n(t,e),t}function K(t,r){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=-t[3],r}function W(t,r,n,e){return c(B,r,t),X(n,B,e)}function Y(t,r,n,e){return ut(ft(t,r,i(A.get(),n,r),Et,e))}function Z(t,r,n){return null!=r&&ut(ft(t,r.origin,r.direction,_t,n))}function $(t,r,n){return ut(ft(t,r.origin,r.vector,Nt.NONE,n))}function tt(t,r,n){return ut(ft(t,r.origin,r.vector,Nt.CLAMP,n))}function rt(t,r){return it(t,r)>=0}function nt(t,r){const e=n(t,r.ray.direction),s=-it(t,r.ray.origin);if(s<0&&e>=0)return!1;if(e>-1e-6&&e<1e-6)return s>0;if((s<0||e<0)&&!(s<0&&e<0))return!0;const c=s/e;return e>0?c<r.c1&&(r.c1=c):c>r.c0&&(r.c0=c),r.c0<=r.c1}function et(t,r){const e=n(t,r.ray.direction),s=-it(t,r.ray.origin);if(e>-1e-6&&e<1e-6)return s>0;const c=s/e;return e>0?c<r.c1&&(r.c1=c):c>r.c0&&(r.c0=c),r.c0<=r.c1}function st(t,r,e){const s=a(A.get(),t,-t[3]),c=function(t,r,e){const s=a(A.get(),t,n(t,r));return i(e,r,s),e}(t,i(A.get(),r,s),A.get());return o(e,c,s),e}function ct(t,r,n,e){const s=t,c=A.get(),a=A.get();M(s,c,a);const o=i(A.get(),n,r),u=D(c,o),f=D(a,o),N=D(s,o);return I(e,u,f,N)}function at(t,r){return Math.abs(it(t,r))}function it(t,r){return n(t,r)+t[3]}var ot;function ut(t){return t===ot.INTERSECTS_INSIDE_OUT||t===ot.INTERSECTS_OUTSIDE_IN}function ft(t,e,s,c,i){const u=n(t,s),f=it(t,e);if(0===u)return f>=0?ot.INSIDE:ot.OUTSIDE;let I=-f/u;return c&Nt.CLAMP&&(I=r(I,0,1)),!(c&Nt.INFINITE_MIN)&&I<0||!(c&Nt.INFINITE_MAX)&&I>1?f>=0?ot.INSIDE:ot.OUTSIDE:(o(i,e,a(i,s,I)),f>=0?ot.INTERSECTS_INSIDE_OUT:ot.INTERSECTS_OUTSIDE_IN)}!function(t){t[t.INTERSECTS_INSIDE_OUT=0]="INTERSECTS_INSIDE_OUT",t[t.INTERSECTS_OUTSIDE_IN=1]="INTERSECTS_OUTSIDE_IN",t[t.INSIDE=2]="INSIDE",t[t.OUTSIDE=3]="OUTSIDE"}(ot||(ot={}));const It=[0,0,1,0];var Nt;!function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"}(Nt||(Nt={}));const Et=Nt.INFINITE_MIN|Nt.INFINITE_MAX,_t=Nt.INFINITE_MAX;export{nt as A,O as B,at as C,Y as D,K as E,ft as F,ot as G,b as H,Nt as I,x as J,d as a,A as b,w as c,V as d,$ as e,W as f,y as g,tt as h,Z as i,rt as j,D as k,q as l,ct as m,j as n,X as o,st as p,g as q,F as r,J as s,l as t,L as u,v,R as w,P as x,et as y,it as z};
