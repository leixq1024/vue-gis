/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{e as t}from"./earcut.js";import{A as n}from"./Axis.js";import{i as o}from"./coordsUtils.js";import{u as e,x as s,h as r}from"./aaBoundingBox.js";import{c as i}from"./Indices.js";import{d as a}from"./mathUtils.js";import{g as c,A as l}from"./unitUtils.js";import{f}from"./vec3.js";import{c as h,g,u}from"./plane.js";import{d as p}from"./deduplicate.js";function m(t,o,e){const s=function(t,n,o,e){const s=(i=n,Array.isArray(i[0])?(t,o)=>n[t][o]:(t,o)=>n[3*t+o]),r=e?c(e)/l(e):1;var i;return u(t,((t,n)=>f(t,s(n,0)*r,s(n,1)*r,s(n,2))),o)}(d,t,o,e)?g(d):[0,0,1];return Math.abs(s[2])>Math.cos(a(80))?n.Z:Math.abs(s[1])>Math.abs(s[0])?n.Y:n.X}const d=h();function A(n){const o=y(n.rings,n.hasZ,w.CCW_IS_HOLE,n.spatialReference),a=new Array;let c=0,l=0;for(const n of o.polygons){const s=n.count,r=n.index,f=e(o.position,3*r,3*s),h=n.holeIndices.map((t=>t-r)),g=i(t(f,h,3));a.push({position:f,faces:g}),c+=f.length,l+=g.length}const f=function(t,n,o){if(1===t.length)return t[0];const e=r(n),s=new Array(o);let a=0,c=0,l=0;for(const n of t){for(let t=0;t<n.position.length;t++)e[a++]=n.position[t];for(const t of n.faces)s[c++]=t+l;l=a/3}return{position:e,faces:i(s)}}(a,c,l),h=Array.isArray(f.position)?p(f.position,3,{originalIndices:f.faces}):p(f.position.buffer,6,{originalIndices:f.faces});return f.position=s(new Float64Array(h.buffer)),f.faces=h.indices,f}function y(t,n,o,e){const s=t.length,i=new Array(s),a=new Array(s),c=new Array(s);let l=0;for(let n=0;n<s;++n)l+=t[n].length;let f=0,h=0,g=0;const u=r(3*l);let p=0;for(let r=s-1;r>=0;r--){const l=t[r],m=o===w.CCW_IS_HOLE&&I(l,n,e);if(m&&1!==s)i[f++]=l;else{let t=l.length;for(let n=0;n<f;++n)t+=i[n].length;const o={index:p,pathLengths:new Array(f+1),count:t,holeIndices:new Array(f)};o.pathLengths[0]=l.length,l.length>0&&(c[g++]={index:p,count:l.length}),p=m?j(l,l.length-1,-1,u,p,l.length,n):j(l,0,1,u,p,l.length,n);for(let t=0;t<f;++t){const e=i[t];o.holeIndices[t]=p,o.pathLengths[t+1]=e.length,e.length>0&&(c[g++]={index:p,count:e.length}),p=j(e,0,1,u,p,e.length,n)}f=0,o.count>0&&(a[h++]=o)}}for(let t=0;t<f;++t){const o=i[t];o.length>0&&(c[g++]={index:p,count:o.length}),p=j(o,0,1,u,p,o.length,n)}return a.length=h,c.length=g,{position:u,polygons:a,outlines:c}}function j(t,n,o,e,s,r,i){s*=3;for(let a=0;a<r;++a){const r=t[n];e[s++]=r[0],e[s++]=r[1],e[s++]=i&&r[2]?r[2]:0,n+=o}return s/3}function I(t,e,s){if(!e)return!o(t);switch(m(t,t.length-1,s)){case n.X:return!o(t,n.Y,n.Z);case n.Y:return!o(t,n.X,n.Z);case n.Z:return!o(t,n.X,n.Y)}}var w;!function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"}(w||(w={}));export{w as C,m as l,y as r,A as t};
