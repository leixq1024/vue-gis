/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import"../core/lang.js";import{c as t}from"./mathUtils.js";export{c as createEmptyImageData}from"./imageUtils.js";import"../request.js";import"../config.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/Error.js";import"./Logger.js";import"../core/JSONSupport.js";import"./tslib.es6.js";import"../core/Accessor.js";import"../core/Handles.js";import"./maybe.js";import"../core/accessorSupport/decorators/subclass.js";import"./metadata.js";import"./utils.js";import"./handleUtils.js";import"./tracking.js";import"./ensureType.js";import"../core/accessorSupport/decorators/property.js";import"./ObservableBase.js";import"../core/scheduling.js";import"../core/promiseUtils.js";function i(i,o){const{format:e,quality:h,rotation:r,disableDecorations:a}=i||{},n=f(i,o.padding),l=function(t,i){const o={x:0,y:0,width:i.width,height:i.height};if(t?.area){null!=t.area.x&&(o.x=Math.floor(t.area.x)),null!=t.area.y&&(o.y=Math.floor(t.area.y));const e=null!=t.area.width?Math.floor(t.area.width):null,h=null!=t.area.height?Math.floor(t.area.height):null;if(o.width=i.width-o.x,o.height=i.height-o.y,null!=e&&null!=h)o.width=Math.min(o.width,e),o.height=Math.min(o.height,h);else if(null==e&&null!=h){const t=Math.min(o.width,e);o.height=t/o.width*o.height,o.width=t}else if(null!=e&&null==h){const t=Math.min(o.height,h);o.width=t/o.height*o.width,o.height=t}}return function(t,i){const o=Math.floor(Math.max(t.x,0)),e=Math.floor(Math.max(t.y,0)),h={x:o,y:e,width:Math.floor(Math.min(t.width,i.width-o)),height:Math.floor(Math.min(t.height,i.height-e))},r=h.width/h.height,a=t.width/t.height;if(a===r)return h;if(a>r){const t=Math.floor(h.width/a),i=h.height-t;return{x:h.x,y:Math.floor(h.y+i/2),width:h.width,height:t}}const n=Math.floor(h.height*a),l=h.width-n;return{x:Math.floor(h.x+l/2),y:h.y,width:n,height:h.height}}(function(t,i){if(null==i?.width||null==i.height)return t;const o=i.width/i.height,e=t.width/t.height;if(e===o)return t;if(e<o){const i=Math.floor(t.height*o);return t.x-=(i-t.width)/2,t.width=i,t}const h=Math.floor(t.width/o);return t.y-=(h-t.height)/2,t.height=h,t}(o,t),i)}(i,{width:o.width-n.left-n.right,height:o.height-n.top-n.bottom}),{width:g,height:s}=function(t,i){if(!t)return i;const o=t.width,e=t.height;if(null!=o&&null!=e)return{width:Math.floor(o),height:Math.floor(e)};if(null==o&&null==e)return i;const h=i.width/i.height;return null==e?{width:Math.floor(o),height:Math.floor(o/h)}:{width:Math.floor(e*h),height:Math.floor(e)}}(i,l),u=m(e),c=M[u];return{format:u,quality:t(null!=h?h:c,0,100),area:l,width:g,height:s,rotation:r,disableDecorations:!!a,ignoreBackground:!!i?.ignoreBackground,ignorePadding:!!i?.ignorePadding}}function o(t,o){const e=i(t,o),h=e.area,r=e.width/h.width,a=f(e,o.padding),n=a.left+a.right,l=a.top+a.bottom,g=o.width-n,s=o.height-l,u=Math.floor(g*r+n),c=Math.floor(s*r+l),d=t?.layers??[],m=e.ignoreBackground,p=e.ignorePadding;return{framebufferWidth:u,framebufferHeight:c,region:{x:Math.floor(h.x*r)+a.left,y:Math.floor(h.y*r)+a.top,width:e.width,height:e.height},format:e.format,quality:e.quality,rotation:e.rotation,pixelRatio:r,layers:d,disableDecorations:e.disableDecorations,ignoreBackground:m,ignorePadding:p,objectAndLayerIdColor:!1}}function e(t,i,o){const{ctx:e,canvas:h}=r(t,o),n=e.getImageData(0,0,t.width,t.height),g=l(h,i);return a(h),{dataUrl:g,data:n}}function h(t,i){const{ctx:o,canvas:e}=r(t,i),h=o.getImageData(0,0,t.width,t.height);return a(e),h}function r(t,i){const o=(null==n&&(n=document.createElement("canvas")),n);i.premultipliedAlpha&&function(t){const i=t.data,o=i.length;for(let t=0;t<o;t+=4){const o=i[t+3];if(255!==o&&o>0){const e=255/o;i[t]=i[t]*e,i[t+1]=i[t+1]*e,i[t+2]=i[t+2]*e}}}(t),o.width=t.width,o.height=t.height;const e=o.getContext("2d",{willReadFrequently:!0});return e.putImageData(t,0,0),i.flipY&&function(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}(e),{ctx:e,canvas:o}}function a(t){t.width=0,t.height=0}let n=null;function l(t,i){const o=p[i.format],e=i.quality/100;return t.toDataURL(o,e)}function g(i,o){const e=m(i),h=M[e];return{format:e,quality:t(null!=o?o:h,0,100)}}function s(t,i){return i/Math.max(t[0],t[1])}function u(t,i,o,e=0,h=0,r=t.width-e,a=t.height-h,n=!1){const{data:l}=t,{width:g,height:s,data:u}=i,c=r/g,d=a/s,f=Math.ceil(c/2),m=Math.ceil(d/2),p=t.width;for(let t=0;t<s;t++)for(let i=0;i<g;i++){const r=4*(i+(n?s-t-1:t)*g);let a=0,w=0,M=0,j=0,y=0,x=0;const b=(t+.5)*d;for(let r=Math.floor(t*d);r<(t+1)*d;r++){const t=Math.abs(b-(r+.5))/m,n=(i+.5)*c,g=t*t;for(let t=Math.floor(i*c);t<(i+1)*c;t++){const i=Math.abs(n-(t+.5))/f,s=Math.sqrt(g+i*i);if(s>=1)continue;let u=2*s*s*s-3*s*s+1;const c=4*(e+t+(h+r)*p);x+=u*l[c+3],w+=u,!o&&l[c+3]<255&&(u=u*l[c+3]/255),M+=u*l[c],j+=u*l[c+1],y+=u*l[c+2],a+=u}}u[r]=M/a,u[r+1]=j/a,u[r+2]=y/a,u[r+3]=x/w}return i}function d(t,i,o){if(!i)return t;const{framebufferWidth:e,framebufferHeight:h,pixelRatio:r,region:a}=t,n=f(t,o),l=n.left+n.right,g=n.top+n.bottom,s=e-l,u=h-g,c=Math.min(8,Math.min((2048-l)/s,(2048-g)/u));return c<1.5?t:{...t,framebufferWidth:Math.round(s*c)+l,framebufferHeight:Math.round(u*c)+g,pixelRatio:r*c,resample:{region:{x:Math.round((a.x-n.left)*c)+n.left,y:Math.round((a.y-n.top)*c)+n.top,width:Math.round(a.width*c),height:Math.round(a.height*c)},width:e,height:h}}}function f(t,i){return!i||t?.ignorePadding?j:i}function m(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return w}}const p={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},w="png",M={png:100,jpg:98,jpeg:98},j={top:0,right:0,bottom:0,left:0};export{i as completeUserSettings,e as encode,h as encodeData,g as getFormatAndQuality,s as getMaximumResolutionScale,u as resampleHermite,d as screenshotSuperSampleSettings,l as toDataUrl,o as toRenderSettings};
