/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import t from"../Color.js";import{getVisualVariableValues as e}from"./visualVariableUtils.js";function o(t,e){if(!t||t.symbol)return null;const o=e?.renderer;return t&&null!=o&&o.getObservationRenderer?o.getObservationRenderer(t):o}function r(t,r){const i=o(t,r),n=function(t,e){if(null!=t.symbol)return t.symbol;const r=o(t,e);return null!=r&&"dot-density"!==r.type?r.getSymbol(t,e):null}(t,r);if(null==n)return null;const l={renderer:i,symbol:n};if(null==i||!("visualVariables"in i)||!i.visualVariables)return l;const a=e(i,t,r)??[],s=["proportional","proportional","proportional"];for(const{variable:t,value:e}of a)switch(t.type){case"color":l.color=e.toRgba();break;case"size":if("outline"===t.target)l.outlineSize=e;else{const o=t.axis,r=t.useSymbolValue?"symbol-value":e;switch(o){case"width":s[0]=r;break;case"depth":s[1]=r;break;case"height":s[2]=r;break;case"width-and-depth":s[0]=s[1]=r;break;default:s[0]=s[1]=s[2]=r}}break;case"opacity":l.opacity=e;break;case"rotation":switch(t.axis){case"tilt":l.tilt=e;break;case"roll":l.roll=e;break;default:l.heading=e}}return"proportional"===s[0]&&"proportional"===s[1]&&"proportional"===s[2]||(l.size=s),l}async function i(r,i){const n=o(r,i),l=await async function(t,e){if(null!=t.symbol)return t.symbol;const r=o(t,e);return null!=r?r.getSymbolAsync(t,e):null}(r,i);if(!l)return null;const a={renderer:n,symbol:l};if(!n||!("visualVariables"in n)||!n.visualVariables)return a;const s=e(n,r,i)??[],u=["proportional","proportional","proportional"];for(const{variable:e,value:o}of s)if("color"===e.type)a.color=t.toUnitRGBA(o);else if("size"===e.type)if("outline"===e.target)a.outlineSize=o;else{const t=e.axis,r=e.useSymbolValue?"symbol-value":o;"width"===t?u[0]=r:"depth"===t?u[1]=r:"height"===t?u[2]=r:u[0]=u[1]="width-and-depth"===t?r:u[2]=r}else"opacity"===e.type?a.opacity=o:"rotation"===e.type&&"tilt"===e.axis?a.tilt=o:"rotation"===e.type&&"roll"===e.axis?a.roll=o:"rotation"===e.type&&(a.heading=o);return(isFinite(u[0])||isFinite(u[1])||isFinite(u[2]))&&(a.size=u),a}function n(t,e=0){const o=t[e];return"number"==typeof o&&isFinite(o)?o:null}function l(t){for(let e=0;e<3;e++){const o=t[e];if("number"==typeof o)return isFinite(o)?o:0}return 0}export{i as a,n as b,l as c,r as g};
