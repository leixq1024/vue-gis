/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import e from"../request.js";import t from"../core/Error.js";import{h as r}from"../core/lang.js";import{throwIfAbortError as o}from"../core/promiseUtils.js";import{removeFile as s,normalize as n}from"../core/urlUtils.js";import l from"../portal/Portal.js";import a from"../portal/PortalQueryParams.js";const f=new Map;function u(e,r,n){return null!=e?.styleUrl?async function(e,t){try{return{data:(await m(e,t)).data,baseUrl:s(e),styleUrl:e}}catch(e){return o(e),null}}(e.styleUrl,n):null!=e?.styleName?function(e,r,o){const s=null!=r.portal?r.portal:l.getDefault();let n;const u=`${s.url} - ${s.user?.username} - ${e}`,c=f.get(u);if(c)return c;const i=function(e,r,o){return r.load(o).then((()=>{const t=new a({disableExtraQuery:!0,query:`owner:${y} AND type:${p} AND typekeywords:"${e}"`});return r.queryItems(t,o)})).then((({results:r})=>{let s=null;const n=e.toLowerCase();if(r&&Array.isArray(r))for(const e of r){const t=e.typeKeywords?.some((e=>e.toLowerCase()===n));if(t&&e.type===p&&e.owner===y){s=e;break}}if(!s)throw new t("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(o)}))}(e,s,o).then((e=>(n=e,e.fetchData()))).then((t=>({data:t,baseUrl:n.itemUrl??"",styleName:e})));return f.set(u,i),i}(e.styleName,r,n):Promise.reject(new t("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function c(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}}function i(e,t,o=["gltf"]){if("cimRef"===t)return encodeURI(e.cimRef);if(e.formatInfos&&!r("enable-feature:force-wosr"))for(const t of o){const r=e.formatInfos.find((e=>e.type===t));if(r)return r.href}return encodeURI(e.webRef)}function m(t,r){const o={responseType:"json",query:{f:"json"},...r};return e(n(t),o)}const y="esri_en",p="Style",d="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";export{d as S,u as f,c as m,m as r,i as s};
