/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as t}from"./tslib.es6.js";import{z as e,d as i,t as a,c as o,f as s,g as n,e as r,b as l}from"./quantityUtils.js";import{property as u}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import"./Logger.js";import{subclass as c}from"../core/accessorSupport/decorators/subclass.js";import{g as p}from"../geometry/Point.js";import{m,s as h,b as f,f as d,c as g,d as v,e as y}from"../views/interactive/Tooltip.js";import k from"../core/Accessor.js";import{g as b}from"./uuid.js";import{f as I}from"./quantityFormatUtils.js";import{b as x,c as A,D as w}from"./angularMeasurementUtils.js";import{s as L}from"./geodesicMeasurementUtils.js";import{c as U,e as V}from"./euclideanAreaMeasurementUtils.js";import{g as F}from"./geodesicAreaMeasurementUtils.js";let M=class extends k{constructor(t){super(t),this.actual=null,this.lockable=!0,this.id=b(),this.inputValue=null,this.readOnly=!1,this.suffix=null,this.visible=!0,this.invalid=!1,this.unlockOnVertexPlacement=!0}get committed(){return this.lockable?this._get("committed"):null}set committed(t){this.lockable&&this._set("committed",t)}get dirty(){return null!=this.inputValue}get locked(){return this.lockable&&null!=this.committed}onInput(t){this.inputValue=t}onCommit(t,e,i){this.lockable?this._onCommitLockable(t,i):this._onCommitNonLockable(i),this.invalid&&"commit-and-exit"===t||i.onCommit(e,t)}_onCommitLockable(t,e){const{inputValue:i,locked:a}=this;a&&_(i)?this.unlock():("commit-and-exit"===t&&!a||null!=i)&&this._parseInputAndLock(e)}_onCommitNonLockable(t){const{inputValue:e}=this;_(e)?this.setActual(null):null!=e&&this._parseInputAndSetActual(t)}applyValue(t){this.lockable?this.lock(t):this.setActual(t)}clearInputValue(){this.inputValue=null,this.invalid=!1}setActual(t){this.actual=t,this.clearInputValue()}lock(t){this.lockable&&(this.committed=t??this.actual,this.clearInputValue())}unlock(){this.lockable&&(this.committed=null,this.clearInputValue())}toggleLock(t){this.lockable&&(this.locked?this.unlock():this._parseInputAndLock(t))}getSuffix(t){const{suffix:e}=this;return"function"==typeof e?e(t):e}getFormattedValue(t){const{actual:e,committed:i,format:a}=this;return null!=i?a(i,t):null!=e?a(e,t):null}getRawDisplayValue(t){const{actual:e,committed:i,inputValue:a}=this;return null!=a?a:this.lockable&&null!=i?this.formatForInputMode(i,t):null!=e?this.formatForInputMode(e,t):null}_parseInputAndSetActual(t){const{inputValue:e}=this;if(null==e||_(e))return this.setActual(null);const i=this.parse(e,t);null!=i?this.setActual(i):this.invalid=!0}_parseInputAndLock(t){const{inputValue:e,actual:i}=this;if(_(e))return this.unlock();if(null==e)return this.lock(i);const a=this.parse(e,t);null!=a?this.lock(a):this.invalid=!0}};function _(t){return null!=t&&""===t.trim()}t([u()],M.prototype,"actual",void 0),t([u()],M.prototype,"committed",null),t([u()],M.prototype,"dirty",null),t([u()],M.prototype,"format",void 0),t([u()],M.prototype,"formatForInputMode",void 0),t([u()],M.prototype,"lockable",void 0),t([u()],M.prototype,"locked",null),t([u()],M.prototype,"id",void 0),t([u()],M.prototype,"inputValue",void 0),t([u()],M.prototype,"name",void 0),t([u()],M.prototype,"parse",void 0),t([u()],M.prototype,"readOnly",void 0),t([u()],M.prototype,"suffix",void 0),t([u()],M.prototype,"title",void 0),t([u()],M.prototype,"visible",void 0),t([u()],M.prototype,"invalid",void 0),t([u()],M.prototype,"unlockOnVertexPlacement",void 0),M=t([c("esri.views.interactive.tooltip.fields.TooltipField")],M);let j=class extends M{constructor(t){super(t),this.showAsZ=!1}normalizeCtorArgs(t){const o=t=>t.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:e,parse:m({createQuantity:(t,e)=>i(t,o(e))}),format:(t,e)=>e.formatters.verticalLength(t),formatForInputMode:(t,e)=>e.formatters.scalar(a(t,o(e))),suffix:t=>t.inputUnitInfos.verticalLength.abbreviation,title:t=>t.messages.sketch[this.showAsZ?"z":"elevation"],unlockOnVertexPlacement:!1,...t}}};t([u()],j.prototype,"showAsZ",void 0),j=t([c("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],j);let z=class extends M{constructor(t){super(t),this.precision=1}normalizeCtorArgs(t){return{name:"orientation",actual:null,parse:m({createQuantity:(t,e)=>o(t,(t=>t.inputUnitInfos.angle.unit)(e),"geographic"),sanitize:h}),format:t=>{const e=x(t);return I(e,"geographic",this.precision)},formatForInputMode:(t,e)=>{const i=x(t);return e.formatters.scalar(i)},suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.orientation,...t}}};t([u()],z.prototype,"precision",void 0),z=t([c("esri.views.interactive.tooltip.fields.TooltipFieldOrientation")],z);let C=class extends M{constructor(t){super(t),this.precision=null}normalizeCtorArgs(t){const e=t=>t.inputUnitInfos.length.unit;return{name:"size",actual:null,parse:m({createQuantity:(t,a)=>i(t,e(a))}),format:(t,e)=>e.formatters.length(t),formatForInputMode:(t,i)=>i.formatters.scalar(a(t,e(i))),suffix:t=>t.inputUnitInfos.length.abbreviation,title:t=>t.messages.sketch.size,...t}}};function O(t){const e=t=>t.inputUnitInfos.angle.unit,i=t=>t.sketchOptions.values.effectiveDirectionMode;return new M({name:"direction",actual:s,parse:m({createQuantity:(t,i)=>o(t,e(i),"geographic"),sanitize:h}),format:(t,e)=>{const a=i(e),o=A(t,a);switch(a){case w.Absolute:return e.formatters.direction(o);case w.Relative:return e.formatters.directionRelative(o);case w.RelativeBilateral:return e.formatters.directionRelativeBilateral(o)}},formatForInputMode:(t,o)=>{const s=A(t,i(o));return o.formatters.scalar(a(s,e(o)))},suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>{const e=i(t),{absolute:a,relative:o}=t.messages.sketch.direction;switch(e){case w.Absolute:return a;case w.Relative:case w.RelativeBilateral:return o}},...t})}function Q(t){const o=t=>t.inputUnitInfos.length.unit;return new M({name:"distance",actual:e,parse:m({createQuantity:(t,e)=>i(Math.max(t,0),o(e))}),format:(t,e)=>e.formatters.length(t),formatForInputMode:(t,e)=>e.formatters.scalar(a(t,o(e))),suffix:t=>t.inputUnitInfos.length.abbreviation,title:t=>t.messages.sketch.distance,...t})}function R(t){return Q({format:(t,e)=>e.formatters.totalLength(t),title:t=>t.messages.sketch.totalLength,readOnly:!0,...t})}function D(t){return Q({...t})}function T(t){return Q({...t,parse:m({createQuantity:(t,e)=>i(t,(t=>t.inputUnitInfos.length.unit)(e))}),format:(t,e)=>e.formatters.lengthRelative(t)})}function S(t){return new z(t)}function P(t){return new C(t)}function X(t){return B("scale",{name:"scale",actual:null,parse:m({createQuantity:t=>r(Math.abs(t))}),...t})}function Y(t){const e=t=>t.inputUnitInfos.area.unit;return new M({name:"area",actual:n,parse:m({createQuantity:(t,i)=>l(t,e(i))}),format:(t,e)=>e.formatters.area(t),formatForInputMode:(t,i)=>i.formatters.scalar(a(t,e(i))),suffix:t=>t.inputUnitInfos.area.abbreviation,title:t=>t.messages.sketch.area,readOnly:!0,...t})}function B(t,e){return new M({actual:r(0),parse:m({createQuantity:t=>r(t)}),format:(t,e)=>e.formatters.scalar(t),formatForInputMode:(t,e)=>e.formatters.scalar(t),title:e=>e.messages.sketch[t],...e})}t([u()],C.prototype,"precision",void 0),C=t([c("esri.views.interactive.tooltip.fields.TooltipFieldSize")],C);const Z=e=>{let i=class extends e{constructor(){super(...arguments),this.longitude=new M({name:"x",actual:s,parse:f,format:(t,e)=>e.formatters.longitudeDecimalDegrees(t),formatForInputMode:t=>d(t),suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.longitude}),this.latitude=new M({name:"y",actual:s,parse:g,format:(t,e)=>e.formatters.latitudeDecimalDegrees(t),formatForInputMode:t=>v(t),suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.latitude}),this.x=B("x",{name:"x"}),this.y=B("y",{name:"y"}),this.elevation=new j(void 0),this.geographic=!1}get effectiveX(){return this.geographic?this.longitude:this.x}get effectiveY(){return this.geographic?this.latitude:this.y}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic}}setLocationFromPoint(t,e=t?.spatialReference){if(this.geographic=!!e&&L(e),null==t)return this._setActualLonLat(null,null),void this._setActualXY(null,null);if(this.geographic){const e=p(t,q);this._setActualLonLat(y(e?.[0]),y(e?.[1]))}else this._setActualXY(r(t.x),r(t.y))}_setActualLonLat(t,e){this.longitude.actual=t,this.latitude.actual=e}_setActualXY(t,e){this.x.actual=t,this.y.actual=e}};return t([u()],i.prototype,"geographic",void 0),t([u()],i.prototype,"effectiveX",null),t([u()],i.prototype,"effectiveY",null),t([u()],i.prototype,"key",null),i=t([c("esri.views.interactive.tooltip.infos.TooltipInfoWithCoordinates")],i),i},q=[0,0];function N(t,e=U()){return function(t,e,i=U()){{const e=F(t);return null!=e?e:V(t,i)}}(t,0,e)}export{Z as T,R as a,N as b,S as c,X as d,O as e,D as f,T as g,P as h,Y as m};
