/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{g as t,o as e}from"./vec2.js";import{c as a}from"./vec2f64.js";import{O as r}from"./vec4f64.js";import{t as n}from"./unitUtils.js";import{l as o}from"./projectBuffer.js";import{h as i}from"./aaBoundingBox.js";import{G as s,n as u}from"./StencilUtils.js";import{g as l}from"./Indices.js";import{V as c}from"./ViewingMode.js";import{A as f}from"./Attribute.js";import{C as p}from"./Material.js";import{V as m}from"./VertexAttribute.js";function h(a,h,D=null){const E=[],g=h.mapPositions;!function(t,e){const{attributeData:{position:a},removeDuplicateStartEnd:r}=t,n=function(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}(a)&&r,o=a.length/3-(n?1:0),i=new Array(2*(o-1)),s=n?a.slice(0,-3):a;let u=0;for(let t=0;t<o-1;t++)i[u++]=t,i[u++]=t+1;e.push([m.POSITION,new f(s,i,3,n)])}(h,E);const A=E[0][1].data,I=E[0][1].indices.length,j=l(I);return function(t,e,a){if(null!=t.attributeData.colorFeature)return;const n=t.attributeData.color;e.push([m.COLOR,new f(n??r,a,4)])}(h,E,j),function(t,e,a){null==t.attributeData.sizeFeature&&e.push([m.SIZE,new f([t.attributeData.size??1],a,1,!0)])}(h,E,j),function(t,e,a){t.attributeData.normal&&e.push([m.NORMAL,new f(t.attributeData.normal,a,3)])}(h,E,j),function(t,e,a){null!=t.attributeData.colorFeature&&e.push([m.COLORFEATUREATTRIBUTE,new f([t.attributeData.colorFeature],a,1,!0)])}(h,E,j),function(t,e,a){null!=t.attributeData.sizeFeature&&e.push([m.SIZEFEATUREATTRIBUTE,new f([t.attributeData.sizeFeature],a,1,!0)])}(h,E,j),function(t,e,a){null!=t.attributeData.opacityFeature&&e.push([m.OPACITYFEATUREATTRIBUTE,new f([t.attributeData.opacityFeature],a,1,!0)])}(h,E,j),function(a,r,s){if(null==a.overlayInfo||a.overlayInfo.renderCoordsHelper.viewingMode!==c.Global||!a.overlayInfo.spatialReference.isGeographic)return;const l=i(s.length),p=n(a.overlayInfo.spatialReference);for(let t=0;t<l.length;t+=3)o(s,t,l,t,p);const h=s.length/3,D=u(h+1);let E=T,g=b,A=0,I=0;t(E,l[I++],l[I++]),I++,D[0]=0;for(let a=1;a<h+1;++a)a===h&&(I=0),t(g,l[I++],l[I++]),I++,A+=e(E,g),D[a]=A,[E,g]=[g,E];r.push([m.DISTANCETOSTART,new f(D,r[0][1].indices,1,!0)])}(h,E,A),new s(a,E,g,p.Line,D)}const T=a(),b=a();function D(t,e){if(null==t||0===t.length)return[];const a=[];return t.forEach((t=>{const r=t.length,n=i(3*r);t.forEach(((t,e)=>{n[3*e]=t[0],n[3*e+1]=t[1],n[3*e+2]=t[2]}));const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};a.push(o)})),a}export{h as c,D as l};
