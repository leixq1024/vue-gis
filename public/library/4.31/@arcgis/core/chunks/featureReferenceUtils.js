/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{j as e,h as t,k as r}from"./vec3.js";import{c as n}from"./vec3f64.js";import{c as l,f as o}from"./ray.js";import{S as a}from"./intersectorUtils.js";import{t as s,h as u,g as i}from"./intersectorUtilsConversions.js";function c(e,t){return d(e)===d(t)}function d(e){if(null==e)return null;const t=null!=e.layer?e.layer.id:"";let r=null;return r=null!=e.objectId?e.objectId:null!=e.layer&&"objectIdField"in e.layer&&null!=e.layer.objectIdField&&null!=e.attributes?e.attributes[e.layer.objectIdField]:e.uid,null==r?null:`o-${t}-${r}`}const f={json:{write:{writer:function(e,t){null!=e?.layer?.objectIdField&&null!=e.attributes&&(t.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})},target:{"feature.layerId":{type:[Number,String]},"feature.objectId":{type:[Number,String]}}},origins:{"web-scene":{read:function(e){if(null!=e.layerId&&null!=e.objectId)return{uid:null,layer:{id:e.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:e.objectId}}}}}}};function I(l,u,i,c){const{sceneIntersectionHelper:f}=l,{observer:I,observerFeatureId:j,targetFeatureId:g,target:p}=i;if(null==j&&null==g)return;c||(c=e=>e),e(y,I,p);const S=t(y);r(y,I,y,1/S);const v=o(y,p,m);u.options.store=a.ALL,f.intersectToolIntersectorRay(v,u);let F=null,N=null,R=null,h=null;for(const e of u.results.all){const t=s(e,l);if(null==t||null==e.distanceInRenderSpace)continue;const r=d(t);null!=r&&(null!=j&&r===j&&(F??=c(b(e,l,S)),e.distanceInRenderSpace-1<F&&(R=e)),null!=g&&r===g&&(N??=c(b(e,l,S)),null==h&&e.distanceInRenderSpace-1<S&&S-e.distanceInRenderSpace+1<N&&(h=e)))}const{observerAdjusted:w,targetAdjusted:A}=i;R?.getIntersectionPoint(w)?i.observerSurfaceNormal=R.getTransformedNormal(n()):i.observerSurfaceNormal=null,h?.getIntersectionPoint(A)?i.targetSurfaceNormal=h.getTransformedNormal(n()):i.targetSurfaceNormal=null}function b(e,t,r){if(u(e)){const n=i(e,t);if(null!=n)return Math.min(n*j,r)}return 1e-5*r}const j=.05,m=l(),y=n();export{f as a,c as f,d as g,I as u};
