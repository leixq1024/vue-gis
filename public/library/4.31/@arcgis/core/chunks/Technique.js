/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{D as t,U as s}from"./enums.js";import{B as e}from"./BufferObject.js";import{V as r}from"./VertexArrayObject.js";import{V as o}from"./VertexElementDescriptor.js";import{W as n}from"./featureTechniqueUtils.js";const i={[t.BYTE]:1,[t.UNSIGNED_BYTE]:1,[t.SHORT]:2,[t.UNSIGNED_SHORT]:2,[t.HALF_FLOAT]:2,[t.INT]:4,[t.UNSIGNED_INT]:4,[t.FLOAT]:4};class a{constructor(n,i){this._boundPart=null,this.vertexBuffers=new Map;for(const[t,r]of Object.entries(i.vertex)){const o=e.createVertex(n,s.STATIC_DRAW,r);this.vertexBuffers.set(t,o)}const a=new Map;for(const[t,r]of Object.entries(i.index??{})){const o=e.createIndex(n,s.STATIC_DRAW,r);a.set(t,o)}this.groups=[];for(const s of i.groups){let e;if(null!=s.index){if(!i.index?.[s.index])throw new Error("No index data.");const{BYTES_PER_ELEMENT:r}=i.index[s.index];2===r?e=t.UNSIGNED_SHORT:4===r&&(e=t.UNSIGNED_INT)}const u=null!=s.index?a.get(s.index):null,c=new Map,d=new Map;for(const t of s.attributes){const{name:s,count:e,type:r,offset:n,normalized:i,divisor:a,stride:u,vertex:p,location:l}=t;let f=d.get(p);f||(f=[],d.set(p,f));const h=new o(s,e,r,n,u,i,a);f.push(h),c.set(s,l)}const p=new r(n,c,d,this.vertexBuffers,u);this.groups.push({...s,vertexArray:p,locations:c,layout:d,indexing:e})}this.parts=i.parts}bind(t,s){this._boundPart=s;const{group:e}=this.parts[this._boundPart],{vertexArray:r}=this.groups[e];t.bindVAO(r)}draw(t){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:s,count:e}=this.parts[this._boundPart],{group:r}=this.parts[this._boundPart],{indexing:o,primitive:n}=this.groups[r];o?t.drawElements(n,e,o,s*i[o]):t.drawArrays(n,s,e)}unbind(t){this._boundPart=null,t.bindVAO(null)}destroy(){for(const{vertexArray:t}of this.groups)t.dispose()}}function u(t){return t.locationsMap}const c={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};class d{constructor(){this.drawPhase=n.MAP|n.HITTEST|n.HIGHLIGHT|n.DEBUG}startup(){}shutdown(t){}}export{a as M,d as T,i as d,u as g,c as s};
