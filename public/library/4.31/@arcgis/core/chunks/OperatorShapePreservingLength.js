/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{x as e,t,G as s,c as n,P as o,e as a}from"./Transformation2D.js";import{O as r,aw as i,p as c,at as g,ax as m,H as u,a as h,b as y,ae as p,a3 as x,ao as l}from"./converterAPI.js";function _(){return{m_pGcs:new o,m_xyz:new l,m_factor:Number.NaN,m_geoLength:Number.NaN,setValues:f,setLength:S,assign:d}}function f(e,t,s,n){this.m_factor=e,this.m_pGcs.assign(t),this.m_xyz.assign(n),this.m_geoLength=s}function S(e){this.m_geoLength=e}function d(e){this.m_pGcs.assign(e.m_pGcs),this.m_xyz.assign(e.m_xyz),this.m_factor=e.m_factor,this.m_geoLength=e.m_geoLength}class w{getOperatorType(){return 10315}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}_ExecuteShapePreservingLength(e,t,s,n,o){if(e.hasNonLinearSegments()&&(e=(new r).execute(e,0,t.getTolerance(0),0,o)),t.isPannable()){let n=90,a=-90;if(1===s.getUnit().getUnitToBaseFactor()&&(n*=Math.PI/180,a*=Math.PI/180),2===t.getCoordinateSystemType()){let e=null;const s=[0,0,0,0];e=t.getPECoordSys(),s[0]=0,s[1]=n,s[2]=0,s[3]=a,i.geogToProj(e,2,s),n=s[1],a=s[3]}const r=new c;e.queryEnvelope(r),r.ymin=a,r.ymax=n,e=(new g).execute(e,r,t,o)}else{const s=t.getPCSHorizon();if((e=(new m).execute(e,s,t,o))===s){const t=e.clone();e=t}}return e.isEmpty()?0:this._ExecuteIterativeApproach(e,t,s,n,1,o)}_ExecuteIterativeApproach(t,s,n,r,c,g){const m=x();n.querySpheroidData(m);const u=m.majorSemiAxis,h=m.e2,y=n.getUnit().getUnitToBaseFactor(),p=e(_,40),f=new Array(40),S=_(),d=_();let w;const E=[0,0,0,0],N=s.getPECoordSys(),G=new o,L=new o,T=new o,v=new o,b=new o;let z=0;const D=t.querySegmentIterator();for(;D.nextPath();)for(;D.hasNextSegment();){const e=D.nextSegment();G.assign(e.getStartXY()),L.assign(e.getEndXY()),2===s.getCoordinateSystemType()?(E[0]=G.x,E[1]=G.y,E[2]=L.x,E[3]=L.y,i.projToGeog(N,2,E),T.x=E[0]*y,T.y=E[1]*y,v.x=E[2]*y,v.y=E[3]*y):(T.setCoordsPoint2D(G),v.setCoordsPoint2D(L),T.scale(y),v.scale(y));const t=new l,n=new l;P(u,h,T,t),P(u,h,v,n);let o=C(u,t,n);S.setValues(0,T,Number.NaN,t),d.setValues(1,v,o,n),w=c,p[0].assign(d),f[0]=c;let r=0;for(;;){r>128&&a("iterations exceeded");const t=.5*(S.m_factor+d.m_factor),n=e.getCoord2D(t);2===s.getCoordinateSystemType()?(E[0]=n.x,E[1]=n.y,i.projToGeog(N,1,E),b.x=E[0]*y,b.y=E[1]*y):(b.setCoordsPoint2D(n),b.scale(y)),T.setCoordsPoint2D(S.m_pGcs),v.setCoordsPoint2D(d.m_pGcs);const g=new l;P(u,h,b,g);const m=C(u,S.m_xyz,g),x=C(u,d.m_xyz,g);o=d.m_geoLength,Number.isNaN(o)&&(o=C(u,S.m_xyz,d.m_xyz));const _=m+x,G=w===c&&_>=20&&Math.abs(_-o)>1e-8*(o+_);if(r+2<40&&(G||Math.abs(_-o)>0&&w>0))d.setLength(x),p[r].assign(d),d.setValues(t,b,m,g),p[++r].assign(d),G?(w=c,f[r]=c):(w--,f[r-1]=w,f[r]=w);else{if(z+=_,0===r)break;S.assign(d),d.assign(p[--r]),w=f[r]}}}return z}execute(e,o,a){if(o&&0!==o.getCoordinateSystemType()||t(""),e.isEmpty()||e.getDimension()<1)return 0;let r=null;const i=o.getGCS();i!==o&&(r=u(o,i,null));const c=e.getGeometryType();if(c===s.enumEnvelope){const t=new h;return t.addEnvelope(e,!1),this._ExecuteShapePreservingLength(t,o,i,r,a)}if(n(c)){const t=new y;return t.addSegment(e,!0),this._ExecuteShapePreservingLength(t,o,i,r,a)}return this._ExecuteShapePreservingLength(e,o,i,r,a)}}function P(e,t,s,n){n.assign(p(e,t,s))}function C(e,t,s){const n=e,o=new l;o.setSub(t,s);const a=o.length();return 2*n*Math.asin(a/(2*n))}export{w as O};
