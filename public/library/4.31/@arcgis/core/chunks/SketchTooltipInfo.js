/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{c as t}from"./asyncUtils.js";import{h as e,m as o}from"./handleUtils.js";import{g as s}from"./mathUtils.js";import{c as n,e as a,v as r}from"./quantityUtils.js";import{watch as i}from"../core/reactiveUtils.js";import{b as l,v as u}from"./unitUtils.js";import{y as c,s as p,F as m}from"./vec3.js";import{a as f,O as d,c as v,d as y}from"./vec3f64.js";import{isLoaded as g,load as h}from"../geometry/coordinateFormatter.js";import"../geometry/Point.js";import j from"../geometry/support/MeshTransform.js";import{i as b}from"./meshVertexSpaceUtils.js";import{lngLatToXY as x}from"../geometry/support/webMercatorUtils.js";import{t as S}from"./keybindings.js";import w,{p as F,a as U}from"../views/interactive/Tooltip.js";import{g as M,a as k}from"./angularMeasurementUtils.js";import{_ as A}from"./tslib.es6.js";import V from"../core/Accessor.js";import{property as E}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import"./Logger.js";import{subclass as I}from"../core/accessorSupport/decorators/subclass.js";function O(t){const e=new w(t());return e.addHandles(i((()=>t()),(({view:t,options:o,info:s})=>{e.view=t,void 0!==o&&(e.options=o),void 0!==s&&(e.info=s)}))),e}function P(t,e){const o=b(e.vertexSpace),{scale:s,orientation:r}=t,{transform:i}=e,l=function(t){if(!t)return 0;const e=R(t.rotationAxis);return null!=e?e*t.rotationAngle:null}(i);o&&null!=l?(r.actual=n(l,"degrees","arithmetic"),r.visible=!0):(r.actual=null,r.visible=!1),o?(s.actual=a(B(i)),s.visible=!0):(s.actual=null,s.visible=!1)}function T(t,e,o){if(!e||!b(e.vertexSpace))return;const s=e.transform??=new j;!function(t,e,o){const s=M(t.orientation.actual),n=R(e.rotationAxis);if(null==s||null==n)return;const a=e.rotationAngle,r=s*n,i=(s-a)*n;a!==r&&(o?.onRotateStart(0),e.rotationAngle=r,o?.onRotate(i),o?.onRotateStop(i))}(t,s,o),function(t,e,o){const s=t.scale.actual?.value,n=B(e);if(null==s||s===n)return;const{scale:a}=e;let r;if(0===n)r=f(d);else{const t=s/n;r=p(v(),a,t)}o?.onScaleStart(a[0],a[1],a[2]),e.scale=r,o?.onScale(r[0],r[1],r[2]),o?.onScaleStop(r[0],r[1],r[2])}(t,s,o)}function z(t,e){const{x:o,y:n,z:a}=e,{x:i,y:c,z:p}=function(t,e){let o,s;t.geographic?(o=k(t.longitude.actual),s=k(t.latitude.actual),l(e)&&(null!=o&&null!=s?[o,s]=x(o,s,D):null!=o?o=x(o,0,D)[0]:null!=s&&(s=x(0,s,D)[1]))):(o=t.x.actual?.value,s=t.y.actual?.value);const n=t.elevation.actual,a=u(e);return{x:o,y:s,z:null!=a&&null!=n?r(n,a):void 0}}(t,e.spatialReference);return{dx:null==i||s(i,o)?0:i-o,dy:null==c||s(c,n)?0:c-n,dz:null==p||null==a||s(p,a)?0:p-a}}const D=[0,0];function R(t){return m(t,y)?1:m(t,q)?-1:null}const q=c(v(),y);function B(t){return t?Math.max(...t.scale):1}function H(t,e){return!("key-down"!==t.type||t.key!==S.enterInputMode||!e||!function(t){const e=t?.sketchOptions;if(!e)return!1;const{inputEnabled:o,visibleElements:s}=e.tooltips;return o&&!0===t.editableFields.some((({name:t})=>"x"===t||"y"===t?s.coordinates:s[t]))}(e.info)||(e.enterInputMode(),t.preventDefault(),t.stopPropagation(),0))}function L(s,n){let a=null;return e([s.on("paste",(async e=>{a?.abort(),a=t((async()=>{g()||await h(),_(e,s.info,n)}))})),t((()=>h())),o((()=>a?.abort()))])}function _(t,e,o){if(!e||!("geographic"in e))return;const s=t.clipboardData?.getData("text");if(!s)return;const n=e=>{t.stopPropagation(),t.preventDefault(),o?.onBeforePaste(),e(),o?.onAfterPaste()};if(e.geographic){const t=F(s);t&&n((()=>{e.longitude.applyValue(t.longitude),e.latitude.applyValue(t.latitude)}))}else{const t=U(s);t&&n((()=>{e.x.applyValue(t.x),e.y.applyValue(t.y)}))}}let C=class extends V{constructor(t){super(t),this.helpMessage=void 0,this.viewType=void 0}get visibleElements(){return this.sketchOptions.tooltips.visibleElements}get allFields(){return[]}get editableFields(){return this.allFields.filter((t=>t.visible&&!t.readOnly))}clearInputValues(){this.allFields.forEach((t=>t.clearInputValue()))}};A([E()],C.prototype,"sketchOptions",void 0),A([E()],C.prototype,"visibleElements",null),A([E()],C.prototype,"helpMessage",void 0),A([E()],C.prototype,"viewType",void 0),A([E()],C.prototype,"allFields",null),A([E()],C.prototype,"editableFields",null),C=A([I("esri.views.interactive.tooltip.infos.SketchTooltipInfo")],C);export{C as S,T as a,L as c,H as e,z as g,O as m,_ as p,P as u};
