/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import"../core/lang.js";import{L as e}from"./Logger.js";function n(e,n){for(const r of e.values())if(n(r))return!0;return!1}function r(e,n){for(const r of e.values())if(n(r))return r;return null}function t(e,n,r){const t=e.get(n);if(void 0!==t)return t;const o=r();return e.set(n,o),o}function o(e){const n=new Map;return r=>(n.has(r)||n.set(r,e(r)),n.get(r))}const u=()=>e.getLogger("esri.core.accessorSupport.ensureTypes");function a(e){return null==e?e:new Date(e)}function s(e){return null==e?e:!!e}function c(e){return null==e?e:e.toString()}function l(e,n=0){return null==e?e:(e=parseFloat(e),isNaN(e)?n:e)}function i(e){return null==e?e:Math.round(parseFloat(e))}function f(e){return null}function p(e,n){return r=>{let t=e(r);return null!=n.step&&(t=Math.round(t/n.step)*n.step),null!=n.min&&(t=Math.max(n.min,t)),null!=n.max&&(t=Math.min(n.max,t)),t}}function y(e){return e?.constructor&&void 0!==e.constructor.__accessorMetadata__}function v(e,n){return null!=n&&e&&!(n instanceof e)}function g(e){return e&&"isCollection"in e}function h(e){return e?.Type?"function"==typeof e.Type?e.Type:e.Type.base:null}function m(e,n){return!!y(n)&&(u().error("Accessor#set","Assigning an instance of '"+(n.declaredClass||"unknown")+"' which is not a subclass of '"+b(e)+"'"),!0)}function d(e,n){return null==n?n:g(e)?function(e,n){if(!n?.constructor||!g(n.constructor))return m(e,n)?n:new e(n);const r=h(e.prototype.itemType),t=h(n.constructor.prototype.itemType);return r?t?r===t?n:r.prototype.isPrototypeOf(t.prototype)?new e(n):(m(e,n),n):new e(n):n}(e,n):v(e,n)?m(e,n)?n:new e(n):n}function b(e){return e?.prototype?.declaredClass||"unknown"}const w=new WeakMap;function A(e,n){const r=function(e){switch(e){case Number:return e=>l(e);case _:return i;case Boolean:return s;case String:return c;case Date:return a;case B:return f;default:return t(w,e,(()=>d.bind(null,e)))}}(e);return 1===arguments.length?r:r(n)}function $(e,n,r){return 1===arguments.length?$.bind(null,e):n?Array.isArray(n)?n.map((n=>e(n,r))):[e(n,r)]:n}function j(e,n){return 1===arguments.length?$((n=>A(e,n))):$((n=>A(e,n)),n)}function k(e,n,r){return 0!==n&&Array.isArray(r)?r.map((r=>k(e,n-1,r))):e(r)}function M(e,n,r){if(2===arguments.length)return r=>M(e,n,r);if(!r)return r;r=k(e,n,r);let t=n,o=r;for(;t>0&&Array.isArray(o);)t--,o=o[0];if(void 0!==o)for(let e=0;e<t;e++)r=[r];return r}function N(e,n,r){return 2===arguments.length?M((n=>A(e,n)),n):M((n=>A(e,n)),n,r)}function S(e){return!!Array.isArray(e)&&!e.some((n=>{const r=typeof n;return!("string"===r||"number"===r||"function"===r&&e.length>1)}))}function T(e,n){if(2===arguments.length)return T(e).call(null,n);const r=new Set,t=e.filter((e=>"function"!=typeof e)),o=e.filter((e=>"function"==typeof e));for(const n of e)"string"!=typeof n&&"number"!=typeof n||r.add(n);let a=null,s=null;return(e,n)=>{if(null==e)return e;const c=typeof e,l="string"===c||"number"===c;return l&&(r.has(e)||o.some((e=>"string"===c&&e===String||"number"===c&&e===Number)))||"object"===c&&o.some((n=>!v(e,n)))?e:(l&&t.length?(a||(a=t.map((e=>"string"==typeof e?`'${e}'`:`${e}`)).join(", ")),u().error("Accessor#set",`'${e}' is not a valid value for this property, only the following values are valid: ${a}`)):"object"==typeof e&&o.length?(s||(s=o.map((e=>b(e))).join(", ")),u().error("Accessor#set",`'${e}' is not a valid value for this property, value must be one of ${s}`)):u().error("Accessor#set",`'${e}' is not a valid value for this property`),n&&(n.valid=!1),null)}}function x(e,n){if(2===arguments.length)return x(e).call(null,n);const r={},t=[],o=[];for(const n in e.typeMap){const u=e.typeMap[n];r[n]=A(u),t.push(b(u)),o.push(n)}const a="string"==typeof e.key?n=>n[e.key]:e.key;return n=>{if(e.base&&!v(e.base,n))return n;if(null==n)return n;const s=a(n)||e.defaultKeyValue,c=r[s];if(!c)return u().error("Accessor#set",`Invalid property value, value needs to be one of '${t.join("', '")}', or a plain object that can autocast (having .type = '${o.join("', '")}')`),null;if(!v(e.typeMap[s],n))return n;if("string"==typeof e.key&&!y(n)){const r={};for(const t in n)t!==e.key&&(r[t]=n[t]);return c(r)}return c(n)}}class _{}class B{}const C={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function D(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function I(e){switch(e.type){case"native":return A(e.value);case"array":return $(I(e.value));case"one-of":return function(e){let n=null;return(r,t)=>F(r,e)?r:(null==n&&(n=L(e)),u().error("Accessor#set",`Invalid property value, value needs to be of type ${n}`),t&&(t.valid=!1),null)}(e);default:return null}}function L(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case _:return"integer";case Date:return"date";case B:return"null";default:return b(e.value)}case"array":return`array of ${L(e.value)}`;case"one-of":{const n=e.values.map((e=>L(e)));return`one of ${n.slice(0,-1)} or ${n[n.length-1]}`}}return"unknown"}function F(e,n){if(null==e)return!0;switch(n.type){case"native":switch(n.value){case Number:case _:return"number"==typeof e;case Boolean:return"boolean"==typeof e;case String:return"string"==typeof e;case B:return null===e}return e instanceof n.value;case"array":return!!Array.isArray(e)&&!e.some((e=>!F(e,n.value)));case"one-of":return n.values.some((n=>F(e,n)))}}export{_ as I,B as N,d as a,x as b,l as c,i as d,A as e,c as f,t as g,$ as h,p as i,D as j,I as k,S as l,T as m,M as n,j as o,N as p,r as q,o as r,n as s,C as t};
