/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as t,c as e}from"./tslib.es6.js";import{j as o,L as i,N as a,O as s,r,P as n,Q as l,d as u,n as p,F as c,R as d,C as y,B as m,u as h,U as f,t as v,W as g,b as x,X as b,S as w,M as S,l as V,g as z,Y as T,V as O,Z as D,G as A,s as R,c as C,h as $,e as M,a as P,f as F,k as H,z as _,_ as I,m as U,$ as W,w as k,p as j,o as L,a0 as N,a1 as q,a2 as G,a3 as Z,q as E,a4 as B,K,a5 as Q,i as X,A as Y,a6 as J,a7 as tt}from"./GraphShaderModule.js";import{n as et}from"./definitions.js";import{h as ot}from"../core/lang.js";import it from"../core/Accessor.js";import{R as at}from"./ReactiveMap.js";import{watch as st}from"../core/reactiveUtils.js";import{property as rt}from"../core/accessorSupport/decorators/property.js";import"./Logger.js";import{subclass as nt}from"../core/accessorSupport/decorators/subclass.js";import{U as lt}from"./UpdatingHandles.js";const ut={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4,isStroke:5}};var pt;!function(t){t[t.Geographic=0]="Geographic",t[t.Arithmatic=1]="Arithmatic"}(pt||(pt={}));const ct=3.14159265359/180,dt=3.14159265359/128,yt=1,mt=24,ht=8,ft=1e-30,vt=4,gt=0,xt=2,bt=2,wt=3,St=0,Vt=3,zt=1.1;function Tt(t){const e=i(12.9898),o=i(78.233),s=i(43758.5453),r=u(t,d(e,o)),n=a(r,i(3.14));return y(m(n).multiply(s))}function Ot(t){return o(t,i(1e-30))}function Dt(t){return t.multiply(2).subtract(1)}function At(t,e){const o=i(2**e);return a(s(t.divide(o)),i(2))}function Rt(t,e){return r(At(t,e),i(.5))}function Ct(t,e){return At(t,e+et)}function $t(t){const e=l(255/256,255/65536,255/16777216,255/4294967296);return u(t,e)}function Mt(t){return p(p(p(t.x,t.y),t.z),t.w)}function Pt(t){return new c(1).subtract(t)}function Ft(t){return t.subtract(new c(1))}function Ht(t,e){return t.subtract(new c(e))}class _t extends f{getVisualVariableData(t){if(!this._vvData){const e=this.getAttributeDataCoords(t);this._vvData=v(this.visualVariableData,e).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(t){if(!this._uv){const e=function(t){const e=At(t.z,7),o=i(1).subtract(e),a=t.xyz.subtract(n(0,0,i(128)));return o.multiply(t).add(e.multiply(a))}(t),o=this.size,s=g(e.x),r=g(e.y).multiply(g(256)),l=g(e.z).multiply(g(256)).multiply(g(256)),u=i(s.add(r).add(l)),p=a(u,o),c=u.subtract(p).divide(o);this._uv=new x(p,c).add(.5).divide(o)}return this._uv}getFilterData(t){const e=this.getAttributeDataCoords(t);return v(this.filterFlags,e).setDebugName("storage0")}getAnimationData(t){const e=this.getAttributeDataCoords(t);return v(this.animation,e).setDebugName("storage1")}getVVData(t){return this.getVisualVariableData(t)}getDataDrivenData0(t){const e=this.getAttributeDataCoords(t);return v(this.dataDriven0,e).setDebugName("storage30")}getDataDrivenData1(t){const e=this.getAttributeDataCoords(t);return v(this.dataDriven1,e).setDebugName("storage31")}getDataDrivenData2(t){const e=this.getAttributeDataCoords(t);return v(this.dataDriven2,e).setDebugName("storage32")}getGPGPUData(t){const e=this.getAttributeDataCoords(t);return v(this.gpgpu,e).setDebugName("storage4")}getLocalTimeOrigin(t){const e=this.getAttributeDataCoords(t);return v(this.localTimeOrigin,e).x.setDebugName("storage5")}getFilterFlags(t){return ot("webgl-ignores-sampler-precision")?b(this.getFilterData(t).x.multiply(i(255))):this.getFilterData(t).x.multiply(i(255))}getLabelVisibility(t){const e=this.getFilterData(t).y.multiply(255);return new c(1).subtract(e)}getAnimationValue(t){return this.getAnimationData(t).x}getSizeValue(t){return this.getVisualVariableData(t).x}getColorValue(t){return this.getVisualVariableData(t).y}getOpacityValue(t){return this.getVisualVariableData(t).z}getRotationValue(t){return this.getVisualVariableData(t).w}}t([h(w)],_t.prototype,"filterFlags",void 0),t([h(w)],_t.prototype,"animation",void 0),t([h(w)],_t.prototype,"gpgpu",void 0),t([h(w)],_t.prototype,"localTimeOrigin",void 0),t([h(w)],_t.prototype,"visualVariableData",void 0),t([h(w)],_t.prototype,"dataDriven0",void 0),t([h(w)],_t.prototype,"dataDriven1",void 0),t([h(w)],_t.prototype,"dataDriven2",void 0),t([h(c)],_t.prototype,"size",void 0);class It extends f{}t([h(c)],It.prototype,"activeReasons",void 0),t([h(c)],It.prototype,"highlightAll",void 0);class Ut extends f{}t([h(x)],Ut.prototype,"position",void 0),t([h(c)],Ut.prototype,"distance",void 0),t([h(c)],Ut.prototype,"smallSymbolDistance",void 0),t([h(c)],Ut.prototype,"smallSymbolSizeThreshold",void 0);class Wt extends f{}t([h(S)],Wt.prototype,"displayViewScreenMat3",void 0),t([h(S)],Wt.prototype,"displayViewMat3",void 0),t([h(S)],Wt.prototype,"displayMat3",void 0),t([h(S)],Wt.prototype,"viewMat3",void 0),t([h(S)],Wt.prototype,"tileMat3",void 0),t([h(c)],Wt.prototype,"displayZoomFactor",void 0),t([h(c)],Wt.prototype,"requiredZoomFactor",void 0),t([h(x)],Wt.prototype,"tileOffset",void 0),t([h(c)],Wt.prototype,"currentScale",void 0),t([h(c)],Wt.prototype,"currentZoom",void 0),t([h(c)],Wt.prototype,"metersPerSRUnit",void 0),t([h(c)],Wt.prototype,"rotation",void 0),t([h(c)],Wt.prototype,"pixelRatio",void 0);class kt extends O{}t([V(0,P)],kt.prototype,"id",void 0),t([V(1,c)],kt.prototype,"bitset",void 0),t([V(2,x)],kt.prototype,"pos",void 0);class jt extends D{}t([V(14,x)],jt.prototype,"nextPos1",void 0),t([V(15,x)],jt.prototype,"nextPos2",void 0);class Lt extends F{}class Nt extends A{clip(t,e){let o=new c(0);const a=this.storage.getFilterFlags(t);if(o=o.add(i(2).multiply(i(1).subtract(Ct(a,0)))),this.inside?o=o.add(i(2).multiply(i(1).subtract(Ct(a,1)))):this.outside?o=o.add(i(2).multiply(Ct(a,1))):this.highlight&&(o=o.add(i(2).multiply(i(1).subtract(this._checkHighlight(a))))),null!=e){const t=new c(1).subtract(R(e.x,this.view.currentZoom)),i=R(e.y,this.view.currentZoom);o=o.add(new c(2).multiply(t.add(i)))}return o}getFragmentOutput(t,e,o=new c(1/255)){const i=new M;return i.glFragColor=this._maybeWriteHittest(e)??this._maybeHighlight(t,o)??t,i}_maybeHighlight(t,e){return this.highlight?new C(t.rgb,R(e,t.a)):null}_checkHighlight(t){let e=this._checkHighlightBit(t,0);for(let o=1;o<et;o++)e=e.add(this._checkHighlightBit(t,o));return R(new c(.1),e.add(this.highlight.highlightAll))}_checkHighlightBit(t,e){return function(t,e){return At(t,e)}(t,e).multiply(At(this.highlight.activeReasons,e))}maybeRunHittest(t,e,o){if(null==this.hittestRequest)return null;const i=this.hittest(t,e,o);let a=$(r(i,this.hittestRequest.distance),new c(2),new c(0));const s=Dt(this.storage.getAttributeDataCoords(t.id));a=a.add(this.clip(t.id,t.zoomRange));const n=new C(new c(1/255),0,0,0);return{glPointSize:new c(1),glPosition:new C(s,a,1),color:n}}_maybeWriteHittest(t){return null!=this.hittestRequest?t.color:null}}function qt(t,e,o){const i=o.subtract(e),a=t.subtract(e),s=u(a,q(i)),r=H(s.divide(_(i)),new c(0),new c(1));return I(t,e.add(r.multiply(o.subtract(e))))}function Gt(t){const e=U(t);return R(e.x.add(e.y).add(e.z),new c(1.05))}function Zt(t,e,o,i){const a=new S(o.x.multiply(i.y).subtract(i.x.multiply(o.y)),i.x.multiply(e.y).subtract(e.x.multiply(i.y)),e.x.multiply(o.y).subtract(o.x.multiply(e.y)),o.y.subtract(i.y),i.y.subtract(e.y),e.y.subtract(o.y),i.x.subtract(o.x),e.x.subtract(i.x),o.x.subtract(e.x)),s=e.x.multiply(o.y.subtract(i.y)),r=o.x.multiply(i.y.subtract(e.y)),n=i.x.multiply(e.y.subtract(o.y)),l=s.add(r).add(n);return new c(1).divide(l).multiply(a.multiply(new P(1,t)))}function Et(t,e,i,a){return o(Gt(Zt(t,e,i,a)),new c(1))}function Bt(t,e,o,i){const a=function(t,e){return t.x.multiply(e.y).subtract(e.x.multiply(t.y))}(o.subtract(e),i.subtract(e)),s=W(k(a,new c(.05)),r(a,new c(-.05)));return j([W(N(s),Et(t.xy,e,o,i)),new c(-1)],[!0,()=>{const a=qt(t,e,o),s=qt(t,o,i),r=qt(t,i,e);return L(L(a,s),r)}])}function Kt(t){return t.distance.add(1)}function Qt(t,e,o){const{viewMat3:i,tileMat3:a}=t.view,s=i.multiply(a),r=s.multiply(new P(e.pos,1)),n=s.multiply(new P(o.nextPos1,1)),l=s.multiply(new P(o.nextPos2,1));return Bt(t.hittestRequest.position,r.xy,n.xy,l.xy)}function Xt(t,e,o){return I(t,o).subtract(e)}t([z],Nt.prototype,"inside",void 0),t([z],Nt.prototype,"outside",void 0),t([T(It)],Nt.prototype,"highlight",void 0),t([h(_t)],Nt.prototype,"storage",void 0),t([h(Wt)],Nt.prototype,"view",void 0),t([T(Ut)],Nt.prototype,"hittestRequest",void 0);class Yt extends f{getColor(t,e,o){return j([B(Ot(t),o),e],[E(t,this.values.first()),this.colors.first()],[Z(t,this.values.last()),this.colors.last()],[!0,()=>{const e=this.values.findIndex((e=>r(e,t))),o=this.values.get(e),i=e.subtract(1),a=this.values.get(i),s=t.subtract(a).divide(o.subtract(a));return K(this.colors.get(i),this.colors.get(e),s)}])}}t([h(G.ofType(C,8))],Yt.prototype,"colors",void 0),t([h(G.ofType(c,8))],Yt.prototype,"values",void 0);class Jt extends f{getOpacity(t){return j([Ot(t),new c(1)],[E(t,this.opacityValues.first()),this.opacities.first()],[Z(t,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const e=this.opacityValues.findIndex((e=>r(e,t))),o=this.opacityValues.get(e),i=e.subtract(1),a=this.opacityValues.get(i),s=t.subtract(a).divide(o.subtract(a));return K(this.opacities.get(i),this.opacities.get(e),s)}])}}function te(t){return null!=t.visualVariableSizeMinMaxValue||null!=t.visualVariableSizeScaleStops||null!=t.visualVariableSizeStops||null!=t.visualVariableSizeUnitValue}function ee(t,e,o){if(te(t)){const i=t.storage.getSizeValue(e);return t.visualVariableSizeMinMaxValue?.getSize(i,o)??t.visualVariableSizeScaleStops?.getSizeForViewScale(t.view.currentScale)??t.visualVariableSizeStops?.getSize(i,o)??t.visualVariableSizeUnitValue?.getSize(i,o)}return o}function oe(t,e,o,i=new Q(!1)){if(null==t.visualVariableColor)return o;const a=t.storage.getColorValue(e);return t.visualVariableColor.getColor(a,o,i)}function ie(t,e){if(null==t.visualVariableOpacity)return new c(1);const o=t.storage.getOpacityValue(e);return t.visualVariableOpacity.getOpacity(o)}function ae(t,e){if(null==t.visualVariableRotation)return S.identity();const o=t.storage.getRotationValue(e);return t.visualVariableRotation.getVVRotationMat3(o)}function se(t,e){if(null==t.visualVariableRotation)return new c(0);const o=t.storage.getRotationValue(e);return t.visualVariableRotation.getNormalizedAngle(o)}t([h(G.ofType(c,8))],Jt.prototype,"opacities",void 0),t([h(G.ofType(c,8))],Jt.prototype,"opacityValues",void 0);class re extends kt{}t([V(3,C)],re.prototype,"color",void 0),t([V(4,x)],re.prototype,"zoomRange",void 0);class ne extends Nt{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const o=ie(this,t.id),i=oe(this,t.id,t.color).multiply(o),a=this.view.displayViewScreenMat3.multiply(new P(t.pos.xy,1)),s=this.clip(t.id,t.zoomRange);return{glPosition:new C(a.xy,s,1),color:i,...this.maybeRunHittest(t,e,null)}}fragment(t){return this.getFragmentOutput(t.color,t,new c(0))}hittest(t,e){return Qt(this,t,e)}}t([T(Yt)],ne.prototype,"visualVariableColor",void 0),t([T(Jt)],ne.prototype,"visualVariableOpacity",void 0),t([e(0,X(re)),e(1,X(jt))],ne.prototype,"vertex",null),t([e(0,X(Lt))],ne.prototype,"fragment",null);class le extends f{getPatternOffsetAtTileOrigin(t,e=new c(0),o=new c(1)){const i=new x(16777216).divide(t);let s=t.multiply(y(this.maxIntsToLocalOrigin.multiply(i))).add(this.tileOffsetFromLocalOrigin).subtract(new c(.5).multiply(t));return s=new x(s.x.multiply(o).subtract(s.y.multiply(e)),s.x.multiply(e).add(s.y.multiply(o))),a(s,t)}}t([h(x)],le.prototype,"tileOffsetFromLocalOrigin",void 0),t([h(x)],le.prototype,"maxIntsToLocalOrigin",void 0);class ue extends f{}t([h(x)],ue.prototype,"size",void 0),t([h(w)],ue.prototype,"texture",void 0);class pe extends re{}function ce(t,e){const a=t.view.requiredZoomFactor,s=new x(e.width,e.height),r=s.multiply(e.scale).multiply(a),n=e.angle.multiply(dt),l=m(n),u=Y(n),p=function(t,e,a,s,r){const n=o(At(r,2),i(1)),l=$t(new C(t,0));return $(n,J(s.divide(e.x),a.divide(e.y),0,tt(a.divide(e.x)),s.divide(e.y),0,Tt(d(l,0)),Tt(d(0,l)),1),J(s.divide(e.x),a.divide(e.y),0,tt(a.divide(e.x)),s.divide(e.y),0,0,0,1))}(e.id,r,l,u,e.bitset),y=t.localTileOffset.getPatternOffsetAtTileOrigin(s,l,u),h=a.multiply(e.scale).multiply(e.offset.subtract(y)).divide(r),f=new P(e.pos,1),v=p.multiply(f).xy.subtract(h),g=e.tlbr.divide(t.mosaicInfo.size.xyxy);let b=At(e.bitset,4);return null!=t.visualVariableColor&&(b=$(Ot(t.storage.getColorValue(e.id)),new c(0),b)),{tileTextureCoord:v,tlbr:g,sampleAlphaOnly:b}}function de(t,e){const o=a(e.tileTextureCoord,new c(1)),i=K(e.tlbr.xy,e.tlbr.zw,o);let s=v(t.mosaicInfo.texture,i);return s=$(r(e.sampleAlphaOnly,new c(.5)),s.aaaa,s),e.color.multiply(s)}t([V(5,C)],pe.prototype,"tlbr",void 0),t([V(6,c)],pe.prototype,"width",void 0),t([V(7,c)],pe.prototype,"height",void 0),t([V(8,x)],pe.prototype,"offset",void 0),t([V(9,x)],pe.prototype,"scale",void 0),t([V(10,c)],pe.prototype,"angle",void 0);class ye extends ne{vertex(t,e){return{...super.vertex(t,e),...ce(this,t)}}fragment(t){const e=de(this,t);return this.getFragmentOutput(e,t,new c(0))}}t([h(ue)],ye.prototype,"mosaicInfo",void 0),t([h(le)],ye.prototype,"localTileOffset",void 0),t([e(0,X(pe)),e(1,X(jt))],ye.prototype,"vertex",null),t([e(0,X(class extends Lt{}))],ye.prototype,"fragment",null);class me extends f{getSize(t,e){const o=this.minMaxValueAndSize.xy,i=this.minMaxValueAndSize.zw;return $(Ot(t),e,(()=>{const e=t.subtract(o.x).divide(o.y.subtract(o.x)),a=H(e,new c(0),new c(1));return i.x.add(a.multiply(i.y.subtract(i.x)))}))}}t([h(C)],me.prototype,"minMaxValueAndSize",void 0);class he extends f{getSizeForViewScale(t){return j([E(t,this.values.first()),this.sizes.first()],[Z(t,this.values.last()),this.sizes.last()],[!0,()=>{const e=this.values.findIndex((e=>r(e,t))),o=this.values.get(e),i=e.subtract(1),a=this.values.get(i),s=t.subtract(a).divide(o.subtract(a));return K(this.sizes.get(i),this.sizes.get(e),s)}])}}t([h(G.ofType(c,8))],he.prototype,"sizes",void 0),t([h(G.ofType(c,8))],he.prototype,"values",void 0);class fe extends f{getSize(t,e){const o=j([Ot(t),e],[E(t,this.values.first()),this.sizes.first()],[Z(t,this.values.last()),this.sizes.last()],[!0,()=>{const e=this.values.findIndex((e=>r(e,t))),o=this.values.get(e),i=e.subtract(1),a=this.values.get(i),s=t.subtract(a).divide(o.subtract(a));return K(this.sizes.get(i),this.sizes.get(e),s)}]);return $(Ot(o),e,o)}}t([h(G.ofType(c,8))],fe.prototype,"sizes",void 0),t([h(G.ofType(c,8))],fe.prototype,"values",void 0);class ve extends f{getSize(t,e){return $(Ot(t),e,t.multiply(this.unitValueToPixelsRatio))}}t([h(c)],ve.prototype,"unitValueToPixelsRatio",void 0);class ge extends kt{}t([V(3,C)],ge.prototype,"color",void 0),t([V(4,x)],ge.prototype,"offset",void 0),t([V(5,x)],ge.prototype,"normal",void 0),t([V(6,c)],ge.prototype,"halfWidth",void 0),t([V(7,c)],ge.prototype,"referenceHalfWidth",void 0),t([V(8,x)],ge.prototype,"zoomRange",void 0);class xe extends Lt{}class be extends f{}function we(t){return p(new c(1.1).multiply(R(t,new c(1))),new c(1))}function Se(t,e){const{halfWidth:o,normal:i}=t,a=we(o),s=_(i).multiply(o);return H(a.multiply(o.subtract(s)).divide(e.add(a).subtract(new c(1))),new c(0),new c(1))}function Ve(t,e){const{id:o,offset:i,pos:a,normal:s,zoomRange:r}=e,{displayViewScreenMat3:n,displayViewMat3:l}=t.view,u=oe(t,o,e.color),d=ie(t,o),y=function(t,e){const{id:o,halfWidth:i,referenceHalfWidth:a}=e;if(te(t)){const e=ee(t,o,new c(2).multiply(a));return new c(.5).multiply(i.divide(p(a,new c(1e-5)))).multiply(e)}return i}(t,e),m=new c(.5).multiply(t.antialiasingControls.antialiasing),h=p(y.add(m),new c(.45)).add(new c(.1).multiply(m)),f=we(h).multiply(h).multiply(i),v=l.multiply(new P(f,new c(0))),g=n.multiply(new P(a,new c(1))).add(v),x=new c(2).multiply(R(y,new c(0))).add(t.clip(o,r)),b=new C(g.xy,x,1);return{color:u,opacity:d,halfWidth:h,normal:s,scaledOffset:f,scaledHalfWidth:y,glPosition:new C(b.xy,x,1)}}function ze(t,e){const{opacity:o,color:i}=t,a=Se(t,e);return o.multiply(i).multiply(a)}t([h(c)],be.prototype,"antialiasing",void 0),t([h(c)],be.prototype,"blur",void 0);class Te extends Nt{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const o=Ve(this,t);return{...o,...this.maybeRunHittest(t,e,o.halfWidth)}}fragment(t){const e=ze(t,this.antialiasingControls.blur);return this.getFragmentOutput(e,t)}hittest(t,e,o){const{viewMat3:i,tileMat3:a}=this.view,s=i.multiply(a),r=s.multiply(new P(t.pos,1)),n=s.multiply(new P(e.nextPos1,1)),l=s.multiply(new P(e.nextPos2,1)),{distance:u,smallSymbolDistance:p,smallSymbolSizeThreshold:c}=this.hittestRequest,d=R(o,c.multiply(.5)).multiply(u.subtract(p)),y=this.hittestRequest.position;return L(qt(y,r.xy,n.xy),qt(y,r.xy,l.xy)).subtract(o).add(d)}}t([h(be)],Te.prototype,"antialiasingControls",void 0),t([T(Yt)],Te.prototype,"visualVariableColor",void 0),t([T(Jt)],Te.prototype,"visualVariableOpacity",void 0),t([T(me)],Te.prototype,"visualVariableSizeMinMaxValue",void 0),t([T(he)],Te.prototype,"visualVariableSizeScaleStops",void 0),t([T(fe)],Te.prototype,"visualVariableSizeStops",void 0),t([T(ve)],Te.prototype,"visualVariableSizeUnitValue",void 0),t([e(0,X(ge)),e(1,X(jt))],Te.prototype,"vertex",null),t([e(0,X(xe))],Te.prototype,"fragment",null);class Oe extends kt{}t([V(3,x)],Oe.prototype,"offset",void 0),t([V(4,C)],Oe.prototype,"color",void 0),t([V(5,x)],Oe.prototype,"normal",void 0),t([V(6,c)],Oe.prototype,"halfWidth",void 0),t([V(7,c)],Oe.prototype,"referenceHalfWidth",void 0),t([V(8,x)],Oe.prototype,"zoomRange",void 0);class De extends xe{}function Ae(t,e,o){const{id:i,bitset:a}=e,s=At(a,0),n=r(s,new c(.5)),l=Ve(t,e),u=$(n,l.halfWidth,new c(0)),p=ie(t,i),d=oe(t,i,e.color),y=$(n,e.color,d.multiply(p)),m=t.view.displayViewScreenMat3.multiply(new P(e.pos.xy,1)),h=t.clip(e.id),f=new C(m.xy,h,1),v=$(n,l.glPosition,f),g=o&&t.maybeRunHittest(e,o,n);return{isOutline:s,color:y,opacity:new c(1),halfWidth:u,normal:l.normal,glPosition:v,...g}}class Re extends Nt{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}}t([h(be)],Re.prototype,"antialiasingControls",void 0),t([T(Yt)],Re.prototype,"visualVariableColor",void 0),t([T(Jt)],Re.prototype,"visualVariableOpacity",void 0),t([T(me)],Re.prototype,"visualVariableSizeMinMaxValue",void 0),t([T(he)],Re.prototype,"visualVariableSizeScaleStops",void 0),t([T(fe)],Re.prototype,"visualVariableSizeStops",void 0),t([T(ve)],Re.prototype,"visualVariableSizeUnitValue",void 0);class Ce extends Re{vertex(t,e){return Ae(this,t,e)}fragment(t){const{color:e,isOutline:o}=t,i=r(o,new c(.5)),a=ze(t,this.antialiasingControls.blur),s=$(i,a,e),n=$(i,new c(1/255),new c(0));return this.getFragmentOutput(s,t,n)}hittest(t,e,o){return $(o,Kt(this.hittestRequest),Qt(this,t,e))}}t([e(0,X(Oe)),e(1,X(jt))],Ce.prototype,"vertex",null),t([e(0,X(De))],Ce.prototype,"fragment",null);class $e extends re{}function Me(t,e){const o=e.tlbr.xy,i=e.tlbr.zw,a=i.x.subtract(o.x),s=o.y.subtract(i.y),r=new x(a,s).multiply(e.inverseRasterizationScale),n=r.multiply(t.view.requiredZoomFactor),l=function(t){const e=new c(1),o=new c(0);return new S(e.divide(t.x),o.divide(t.y),0,tt(o.divide(t.x)),e.divide(t.y),0,0,0,1)}(n),u=t.localTileOffset.getPatternOffsetAtTileOrigin(r).divide(n),p=new P(e.pos,1);return{tileTextureCoord:l.multiply(p).xy.subtract(u),tlbr:e.tlbr.divide(t.mosaicInfo.size.xyxy)}}function Pe(t,e){const o=a(t.tileTextureCoord,new c(1)),i=K(t.tlbr.xy,t.tlbr.zw,o),s=v(e.texture,i);return t.color.multiply(s)}t([V(5,C)],$e.prototype,"tlbr",void 0),t([V(6,c)],$e.prototype,"inverseRasterizationScale",void 0);class Fe extends ne{vertex(t,e){return{...super.vertex(t,e),...Me(this,t)}}fragment(t){const e=Pe(t,this.mosaicInfo);return this.getFragmentOutput(e,t,new c(0))}}t([h(ue)],Fe.prototype,"mosaicInfo",void 0),t([h(le)],Fe.prototype,"localTileOffset",void 0),t([e(0,X($e)),e(1,X(jt))],Fe.prototype,"vertex",null),t([e(0,X(class extends Lt{}))],Fe.prototype,"fragment",null);class He extends Oe{}t([V(9,C)],He.prototype,"tlbr",void 0),t([V(10,c)],He.prototype,"inverseRasterizationScale",void 0);class _e extends De{}class Ie extends Ce{vertex(t,e){return{...Ae(this,t,e),...Me(this,t)}}fragment(t){const{isOutline:e}=t,o=r(e,new c(.5)),i=ze(t,this.antialiasingControls.blur),a=Pe(t,this.mosaicInfo),s=$(o,i,a),n=$(o,new c(1/255),new c(0));return this.getFragmentOutput(s,t,n)}}t([h(ue)],Ie.prototype,"mosaicInfo",void 0),t([h(le)],Ie.prototype,"localTileOffset",void 0),t([e(0,X(He)),e(1,X(jt))],Ie.prototype,"vertex",null),t([e(0,X(_e))],Ie.prototype,"fragment",null);const Ue=16,We=1/16,ke=128;class je extends kt{}t([V(3,C)],je.prototype,"color",void 0),t([V(4,C)],je.prototype,"tlbr",void 0),t([V(5,c)],je.prototype,"angle",void 0),t([V(6,c)],je.prototype,"aux1",void 0),t([V(7,c)],je.prototype,"aux2",void 0),t([V(8,x)],je.prototype,"aux3",void 0),t([V(9,x)],je.prototype,"aux4",void 0),t([V(10,x)],je.prototype,"zoomRange",void 0);class Le extends Re{vertex(t,e){const{aux1:o,aux2:i,aux3:a,aux4:s}=t,n={...t,width:o,height:i,offset:a,scale:s.multiply(We)},l=Ae(this,{...t,halfWidth:o,referenceHalfWidth:i,offset:a,normal:s.subtract(128).multiply(We)}),u=ce(this,n),p=r(l.isOutline,new c(.5));return{...l,...u,...this.maybeRunHittest(t,e,p)}}fragment(t){const{isOutline:e}=t,o=r(e,new c(.5)),i=ze(t,this.antialiasingControls.blur),a=de(this,t),s=$(o,i,a),n=$(o,new c(1/255),new c(0));return this.getFragmentOutput(s,t,n)}hittest(t,e,o){return $(o,Kt(this.hittestRequest),Qt(this,t,e))}}t([h(ue)],Le.prototype,"mosaicInfo",void 0),t([h(le)],Le.prototype,"localTileOffset",void 0),t([e(0,X(je)),e(1,X(jt))],Le.prototype,"vertex",null),t([e(0,X(class extends _e{}))],Le.prototype,"fragment",null);const Ne=8388607,qe=t=>t&Ne;function Ge(t,e){return((e?8388608:0)|t)>>>0}var Ze;!function(t){t.Local="Local",t.Global="Global"}(Ze||(Ze={}));class Ee{generateSource(t){const e=[];for(let o=1;o<this.length;o++)e.push(`vec4 atom${o} = texture(${t.animationTexture}, (pointer + 0.5) / size);`),e.push("pointer.x += 1.0;");for(let t=0;t<this.ins;t++)e.push("top--;"),e.push(`vec4 in${this.ins-t-1} = stack[top];`);for(let t=0;t<this.outs;t++)e.push(`vec4 out${t};`);const{microcode:o}=this;for(const t of o)e.push(t);for(let t=0;t<this.outs;t++)e.push(`stack[top] = out${t};`),e.push("top++;"),e.push(`if (top >= ${eo}) { top = ${eo-1}; }`);return e}}let Be=128;function Ke(t){return[`float duration = clamp(${t.duration}, 0.05, 3600.0);`,`float startTimeOffset = ${t.startTimeOffset};`,`float repeatDelay = ${t.repeatDelay};`,`float timeOriginSelector = ${t.timeOriginSelector};`,`float repeatType = ${t.repeatType};`,`float easing = ${t.easing};`,`float playAnimation = ${t.playAnimation} * (1.0 - step(0.0, -${t.duration}));`,`float reverseAnimation = ${t.reverseAnimation};`,"float time = globalTime - (timeOriginSelector == 1.0 ? localTimeOrigin : 0.0);","time *= playAnimation;","time *= 1.0 - reverseAnimation * 2.0;","float period = duration + repeatDelay;","time += reverseAnimation == 1.0 ? (period - startTimeOffset - 0.001) : startTimeOffset + 0.001;","float omega = time / period;","float oi = floor(omega);","omega = repeatType == 1.0 || repeatType == 3.0 ? omega - oi : omega;","float of = omega * period;","of = (clamp(of, reverseAnimation * repeatDelay, period - (1.0 - reverseAnimation) * repeatDelay) - reverseAnimation * repeatDelay) / duration;","of = easing == 2.0 ? pow(of, 3.0) : of;","of = easing == 3.0 ? 1.0 - pow(1.0 - of, 3.0) : of;","of = easing == 4.0 ? of < 0.5 ? 4.0 * pow(of, 3.0) : 1.0 - pow(-2.0 * of + 2.0, 3.0) / 2.0 : of;","bool oscillate = repeatType == 3.0 && mod(oi, 2.0) == 1.0;",`${t.out} = oscillate ? 1.0 - of : of;`]}const Qe={Linear:1,EaseIn:2,EaseOut:3,EaseInOut:4},Xe={Loop:1,None:2,Oscillate:3},Ye={Local:1,Global:2};function Je(t){const e=Qe[t.easing],o=Xe[t.repeatType],i=Ye[t.timeOriginSelector];return[[t.duration,t.startTimeOffset,t.repeatDelay,i],[o,e,t.playAnimation,t.reverseAnimation]]}const to={scalar:new class extends Ee{constructor(){super(...arguments),this.opcode=++Be,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.y, atom0.y, atom0.y, atom0.y);"]}encode(t){return[[this.opcode,t,0,0]]}},vector3:new class extends Ee{constructor(){super(...arguments),this.opcode=++Be,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.yzw, 0.0);"]}encode(t){return[[this.opcode,t[0]||0,t[1]||0,t[2]||0]]}},vector4:new class extends Ee{constructor(){super(...arguments),this.opcode=++Be,this.length=2,this.ins=0,this.outs=1,this.microcode=["out0 = atom1;"]}encode(t){return[[this.opcode,0,0,0],t]}},animatedTransform:new class extends Ee{constructor(){super(...arguments),this.opcode=++Be,this.length=10,this.ins=1,this.outs=1,this.microcode=["vec2 fromTranslation = atom1.xy;","vec2 toTranslation = atom1.zw;","float fromRotation = atom2.x;","float toRotation = atom2.y;","float fromScale = atom2.z;","float toScale = atom2.w;","bool relativeTranslation = atom9.x == 1.0;","bool absoluteScale = atom9.y == 1.0;","vec2 translationMultiplier = relativeTranslation ? pixelDimensions : vec2(1.0, 1.0);","float scaleDivisor = absoluteScale ? pixelDimensions.y : 1.0;","float fTranslation;","{",...Ke({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fTranslation"}),"}","float fRotation;","{",...Ke({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fRotation"}),"}","float fScale;","{",...Ke({duration:"atom7.x",startTimeOffset:"atom7.y",repeatDelay:"atom7.z",timeOriginSelector:"atom7.w",repeatType:"atom8.x",easing:"atom8.y",playAnimation:"atom8.z",reverseAnimation:"atom8.w",out:"fScale"}),"}","vec2 aTranslation = mix(fromTranslation, toTranslation, fTranslation);","float aRotation = mix(fromRotation, toRotation, fRotation);","float aScale = mix(fromScale, toScale, fScale);","vec2 pTranslation = in0.xy;","float pRotation = in0.z;","float pScale = in0.w;","aTranslation *= translationMultiplier;","aScale /= scaleDivisor;","float rotation = pRotation + aRotation;","float scale = pScale * aScale;","float sin1 = sin(pRotation);","float cos1 = cos(pRotation);","float s1 = pScale;","float x1 = pTranslation.x;","float y1 = pTranslation.y;","float x2 = aTranslation.x;","float y2 = aTranslation.y;","\n    vec2 translation = vec2(\n      cos1 * s1 * x2 - sin1 * s1 * y2 + x1,\n      sin1 * s1 * x2 + cos1 * s1 * y2 + y1\n    );\n    ","out0 = vec4(translation, rotation, scale);"]}encode(t){return[[this.opcode,0,0,0],[t.translation.from[0],t.translation.from[1],t.translation.to[0],t.translation.to[1]],[t.rotation.from,t.rotation.to,t.scale.from,t.scale.to],...Je(t.translation.timing),...Je(t.rotation.timing),...Je(t.scale.timing),[t.relativeTranslation?1:0,t.absoluteScale?1:0,0,0]]}},animatedColor:new class extends Ee{constructor(){super(...arguments),this.opcode=++Be,this.length=7,this.ins=1,this.outs=1,this.microcode=["float fromOpacity = atom0.y;","float toOpacity = atom0.z;","vec4 fromColor = atom1;","vec4 toColor = atom2;","float fColor;","{",...Ke({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fColor"}),"}","float fOpacity;","{",...Ke({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fOpacity"}),"}","vec4 aColor = mix(fromColor, toColor, fColor);","aColor.a *= mix(fromOpacity, toOpacity, fOpacity);","vec4 pColor = in0;","out0 = aColor * pColor;"]}encode(t){return[[this.opcode,t.opacity.from,t.opacity.to,0],[t.color.from[0],t.color.from[1],t.color.from[2],t.color.from[3]],[t.color.to[0],t.color.to[1],t.color.to[2],t.color.to[3]],...Je(t.color.timing),...Je(t.opacity.timing)]}},ret:new class extends Ee{constructor(){super(...arguments),this.opcode=++Be,this.length=1,this.ins=0,this.outs=0,this.microcode=["break;"]}encode(){return[[this.opcode,0,0,0]]}}},eo=4;function oo(t){const e=[];e.push(`float globalTime = ${t.globalTime};`),e.push(`float localTimeOrigin = ${t.localTimeOrigin};`),e.push(`vec2 pointer = ${t.animationPointer};`),e.push(`vec2 size = ${t.animationTextureSize};`),e.push("int top = 0;"),e.push(`vec4 stack[${eo}];`),e.push("for (int counter = 0; counter < 40; counter++) {"),e.push(`vec4 atom0 = texture(${t.animationTexture}, (pointer + 0.5) / size);`),e.push("pointer.x += 1.0;"),e.push(`vec2 pixelDimensions = ${t.pixelDimensions};`),e.push("if (false) {");for(const o in to){const i=to[o];e.push(`} else if (int(atom0.x) == ${i.opcode}) {`);for(const o of i.generateSource(t))e.push(o)}return e.push("} // End if-else."),e.push("} // End for."),e.push(`${t.out} = top > 0 ? stack[top - 1] : vec4(0.0);`),e.join("\n")}let io=class extends it{constructor(t){super(t),this.debugName="",this._updatingHandles=new lt,this._idToUpdatingState=new at}get updating(){const t=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some((t=>t));if(ot("esri-2d-log-updating")){const e=Array.from(this._idToUpdatingState.entries()).map((([t,e])=>`-> ${t}: ${e}`)).join("\n");console.log(`${this.debugName}: Updating: ${t}\n-> Handles: ${this._updatingHandles.updating}\n${e}`)}return t}addUpdateTracking(t,e){const o=st((()=>e.updating),(e=>this._idToUpdatingState.set(t,e)),{sync:!0});this.addHandles(o)}addPromise(t){return this._updatingHandles.addPromise(t)}};t([rt({constructOnly:!0})],io.prototype,"debugName",void 0),t([rt({readOnly:!0})],io.prototype,"updating",null),io=t([nt("esri.views.2d.layers.support.UpdateTracking2D")],io);export{Le as $,Nt as A,ue as B,Jt as C,me as D,he as E,kt as F,fe as G,ve as H,Lt as I,At as J,ee as K,oe as L,ut as M,Rt as N,ie as O,Bt as P,Zt as Q,pt as R,Gt as S,Ze as T,io as U,Yt as V,Kt as W,Wt as X,Mt as Y,ne as Z,ye as _,Ht as a,Ce as a0,Fe as a1,Ie as a2,Xt as a3,mt as a4,ae as a5,ht as a6,Te as a7,ge as a8,Ve as a9,Se as aa,jt as ab,zt as b,dt as c,Ne as d,Ge as e,xt as f,qe as g,vt as h,to as i,gt as j,St as k,Vt as l,Ft as m,ft as n,Pt as o,Ue as p,bt as q,wt as r,ke as s,Ot as t,Dt as u,ct as v,se as w,$t as x,yt as y,oo as z};
