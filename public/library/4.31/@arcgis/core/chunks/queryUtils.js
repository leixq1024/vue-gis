/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{J as e}from"./jsonMap.js";import{f as t,e as i,c as r,b as n,w as a}from"./unitUtils.js";import{canProjectWithoutEngine as s}from"../geometry/projection.js";import{a as o}from"./extentUtils.js";import{fromJSON as l,isExtent as m,isPolygon as f,isPolyline as c}from"../geometry/support/jsonUtils.js";import{normalizeCentralMeridian as u}from"../geometry/support/normalizeUtils.js";import{c as p,p as y}from"./projectionSupport.js";const R=new e({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),S=Object.freeze({});async function g(e,t,i){const{outFields:r,orderByFields:n,groupByFieldsForStatistics:a,outStatistics:s}=e;if(r)for(let e=0;e<r.length;e++)r[e]=r[e].trim();if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(a)for(let e=0;e<a.length;e++)a[e]=a[e].trim();if(s)for(let e=0;e<s.length;e++)s[e].onStatisticField&&(s[e].onStatisticField=s[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),w(e,t,i)}async function w(e,t,s){if(!e)return null;let{where:f}=e;if(e.where=f=f?.trim(),(!f||/^1 *= *1$/.test(f)||t&&t===f)&&(e.where=null),!e.geometry)return e;let c=await async function(e){const{distance:t,units:s}=e,o=e.geometry;if(null==t||"vertexAttributes"in o)return o;const l=o.spatialReference,m=s?R.fromJSON(s):i(l),f=l&&(r(l)||n(l))?o:await p(l,a).then((()=>y(o,a)));return(await async function(){return(await import("./geometryEngineJSON.js").then((e=>e.g))).geodesicBuffer}())(f.spatialReference,f,t,m)}(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;c=o(c),c.spatialReference=t}if(c){await p(c.spatialReference,s),c=function(e,t){const i=e.spatialReference;return x(e,t)&&m(e)?{spatialReference:i,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}(c,s);const t=(await u(l(c)))[0];if(null==t)throw S;const i="quantizationParameters"in e&&e.quantizationParameters?.tolerance||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,r=i&&x(c,s)?{densificationStep:8*i}:void 0,n=t.toJSON(),a=y(n,n.spatialReference,s,r);if(!a)throw S;a.spatialReference=s,e.geometry=a}return e}function x(e,i){if(!e)return!1;const r=e.spatialReference;return(m(e)||f(e)||c(e))&&!t(r,i)&&!s(r,i)}export{g as a,w as n,S as q,R as u};
