/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{Z as e}from"./vec4f64.js";import{n as t}from"./InterleavedLayout.js";import{S as s,f as r,d as i,g as o,o as a}from"./Matrix4PassUniform.js";import{a as n}from"./AlphaCutoff.js";import{C as l}from"./basicInterfaces.js";import{S as p,d as c,B as h,D as u,j as d,o as f,F as v,t as m,C as _,k as O,l as g,E as T,m as C,p as A,q as P,r as y,s as I,u as S,v as b,H as D,I as E,J as R,K as N,i as j,L as w,a as L,V as M}from"./StencilUtils.js";import{V as x}from"./VertexAttribute.js";import{D as F}from"./RayIntersections.js";import{T as V}from"./TriangleMaterial.js";import"./Material.js";import{T as q,V as U}from"./VertexColor.glsl.js";import{g as B}from"./interfaces3.js";import{l as H}from"./enums.js";import{m as W,c as z,d as $}from"./renderState.js";import{_ as J}from"./tslib.es6.js";import{p as Q}from"./ShaderTechniqueConfiguration.js";const k=Object.freeze(Object.defineProperty({__proto__:null,build:function(e){const t=new p,{vertex:r,fragment:i,attributes:o,varyings:a}=t;c(r,e),t.include(q,e),t.include(U,e),t.include(h,e),t.include(u,e),t.include(d,e),t.include(f,e),o.add(x.POSITION,"vec3"),e.vvColor&&o.add(x.COLORFEATUREATTRIBUTE,"float"),a.add("vColor","vec4"),a.add("vpos","vec3");const n=e.terrainDepthTest&&e.output===s.Color;return n&&a.add("depth","float"),r.uniforms.add(new v("eColor",(e=>e.color))),r.main.add(B`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${e.hasVertexColors?"vColor *= eColor;":e.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${n?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);`),t.include(d,e),n&&t.include(m,e),i.include(_),i.main.add(B`
    discardBySlice(vpos);
    ${n?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;
    outputColorHighlightOID(fColor, vpos);`),t}},Symbol.toStringTag,{value:"Module"}));class G extends O{constructor(e,t,s){super(e,t,new g(k,(()=>Promise.resolve().then((()=>k)))),s)}_createPipeline(e,t){const{oitPass:r,output:i,transparent:o,cullFace:a,draped:n,hasOccludees:l,polygonOffset:p,enableOffset:c}=e,h=r===T.NONE,u=r===T.FrontFace;return W({blending:i===s.Color&&o?C(r):null,culling:z(a),depthTest:n?null:{func:A(r)},depthWrite:P(e),drawBuffers:i===s.Depth?{buffers:[H.NONE]}:y(r,i),colorWrite:$,stencilWrite:l?I:null,stencilTest:l?t?S:b:null,polygonOffset:h||u?p?K:null:D(c)})}initializePipeline(e){return this._occludeePipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}const K={factor:1,units:1};class Y extends E{constructor(){super(...arguments),this.cullFace=l.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=R.None,this.emissionSource=N.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.vvSize=!1,this.vvOpacity=!1}}J([Q({count:l.COUNT})],Y.prototype,"cullFace",void 0),J([Q()],Y.prototype,"hasSlicePlane",void 0),J([Q()],Y.prototype,"hasVertexColors",void 0),J([Q()],Y.prototype,"transparent",void 0),J([Q()],Y.prototype,"discardInvisibleFragments",void 0),J([Q()],Y.prototype,"polygonOffset",void 0),J([Q()],Y.prototype,"enableOffset",void 0),J([Q()],Y.prototype,"writeDepth",void 0),J([Q()],Y.prototype,"hasOccludees",void 0),J([Q()],Y.prototype,"terrainDepthTest",void 0),J([Q()],Y.prototype,"cullAboveTerrain",void 0),J([Q()],Y.prototype,"objectAndLayerIdColorInstanced",void 0),J([Q()],Y.prototype,"vvColor",void 0),J([Q()],Y.prototype,"draped",void 0);class Z extends V{constructor(e){super(e,ee),this._configuration=new Y,this.supportsEdges=!0,this.produces=new Map([[j.OPAQUE_MATERIAL,e=>this._isOpaqueMaterialPass(e)],[j.OPAQUE_MATERIAL_WITHOUT_NORMALS,e=>this._isOpaqueNoSSAODepthPass(e)],[j.TRANSPARENT_MATERIAL,e=>r(e)&&this._transparent&&this.parameters.writeDepth],[j.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,e=>i(e)&&this._transparent&&this.parameters.writeDepth],[j.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>r(e)&&this._transparent&&!this.parameters.writeDepth],[j.DRAPED_MATERIAL,e=>o(e)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(e)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<w,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=n}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(e){return this._isOpaqueMaterialPass(e)||this._isOpaqueNoSSAODepthPass(e)}_isOpaqueMaterialPass(e){return e===s.Highlight||r(e)&&!this._transparent}_isOpaqueNoSSAODepthPass(e){return i(e)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(e){return new X(e)}createBufferWriter(){const e=t().vec3f(x.POSITION);return a()&&e.vec4u8(x.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(x.COLORFEATUREATTRIBUTE):e.vec4u8(x.COLOR),new F(e)}}class X extends L{beginSlot(e){return this.acquireTechnique(G,e)}}class ee extends M{constructor(){super(...arguments),this.color=e,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=l.None,this.draped=!1,this.discardInvisibleFragments=!1}}export{Z as C};
