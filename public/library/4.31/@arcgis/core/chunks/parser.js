/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{a as e,i as t,b as r,h as n}from"./colorUtils.js";import u from"../core/Error.js";import{c as a,n as o,C as c,O as i,H as l,B as s,D as f,a as p}from"./utils2.js";function h(e,t,r,n){var u=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(u,h.prototype),u.expected=t,u.found=r,u.location=n,u.name="SyntaxError",u}function m(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}function g(e){if(!e||0===e.length)return null;if("string"==typeof e){const t=v(e);return t&&0!==t.length?t:null}const t=e.map((e=>{if(!Number.isFinite(e.scale)||e.scale<=0)throw new u("effect:invalid-scale","scale must be finite and greater than 0",{stop:e});return{scale:e.scale,effects:v(e.value)}}));t.sort(((e,t)=>t.effects.length-e.effects.length));for(let e=0;e<t.length-1;e++){if(!a(t[e].effects,t[e+1].effects))throw new u("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[e].effects,b:t[e+1].effects});o(t[e].effects,t[e+1].effects)}return t.sort(((e,t)=>t.scale-e.scale)),t}function v(e){let t;if(!e)return[];try{t=function(e,t){var r,n,u,a,o={},c=(t=void 0!==t?t:{}).grammarSource,i={start:Ve},l=Ve,s="none",f=")",p=",",m="(",g="%",v="px",d="cm",y="mm",w="in",x="pt",A="pc",b="deg",F="rad",$="grad",C="turn",E="#",j=".",O="e",P=/^[ \t\n\r]/,q=/^[a-z\-]/,k=/^[0-9a-fA-F]/,z=/^[+\-]/,I=/^[0-9]/,R=Ge("none"),S=He("none",!1),M=He(")",!1),D=He(",",!1),N=Ge("whitespace"),T=Le([" ","\t","\n","\r"],!1,!1),U=Ge("function"),B=He("(",!1),H=Ge("identifier"),L=Le([["a","z"],"-"],!1,!1),G=Ge("percentage"),J=He("%",!1),K=Ge("length"),Q=He("px",!1),V=He("cm",!1),W=He("mm",!1),X=He("in",!1),Y=He("pt",!1),Z=He("pc",!1),_=Ge("angle"),ee=He("deg",!1),te=He("rad",!1),re=He("grad",!1),ne=He("turn",!1),ue=Ge("number"),ae=Ge("color"),oe=He("#",!1),ce=Le([["0","9"],["a","f"],["A","F"]],!1,!1),ie=Le(["+","-"],!1,!1),le=Le([["0","9"]],!1,!1),se=He(".",!1),fe=He("e",!1),pe=function(){return[]},he=function(e,t){return{type:"function",name:e,parameters:t||[]}},me=function(e,t){return t.length>0?function(e,t){return[e].concat(t.map((function(e){return e[3]})))}(e,t):[e]},ge=function(e){return{type:"quantity",value:e.value,unit:e.unit}},ve=function(e){return{type:"color",colorType:e.type,value:e.value}},de=function(e){return e},ye=function(){return Be()},we=function(e){return{value:e,unit:"%"}},xe=function(e){return{value:e,unit:"px"}},Ae=function(e){return{value:e,unit:"cm"}},be=function(e){return{value:e,unit:"mm"}},Fe=function(e){return{value:e,unit:"in"}},$e=function(e){return{value:e,unit:"pt"}},Ce=function(e){return{value:e,unit:"pc"}},Ee=function(e){return{value:e,unit:"deg"}},je=function(e){return{value:e,unit:"rad"}},Oe=function(e){return{value:e,unit:"grad"}},Pe=function(e){return{value:e,unit:"turn"}},qe=function(e){return{value:e,unit:null}},ke=function(){return{type:"hex",value:Be()}},ze=function(e){return{type:"function",value:e}},Ie=function(){return{type:"named",value:Be()}},Re=function(){return parseFloat(Be())},Se=0|t.peg$currPos,Me=Se,De=[{line:1,column:1}],Ne=Se,Te=t.peg$maxFailExpected||[],Ue=0|t.peg$silentFails;if(t.startRule){if(!(t.startRule in i))throw new Error("Can't start parsing from rule \""+t.startRule+'".');l=i[t.startRule]}function Be(){return e.substring(Me,Se)}function He(e,t){return{type:"literal",text:e,ignoreCase:t}}function Le(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Ge(e){return{type:"other",description:e}}function Je(t){var r,n=De[t];if(n)return n;if(t>=De.length)r=De.length-1;else for(r=t;!De[--r];);for(n={line:(n=De[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return De[t]=n,n}function Ke(e,t,r){var n=Je(e),u=Je(t);return{source:c,start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:u.line,column:u.column}}}function Qe(e){Se<Ne||(Se>Ne&&(Ne=Se,Te=[]),Te.push(e))}function Ve(){var t;return(t=function(){var t,r;return Ue++,t=Se,Ye(),e.substr(Se,4)===s?(r=s,Se+=4):(r=o,0===Ue&&Qe(S)),r!==o?(Ye(),Me=t,t=pe()):(Se=t,t=o),Ue--,t===o&&0===Ue&&Qe(R),t}())===o&&(t=function(){var e,t;if(e=[],(t=We())!==o)for(;t!==o;)e.push(t),t=We();else e=o;return e}()),t}function We(){var t,r,n,u;return t=Se,Ye(),r=function(){var t,r,n;return Ue++,t=Se,(r=Ze())!==o?(40===e.charCodeAt(Se)?(n=m,Se++):(n=o,0===Ue&&Qe(B)),n!==o?(Me=t,t=de(r)):(Se=t,t=o)):(Se=t,t=o),Ue--,t===o&&(r=o,0===Ue&&Qe(U)),t}(),r!==o?(Ye(),n=function(){var t,r,n,u,a,c,i,l;if(t=Se,(r=Xe())!==o){for(n=[],u=Se,a=Ye(),44===e.charCodeAt(Se)?(c=p,Se++):(c=o,0===Ue&&Qe(D)),c===o&&(c=null),i=Ye(),(l=Xe())!==o?u=a=[a,c,i,l]:(Se=u,u=o);u!==o;)n.push(u),u=Se,a=Ye(),44===e.charCodeAt(Se)?(c=p,Se++):(c=o,0===Ue&&Qe(D)),c===o&&(c=null),i=Ye(),(l=Xe())!==o?u=a=[a,c,i,l]:(Se=u,u=o);Me=t,t=me(r,n)}else Se=t,t=o;return t}(),n===o&&(n=null),Ye(),41===e.charCodeAt(Se)?(u=f,Se++):(u=o,0===Ue&&Qe(M)),u!==o?(Ye(),Me=t,t=he(r,n)):(Se=t,t=o)):(Se=t,t=o),t}function Xe(){var t,r;return t=Se,r=function(){var t,r,n;return Ue++,t=Se,Ye(),(r=_e())!==o?(37===e.charCodeAt(Se)?(n=g,Se++):(n=o,0===Ue&&Qe(J)),n!==o?(Me=t,t=we(r)):(Se=t,t=o)):(Se=t,t=o),Ue--,t===o&&0===Ue&&Qe(G),t}(),r===o&&(r=function(){var t,r,n;return Ue++,t=Se,Ye(),(r=_e())!==o?(e.substr(Se,2)===v?(n=v,Se+=2):(n=o,0===Ue&&Qe(Q)),n!==o?(Me=t,t=xe(r)):(Se=t,t=o)):(Se=t,t=o),t===o&&(t=Se,Ye(),(r=_e())!==o?(e.substr(Se,2)===d?(n=d,Se+=2):(n=o,0===Ue&&Qe(V)),n!==o?(Me=t,t=Ae(r)):(Se=t,t=o)):(Se=t,t=o),t===o&&(t=Se,Ye(),(r=_e())!==o?(e.substr(Se,2)===y?(n=y,Se+=2):(n=o,0===Ue&&Qe(W)),n!==o?(Me=t,t=be(r)):(Se=t,t=o)):(Se=t,t=o),t===o&&(t=Se,Ye(),(r=_e())!==o?(e.substr(Se,2)===w?(n=w,Se+=2):(n=o,0===Ue&&Qe(X)),n!==o?(Me=t,t=Fe(r)):(Se=t,t=o)):(Se=t,t=o),t===o&&(t=Se,Ye(),(r=_e())!==o?(e.substr(Se,2)===x?(n=x,Se+=2):(n=o,0===Ue&&Qe(Y)),n!==o?(Me=t,t=$e(r)):(Se=t,t=o)):(Se=t,t=o),t===o&&(t=Se,Ye(),(r=_e())!==o?(e.substr(Se,2)===A?(n=A,Se+=2):(n=o,0===Ue&&Qe(Z)),n!==o?(Me=t,t=Ce(r)):(Se=t,t=o)):(Se=t,t=o)))))),Ue--,t===o&&0===Ue&&Qe(K),t}(),r===o&&(r=function(){var t,r,n;return Ue++,t=Se,(r=_e())!==o?(e.substr(Se,3)===b?(n=b,Se+=3):(n=o,0===Ue&&Qe(ee)),n!==o?(Me=t,t=Ee(r)):(Se=t,t=o)):(Se=t,t=o),t===o&&(t=Se,(r=_e())!==o?(e.substr(Se,3)===F?(n=F,Se+=3):(n=o,0===Ue&&Qe(te)),n!==o?(Me=t,t=je(r)):(Se=t,t=o)):(Se=t,t=o),t===o&&(t=Se,(r=_e())!==o?(e.substr(Se,4)===$?(n=$,Se+=4):(n=o,0===Ue&&Qe(re)),n!==o?(Me=t,t=Oe(r)):(Se=t,t=o)):(Se=t,t=o),t===o&&(t=Se,(r=_e())!==o?(e.substr(Se,4)===C?(n=C,Se+=4):(n=o,0===Ue&&Qe(ne)),n!==o?(Me=t,t=Pe(r)):(Se=t,t=o)):(Se=t,t=o)))),Ue--,t===o&&(r=o,0===Ue&&Qe(_)),t}(),r===o&&(r=function(){var e,t;return Ue++,e=Se,Ye(),(t=_e())!==o?(Me=e,e=qe(t)):(Se=e,e=o),Ue--,e===o&&0===Ue&&Qe(ue),e}()))),r!==o&&(Me=t,r=ge(r)),(t=r)===o&&(t=Se,r=function(){var t,r,n,u;if(Ue++,t=Se,35===e.charCodeAt(Se)?(r=E,Se++):(r=o,0===Ue&&Qe(oe)),r!==o){if(n=[],u=e.charAt(Se),k.test(u)?Se++:(u=o,0===Ue&&Qe(ce)),u!==o)for(;u!==o;)n.push(u),u=e.charAt(Se),k.test(u)?Se++:(u=o,0===Ue&&Qe(ce));else n=o;n!==o?(Me=t,t=ke()):(Se=t,t=o)}else Se=t,t=o;return t===o&&(t=Se,(r=We())!==o&&(Me=t,r=ze(r)),(t=r)===o&&(t=Se,(r=Ze())!==o&&(Me=t,r=Ie()),t=r)),Ue--,t===o&&(r=o,0===Ue&&Qe(ae)),t}(),r!==o&&(Me=t,r=ve(r)),t=r),t}function Ye(){var t,r;for(Ue++,t=[],r=e.charAt(Se),P.test(r)?Se++:(r=o,0===Ue&&Qe(T));r!==o;)t.push(r),r=e.charAt(Se),P.test(r)?Se++:(r=o,0===Ue&&Qe(T));return Ue--,r=o,0===Ue&&Qe(N),t}function Ze(){var t,r,n;if(Ue++,t=Se,r=[],n=e.charAt(Se),q.test(n)?Se++:(n=o,0===Ue&&Qe(L)),n!==o)for(;n!==o;)r.push(n),n=e.charAt(Se),q.test(n)?Se++:(n=o,0===Ue&&Qe(L));else r=o;return r!==o&&(Me=t,r=ye()),Ue--,(t=r)===o&&(r=o,0===Ue&&Qe(H)),t}function _e(){var t,r,n,u,a,c,i,l;for(t=Se,r=e.charAt(Se),z.test(r)?Se++:(r=o,0===Ue&&Qe(ie)),r===o&&(r=null),n=Se,u=[],a=e.charAt(Se),I.test(a)?Se++:(a=o,0===Ue&&Qe(le));a!==o;)u.push(a),a=e.charAt(Se),I.test(a)?Se++:(a=o,0===Ue&&Qe(le));if(46===e.charCodeAt(Se)?(a=j,Se++):(a=o,0===Ue&&Qe(se)),a!==o){if(c=[],i=e.charAt(Se),I.test(i)?Se++:(i=o,0===Ue&&Qe(le)),i!==o)for(;i!==o;)c.push(i),i=e.charAt(Se),I.test(i)?Se++:(i=o,0===Ue&&Qe(le));else c=o;c!==o?n=u=[u,a,c]:(Se=n,n=o)}else Se=n,n=o;if(n===o)if(n=[],u=e.charAt(Se),I.test(u)?Se++:(u=o,0===Ue&&Qe(le)),u!==o)for(;u!==o;)n.push(u),u=e.charAt(Se),I.test(u)?Se++:(u=o,0===Ue&&Qe(le));else n=o;if(n!==o){if(u=Se,101===e.charCodeAt(Se)?(a=O,Se++):(a=o,0===Ue&&Qe(fe)),a!==o){if(c=e.charAt(Se),z.test(c)?Se++:(c=o,0===Ue&&Qe(ie)),c===o&&(c=null),i=[],l=e.charAt(Se),I.test(l)?Se++:(l=o,0===Ue&&Qe(le)),l!==o)for(;l!==o;)i.push(l),l=e.charAt(Se),I.test(l)?Se++:(l=o,0===Ue&&Qe(le));else i=o;i!==o?u=a=[a,c,i]:(Se=u,u=o)}else Se=u,u=o;u===o&&(u=null),Me=t,t=Re()}else Se=t,t=o;return t}if(r=l(),t.peg$library)return{peg$result:r,peg$currPos:Se,peg$FAILED:o,peg$maxFailExpected:Te,peg$maxFailPos:Ne};if(r!==o&&Se===e.length)return r;throw r!==o&&Se<e.length&&Qe({type:"end"}),n=Te,u=Ne<e.length?e.charAt(Ne):null,a=Ne<e.length?Ke(Ne,Ne+1):Ke(Ne,Ne),new h(h.buildMessage(n,u),n,u,a)}(e)}catch(t){throw new u("effect:invalid-syntax","Invalid effect syntax",{value:e,error:t})}return t.map((e=>function(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function(e){let t=1;return d(e.parameters,1),1===e.parameters.length&&(t=b(e.parameters[0])),new c(e.name,t)}(e);case"opacity":return function(e){let t=1;return d(e.parameters,1),1===e.parameters.length&&(t=b(e.parameters[0])),new i(t)}(e);case"hue-rotate":return function(e){let t=0;var r;return d(e.parameters,1),1===e.parameters.length&&(function(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=x[e.unit]))throw new u("effect:type-error",`Expected <angle>, Actual: ${y(e)}`,{term:e})}(r=e.parameters[0]),t=r.value*x[r.unit]||0),new l(t)}(e);case"blur":return function(e){let t=0;return d(e.parameters,1),1===e.parameters.length&&(t=F(e.parameters[0]),w(t,e.parameters[0])),new s(t)}(e);case"drop-shadow":return function(e){const t=[];let r=null;for(const n of e.parameters)if("color"===n.type){if(t.length&&Object.freeze(t),r)throw new u("effect:type-error","Accepts only one color",{});r=$(n)}else{const e=F(n);if(Object.isFrozen(t))throw new u("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(e),3===t.length&&w(e,n)}if(t.length<2||t.length>3)throw new u("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new f(t[0],t[1],t[2]||0,r||C("black"))}(e);case"bloom":return function(e){let t=1,r=0,n=0;return d(e.parameters,3),e.parameters[0]&&(t=b(e.parameters[0])),e.parameters[1]&&(r=F(e.parameters[1]),w(r,e.parameters[1])),e.parameters[2]&&(n=b(e.parameters[2])),new p(t,r,n)}(e)}}catch(t){throw t.details.filter=e,t}throw new u("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}(e)))}function d(e,t){if(e.length>t)throw new u("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function y(e){if("color"===e.type)return"<color>";if(e.unit){if(e.unit in A)return"<length>";if(e.unit in x)return"<angle>";if("%"===e.unit)return"<percentage>"}return"<double>"}function w(e,t){if(e<0)throw new u("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}!function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(h,Error),h.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r,n=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){n=e[r].text.split(/\r\n|\n|\r/g);break}var u=this.location.start,a=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(u):u,o=this.location.source+":"+a.line+":"+a.column;if(n){var c=this.location.end,i=m("",a.line.toString().length," "),l=n[u.line-1],s=(u.line===c.line?c.column:l.length+1)-u.column||1;t+="\n --\x3e "+o+"\n"+i+" |\n"+a.line+" | "+l+"\n"+i+" | "+m("",u.column-1," ")+m("",s,"^")}else t+="\n at "+o}return t},h.buildMessage=function(e,t){var r={literal:function(e){return'"'+u(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?a(e[0])+"-"+a(e[1]):a(e)}));return"["+(e.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function u(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function o(e){return r[e.type](e)}return"Expected "+function(e){var t,r,n=e.map(o);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+u(e)+'"':"end of input"}(t)+" found."};const x={deg:1,grad:.9,rad:180/Math.PI,turn:360},A={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function b(e){!function(e){if("quantity"!==e.type||null!==e.unit&&"%"!==e.unit)throw new u("effect:type-error",`Expected <double> or <percentage>, Actual: ${y(e)}`,{term:e})}(e);const t=e.value;return w(t,e),"%"===e.unit?.01*t:t}function F(e){return function(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=A[e.unit]))throw new u("effect:type-error",`Expected <length>, Actual: ${y(e)}`,{term:e})}(e),e.value*A[e.unit]||0}function $(t){switch(t.colorType){case"hex":return e(t.value);case"named":return C(t.value);case"function":return function(e){if(d(e.parameters,4),E.test(e.name))return[b(e.parameters[0]),b(e.parameters[1]),b(e.parameters[2]),e.parameters[3]?b(e.parameters[3]):1];if(j.test(e.name))return n(function(e){return function(e){if("quantity"!==e.type||null!==e.unit)throw new u("effect:type-error",`Expected <double>, Actual: ${y(e)}`,{term:e})}(e),w(e.value,e),e.value}(e.parameters[0]),b(e.parameters[1]),b(e.parameters[2]),e.parameters[3]?b(e.parameters[3]):1);throw new u("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}(t.value)}}function C(e){if(!t(e))throw new u("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return r(e)}const E=/^rgba?/i,j=/^hsla?/i;export{g as p};
