/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import"../core/lang.js";import{L as e}from"./Logger.js";import{p as t,g as s}from"./utils.js";var n;!function(e){e[e.Dirty=1]="Dirty",e[e.Overridden=2]="Overridden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"}(n||(n={}));class i{constructor(e){this.accessed=void 0,this._handles=void 0,this._observer=e}destroy(){this.accessed?.clear(),this.clear()}onAccessed(e){null!=this._observer&&e!==this._observer&&(null==this.accessed&&(this.accessed=new Set),this.accessed.add(e))}onTrackingEnd(){null!=this._observer&&(this.clear(),null!=this.accessed&&(null==this._handles&&(this._handles=[]),this.accessed.forEach((e=>{this._handles.push(e.observe(this._observer))})),this.accessed.clear()))}clear(){if(null!=this._handles){for(let e=0;e<this._handles.length;++e)this._handles[e].remove();this._handles.length=0}}}const r=new i,a=[];let c=r;function l(e){c.onAccessed(e)}let o=!1,u=!1;function d(e,t,s){if(o)return h(e,t,s);let n=null;return f(e),n=t.call(s),p(),n}function g(e,t){return d(r,e,t)}function h(t,s,n){const i=o;o=!0,f(t);let r=null;try{r=s.call(n)}catch(t){u&&e.getLogger("esri.core.accessorSupport.tracking").error(t)}return p(),o=i,r}function f(e){c=e,a.push(e)}function p(){const e=a.length;if(e>1){const t=a.pop();c=a[e-2],t.onTrackingEnd()}else if(1===e){const e=a.pop();c=r,e.onTrackingEnd()}else c=r}function k(e,t){if(t.flags&n.DepTrackingInitialized)return;t.flags|=n.DepTrackingInitialized;const s=u;u=!1,t.flags&n.AutoTracked?h(t.trackingTarget,t.metadata.get,e):y(e,t),u=s}const T=[];function y(e,s){s.flags&n.ExplicitlyTracking||(s.flags|=n.ExplicitlyTracking,h(s.trackingTarget,(()=>{const n=s.metadata.dependsOn||T;for(const s of n)if("string"!=typeof s||s.includes(".")){const n=t(s);for(let t=0,s=e;t<n.length&&null!=s&&"object"==typeof s;++t)s=v(s,n[t],t!==n.length-1)}else v(e,s,!1)})),s.flags&=~n.ExplicitlyTracking)}function v(e,t,n){const i="?"===t[t.length-1]?t.slice(0,-1):t;if(null!=e.getItemAt||Array.isArray(e)){const t=parseInt(i,10);if(!isNaN(t))return Array.isArray(e)?e[t]:e.at(t)}const r=s(e);if(r){const t=r.propertiesByName.get(i);t&&(l(t),k(e,t))}return n?e[i]:void 0}export{n as F,i as T,y as a,g as b,k as i,d as r,l as t};
