/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{i as t}from"../../core/lang.js";import{S as e,G as s,p as r,h as o,bw as n,J as i,aZ as m,g as u,t as c,c as p,f as a}from"../../chunks/converterAPI.js";import{e as l,a as j,g as h,G as d,P as g,o as k}from"../../chunks/Transformation2D.js";import"../../chunks/tslib.es6.js";import"../../geometry.js";import"../../chunks/ensureType.js";import"../../chunks/Logger.js";import"../../config.js";import"../Extent.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/metadata.js";import"../../core/Error.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/tracking.js";import"../Geometry.js";import"../../core/JSONSupport.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/maybe.js";import"../../chunks/ObservableBase.js";import"../../core/scheduling.js";import"../../core/promiseUtils.js";import"../../chunks/reader.js";import"../SpatialReference.js";import"../../chunks/unitUtils.js";import"../../chunks/jsonMap.js";import"../../chunks/assets.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/writer.js";import"../Point.js";import"../../core/accessorSupport/decorators/cast.js";import"../support/webMercatorUtils.js";import"../Multipoint.js";import"../../chunks/zmUtils.js";import"../Polygon.js";import"../../chunks/coordsUtils.js";import"../../chunks/Axis.js";import"../../chunks/extentUtils.js";import"../../chunks/boundsUtils.js";import"../../chunks/aaBoundingRect.js";import"../../chunks/mathUtils.js";import"../Polyline.js";import"../../chunks/typeUtils.js";import"../support/jsonUtils.js";function f(t,e,s,o){const n=t.getImpl().getAttributeStreamRef(0),m=t.getPointCount(),u=e.getXY(),c=t.createInstance(),p=i(s),a=new r;if(t.queryEnvelope(a),a.inflateCoords(p,p),a.contains(u)){const s=p*p;let r=!1;const o=k(m,!1);for(let t=0;t<m;t++){const e=n.read(2*t),i=n.read(2*t+1),m=e-u.x,c=i-u.y;m*m+c*c<=s&&(r=!0,o[t]=!0)}if(r)for(let e=0;e<m;e++)o[e]||c.addPoints(t,e,e+1);else c.addPoints(t,0,m),c.add(e)}else c.addPoints(t,0,m),c.add(e);return c}class y extends s{constructor(t,e,s,r){super(),this.m_progressTracker=r,this.m_index=-1,this.m_inputGeoms=t,this.m_spatialReference=s,this.m_rightGeom=e.next(),this.m_bEmpty=!this.m_rightGeom,j(this.m_rightGeom)}tock(){return h(0),!1}getRank(){return h(0),0}next(){if(this.m_bEmpty)return null;const t=this.m_inputGeoms.next();return t?(j(t),this.m_index=this.m_inputGeoms.getGeometryID(),function(t,e,s,u){const c=t.getDimension(),p=e.getDimension();if(c!==p)return c>p?t:e;if(t.isEmpty())return e;if(e.isEmpty())return t;const a=new r,l=new r,j=new r;t.queryEnvelope(a),e.queryEnvelope(l),j.setCoords({env2D:a}),j.mergeEnvelope2D(l);const h=o(s,j,!0),k=t.getGeometryType(),y=e.getGeometryType();return k===d.enumPoint&&y===d.enumPoint?function(t,e,s){const r=i(s),o=r*r,n=t.getXY(),u=e.getXY(),c=new m({vd:t.getDescription()});return g.sqrDistance(n,u)>o&&(c.add(t),c.add(e)),c}(t,e,h):k===d.enumPoint&&y===d.enumMultiPoint?f(e,t,h):k===d.enumMultiPoint&&y===d.enumPoint?f(t,e,h):n(t,e,s,u)}(t,this.m_rightGeom,this.m_spatialReference,this.m_progressTracker)):null}getGeometryID(){return this.m_index}}const x=new class{getOperatorType(){return 10003}supportsCurves(){return!0}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}executeMany(t,e,s,r){return new y(t,e,s,r)}execute(t,s,r,o){const n=new e([t]),i=new e([s]),m=this.executeMany(n,i,r,o).next();return m||l("null output"),m}};function G(t,e){const s=u(t);return c(function(t,e,s){return x.execute(t,e,s,null)}(a(t),a(e),p(s)),s)}function _(s,r){const o=s.map(a),n=u(s);return function(t,s,r){const o=x.executeMany(new e(t),new e([s]),r,null);return Array.from(o)}(o,a(r),p(n)).map((t=>c(t,n))).filter(t)}function P(){return x.supportsCurves()}export{G as execute,_ as executeMany,P as supportsCurves};
