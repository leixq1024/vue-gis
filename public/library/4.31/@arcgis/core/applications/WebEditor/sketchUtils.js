/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{c as o}from"../../chunks/asyncUtils.js";import{ignoreAbortErrors as e,isAborted as t,createResolver as s,onAbort as i,waitTick as r,o as n}from"../../core/promiseUtils.js";import{m as c}from"../../chunks/handleUtils.js";import{whenOnce as a}from"../../core/reactiveUtils.js";import{waitAnimationFrame as p}from"../../core/scheduling.js";import{c as m}from"../../chunks/screenUtils.js";import{S as l}from"../../chunks/SketchTooltipVisibleElements.js";import"../../chunks/tslib.es6.js";import"../../core/Accessor.js";import"../../core/lang.js";import"../../core/Handles.js";import"../../chunks/Logger.js";import"../../config.js";import"../../chunks/maybe.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/metadata.js";import"../../chunks/utils.js";import"../../chunks/tracking.js";import"../../chunks/ensureType.js";import"../../core/Error.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/ObservableBase.js";import"../../core/Collection.js";import"../../core/Evented.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";async function u(l,u,f={}){const h=d.get(l);h&&(h.abort(),await h.promise);const j=o((async function(o){const e=function(o){const{activeComponent:e}=o;return e&&"tooltip"in e&&"activeTooltipInfo"in e&&"destroyed"in e?e:null}(l),{tooltipOptions:d}=l;if("coordinates"===u?(u="x",d.xyMode="coordinates"):"direction"!==u&&"distance"!==u||(d.xyMode="direction-distance"),await p(),t(f)||t(o))return;const h=e?.tooltip;if(!h||!e.activeTooltipInfo?.editableFields?.find((o=>o.name===u)))return;const{handle:j,promise:k}=function(o,{hideOnBlur:e=!0}){const t=s();if(!e)return{promise:t.promise,handle:c()};const{outerContainer:i}=o,r=n(i,"focusout",(({relatedTarget:o})=>{o instanceof HTMLElement&&i.contains(o)||t.resolve()}));return{promise:t.promise,handle:r}}(h,f),v=s(),b=i(f.signal,v.resolve),y=i(o,v.resolve),g=d.offset,w=h.position;try{if(d.forceEnabled=!0,await r(),f.position&&(d.offset=0,h.position=m(f.position[0],f.position[1])),await h.enterInputMode(u),t(f)||t(o))return;f.onOpen?.(),await Promise.race([a((()=>e.destroyed||"feedback"===h.content?.mode),f),k,v.promise])}finally{b?.remove(),y?.remove(),j.remove();const o=h.outerContainer.contains(document.activeElement);d.enabled?await h.exitInputMode({focusOnView:o}):o&&l.view?.focus(),f.onClose?.(),h.position=w,d.offset=g,d.forceEnabled=!1}}));return d.set(l,j),j.promise.catch(e).finally((()=>{d.get(l)===j&&d.delete(l)}))}const d=new Map,f={area:!1,distance:!1,direction:!1,elevation:!1,orientation:!1,radius:!1,rotation:!1,scale:!1,size:!1,totalLength:!1,coordinates:!1,helpMessage:!1,header:!1};function h(o){o.tooltipOptions.visibleElements=new l(f)}export{h as hideAllVisibleElements,u as showTooltipAndFocusField};
