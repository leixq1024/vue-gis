/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import"../../renderers/PointCloudClassBreaksRenderer.js";import"../../renderers/PointCloudRenderer.js";import e from"../../renderers/PointCloudRGBRenderer.js";import s from"../../renderers/PointCloudStretchRenderer.js";import"../../renderers/PointCloudUniqueValueRenderer.js";import r from"../../renderers/ClassBreaksRenderer.js";import"../../renderers/DictionaryRenderer.js";import"../../renderers/DotDensityRenderer.js";import"../../renderers/HeatmapRenderer.js";import"../../renderers/PieChartRenderer.js";import"../../renderers/Renderer.js";import"../../renderers/SimpleRenderer.js";import"../../renderers/UniqueValueRenderer.js";import"../../renderers/support/jsonUtils.js";import"../../chunks/Logger.js";import{d as o}from"../../chunks/colorUtils2.js";import i from"../../core/Error.js";import{clone as t}from"../../core/lang.js";import{a}from"../../chunks/ensureType.js";import{f as n}from"../../chunks/messages.js";import l from"../../renderers/support/AuthoringInfo.js";import m from"../../renderers/support/AuthoringInfoVisualVariable.js";import{setLabelsForClassBreaks as p,createColorStops as u}from"../../renderers/support/utils.js";import c from"../../renderers/visualVariables/ColorVariable.js";import d from"../../renderers/visualVariables/support/ColorStop.js";import{V as y}from"../../renderers/visualVariables/VisualVariable.js";import{a as h}from"../../chunks/ageUnit.js";import{b as f,o as j,e as b,d as v,f as g,h as w,u as k,v as T,i as S,j as x,k as V,l as z,g as E,c as I,m as U,n as M,p as C,a as O}from"../../chunks/utils19.js";import P from"../heuristics/sizeRange.js";import{s as R,u as B,p as D,g as F,a as L,h as q,b as A,f as G,c as Q,d as $}from"../../chunks/regenerateUtils.js";import{verifyDates as N,supportedAgeUnits as W}from"../statistics/support/ageUtils.js";import{v as H}from"../../chunks/binningUtils.js";import{i as J,d as Z,b as K}from"../../chunks/utils3.js";import{b as X,f as Y,c as _,g as ee,L as se}from"../../chunks/layerUtils3.js";import{cloneScheme as re,getSchemes as oe,getSchemeById as ie}from"../symbology/color.js";import"../../chunks/tslib.es6.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/metadata.js";import"../../chunks/enumeration.js";import"../../chunks/jsonMap.js";import"../../config.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/tracking.js";import"../../chunks/RendererLegendOptions.js";import"../../core/Clonable.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/maybe.js";import"../../chunks/ObservableBase.js";import"../../core/scheduling.js";import"../../core/promiseUtils.js";import"../../core/JSONSupport.js";import"../../Color.js";import"../../chunks/colorUtils.js";import"../../chunks/mathUtils.js";import"../../chunks/PointSizeSplatAlgorithm.js";import"../../chunks/writer.js";import"../../symbols.js";import"../../symbols/CIMSymbol.js";import"../../chunks/reader.js";import"../../layers/support/fieldUtils.js";import"../../core/sql.js";import"../../intl.js";import"../../chunks/date.js";import"../../chunks/locale.js";import"../../chunks/datetime.js";import"../../chunks/number.js";import"../../chunks/substitute.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/assets.js";import"../../geometry.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../geometry/SpatialReference.js";import"../../chunks/unitUtils.js";import"../../geometry/Point.js";import"../../core/accessorSupport/decorators/cast.js";import"../../geometry/support/webMercatorUtils.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/coordsUtils.js";import"../../chunks/Axis.js";import"../../chunks/extentUtils.js";import"../../chunks/boundsUtils.js";import"../../chunks/aaBoundingRect.js";import"../../geometry/Polyline.js";import"../../chunks/typeUtils.js";import"../../geometry/support/jsonUtils.js";import"../../symbols/Symbol.js";import"../../symbols/ExtrudeSymbol3DLayer.js";import"../../symbols/Symbol3DLayer.js";import"../../chunks/utils4.js";import"../../symbols/edges/Edges3D.js";import"../../chunks/screenUtils.js";import"../../chunks/materialUtils.js";import"../../chunks/opacityUtils.js";import"../../symbols/edges/SketchEdges3D.js";import"../../symbols/edges/SolidEdges3D.js";import"../../chunks/Symbol3DMaterial.js";import"../../chunks/vec3f64.js";import"../../symbols/FillSymbol.js";import"../../symbols/SimpleLineSymbol.js";import"../../symbols/LineSymbol.js";import"../../symbols/LineSymbolMarker.js";import"../../chunks/lineMarkers.js";import"../../symbols/FillSymbol3DLayer.js";import"../../symbols/patterns/LineStylePattern3D.js";import"../../symbols/patterns/StylePattern3D.js";import"../../chunks/utils5.js";import"../../chunks/colors.js";import"../../chunks/symbolLayerUtils3D.js";import"../../chunks/aaBoundingBox.js";import"../../symbols/Font.js";import"../../symbols/IconSymbol3DLayer.js";import"../../chunks/persistableUrlUtils.js";import"../../symbols/LabelSymbol3D.js";import"../../core/Collection.js";import"../../core/Evented.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../symbols/Symbol3D.js";import"../../chunks/collectionUtils.js";import"../../portal/Portal.js";import"../../core/Loadable.js";import"../../core/Promise.js";import"../../portal/PortalGroup.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../../symbols/LineSymbol3DLayer.js";import"../../symbols/LineStyleMarker3D.js";import"../../symbols/ObjectSymbol3DLayer.js";import"../../symbols/PathSymbol3DLayer.js";import"../../symbols/TextSymbol3DLayer.js";import"../../symbols/WaterSymbol3DLayer.js";import"../../symbols/support/StyleOrigin.js";import"../../chunks/Thumbnail.js";import"../../chunks/calloutUtils.js";import"../../symbols/callouts/Callout3D.js";import"../../symbols/callouts/LineCallout3D.js";import"../../symbols/support/Symbol3DVerticalOffset.js";import"../../symbols/LineSymbol3D.js";import"../../symbols/MarkerSymbol.js";import"../../symbols/MeshSymbol3D.js";import"../../symbols/PictureFillSymbol.js";import"../../chunks/urlUtils.js";import"../../symbols/PictureMarkerSymbol.js";import"../../symbols/PointSymbol3D.js";import"../../symbols/PolygonSymbol3D.js";import"../../core/reactiveUtils.js";import"../../chunks/asyncUtils.js";import"../../symbols/SimpleFillSymbol.js";import"../../symbols/SimpleMarkerSymbol.js";import"../../symbols/TextSymbol.js";import"../../symbols/WebStyleSymbol.js";import"../../renderers/mixins/VisualVariablesMixin.js";import"../../renderers/visualVariables/OpacityVariable.js";import"../../renderers/visualVariables/support/OpacityStop.js";import"../../renderers/visualVariables/RotationVariable.js";import"../../renderers/visualVariables/SizeVariable.js";import"../../renderers/visualVariables/support/SizeStop.js";import"../../chunks/sizeVariableUtils.js";import"../../chunks/visualVariableUtils.js";import"../../Graphic.js";import"../../PopupTemplate.js";import"../../popup/content.js";import"../../popup/content/AttachmentsContent.js";import"../../popup/content/Content.js";import"../../popup/content/CustomContent.js";import"../../popup/content/ExpressionContent.js";import"../../popup/ElementExpressionInfo.js";import"../../popup/content/FieldsContent.js";import"../../popup/FieldInfo.js";import"../../popup/support/FieldInfoFormat.js";import"../../popup/content/MediaContent.js";import"../../popup/content/BarChartMediaInfo.js";import"../../popup/content/mixins/ChartMediaInfo.js";import"../../popup/content/mixins/MediaInfo.js";import"../../popup/content/support/ChartMediaInfoValue.js";import"../../popup/content/support/ChartMediaInfoValueSeries.js";import"../../chunks/chartMediaInfoUtils.js";import"../../popup/content/ColumnChartMediaInfo.js";import"../../popup/content/ImageMediaInfo.js";import"../../popup/content/support/ImageMediaInfoValue.js";import"../../popup/content/LineChartMediaInfo.js";import"../../popup/content/PieChartMediaInfo.js";import"../../popup/content/RelationshipContent.js";import"../../popup/support/RelatedRecordsInfoFieldOrder.js";import"../../popup/content/TextContent.js";import"../../popup/content/UtilityNetworkAssociationsContent.js";import"../../popup/support/UtilityNetworkAssociationType.js";import"../../popup/ExpressionInfo.js";import"../../popup/LayerOptions.js";import"../../popup/RelatedRecordsInfo.js";import"../../support/actions/ActionBase.js";import"../../core/Identifiable.js";import"../../support/actions/ActionButton.js";import"../../support/actions/ActionToggle.js";import"../../chunks/compilerUtils.js";import"../../chunks/lengthUtils.js";import"../../renderers/support/ClassBreakInfo.js";import"../../chunks/commonProperties.js";import"../../symbols/support/jsonUtils.js";import"../../chunks/layerUtils.js";import"../../chunks/defaults.js";import"../../chunks/defaultsJSON.js";import"../../chunks/colorRamps.js";import"../../rest/support/AlgorithmicColorRamp.js";import"../../rest/support/ColorRamp.js";import"../../rest/support/MultipartColorRamp.js";import"../../chunks/LRUCache.js";import"../../chunks/MemCache.js";import"../../chunks/Version2.js";import"../../layers/support/FieldsIndex.js";import"../../chunks/UnknownTimeZone.js";import"../../chunks/OverrideHelper.js";import"../../chunks/utils7.js";import"../../chunks/enums2.js";import"../../chunks/quantizationUtils.js";import"../../renderers/support/AttributeColorInfo.js";import"../../renderers/support/HeatmapColorStop.js";import"../../chunks/heatmapUtils.js";import"../../chunks/vec4.js";import"../../chunks/common.js";import"../../chunks/vec4f64.js";import"../../chunks/diffUtils.js";import"../../renderers/support/UniqueValue.js";import"../../renderers/support/UniqueValueClass.js";import"../../renderers/support/UniqueValueGroup.js";import"../../renderers/support/UniqueValueInfo.js";import"../../chunks/styleUtils.js";import"../../chunks/numberUtils.js";import"../../chunks/utils12.js";import"../../chunks/jsonUtils.js";import"../../chunks/parser.js";import"../../chunks/utils2.js";import"../../chunks/mat4.js";import"../../symbols/support/cimSymbolUtils.js";import"../../chunks/colorRampUtils2.js";import"../../chunks/utils15.js";import"../../chunks/timeUtils.js";import"../../chunks/basemapUtils.js";import"../../Basemap.js";import"../../chunks/loadAll.js";import"../../portal/PortalItem.js";import"../../portal/PortalItemResource.js";import"../../portal/PortalRating.js";import"../../support/BasemapStyle.js";import"../../chunks/writeUtils.js";import"../statistics/summaryStatisticsForAge.js";import"../statistics/summaryStatistics.js";import"../../chunks/utils13.js";import"../../chunks/utils11.js";import"../../chunks/generateRendererUtils.js";import"../../core/workers/workers.js";import"../../core/workers/Connection.js";import"../../chunks/Queue.js";import"../../core/workers/RemoteClient.js";import"../../chunks/arcgisLayerUrl.js";import"../../chunks/utils9.js";import"../../chunks/executeQuery.js";import"../../chunks/infoFor3D.js";import"../../chunks/DataLayerSource.js";import"../../layers/support/Field.js";import"../../chunks/domains.js";import"../../layers/support/CodedValueDomain.js";import"../../layers/support/Domain.js";import"../../layers/support/InheritedDomain.js";import"../../layers/support/RangeDomain.js";import"../../chunks/fieldType.js";import"../../chunks/executeQueryJSON.js";import"../../chunks/query.js";import"../../geometry/support/normalizeUtils.js";import"../../chunks/normalizeUtilsCommon.js";import"../../chunks/simplify.js";import"../../chunks/utils10.js";import"../../chunks/pbfQueryUtils.js";import"../../chunks/pbf.js";import"../../chunks/OptimizedGeometry.js";import"../../chunks/OptimizedFeature.js";import"../../chunks/OptimizedFeatureSet.js";import"../../chunks/queryZScale.js";import"../../chunks/zscale.js";import"../../rest/support/FeatureSet.js";import"../../rest/support/Query.js";import"../../chunks/FullTextSearch.js";import"../../chunks/spatialRelationships.js";import"../../rest/support/StatisticDefinition.js";import"../../time/TimeExtent.js";import"../../chunks/executeQueryPBF.js";import"../../chunks/featureConversionUtils.js";import"../../chunks/BinsQuery.js";import"../../chunks/queryUtils.js";import"../../geometry/projection.js";import"../../chunks/projectBuffer.js";import"../../chunks/geodesicConstants.js";import"../../geometry/support/GeographicTransformation.js";import"../../geometry/support/GeographicTransformationStep.js";import"../../chunks/projectionSupport.js";import"../../chunks/json.js";import"../statistics/support/predominanceUtils.js";import"../../chunks/statsWorker.js";import"../../chunks/utils16.js";import"../../chunks/viewpointUtils.js";import"../../Viewpoint.js";import"../../Camera.js";import"../../CameraLayout.js";import"../../chunks/Cyclical.js";import"../../chunks/mat2d.js";import"../../chunks/mat2df64.js";import"../../chunks/vec2.js";import"../../chunks/vec2f64.js";import"../../chunks/scaleUtils.js";import"../../chunks/spatialStatistics.js";import"../statistics/classBreaks.js";import"../../views/support/colorUtils.js";import"../heuristics/scaleRange.js";import"../../chunks/colors2.js";import"../../chunks/symbologyUtils.js";import"../../chunks/utils20.js";const te=2**53-1;async function ae(e){if(!(e&&e.layer&&(e.field||e.valueExpression||e.sqlExpression)))throw new i("color-visual-variable:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(e.valueExpression&&!e.sqlExpression&&!e.view)throw new i("color-visual-variable:missing-parameters","View is required when 'valueExpression' is specified");e.forBinning&&H(e,"color-visual-variable");const s={...e},r=e.forBinning?X:Y,o=_(s.layer,r,e.forBinning);if(!o)throw new i("color-visual-variable:invalid-parameters","'layer' must be one of these types: "+ee(r).join(", "));const t=null!=s.signal?{signal:s.signal}:null;if(await o.load(t),"mesh"!==o.geometryType&&s.worldScale&&(!s.view||"3d"!==s.view.type))throw new i("color-visual-variable:invalid-parameters","'view' parameter should be an instance of SceneView when 'worldScale' parameter is true");const a=await Z({field:s.field,normalizationField:s.normalizationField,valueExpression:s.valueExpression}),n=T(o,a,"color-visual-variable:invalid-parameters");if(n)throw n;return{...s,layer:o}}async function ne(e){if(!(e&&e.layer&&(e.field||e.valueExpression||e.sqlExpression)))throw new i("color-continuous-renderer:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(e.valueExpression&&!e.sqlExpression&&!e.view)throw new i("color-continuous-renderer:missing-parameters","View is required when 'valueExpression' is specified");e.forBinning&&H(e,"color-continuous-renderer");const s={...e};s.symbolType=s.symbolType||"2d",s.defaultSymbolEnabled??=!0;const r=e.forBinning?X:Y,o=_(s.layer,r,e.forBinning);if(!o)throw new i("color-continuous-renderer:invalid-parameters","'layer' must be one of these types: "+ee(r).join(", "));const t=null!=s.signal?{signal:s.signal}:null;await o.load(t);const a=o.geometryType;if(s.outlineOptimizationEnabled="polygon"===a&&s.outlineOptimizationEnabled,s.sizeOptimizationEnabled=("point"===a||"multipoint"===a||"polyline"===a)&&s.sizeOptimizationEnabled,"mesh"===a)s.symbolType="3d-volumetric",s.colorMixMode=s.colorMixMode||"replace",s.edgesType=s.edgesType||"none";else{if("3d-volumetric-uniform"===s.symbolType&&"point"!==a)throw new i("color-continuous-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(s.symbolType.includes("3d-volumetric")&&(!s.view||"3d"!==s.view.type))throw new i("color-continuous-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'")}const n=await Z({field:s.field,normalizationField:s.normalizationField,valueExpression:s.valueExpression}),l=T(o,n,"color-continuous-renderer:invalid-parameters");if(l)throw l;return{...s,layer:o}}async function le(e){if(!e||!e.layer||!e.field&&!e.valueExpression)throw new i("color-class-breaks-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(e.valueExpression&&!e.view)throw new i("color-class-breaks-renderer:missing-parameters","View is required when 'valueExpression' is specified");e.forBinning&&H(e,"color-class-breaks-renderer");const s={...e};s.symbolType=s.symbolType||"2d",s.defaultSymbolEnabled??=!0,s.classificationMethod??="equal-interval",s.normalizationType=K(s);const r=e.forBinning?X:Y,o=_(s.layer,r,e.forBinning);if(!o)throw new i("color-class-breaks-renderer:invalid-parameters","'layer' must be one of these types: "+ee(r).join(", "));if(!(null!=s.minValue&&null!=s.maxValue||null==s.minValue&&null==s.maxValue))throw new i("color-class-breaks-renderer:missing-parameters","Both 'minValue' and 'maxValue' are required when specifying custom data range");const t=null!=s.signal?{signal:s.signal}:null;await o.load(t);const a=o.geometryType;if(s.outlineOptimizationEnabled="polygon"===a&&s.outlineOptimizationEnabled,"mesh"===a)s.symbolType="3d-volumetric",s.colorMixMode=s.colorMixMode||"replace",s.edgesType=s.edgesType||"none";else{if("3d-volumetric-uniform"===s.symbolType&&"point"!==a)throw new i("color-class-breaks-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(s.symbolType.includes("3d-volumetric")&&(!s.view||"3d"!==s.view.type))throw new i("color-class-breaks-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'")}const n=await Z({field:s.field,normalizationField:s.normalizationField}),l=T(o,n,"color-class-breaks-renderer:invalid-parameters");if(l)throw l;return{...s,layer:o}}function me(e){const s={...e};delete s.basemap,delete s.colorScheme,delete s.legendOptions,delete s.symbolType,delete s.defaultSymbolEnabled,delete s.colorMixMode,delete s.edgesType;const r=s;return r.analyzeData=!(null!=s.minValue&&null!=s.maxValue),r}function pe(e){const s={...e},r=!!s.symbolType?.includes("3d-volumetric");delete s.symbolType,delete s.defaultSymbolEnabled,delete s.colorMixMode,delete s.edgesType;const o=s;return o.worldScale=r,o}async function ue(e){if(!(e&&e.layer&&e.view&&e.startTime&&e.endTime))throw new i("color-age-renderer:missing-parameters","'layer', 'view', startTime', 'endTime' parameters are required");const s={...e};s.symbolType=s.symbolType||"2d",s.defaultSymbolEnabled??=!0;const r=_(s.layer,Y);if(!r)throw new i("color-age-renderer:invalid-parameters","'layer' must be one of these types: "+ee(Y).join(", "));const o=null!=s.signal?{signal:s.signal}:null;await r.load(o);const t=r.geometryType;if(s.outlineOptimizationEnabled="polygon"===t&&s.outlineOptimizationEnabled,s.sizeOptimizationEnabled=("point"===t||"multipoint"===t||"polyline"===t)&&s.sizeOptimizationEnabled,"mesh"===t)s.symbolType="3d-volumetric",s.colorMixMode=s.colorMixMode||"replace",s.edgesType=s.edgesType||"none";else if("3d-volumetric-uniform"===s.symbolType&&"point"!==t)throw new i("color-continuous-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(s.symbolType.includes("3d-volumetric")&&(!s.view||"3d"!==s.view.type))throw new i("color-age-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'");const a=N(r,s.startTime,s.endTime,"color-age-renderer:invalid-parameters");if(a)throw a;if(s.unit&&!W.includes(s.unit))throw new i("color-age-renderer:invalid-unit",`Supported units are: ${W.join(", ")}`);return{...s,layer:r}}async function ce(e,s){let r=e.colorScheme,o=null,i=null;const{view:t}=e,a=await O(e.basemap,t);if(o=null!=a.basemapId?a.basemapId:null,i=null!=a.basemapTheme?a.basemapTheme:null,r)return{scheme:re(r),basemapId:o,basemapTheme:i};const n=e.theme||"high-to-low",l=oe({theme:n,basemapTheme:i,geometryType:e.geometryType,worldScale:e.worldScale,view:t});if(l)if(o=l.basemapId,i=l.basemapTheme,e.schemeId){const s=n+"/"+o+"/"+e.schemeId;r=ie({id:s,geometryType:e.geometryType})}else r=l.primaryScheme;return{scheme:r,basemapId:o,basemapTheme:i}}function de(e,s,r,o){const i=E(e,s,r,!0);return{values:I(i,e,s,o),defaultValuesUsed:i.defaultValuesUsed}}async function ye(e,s,o,i,t,a,l){const m=await n("esri/smartMapping/t9n/smartMapping"),{field:p,defaultSymbolEnabled:u}=l,c=re(e.colorScheme),d=s?.opacity,y=[e.visualVariable.clone()];return s?.visualVariables?.length&&y.push(...s.visualVariables.map((e=>e.clone()))),o?.minSize&&y.push(o.minSize),{renderer:new r({classBreakInfos:[{minValue:-te,maxValue:te,symbol:U(a,{type:l.symbolType,color:c.noDataColor,size:M(c,a),outline:C(c,a,d),meshInfo:{colorMixMode:l.colorMixMode,edgesType:l.edgesType}})}],defaultLabel:u?m.other:null,defaultSymbol:u?U(a,{type:l.symbolType,color:c.noDataColor,size:M(c,a),outline:C(c,a,d),meshInfo:{colorMixMode:l.colorMixMode,edgesType:l.edgesType}}):null,field:p,normalizationType:i,normalizationField:t,valueExpression:l.valueExpression,valueExpressionTitle:l.valueExpressionTitle,visualVariables:y,authoringInfo:e.authoringInfo&&e.authoringInfo.clone()}),visualVariable:e.visualVariable.clone(),statistics:e.statistics,defaultValuesUsed:e.defaultValuesUsed,colorScheme:re(e.colorScheme),basemapId:e.basemapId,basemapTheme:e.basemapTheme}}async function he(e){const s=await ae(e),{view:r,field:t,valueExpression:n,minValue:p,maxValue:u,layer:h,normalizationField:j,signal:b,filter:v,statistics:g}=s,w=j?"field":void 0,k=await(g??f({layer:h,field:t,valueExpression:n,sqlExpression:s.sqlExpression,sqlWhere:s.sqlWhere,normalizationType:w,normalizationField:j,minValue:p,maxValue:u,filter:v,view:r,signal:b})),T=h,S=t&&"function"!=typeof t?T.getField(t):null;return async function(e,s,r,t){const{field:n,theme:p}=e,u=await ce({basemap:e.basemap,theme:e.theme,geometryType:r,colorScheme:e.colorScheme,worldScale:e.worldScale,view:e.view}),h=u.scheme;if(!h)throw new i("color-visual-variable:insufficient-info","Unable to find color scheme");const f=o(h.colors,5);if(f.length<5)throw new i("color-visual-variable:insufficient-info","Color scheme does not have enough colors");const j=h.id.includes("seq-"),{values:b,defaultValuesUsed:v}=de(s,p,t,j),g=o(f,5),w=new c({field:n??void 0,valueExpression:e.valueExpression,valueExpressionTitle:e.valueExpressionTitle,normalizationField:e.normalizationField,stops:b.map(((e,s)=>new d({value:e,color:g[s]}))),legendOptions:a(y,e.legendOptions)}),k=new m({type:"color",minSliderValue:null!=e.minValue?e.minValue:s.min,maxSliderValue:null!=e.maxValue?e.maxValue:s.max,theme:h.theme}),T=new l({visualVariables:[k]});return{basemapId:u.basemapId,basemapTheme:u.basemapTheme,visualVariable:w,statistics:s,defaultValuesUsed:v,colorScheme:re(h),authoringInfo:T}}(s,k,T.geometryType,J(S))}async function fe(e){const{view:s,filter:r,creatorParameters:o,renderer:t,signal:a}=await async function(e){const s="regenerate-color-visual-variable";await D(e,s);const r=await F(e);if("class-breaks"!==r?.type)throw new i(`${s}:invalid-parameters`,"Renderer must be a ClassBreaksRenderer to regenerate a color visual variable");const o=r.authoringInfo,t=o?.visualVariables.find((e=>"color"===e.type)),a=r.visualVariables?.find((e=>"color"===e.type));if(!a)throw new i(`${s}:invalid-parameters`,"Renderer does not have a color visual variable");const{field:n,normalizationField:l,valueExpression:m,valueExpressionTitle:p}=a,u="univariate-color-size"===o?.type?o?.univariateTheme:t?.theme,{layer:c,forBinning:d,filter:y,view:h,signal:f}=e,j=await ae({layer:c,field:n,valueExpression:m,valueExpressionTitle:p,normalizationField:l,theme:u,forBinning:d,filter:y,view:h,signal:f});return{...e,creatorParameters:j,renderer:r}}(e),n=t.authoringInfo?.clone(),l=n?.visualVariables.find((e=>"color"===e.type)),m=t.visualVariables?.find((e=>"color"===e.type)),{field:p,normalizationField:u,valueExpression:c,theme:d,layer:y}=o,h=await f({layer:y,field:p,valueExpression:c,normalizationField:u,filter:r,view:s,signal:a}),j=p&&"function"!=typeof p?y.getField(p):null,{values:b}=de(h,d,J(j),"high-to-low"===d);if(b.length!==m.stops.length)throw new i("regenerate-color-visual-variable:invalid-parameters","Visual variable is invalid");return m.stops.forEach(((e,s)=>e.value=b[s])),l&&(l.minSliderValue=h.min,l.maxSliderValue=h.max),{visualVariable:m,authoringInfo:n,statistics:h}}async function je(e){const s=await ne(e),{layer:r,view:o,signal:i,filter:t}=s,[a,n,l]=await Promise.all([he(pe(s)),s.outlineOptimizationEnabled?j({layer:r,view:o,signal:i,filter:t}).catch(b):null,s.sizeOptimizationEnabled?P({layer:r,view:o,signal:i,filter:t}).catch(b):null]),m=s.normalizationField;return ye(a,n,l,m?"field":void 0,m,r.geometryType,s)}async function be(e){const{renderer:s,view:r,signal:o,filter:t,creatorParameters:a}=await async function(e){const s="regenerate-color-continuous-renderer";await D(e,s);const r=await F(e),o=L(r);if(!o||!["color-continuous","color-size"].includes(o))throw new i(`${s}:invalid-renderer`,"Renderer is invalid");const{authoringInfo:t,field:a,normalizationField:n,valueExpression:l,valueExpressionTitle:m}=r,p=t?.visualVariables.find((e=>"color"===e.type)),u=p?.theme,{layer:c,forBinning:d,filter:y,view:h,signal:f}=e,j=q(r),b=A(r),v=await ne({layer:c,field:a,valueExpression:l,valueExpressionTitle:m,normalizationField:n,theme:u,outlineOptimizationEnabled:j,sizeOptimizationEnabled:b,forBinning:d,filter:y,view:h,signal:f});return{...e,creatorParameters:v,renderer:r}}(e),{layer:n,outlineOptimizationEnabled:l,sizeOptimizationEnabled:m}=a,[p,u,c]=await Promise.all([fe(e),l?j({layer:n,view:r,signal:o,filter:t}).catch(b):null,m?P({layer:n,view:r,signal:o,filter:t}).catch(b):null]);return R(s,p.visualVariable,G),R(s,u?.visualVariables,Q),R(s,c?.minSize,$),B(s,p.authoringInfo,"color"),{renderer:s}}async function ve(e){const s=await le(e);return async function(e,s){const a=await n("esri/smartMapping/t9n/smartMapping"),m=e.layer,u=e.defaultSymbolEnabled,c=m.geometryType,d=e.classificationMethod,y="standard-deviation"===d,h=await ce({basemap:e.basemap,geometryType:c,theme:y?"above-and-below":null,colorScheme:e.colorScheme,worldScale:!!e.symbolType?.includes("3d-volumetric"),view:e.view}),f=h.scheme,{result:j,outlineResult:b}=s,v=j.classBreakInfos,g=e.normalizationType;if(!f)throw new i("color-class-breaks-renderer:insufficient-info","Unable to find color scheme");const w=function(e,s){const r=e.colorsForClassBreaks;if(r?.length)for(const e of r)if(e.numClasses===s)return t(e.colors);return o(e.colors,s)}(f,v.length);if(!w||w.length!==v.length)throw new i("color-class-breaks-renderer:insufficient-info","Color scheme does not have enough colors");const k=b?.opacity,T=new r({classBreakInfos:v.map(((s,r)=>({minValue:s.minValue,maxValue:s.maxValue,symbol:U(c,{type:e.symbolType,color:w[r],size:M(f,c),outline:C(f,c,k),meshInfo:{colorMixMode:e.colorMixMode,edgesType:e.edgesType}}),label:s.label}))),defaultLabel:u?a.other:null,defaultSymbol:u?U(c,{type:e.symbolType,color:f.noDataColor,size:M(f,c),outline:C(f,c,k),meshInfo:{colorMixMode:e.colorMixMode,edgesType:e.edgesType}}):null,field:e.field,valueExpression:e.valueExpression,valueExpressionTitle:e.valueExpressionTitle,normalizationType:g,normalizationField:e.normalizationField,normalizationTotal:"percent-of-total"===g?j.normalizationTotal:void 0,legendOptions:e.legendOptions,authoringInfo:new l({type:"class-breaks-color",classificationMethod:d,standardDeviationInterval:e.standardDeviationInterval})});return y||p({classBreakInfos:T.classBreakInfos,classificationMethod:d,normalizationType:g,round:!0}),b?.visualVariables?.length&&(T.visualVariables=b.visualVariables.map((e=>e.clone()))),{renderer:T,colorScheme:re(f),classBreaksResult:j,defaultValuesUsed:s.defaultValuesUsed,basemapId:h.basemapId,basemapTheme:h.basemapTheme}}(s,await v(me(s),s.outlineOptimizationEnabled))}async function ge(e){const{renderer:s,creatorParameters:r}=await async function(e){const s="regenerate-color-class-breaks-renderer";await D(e,s);const r=await F(e);if("color-class-breaks"!==L(r))throw new i(`${s}:invalid-parameters`,"Renderer is invalid");const{authoringInfo:o,field:t,normalizationField:a,normalizationType:n,normalizationTotal:l,valueExpression:m,valueExpressionTitle:p}=r,{classificationMethod:u,standardDeviationInterval:c}=o,d=r.classBreakInfos.length,{layer:y,forBinning:h,filter:f,view:j,signal:b}=e,v=q(r),g=await le({layer:y,field:t,valueExpression:m,valueExpressionTitle:p,normalizationType:n,normalizationField:a,normalizationTotal:l,classificationMethod:u,standardDeviationInterval:c,numClasses:d,outlineOptimizationEnabled:v,forBinning:h,filter:f,view:j,signal:b});return{...e,creatorParameters:g,renderer:r}}(e),{normalizationType:o,outlineOptimizationEnabled:t,classificationMethod:a}=r,{result:n,outlineResult:l}=await v(me(r),t),m=n.classBreakInfos;if(r.numClasses!==m.length)throw new i("regenerate-color-class-breaks-renderer:insufficient-info","The number of class breaks generated does not match the number of class breaks in the renderer.");return s.classBreakInfos.forEach(((e,s)=>{e.minValue=m[s].minValue,e.maxValue=m[s].maxValue,e.label=m[s].label})),s.normalizationTotal="percent-of-total"===o?n.normalizationTotal:void 0,"standard-deviation"!==a&&p({classBreakInfos:s.classBreakInfos,classificationMethod:a,normalizationType:o,round:!0}),R(s,l?.visualVariables,Q),{renderer:s}}function we(s){return async function(e){if(!e?.layer)throw new i("color-point-cloud-true-color-renderer:missing-parameters","'layer' parameter is required");const s={...e,layer:e.layer},r=[se.PointCloudLayer],o=_(s.layer,r);if(!o)throw new i("color-point-cloud-true-color-renderer:invalid-parameters","'layer' must be one of these types: "+ee(r).join(", "));if(s.layer=o,s.density=s.density||25,s.size=s.size||"100%",!S(s.size))throw new i("color-point-cloud-true-color-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'");const t=null!=s.signal?{signal:s.signal}:null;return await o.load(t),s}(s).then((s=>({renderer:new e({field:"RGB",pointsPerInch:s.density??void 0,pointSizeAlgorithm:g(s.size)})})))}async function ke(e){const r=await async function(e){if(!e?.layer||!e.field)throw new i("color-point-cloud-continuous-renderer:missing-parameters","'layer' and 'field' parameters are required");const s=e.field.toLowerCase();if("intensity"!==s&&"elevation"!==s)throw new i("color-point-cloud-continuous-renderer:invalid-parameters","'field' should be either 'intensity' or 'elevation'");const r={...e,layer:e.layer,field:e.field},o=[se.PointCloudLayer],t=_(r.layer,o);if(!t)throw new i("color-point-cloud-continuous-renderer:invalid-parameters","'layer' must be one of these types: "+ee(o).join(", "));if(r.layer=t,r.density=r.density||25,r.size=r.size||"100%",!S(r.size))throw new i("color-point-cloud-continuous-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'");const a=null!=r.signal?{signal:r.signal}:null;return await t.load(a),r}(e),t=r.statistics??await f({layer:r.layer,field:r.field,signal:r.signal}),a=await async function(e,s){const r=s.layer,t=await ce({basemap:s.basemap,colorScheme:s.colorScheme,geometryType:r.geometryType,schemeId:"elevation"===s.field.toLowerCase()?"point-cloud-elevation-scheme":"point-cloud-intensity-scheme"}),a=t.scheme;if(!a)throw new i("color-point-cloud-continuous-renderer:insufficient-info","Unable to find color scheme");const n=o(a.colors,5);if(n.length<5)throw new i("color-point-cloud-continuous-renderer:insufficient-info","Color scheme does not have enough colors");const l=x(e,!1,!0),m=l?V(l[0],l[1],5):z(e);return{stops:u({values:m,isDate:!1,colors:n,labelIndexes:[0,2,4]}),basemapId:t.basemapId,basemapTheme:t.basemapTheme,statistics:e,defaultValuesUsed:!!l,colorScheme:re(a)}}(t,r);return{renderer:new s({field:r.field,pointsPerInch:r.density??void 0,pointSizeAlgorithm:g(r.size),stops:a.stops}),basemapId:a.basemapId,basemapTheme:a.basemapTheme,statistics:a.statistics,defaultValuesUsed:a.defaultValuesUsed,colorScheme:a.colorScheme}}async function Te(e){const s=await ue(e),{defaultSymbolEnabled:r,view:o,startTime:i,endTime:t,symbolType:a,colorMixMode:n,edgesType:l,minValue:m,maxValue:p,signal:u,filter:c}=s,d=s.layer,[y,f,v]=await Promise.all([s.unit?{unit:s.unit,statistics:null}:h({view:o,layer:d,startTime:i,endTime:t,minValue:m,maxValue:p,signal:u,filter:c}),s.outlineOptimizationEnabled?j({layer:d,view:o,signal:u,filter:c}).catch(b):null,s.sizeOptimizationEnabled?P({layer:d,view:o,signal:u,filter:c}).catch(b):null]),{unit:g,statistics:T}=y,{valueExpression:S,title:x}=await w(s,g),V=await he(pe({layer:d,basemap:s.basemap,valueExpression:S,symbolType:a,statistics:T,legendOptions:{title:x},colorScheme:s.colorScheme,theme:s.theme,view:o,minValue:s.minValue,maxValue:s.maxValue,filter:c,signal:u})),z={layer:d,valueExpression:S,defaultSymbolEnabled:r,symbolType:a,colorMixMode:n,edgesType:l},E=await ye(V,f,v,null,null,d.geometryType,z),I=E.renderer.authoringInfo?.visualVariables;return I?.forEach((e=>k(e,i,t,g))),{...E,unit:g}}async function Se(e){const{renderer:s,creatorParameters:r}=await async function(e){const s="regenerate-color-age-renderer";await D(e,s);const r=await F(e);if("color-age"!==L(r))throw new i(`${s}:invalid-parameters`,"Renderer is invalid");const{authoringInfo:o}=r,t=o?.visualVariables.find((e=>"color"===e.type)),a=t.startTime,n=t.endTime,l=t.units,m=t.theme,{layer:p,filter:u,view:c,signal:d}=e,y=q(r),h=A(r),f=await ue({layer:p,startTime:a,endTime:n,unit:l,theme:m,outlineOptimizationEnabled:y,sizeOptimizationEnabled:h,filter:u,view:c,signal:d});return{...e,creatorParameters:f,renderer:r}}(e),{layer:o,outlineOptimizationEnabled:t,sizeOptimizationEnabled:a,startTime:n,endTime:l,theme:m,view:p,signal:u,filter:c}=r,[d,y,f]=await Promise.all([h({view:p,layer:o,startTime:n,endTime:l,signal:u,filter:c}),t?j({layer:o,view:p,signal:u,filter:c}).catch(b):null,a?P({layer:o,view:p,signal:u,filter:c}).catch(b):null]),{unit:v,statistics:g}=d,{valueExpression:T,title:S}=await w(r,v),x=await he(pe({layer:o,valueExpression:T,statistics:g,legendOptions:{title:S},theme:m,view:p,filter:c,signal:u}));R(s,x.visualVariable,G),R(s,y?.visualVariables,Q),R(s,f?.minSize,$),s.authoringInfo=x.authoringInfo.clone();const V=s.authoringInfo?.visualVariables;return V?.forEach((e=>k(e,n,l,v))),{renderer:s}}export{Te as createAgeRenderer,ve as createClassBreaksRenderer,je as createContinuousRenderer,ke as createPCContinuousRenderer,we as createPCTrueColorRenderer,he as createVisualVariable,Se as regenerateAgeRenderer,ge as regenerateClassBreaksRenderer,be as regenerateContinuousRenderer,fe as regenerateVisualVariable};
