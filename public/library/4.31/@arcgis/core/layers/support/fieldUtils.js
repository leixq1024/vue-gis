/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import e from"../../core/Error.js";import{g as n,s as t}from"../../config.js";import{u as i}from"../../core/Accessor.js";import{parseWhereClause as r}from"../../core/sql.js";import"../../intl.js";import"../../core/lang.js";import{c as s}from"../../chunks/mathUtils.js";import{m as o}from"../../chunks/maybe.js";import{u as l,c as a,a as u,b as c,d as f,f as m}from"../../chunks/date.js";import{D as d,F as p}from"../../chunks/datetime.js";import{g as y}from"../../chunks/locale.js";import"../../geometry.js";import{L as g}from"../../chunks/Logger.js";import h from"../../geometry/SpatialReference.js";import"../../core/Handles.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/metadata.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/tracking.js";import"../../chunks/ensureType.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/ObservableBase.js";import"../../core/scheduling.js";import"../../core/promiseUtils.js";import"../../chunks/number.js";import"../../chunks/substitute.js";import"../../chunks/messages.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../core/JSONSupport.js";import"../../chunks/tslib.es6.js";import"../../chunks/assets.js";import"../../chunks/jsonMap.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../chunks/reader.js";import"../../chunks/unitUtils.js";import"../../chunks/writer.js";import"../../geometry/Point.js";import"../../core/accessorSupport/decorators/cast.js";import"../../geometry/support/webMercatorUtils.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/coordsUtils.js";import"../../chunks/Axis.js";import"../../chunks/extentUtils.js";import"../../chunks/boundsUtils.js";import"../../chunks/aaBoundingRect.js";import"../../geometry/Polyline.js";import"../../chunks/typeUtils.js";import"../../geometry/support/jsonUtils.js";function F(e){return"number"==typeof e}function w(e){return"string"==typeof e||e instanceof String}const I=l,b={date:null,time:null,timeZoneOffset:null},S=new Map([["hours",3600],["minutes",60],["seconds",1],["deciseconds",.1],["centiseconds",.01],["milliseconds",.001]]);var v;!function(e){e.HM="HH:mm",e.HMS="HH:mm:ss",e.HMS_MS="HH:mm:ss.SSS"}(v||(v={}));const x=[v.HMS_MS,v.HMS,v.HM,"TT"],T="yyyy-MM-dd",j=v.HMS,_="latn",A=new Set(["date-only","time-only","timestamp-offset"]);function M(e){return{locale:y(),numberingSystem:_,zone:e??I}}function O(e,n){return null===e?null:d.fromMillis(e,M(n))}function E(e,n){if(null==e||!w(e)||""===e){if(n){const e=d.local({zone:n});return{date:null,time:null,timeZoneOffset:e.isValid?e.offset.toString():null}}return b}const t=d.fromISO(e,{setZone:!0});return{date:t.toFormat(T,M()),time:t.toFormat(v.HMS_MS,M()),timeZoneOffset:t.offset.toString()}}function k(e,n){if(null==e||!F(e)||isNaN(e))return b;const t=O(e,n);return t?{date:t.toFormat(T,M(n)),time:t.toFormat(j,M(n))}:b}function N(e){switch(e.type){case"date":default:return a("short-date-short-time");case"date-only":return a("short-date");case"time-only":return a("short-time");case"timestamp-offset":return{...a("short-date-short-time"),timeZone:void 0,timeZoneName:"short"}}}function $(e,n,t){if(!e||null==n)return null;switch(e.type){case"date":return m(n,t);case"date-only":return f(n,t);case"time-only":return c(n,t);case"timestamp-offset":return u(n,t);default:return null}}function D(e){const{dateComponent:n,defaultTimeZone:t,timeComponent:i,timeZoneComponent:r,oldValue:s}=e;if(!n?.value)return null;const{year:o,month:a,day:u}=d.fromFormat(n.value,T),{hour:c,minute:f,second:m,millisecond:y}=U(i,l)??d.now(),g=E(s,t),h=r?.value?parseInt(r.value,10):null!=g.timeZoneOffset?parseInt(g.timeZoneOffset,10):(new Date).getTimezoneOffset(),F=p.instance(h),w=d.fromObject({year:o,month:a,day:u,hour:c,minute:f,second:m,millisecond:y},{zone:F});return w.isValid?w.toISO({includeOffset:!0}):null}function V(e){const{dateComponent:n,timeComponent:t,timeZone:i,max:r,min:s,oldValue:o}=e,l=U(n,i);let a=!!e.applyRange;if(!l)return null;let u=null;if(null!=t?.value){const e=U(t,i),n=Date.now(),s=null!=r&&r<n?r:n,o=d.fromMillis(s,M(i)),a=l||o,{year:c,month:f,day:m}=a,{hour:p,minute:y,second:g,millisecond:h}=e||o;u=a.set({year:c,month:f,day:m,hour:p,minute:y,second:g,millisecond:h})}else{const e=O(R({value:o??Date.now(),max:r,min:s}),i),{year:n,month:t,day:c}=l,{hour:f,minute:m,second:d,millisecond:p}=e;a=!0,u=l.set({year:n,month:t,day:c,hour:f,minute:m,second:d,millisecond:p})}if(!u.isValid)return null;const c=u.toMillis();return a?R({value:c,max:r,min:s}):c}function U(e,n){if(null==e?.value||Array.isArray(e.value))return null;let t=null;return t=(e=>"valueAsDate"in e)(e)?d.fromFormat(e.value,T,M(n)):z(e.value),t?.isValid?t:null}function L(e){const{max:n,min:t,value:i}=e;return!(isNaN(i)||null!=n&&i>n||null!=t&&i<t)}function R(e){const{max:n,min:t,value:i}=e;return null!=n&&null!=t?s(i,t,n):null!=n&&i>n?n:null!=t&&i<t?t:i}function C(n){if(!n)return"";const t=n.split(".").at(0);if(!t||t.length<1)throw new e("invalid time-only field",`Cannot parse valid time-only field value from ${n}`);const i=t.split(":"),r=new Array(3);for(let e=0;e<3;e++){const n=i.at(e)??"";r[e]=n.padStart(2,"0")}return r.join(":")}function G(e,n){switch(n){case"date":return e.getTime();case"date-only":return e.toISODate();case"time-only":return C(e.toISOTime(!0,!1));case"timestamp-offset":return e.toISOString(!1);default:return null}}function H(e){return!!e&&"object"==typeof e&&"getTime"in e&&"toISOString"in e&&"timeZone"in e}function Z(e){if(!e||!w(e))return null;const n=d.fromFormat(e,T);return n.isValid?n:null}function z(e){return e&&w(e)?o(x,(n=>{const t=d.fromFormat(e,n);return t.isValid?t:null}))??null:null}function P(e){if(!e||!w(e))return null;const n=d.fromISO(e);return n.isValid?n:null}function B(e){const{type:n,range:t,value:i}=e;if(null==i||!t||i===t.min||i===t.max)return!0;if("date"===n)return L({value:i,min:t.min,max:t.max});const{rawMax:r,rawMin:s}=t;let o=null,l=null,a=null;switch(n){case"date-only":o=Z(r),l=Z(s),a=Z(i);break;case"time-only":o=z(r),l=z(s),a=z(i);break;case"timestamp-offset":o=P(r),l=P(s),a=P(i)}return!a||L({value:a.valueOf(),min:l?.valueOf(),max:o?.valueOf()})}const X=new Set(["small-integer","big-integer","integer","single","double"]);function q(e){return X.has(e)}const J=new Set(["date-picker","time-picker","datetimeoffset-picker","datetime-picker"]);function Y(e){return J.has(e)}var W;!function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"}(W||(W={}));const K=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function Q(e){return null!=e&&("date-only"===e.type||"esriFieldTypeDateOnly"===e.type)}function ee(e){return null!=e&&("timestamp-offset"===e.type||"esriFieldTypeTimestampOffset"===e.type)}function ne(e){return null!=e&&("time-only"===e.type||"esriFieldTypeTimeOnly"===e.type)}function te(e,n,t){const i=t??e?.domain;if(!i)return null;switch(i.type){case"range":{const{min:i,max:r}=ie(e,t);if(null!=i&&+n<i||null!=r&&+n>r)return W.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(null==i.codedValues||i.codedValues.every((e=>null==e||e.code!==n)))return W.INVALID_CODED_VALUE}return null}function ie(e,n){const t=n??e?.domain;if(!t||"range"!==t.type)return;const i="range"in t?t.range[0]:t.minValue,r="range"in t?t.range[1]:t.maxValue,s=function(e){return null!=e&&K.has(e.type)}(e);return Q(e)||ne(e)||ee(e)?{...re(e,r,i),isInteger:s}:{min:null!=i&&"number"==typeof i?i:null,max:null!=r&&"number"==typeof r?r:null,rawMin:i,rawMax:r,isInteger:s}}function re(e,n,t){return Q(e)?{min:Z(t)?.toMillis(),max:Z(n)?.toMillis(),rawMin:t,rawMax:n}:ne(e)?{min:z(t)?.toMillis(),max:z(n)?.toMillis(),rawMin:t,rawMax:n}:ee(e)?{min:P(t)?.toMillis(),max:P(n)?.toMillis(),rawMin:t,rawMax:n}:{max:null,min:null}}let se;function oe(){return se||(se=(async()=>{const e=await import("../../chunks/arcadeUtils.js").then((e=>e.u));return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),se}const le=(e,n,t)=>ce.create(e,n,t,null,["$feature","$view"],[]),ae=(e,n,t)=>ce.create(e,n,t,null,["$feature","$view"],[]),ue=(e,n,t,i)=>ce.create(e,n,t,i,["$feature","$view"],[]);class ce{constructor(e,n,t,i,r,s,o){this.services=null,this.script=e,this.evaluate=i;const l=Array.isArray(s)?s:s?.fields;this.fields=l??[],this._syntaxTree=t,this._arcade=n,this._arcadeFeature=r,this._spatialReference=o,this._referencesGeometry=n.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(n,t,i,r,s,o){const{arcade:l,Feature:a,Dictionary:u}=await oe(),c=t instanceof h?t:h.fromJSON(t);let f;try{f=l.parseScript(n,o)}catch(t){return g.getLogger("esri.support.arcadeOnDemand").error(new e("arcade-bad-expression","Failed to parse arcade script",{script:n,error:t})),null}const m=s.reduce(((e,n)=>({...e,[n]:null})),{});let d=null;null!=r&&(d=new u(r),d.immutable=!0,m.$config=null);const p=l.scriptUsesGeometryEngine(f),y=p&&l.enableGeometrySupport(),F=l.scriptUsesFeatureSet(f)&&l.enableFeatureSetSupport(),w=l.scriptIsAsync(f),I=w&&l.enableAsyncSupport(),b={vars:m,spatialReference:c,useAsync:!!I};await Promise.all([y,F,I]);const S=new Set;await l.loadDependentModules(S,f,null,w,p);const v=new u;v.immutable=!1,v.setField("scale",0);const x=l.compileScript(f,b);return new ce(n,l,f,((e,n)=>{const t=e.$view?.timeZone;return"$view"in e&&e.$view&&(v.setField("scale","object"==typeof e.$view&&"scale"in e.$view?e.$view.scale:void 0),e.$view=v),d&&(e.$config=d),x({vars:e,spatialReference:c,services:n,timeZone:t})}),new a,i,c)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}}const fe=/^([0-9_])/,me=/[^a-z0-9_\u0080-\uffff]+/gi;function de(e){return null==e?null:e.trim().replaceAll(me,"_").replace(fe,"F$1")||null}const pe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],ye=["field","normalizationField"];function ge(e,n){if(null!=e&&null!=n)for(const t of Array.isArray(e)?e:[e])if(he(pe,t,n),"visualVariables"in t&&t.visualVariables)for(const e of t.visualVariables)he(ye,e,n)}function he(e,i,r){if(e)for(const s of e){const e=n(s,i),o=e&&"function"!=typeof e&&r.get(e);o&&t(s,o.name,i)}}function Fe(e,n){if(null!=e&&n?.fields?.length)if("startField"in e){const t=n.get(e.startField),i=n.get(e.endField);e.startField=t?.name??null,e.endField=i?.name??null}else{const t=n.get(e.startTimeField),i=n.get(e.endTimeField);e.startTimeField=t?.name??null,e.endTimeField=i?.name??null}}const we=new Set;function Ie(e,n){return e&&n?(we.clear(),be(we,e,n),Array.from(we).sort()):[]}function be(e,n,t){if(t)if(n?.fields?.length)if(t.includes("*"))for(const{name:t}of n.fields)e.add(t);else for(const i of t)Se(e,n,i);else{if(t.includes("*"))return e.clear(),void e.add("*");for(const n of t)null!=n&&e.add(n)}}function Se(e,n,t){if("string"==typeof t)if(n){const i=n.get(t);i&&e.add(i.name)}else e.add(t)}function ve(e,n){return null==n||null==e?[]:n.includes("*")?(e.fields??[]).map((e=>e.name)):n}function xe(e,n,t=1){if(!n||!e)return[];if(n.includes("*"))return["*"];const i=Ie(e,n);return i.length/e.fields.length>=t?["*"]:i}async function Te(e,n,t){if(!t)return;const{arcadeUtils:i}=await oe(),r=i.extractFieldNames(t,n?.fields?.map((e=>e.name)));for(const t of r)Se(e,n,t)}async function je(n,t,i){if(i&&"1=1"!==i){const s=await r(i,t);if(!s.isStandardized)throw new e("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});be(n,t,s.fieldNames)}}function _e({displayField:e,fields:n}){return e||(n?.length?Ae(n,"name-or-title")||Ae(n,"unique-identifier")||Ae(n,"type-or-category")||function(e){for(const n of e){if(!n?.name)continue;const e=n.name.toLowerCase();if(e.includes("name")||e.includes("title"))return n.name}return null}(n):null)}function Ae(e,n){for(const t of e)if(t?.valueType&&t.valueType===n)return t.name;return null}async function Me(e){if(!e)return[];const n=new Set;return await Oe(n,e),Array.from(n).sort()}async function Oe(e,n){if(!n)return;const t=n.elevationInfo?.featureExpressionInfo;return t?t.collectRequiredFields(e,n.fieldsIndex):void 0}async function Ee(e,n,t){if(!n||!t||!("fields"in t))return;const i=[],r=t.popupTemplate;i.push(ke(e,n,r)),t.fields&&i.push(...t.fields.map((async t=>function(e,n,t){t.onStatisticExpression?Te(e,n,t.onStatisticExpression.expression):e.add(t.onStatisticField)}(e,n.fieldsIndex,t)))),await Promise.all(i)}async function ke(e,n,t){const i=[];t?.expressionInfos&&i.push(...t.expressionInfos.map((t=>Te(e,n.fieldsIndex,t.expression))));const r=t?.content;if(Array.isArray(r))for(const t of r)"expression"===t.type&&t.expressionInfo&&i.push(Te(e,n.fieldsIndex,t.expressionInfo.expression));await Promise.all(i)}async function Ne(e,n,t){n&&(n.timeInfo&&t?.timeExtent&&be(e,n.fieldsIndex,[n.timeInfo.startField,n.timeInfo.endField]),n.floorInfo&&be(e,n.fieldsIndex,[n.floorInfo.floorField]),null!=t?.where&&await je(e,n.fieldsIndex,t.where))}async function $e(e,n,t){n&&t&&await Promise.all(t.map((t=>async function(e,n,t){n&&t&&(t.valueExpression?await Te(e,n.fieldsIndex,t.valueExpression):t.field&&Se(e,n.fieldsIndex,t.field))}(e,n,t))))}async function De(e){if(!e)return[];const n="timeInfo"in e&&e.timeInfo;return n?Ie(e.fieldsIndex,[e.trackIdField,n.startField,n.endField]):[]}function Ve(e){return e?Ie(e.fieldsIndex,He(e)):[]}function Ue(e){if(!e)return[];const n=e.geometryFieldsInfo;return n?Ie(e.fieldsIndex,[n.shapeAreaField,n.shapeLengthField]):[]}const Le=new Set(["oid","global-id","guid"]),Re=new Set(["oid","global-id"]),Ce=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function Ge(e){const n=new Set;Ze(e).forEach((e=>n.add(e))),Ue(e).forEach((e=>n.add(e.toLowerCase())));const t=e&&"infoFor3D"in e?e.infoFor3D:void 0;return t&&(Object.values(t.assetMapFieldRoles).forEach((e=>n.add(e.toLowerCase()))),Object.values(t.transformFieldRoles).forEach((e=>n.add(e.toLowerCase())))),Array.from(n)}function He(e){if(!e)return[];const n="editFieldsInfo"in e&&e.editFieldsInfo;if(!n)return[];const{creationDateField:t,creatorField:i,editDateField:r,editorField:s}=n;return[t,i,r,s].filter(Boolean)}function Ze(e){return He(e).map((e=>e.toLowerCase()))}function ze(e,n){return e.editable&&!Le.has(e.type)&&!Ze(n).includes(e.name?.toLowerCase()??"")}function Pe(e,n){const t=e.name?.toLowerCase()??"";return!(null!=n?.objectIdField&&t===n.objectIdField.toLowerCase()||null!=n?.globalIdField&&t===n.globalIdField.toLowerCase()||Ge(n).includes(t)||Re.has(e.type)||Ce.some((e=>e.test(t))))}async function Be(e){if(!e)return[];const n=new Set;return await Xe(n,e),Array.from(n).sort()}async function Xe(e,n){const{labelingInfo:t,fieldsIndex:i}=n;t?.length&&await Promise.all(t.map((n=>async function(e,n,t){if(!t)return;const i=t.getLabelExpression(),r=t.where;if("arcade"===i.type)await Te(e,n,i.expression);else{const t=i.expression.match(/{[^}]*}/g);t&&t.forEach((t=>{Se(e,n,t.slice(1,-1))}))}await je(e,n,r)}(e,i,n))))}function qe(e){const n=e.defaultValue;return void 0!==n&&tn(e,n)?n:e.nullable?null:void 0}function Je(e){const n="string"==typeof e?{type:e}:e;return pn(n)?255:"esriFieldTypeDate"===n.type||"date"===n.type?8:void 0}function Ye(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}function We(e){return null===e||Ye(e)}function Ke(e){return null===e||Number.isInteger(e)}function Qe(e){return null!=e&&"string"==typeof e}function en(e){return null===e||Qe(e)}function nn(){return!0}function tn(e,n){let t;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":t=e.nullable?Ke:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":t=e.nullable?We:Ye;break;case"string":case"esriFieldTypeString":t=e.nullable?en:Qe;break;default:t=nn}return 1===arguments.length?t:t(n)}const rn=["integer","small-integer","big-integer"],sn=["single","double"],on=[...rn,...sn],ln=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],an=["esriFieldTypeSingle","esriFieldTypeDouble"],un=new Set([...rn,...ln]),cn=new Set([...sn,...an]),fn=i(un,cn);function mn(e){return null!=e&&un.has(e.type)}function dn(e){return null!=e&&fn.has(e.type)}function pn(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}function yn(e){return null!=e&&("date"===e.type||"esriFieldTypeDate"===e.type)}function gn(e){return null!=e&&("date-only"===e.type||"esriFieldTypeDateOnly"===e.type)}function hn(e){return null!=e&&("timestamp-offset"===e.type||"esriFieldTypeTimestampOffset"===e.type)}function Fn(e){return null!=e&&("time-only"===e.type||"esriFieldTypeTimeOnly"===e.type)}function wn(e){return null!=e&&("oid"===e.type||"esriFieldTypeOID"===e.type)}function In(e){return null!=e&&("global-id"===e.type||"esriFieldTypeGlobalID"===e.type)}function bn(e,n){return null===Tn(e,n)}var Sn,vn;function xn(e){return null==e||"number"==typeof e&&isNaN(e)?null:e}function Tn(e,n){return null==e||e.nullable&&null===n?null:dn(e)&&!jn(e.type,Number(n))?Sn.OUT_OF_RANGE:tn(e,n)?e.domain?te(e,n):null:vn.INVALID_TYPE}function jn(e,n){const t="string"==typeof e?An(e):e;if(!t)return!1;const i=t.min,r=t.max;return t.isInteger?Number.isInteger(n)&&n>=i&&n<=r:n>=i&&n<=r}function _n(e,n){return ie(e,n)||(dn(e)?An(e.type):void 0)}function An(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return On;case"esriFieldTypeInteger":case"integer":return En;case"esriFieldTypeBigInteger":case"big-integer":return kn;case"esriFieldTypeSingle":case"single":return Nn;case"esriFieldTypeDouble":case"double":return $n}}function Mn(e){if(!Ye(e))return null;if(Number.isInteger(e)){if(e>=On.min&&e<=On.max)return"esriFieldTypeSmallInteger";if(e>=En.min&&e<=En.max)return"esriFieldTypeInteger";if(e>=kn.min&&e<=kn.max)return"esriFieldTypeBigInteger"}return e>=Nn.min&&e<=Nn.max?"esriFieldTypeSingle":"esriFieldTypeDouble"}!function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"}(Sn||(Sn={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(vn||(vn={}));const On={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},En={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},kn={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},Nn={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},$n={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function Dn(e,n,t){switch(e){case W.INVALID_CODED_VALUE:return`Value ${t} is not in the coded domain - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case W.VALUE_OUT_OF_RANGE:return`Value ${t} is out of the range of valid values - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case vn.INVALID_TYPE:return`Value ${t} is not a valid value for the field type - field: ${n.name}, type: ${n.type}, nullable: ${n.nullable}`;case Sn.OUT_OF_RANGE:{const{min:e,max:i}=An(n.type);return`Value ${t} is out of range for the number type - field: ${n.name}, type: ${n.type}, value range is ${e} to ${i}`}}}function Vn(e,n){return!Un(e,n,null)}function Un(e,n,t){if(!n?.attributes||!e){if(null!=t)for(const n of e??[])t.add(n);return!0}const i=new Set(Object.keys(n.attributes));let r=!1;for(const n of e)if(!i.has(n)){if(r=!0,null==t)break;t.add(n)}return r}async function Ln(e,n){const t=new Set;for(const i of n)await Te(t,e.fieldsIndex,i);return Array.from(t).sort()}function Rn(e){return!!e&&["raster.itempixelvalue","raster.servicepixelvalue"].some((n=>e.toLowerCase().startsWith(n)))}async function Cn(e,n){const t=new Set;return e?.collectRequiredFields&&await e.collectRequiredFields(t,n),Array.from(t).sort()}function Gn(e){const n=e?.match(/{[^}]+}/g);return n?n.map((e=>e.slice(1,-1).split(":")[0].trim())):[]}export{Y as A,q as B,W as D,Sn as NumericRangeValidationError,vn as TypeValidationError,$ as a,N as b,kn as bigIntegerRange,le as c,Te as collectArcadeFieldNames,Oe as collectElevationFields,Ee as collectFeatureReductionFields,Se as collectField,be as collectFields,Ne as collectFilterFields,Xe as collectLabelingFields,$e as collectOrderByInfos,ke as collectPopupTemplateFields,re as d,$n as doubleRange,H as e,Gn as extractSubstitutionTemplatesFromString,G as f,Vn as featureHasFields,Ie as fixFields,ge as fixRendererFields,Fe as fixTimeInfoFields,an as floatJSONTypes,sn as floatTypes,ie as g,_e as getDisplayFieldName,He as getEditTrackingFields,Me as getElevationFields,Ln as getExpressionFields,Ve as getFeatureEditFields,Ue as getFeatureGeometryFields,Je as getFieldDefaultLength,qe as getFieldDefaultValue,_n as getFieldRange,Be as getLabelingFields,Ge as getLowerCaseDefaultHiddenFields,Ze as getLowerCaseEditTrackingFields,Mn as getNumericTypeForValue,Cn as getRendererFields,De as getTimeFields,B as h,F as i,ln as integerJSONTypes,En as integerRange,rn as integerTypes,yn as isDateField,gn as isDateOnlyField,ze as isFieldEditable,Pe as isFieldVisibleByDefault,In as isGlobalIDField,mn as isIntegerField,jn as isNumberInRange,dn as isNumericField,wn as isObjectIDField,Rn as isRasterPixelValueField,pn as isStringField,Fn as isTimeOnlyField,hn as isTimestampOffsetField,bn as isValidFieldValue,tn as isValueMatchingFieldType,A as j,L as k,oe as l,V as m,D as n,de as normalizeFieldName,on as numericTypes,C as o,E as p,xe as packFields,Un as populateMissingFields,k as q,ue as r,pe as rendererFields,ae as s,xn as sanitizeNullFieldValue,Nn as singleRange,On as smallIntegerRange,S as t,T as u,ve as unpackFieldNames,te as v,Tn as validateFieldValue,Dn as validationErrorToString,ye as visualVariableFields,M as w,j as x,w as y,_ as z};
