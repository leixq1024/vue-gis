/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import"../../../geometry.js";import{m as s}from"../../../core/lang.js";import{c as t,a as r,z as e}from"../../../chunks/vec3f64.js";import{j as o}from"../../../chunks/vec3.js";import{f as i,e as p}from"../../../chunks/ray.js";import{k as m,h as a}from"../../../chunks/sphere.js";import{i as n}from"../../../chunks/ElevationSourceDefinitions.js";import{d as l}from"../../../chunks/deepClone.js";import"../../../core/Error.js";import"../../../chunks/Logger.js";import{l as u,D as c}from"../../../chunks/plane.js";import{i as j,u as h,a as y,b as k,d,p as f,o as b,worldToImage as g,worldToImagePanoramic as I,e as S,s as R,f as P,g as U,h as x,v,j as M,k as C,l as w,m as L,n as A,q as T,r as D,t as V,w as F,x as E}from"./worldToImage.js";import O from"../../../geometry/Point.js";import B from"../../../geometry/Polygon.js";import"../../../chunks/ensureType.js";import"../../../geometry/Extent.js";import"../../../chunks/tslib.es6.js";import"../../../core/accessorSupport/decorators/property.js";import"../../../chunks/utils.js";import"../../../chunks/handleUtils.js";import"../../../chunks/metadata.js";import"../../../config.js";import"../../../core/accessorSupport/decorators/subclass.js";import"../../../chunks/tracking.js";import"../../../geometry/Geometry.js";import"../../../core/JSONSupport.js";import"../../../core/Accessor.js";import"../../../core/Handles.js";import"../../../chunks/maybe.js";import"../../../chunks/ObservableBase.js";import"../../../core/scheduling.js";import"../../../core/promiseUtils.js";import"../../../chunks/reader.js";import"../../../geometry/SpatialReference.js";import"../../../chunks/unitUtils.js";import"../../../chunks/jsonMap.js";import"../../../chunks/assets.js";import"../../../request.js";import"../../../kernel.js";import"../../../core/urlUtils.js";import"../../../chunks/writer.js";import"../../../geometry/support/webMercatorUtils.js";import"../../../core/accessorSupport/decorators/cast.js";import"../../../geometry/Multipoint.js";import"../../../chunks/zmUtils.js";import"../../../geometry/Polyline.js";import"../../../chunks/extentUtils.js";import"../../../chunks/boundsUtils.js";import"../../../chunks/aaBoundingRect.js";import"../../../chunks/mathUtils.js";import"../../../chunks/typeUtils.js";import"../../../geometry/support/jsonUtils.js";import"../../../chunks/coordsUtils.js";import"../../../chunks/Axis.js";import"../../../chunks/common.js";import"../../../chunks/mat3.js";import"../../../chunks/mat3f64.js";import"../../../chunks/mat4.js";import"../../../chunks/vec4.js";import"../../../chunks/vec4f64.js";import"../../../core/Clonable.js";import"../../../chunks/languageUtils.js";import"../../../chunks/TimeOnly.js";import"../../../chunks/UnknownTimeZone.js";import"../../../chunks/datetime.js";import"../../../chunks/locale.js";import"../../../chunks/ImmutableArray.js";import"../../../chunks/shared2.js";import"../../support/Field.js";import"../../../chunks/enumeration.js";import"../../../chunks/domains.js";import"../../support/CodedValueDomain.js";import"../../support/Domain.js";import"../../support/InheritedDomain.js";import"../../support/RangeDomain.js";import"../../../chunks/fieldType.js";import"../../../chunks/number2.js";import"../../../rest/support/Query.js";import"../../../chunks/DataLayerSource.js";import"../../../chunks/FullTextSearch.js";import"../../../chunks/spatialRelationships.js";import"../../../rest/support/StatisticDefinition.js";import"../../../time/TimeExtent.js";import"../../../chunks/timeUtils.js";import"../../../chunks/date.js";import"../../../chunks/mat4f64.js";import"../../../chunks/quatf64.js";import"../../../chunks/vec2f64.js";import"../../../chunks/mathUtils2.js";import"../../../geometry/projection.js";import"../../../chunks/SimpleObservable.js";import"../../../chunks/projectBuffer.js";import"../../../chunks/geodesicConstants.js";import"../../../geometry/support/GeographicTransformation.js";import"../../../geometry/support/GeographicTransformationStep.js";import"../../../chunks/zscale.js";import"../../../chunks/vec32.js";import"../../ElevationLayer.js";import"../../../chunks/MultiOriginJSONSupport.js";import"../../../geometry/HeightModelInfo.js";import"../../Layer.js";import"../../../core/Evented.js";import"../../../core/Identifiable.js";import"../../../core/Loadable.js";import"../../../core/Promise.js";import"../../mixins/ArcGISCachedService.js";import"../../support/TileInfo.js";import"../../support/LOD.js";import"../../../chunks/TileKey.js";import"../../../chunks/TileInfoTilemapCache.js";import"../../../chunks/TilemapCache.js";import"../../../chunks/ByteSizeUnit.js";import"../../../chunks/LRUCache.js";import"../../../chunks/MemCache.js";import"../../../core/reactiveUtils.js";import"../../../chunks/asyncUtils.js";import"../../../core/Collection.js";import"../../../chunks/shared.js";import"../../../chunks/ArcGISService.js";import"../../../chunks/arcgisLayerUrl.js";import"../../../chunks/persistableUrlUtils.js";import"../../mixins/OperationalLayer.js";import"../../../chunks/layerContainerType.js";import"../../../chunks/commonProperties2.js";import"../../../chunks/ElevationInfo.js";import"../../support/fieldUtils.js";import"../../../core/sql.js";import"../../../intl.js";import"../../../chunks/number.js";import"../../../chunks/substitute.js";import"../../../chunks/messages.js";import"../../../chunks/unitConversionUtils.js";import"../../../chunks/lengthUtils.js";import"../../../tables/AttributeTableTemplate.js";import"../../../tables/elements/AttributeTableGroupElement.js";import"../../../tables/elements/AttributeTableElement.js";import"../../../tables/support/elements.js";import"../../../tables/elements/AttributeTableAttachmentElement.js";import"../../../tables/elements/AttributeTableFieldElement.js";import"../../../tables/elements/AttributeTableRelationshipElement.js";import"../../../chunks/opacityUtils.js";import"../../mixins/PortalLayer.js";import"../../../chunks/layerUtils.js";import"../../../portal/Portal.js";import"../../../portal/PortalGroup.js";import"../../../portal/PortalQueryParams.js";import"../../../portal/PortalQueryResult.js";import"../../../portal/PortalUser.js";import"../../../portal/PortalFolder.js";import"../../../portal/PortalItem.js";import"../../../portal/PortalItemResource.js";import"../../../portal/PortalRating.js";import"../../../chunks/portalItemUtils.js";import"../../../chunks/LercDecoder.js";import"../../../chunks/WorkerHandle.js";import"../../../core/workers/workers.js";import"../../../core/workers/Connection.js";import"../../../chunks/Queue.js";import"../../../core/workers/RemoteClient.js";import"../../ImageryLayer.js";import"../../../PopupTemplate.js";import"../../../popup/content.js";import"../../../popup/content/AttachmentsContent.js";import"../../../popup/content/Content.js";import"../../../popup/content/CustomContent.js";import"../../../popup/content/ExpressionContent.js";import"../../../popup/ElementExpressionInfo.js";import"../../../popup/content/FieldsContent.js";import"../../../popup/FieldInfo.js";import"../../../popup/support/FieldInfoFormat.js";import"../../../popup/content/MediaContent.js";import"../../../popup/content/BarChartMediaInfo.js";import"../../../popup/content/mixins/ChartMediaInfo.js";import"../../../popup/content/mixins/MediaInfo.js";import"../../../popup/content/support/ChartMediaInfoValue.js";import"../../../Color.js";import"../../../chunks/colorUtils.js";import"../../../popup/content/support/ChartMediaInfoValueSeries.js";import"../../../chunks/chartMediaInfoUtils.js";import"../../../popup/content/ColumnChartMediaInfo.js";import"../../../popup/content/ImageMediaInfo.js";import"../../../popup/content/support/ImageMediaInfoValue.js";import"../../../popup/content/LineChartMediaInfo.js";import"../../../popup/content/PieChartMediaInfo.js";import"../../../popup/content/RelationshipContent.js";import"../../../popup/support/RelatedRecordsInfoFieldOrder.js";import"../../../popup/content/TextContent.js";import"../../../popup/content/UtilityNetworkAssociationsContent.js";import"../../../popup/support/UtilityNetworkAssociationType.js";import"../../../popup/ExpressionInfo.js";import"../../../popup/LayerOptions.js";import"../../../popup/RelatedRecordsInfo.js";import"../../../support/actions/ActionBase.js";import"../../../support/actions/ActionButton.js";import"../../../support/actions/ActionToggle.js";import"../../mixins/ArcGISImageService.js";import"../../../Graphic.js";import"../../../symbols.js";import"../../../symbols/CIMSymbol.js";import"../../../symbols/Symbol.js";import"../../../symbols/ExtrudeSymbol3DLayer.js";import"../../../symbols/Symbol3DLayer.js";import"../../../chunks/utils4.js";import"../../../symbols/edges/Edges3D.js";import"../../../chunks/screenUtils.js";import"../../../chunks/materialUtils.js";import"../../../symbols/edges/SketchEdges3D.js";import"../../../symbols/edges/SolidEdges3D.js";import"../../../chunks/Symbol3DMaterial.js";import"../../../symbols/FillSymbol.js";import"../../../symbols/SimpleLineSymbol.js";import"../../../symbols/LineSymbol.js";import"../../../symbols/LineSymbolMarker.js";import"../../../chunks/lineMarkers.js";import"../../../symbols/FillSymbol3DLayer.js";import"../../../symbols/patterns/LineStylePattern3D.js";import"../../../symbols/patterns/StylePattern3D.js";import"../../../chunks/utils5.js";import"../../../chunks/colors.js";import"../../../chunks/symbolLayerUtils3D.js";import"../../../chunks/aaBoundingBox.js";import"../../../symbols/Font.js";import"../../../symbols/IconSymbol3DLayer.js";import"../../../symbols/LabelSymbol3D.js";import"../../../symbols/Symbol3D.js";import"../../../chunks/collectionUtils.js";import"../../../symbols/LineSymbol3DLayer.js";import"../../../symbols/LineStyleMarker3D.js";import"../../../symbols/ObjectSymbol3DLayer.js";import"../../../symbols/PathSymbol3DLayer.js";import"../../../symbols/TextSymbol3DLayer.js";import"../../../symbols/WaterSymbol3DLayer.js";import"../../../symbols/support/StyleOrigin.js";import"../../../chunks/Thumbnail.js";import"../../../chunks/calloutUtils.js";import"../../../symbols/callouts/Callout3D.js";import"../../../symbols/callouts/LineCallout3D.js";import"../../../symbols/support/Symbol3DVerticalOffset.js";import"../../../symbols/LineSymbol3D.js";import"../../../symbols/MarkerSymbol.js";import"../../../symbols/MeshSymbol3D.js";import"../../../symbols/PictureFillSymbol.js";import"../../../chunks/urlUtils.js";import"../../../symbols/PictureMarkerSymbol.js";import"../../../symbols/PointSymbol3D.js";import"../../../symbols/PolygonSymbol3D.js";import"../../../symbols/SimpleFillSymbol.js";import"../../../symbols/SimpleMarkerSymbol.js";import"../../../symbols/TextSymbol.js";import"../../../symbols/WebStyleSymbol.js";import"../../../rasterRenderers.js";import"../../../renderers/ClassBreaksRenderer.js";import"../../../renderers/Renderer.js";import"../../../renderers/support/AuthoringInfo.js";import"../../../renderers/support/AuthoringInfoVisualVariable.js";import"../../../chunks/colorRamps.js";import"../../../rest/support/AlgorithmicColorRamp.js";import"../../../rest/support/ColorRamp.js";import"../../../rest/support/MultipartColorRamp.js";import"../../../renderers/mixins/VisualVariablesMixin.js";import"../../../renderers/visualVariables/ColorVariable.js";import"../../../renderers/visualVariables/VisualVariable.js";import"../../../renderers/visualVariables/support/ColorStop.js";import"../../../renderers/visualVariables/OpacityVariable.js";import"../../../renderers/visualVariables/support/OpacityStop.js";import"../../../renderers/visualVariables/RotationVariable.js";import"../../../renderers/visualVariables/SizeVariable.js";import"../../../renderers/visualVariables/support/SizeStop.js";import"../../../chunks/sizeVariableUtils.js";import"../../../chunks/visualVariableUtils.js";import"../../../chunks/compilerUtils.js";import"../../../renderers/support/ClassBreakInfo.js";import"../../../chunks/commonProperties.js";import"../../../symbols/support/jsonUtils.js";import"../../../chunks/defaults.js";import"../../../chunks/defaultsJSON.js";import"../../../chunks/RendererLegendOptions.js";import"../../../renderers/FlowRenderer.js";import"../../../renderers/RasterColormapRenderer.js";import"../../../renderers/support/ColormapInfo.js";import"../../../chunks/colorRampUtils.js";import"../../../chunks/colorUtils2.js";import"../../../renderers/RasterShadedReliefRenderer.js";import"../../../renderers/RasterStretchRenderer.js";import"../../../chunks/stretchRendererUtils.js";import"../../../renderers/UniqueValueRenderer.js";import"../../../chunks/diffUtils.js";import"../../../renderers/support/UniqueValue.js";import"../../../renderers/support/UniqueValueClass.js";import"../../../renderers/support/UniqueValueGroup.js";import"../../../renderers/support/UniqueValueInfo.js";import"../../../chunks/styleUtils.js";import"../../../renderers/VectorFieldRenderer.js";import"../../../geometry/support/normalizeUtils.js";import"../../../chunks/normalizeUtilsCommon.js";import"../../../chunks/simplify.js";import"../../../chunks/utils9.js";import"../../../chunks/utils10.js";import"../../../chunks/vectorFieldUtils.js";import"../../support/PixelBlock.js";import"../../../chunks/pixelRangeUtils.js";import"../../../chunks/utils12.js";import"../../../chunks/jsonUtils.js";import"../../../chunks/parser.js";import"../../../chunks/utils2.js";import"../../../symbols/support/cimSymbolUtils.js";import"../../../chunks/utils7.js";import"../../../chunks/enums2.js";import"../../support/DimensionalDefinition.js";import"../../support/RasterFunction.js";import"../../support/MosaicRule.js";import"../../support/FieldsIndex.js";import"../../../chunks/imageBitmapUtils.js";import"../../support/MultidimensionalSubset.js";import"../../support/RasterInfo.js";import"../../support/RasterBandInfo.js";import"../../support/RasterSensorInfo.js";import"../../../chunks/RasterJobHandler.js";import"../../../chunks/multidimensionalUtils.js";import"../../../chunks/RasterSymbolizer.js";import"../../../chunks/_commonjsHelpers.js";import"../../../chunks/stretchUtils.js";import"../../../chunks/rasterRendererHelper.js";import"../../../chunks/generateRendererUtils.js";import"../../../rest/imageService.js";import"../../../rest/support/FindImagesParameters.js";import"../../../rest/support/FindImagesResult.js";import"../../../rest/support/ImageInspectionInfo.js";import"../../../rest/support/CameraInfoMixin.js";import"../../../rest/support/ImageAngleParameters.js";import"../../../rest/support/ImageAngleResult.js";import"../../../rest/support/ImageAreaParameters.js";import"../../../rest/support/BaseImageMeasureParameters.js";import"../../../rest/support/ImageAreaResult.js";import"../../../rest/support/BaseImageMeasureResult.js";import"../../../rest/support/ImageBoundaryParameters.js";import"../../../rest/support/ImageBoundaryResult.js";import"../../../rest/support/ImageDistanceParameters.js";import"../../../rest/support/ImageDistanceResult.js";import"../../../rest/support/ImageGPSInfoParameters.js";import"../../../rest/support/ImageGPSInfoResult.js";import"../../../rest/support/CameraInfo.js";import"../../../rest/support/ImageGPSInfo.js";import"../../../rest/support/ImageHeightParameters.js";import"../../../rest/support/ImageHeightResult.js";import"../../../rest/support/ImageHistogramParameters.js";import"../../../rest/support/ImageIdentifyParameters.js";import"../../../rest/support/ImageIdentifyResult.js";import"../../../rest/support/FeatureSet.js";import"../../../rest/support/ImagePixelLocationParameters.js";import"../../../rest/support/ImagePixelLocationResult.js";import"../../../rest/support/ImagePointParameters.js";import"../../../rest/support/ImagePointResult.js";import"../../../rest/support/ImageSampleParameters.js";import"../../../rest/support/ImageSampleResult.js";import"../../../rest/support/ImageSample.js";import"../../../rest/support/ImageToMapMultirayParameters.js";import"../../../rest/support/ImageToMapParameters.js";import"../../../rest/support/ImageUrlParameters.js";import"../../../rest/support/ImageUrlResult.js";import"../../../rest/support/MapToImageParameters.js";import"../../../rest/support/MeasureAreaFromImageResult.js";import"../../../rest/support/MeasureFromImageParameters.js";import"../../../rest/support/MeasureLengthFromImageResult.js";import"../../../chunks/fetchRasterInfo.js";import"../../../chunks/executeForIds.js";import"../../../chunks/query.js";import"../../../chunks/pbfQueryUtils.js";import"../../../chunks/pbf.js";import"../../../chunks/OptimizedGeometry.js";import"../../../chunks/OptimizedFeature.js";import"../../../chunks/OptimizedFeatureSet.js";import"../../../chunks/queryZScale.js";import"../../../chunks/executeQueryJSON.js";import"../../../chunks/dataUtils.js";import"../../mixins/BlendLayer.js";import"../../mixins/CustomParametersMixin.js";import"../../mixins/RasterPresetRendererMixin.js";import"../../../renderers/support/RasterPresetRenderer.js";import"../../mixins/RefreshableLayer.js";import"../../mixins/ScaleRangeLayer.js";import"../../mixins/TemporalLayer.js";import"../../support/TimeInfo.js";import"../../../time/TimeInterval.js";import"../../../chunks/versionUtils.js";import"../../../support/popupUtils.js";import"../../../chunks/interfaces2.js";import"../../ImageryTileLayer.js";import"../../mixins/ImageryTileMixin.js";import"../../../chunks/RawBlockCache.js";import"../../../chunks/rasterProjectionHelper.js";import"../../../chunks/QueueProcessor.js";import"../../../chunks/ReactiveMap.js";import"../../../core/signal.js";import"../../../chunks/rasterFunctionHelper.js";import"../../support/rasterFunctionConstants.js";import"../../../chunks/focalStatUtils.js";import"../../../chunks/xmlUtilities.js";import"../../../chunks/GCSShiftTransform.js";import"../../support/ElevationSampler.js";import"../../../chunks/ElevationTile.js";import"../../../chunks/ElevationSamplerData.js";import"../../../chunks/requestPresets.js";async function G(s,t,r){const e=Array.isArray(s)?s:[s];let o;if(j(t))o=await h(e,t.elevationSample,r);else if(y(t)){const{elevationSource:s,extent:i}=t,{url:p,lod:m,rasterFunction:a}=s;o=await k(e,{url:p,lod:m,rasterFunction:a,extent:i},r)}else o=await d(e,t.elevationSource.constantElevation,r);return Array.isArray(s)?o:o[0]}async function q(s,r,e,o=H){const{cameraLocation:i,farPlaneVertices:p}=e,m=f(i),a=new Array;await N(p,e,a);let n=u(a[0],a[1],a[2]),l=s.clone();for(let s=0;s<o;s++){const s=t();if(!c(n,m,f(l),s))break;let o=0,p=null;if(({error:o,imagePoint:p,pointWithZ:l}=await Z(r,new O(s,i.spatialReference),e)),o<=1)break;const[j,h]=Q(i.spatialReference,a);if(b(j<=1,h<=1))break;a.splice(0,a.length,...await X(j,h,new O(s,i.spatialReference),e)),n=u(a[0],a[1],a[2])}return f(l)}async function z(s,r,e,o=H){const{cameraLocation:i,farPlaneVertices:p}=e,m=f(i),a=new Array;await N(p,e,a);let n=u(a[0],a[1],a[2]),l=s.clone();for(let s=0;s<o;s++){const s=t();if(!c(n,m,f(l),s))break;let o,p=0;if(({error:p,imagePoint:o,pointWithZ:l}=await J(r,new O(s,i.spatialReference),e)),p<=1)break;const[j,h]=Q(i.spatialReference,a);if(b(j<=1,h<=1))break;a.splice(0,a.length,...await X(j,h,new O(s,i.spatialReference),e)),n=u(a[0],a[1],a[2])}return f(l)}const H=10,W=10;function Q(s,t){const r=new B({spatialReference:s});return r.addRing(t),[r.extent?.width?r.extent.width/W:1,r.extent?.height?r.extent.height/W:1]}async function N(s,t,r){const e=l(s),o=await G(e,t);r.push(...o.map(f))}async function Z(s,t,r){const e=await G(t,r),o=g(e,r);return{error:K(o,s),imagePoint:o,pointWithZ:e}}async function J(s,t,r){const e=await G(t,r),o=I(e,r);return{error:_(o,s),imagePoint:o,pointWithZ:e}}const K=(s,t)=>Math.abs(s.x-t.x)+Math.abs(s.y-t.y),_=(s,t)=>Math.abs(s.heading-t.heading)+Math.abs(s.pitch-t.pitch);async function X(s,t,r,e){return G([[-s,-t],[s,-t],[s,t],[-s,t]].map((([s,t])=>new O([r.x+s,r.y+t],r.spatialReference))),e).then((s=>s.map((s=>s.toArray()))))}async function Y(s,t,r){const{verticalFieldOfView:e,imageBoundaries:o,scalingFactor:i,farPlaneVertices:p,cameraLocation:m,pixelsToTransform:a,vecToPoint:n}=es(s,t),l=new Array;return await async function(s,t,r,e,o,i,p,m,a,n){for(const l of s){let s=ss(t,r,l,e,o);n&&b(S(n.elevationSample),y(n))&&(s=await q(e(s),{x:l[0],y:l[1]},{...o,...n,farPlaneVertices:t.map(e)})),i.push(e($(s,p,m,o.averageElevation,o.cameraPitch,a)))}}(a,p,o,n,t,l,m,i,e,r),Array.isArray(s)?l:l[0]}function $(s,t,i,p,m,a){let n=r(s);const l=Math.sqrt((s[2]-t[2])**2+(Math.sqrt((s[0]-t[0])**2+(s[1]-t[1])**2)/i)**2)*i,u=R(o(e(),s,t),1/l,1/i);if(function(s,t,r,e){return s<t||r+e/2<90}(s[2],p,m,a)){const s=Math.abs((t[2]-p)/-u[2])*i;n=P(t,u,s,i)}else n[2]=p;return n}function ss(s,t,r,e,o){let i,p=null,m=0,a=s,n=t;for(;m<=9;){const s=rs(r,n,a,o);if(i=s.error,p=s.transformedPoint,b(i<=1,9===m))break;a=U(a,i,r,t),n=ts(a,e,o),m++}return p}function ts(s,t,r){return g(s.map(t),r).map((({x:s,y:t})=>[s,t,1]))}function rs(s,t,r,e){const{cameraLocation:o}=e,i=x(s,t,r),{x:p,y:m}=g(new O(i,o.spatialReference),e);var a,n;return{transformedPoint:i,error:(a=s,n=[p,m,1],Math.abs(a[0]-n[0])+Math.abs(a[1]-n[1]))}}function es(t,r){const e=s(t)||"items"in t?t:[t],{cameraLocation:o,rotationMatrix:i}=r;if(v(e,o),M(i),9!==i?.length)throw new Error("Rotation matrix is not provided or is not a valid 3x3 matrix");const p=C(o.y,o.spatialReference),m=w({...r,scalingFactor:p}),a=g(m.map((s=>new O(s,o.spatialReference))),r),{vfov:n}=L(r.horizontalFieldOfView,r.verticalFieldOfView,r.cameraRoll);return{cameraLocation:o.toArray(),imageBoundaries:a.map((({x:s,y:t})=>[s,t,1])),verticalFieldOfView:n,farPlaneVertices:m,scalingFactor:p,pixelsToTransform:e.map((s=>[s.x,s.y,1])),vecToPoint:A(o.spatialReference)}}async function os(s,t,r){const{averageElevation:o,cameraHeading:l,cameraLocation:u,farDistance:c,imageHeight:j,imageWidth:h,verticalFieldOfView:y}=t,k=C(u.y,u.spatialReference),d=new Array,[f,b,g]=u.toArray(),I=a([f,b,g??0],c*k),R=T.toArray(),P=Array.isArray(s)?s:[s];for(const s of P){let a,P;if(D(s))a=s.heading,P=s.pitch;else{const t=V({x:s.x,y:s.y},h,j);a=t.heading,P=t.pitch}a=(a+l)%360;const U=i([R[0],R[1],R[2]],F(a,P)),x=p([f,b,g??0],U.direction);let v=e();m(I,x,v),r&&(n(r)||S(r.elevationSample))&&P+y/2<90&&(v=await z(new O(v,u.spatialReference),{heading:a,pitch:P},{...t,...r,farPlaneVertices:E(c,c).map((([s,t])=>new O([u.x+s,u.y+t],u.spatialReference)))})),v=$(v,u.toArray(),k,o,P,y),d.push(new O(v,u.spatialReference))}return Array.isArray(s)?d:d[0]}export{Y as imageToWorld,os as imageToWorldPanoramic,G as u};
