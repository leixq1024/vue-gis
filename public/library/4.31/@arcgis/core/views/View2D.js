/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import"../geometry.js";import e from"../Viewpoint.js";import i from"../core/Collection.js";import{C as s}from"../chunks/CollectionFlattener.js";import o from"../core/Error.js";import{h as n,i as a}from"../core/lang.js";import{L as r}from"../chunks/Logger.js";import{r as l,d as p}from"../chunks/maybe.js";import{watch as h,whenOnce as c,initial as m,when as u,sync as d,syncAndInitial as g}from"../core/reactiveUtils.js";import{initialize as y}from"../core/workers/workers.js";import{property as w}from"../core/accessorSupport/decorators/property.js";import{cast as f}from"../core/accessorSupport/decorators/cast.js";import{subclass as v}from"../core/accessorSupport/decorators/subclass.js";import{a as _}from"../chunks/ensureType.js";import{project as j,isLoadedOrLoadFor as k}from"../geometry/projection.js";import b from"../layers/support/TileInfo.js";import{BreakpointsOwner as M}from"./BreakpointsOwner.js";import{DOMContainer as S}from"./DOMContainer.js";import{PopupView as T}from"./PopupView.js";import V from"./View.js";import x from"../core/Accessor.js";import{addFrameTask as D,M as L}from"../core/scheduling.js";import{c as P}from"../chunks/screenUtils.js";import{c as C}from"../chunks/vec2f64.js";import I from"./ViewAnimation.js";import{P as O,V as R}from"../chunks/ViewStateManager.js";import{e as z,p as U}from"../chunks/unitBezier.js";import{o as E,c as N,y as Z,t as A,u as G,l as F}from"../chunks/viewpointUtils.js";import{d as q,l as H}from"../chunks/mathUtils.js";import K,{d as $}from"../geometry/Point.js";import{d as B,A as W,e as Y,D as Q,r as X,a as J,i as tt,o as et,b as it,m as st,g as ot,B as nt,I as at,P as rt,S as lt,c as pt,f as ht,h as ct}from"../chunks/WebGLRequirements.js";import{isPromiseLike as mt,throwIfAborted as ut,whenOrAbort as dt,c as gt}from"../core/promiseUtils.js";import{a as yt,R as wt}from"../chunks/Scheduler.js";import{p as ft}from"../chunks/a11yUtils.js";import vt from"../layers/support/LOD.js";import{NumericIdentifiableMixin as _t}from"../core/Identifiable.js";import jt,{a as kt,p as bt}from"../geometry/Extent.js";import{u as Mt}from"../chunks/vec2.js";import{p as St}from"../chunks/coordsUtils.js";import Tt from"../geometry/Polygon.js";import{c as Vt,T as xt}from"../chunks/TileStrategy.js";import{T as Dt}from"../chunks/TileKey2.js";import{I as Lt,a as Pt,V as Ct}from"../chunks/InputManager.js";import It,{i as Ot}from"../core/Handles.js";import Rt from"../core/Evented.js";import{r as zt}from"../chunks/rbush.js";import{w as Ut,o as Et,c as Nt}from"../chunks/aaBoundingRect.js";import{l as Zt}from"../chunks/unitUtils.js";import{T as At}from"../chunks/Tile.js";import{c as Gt,H as Ft}from"../chunks/util2.js";import{a as qt}from"../chunks/clippingUtils.js";import{c as Ht,g as Kt,s as $t,H as Bt}from"../chunks/highlightGroupUtils.js";import Wt from"../Graphic.js";import{i as Yt,d as Qt}from"../chunks/screenUtils2.js";import{getFormatAndQuality as Xt,encode as Jt,encodeData as te,getMaximumResolutionScale as ee}from"../chunks/screenshotUtils.js";import{T as ie}from"../chunks/Timeline.js";import se from"./ui/DefaultUI.js";import{i as oe}from"../chunks/utils6.js";import ne from"../webmap/background/ColorBackground.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/metadata.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../config.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/writer.js";import"../chunks/jsonMap.js";import"../chunks/assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Polyline.js";import"../chunks/extentUtils.js";import"../chunks/boundsUtils.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../chunks/Axis.js";import"../Camera.js";import"../CameraLayout.js";import"../core/Clonable.js";import"../chunks/Cyclical.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/asyncUtils.js";import"../core/workers/Connection.js";import"../chunks/Queue.js";import"../core/workers/RemoteClient.js";import"../intl.js";import"../chunks/date.js";import"../chunks/locale.js";import"../chunks/datetime.js";import"../chunks/number.js";import"../chunks/substitute.js";import"../chunks/messages.js";import"../chunks/vec3f64.js";import"../chunks/projectBuffer.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../chunks/zscale.js";import"../chunks/TileKey.js";import"../chunks/domUtils.js";import"../chunks/UpdatingHandles.js";import"../chunks/projector.js";import"../chunks/widgetUtils.js";import"../core/signal.js";import"../Map.js";import"../Basemap.js";import"../chunks/collectionUtils.js";import"../core/Loadable.js";import"../core/Promise.js";import"../chunks/loadAll.js";import"../portal/Portal.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/persistableUrlUtils.js";import"../support/BasemapStyle.js";import"../chunks/writeUtils.js";import"../chunks/layerUtils.js";import"../Ground.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/compilerUtils.js";import"../chunks/enumeration.js";import"../chunks/opacityUtils.js";import"../chunks/editableLayers.js";import"../layers/catalog/catalogUtils.js";import"../chunks/basemapUtils.js";import"../chunks/utils2.js";import"../chunks/mat4.js";import"../chunks/common.js";import"../chunks/collectionUtils2.js";import"../support/LayersMixin.js";import"../layers/Layer.js";import"../time/TimeExtent.js";import"../chunks/timeUtils.js";import"../support/TablesMixin.js";import"../chunks/GraphicsCollection.js";import"../geometry/HeightModelInfo.js";import"./BasemapView.js";import"./Magnifier.js";import"../chunks/ReactiveMap.js";import"../rest/support/Query.js";import"../chunks/DataLayerSource.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../chunks/FullTextSearch.js";import"../chunks/spatialRelationships.js";import"../rest/support/StatisticDefinition.js";import"../chunks/selectionUtils.js";import"./Theme.js";import"../chunks/ViewEvents.js";import"../chunks/IViewEvents.js";import"../chunks/interfaces.js";import"./input/Input.js";import"./input/gamepad/GamepadSettings.js";import"./input/gamepad/GamepadInputDevice.js";import"./navigation/Navigation.js";import"./navigation/gamepad/GamepadSettings.js";import"../chunks/heightModelInfoUtils.js";import"../chunks/arcgisLayerUrl.js";import"../chunks/ViewingMode.js";import"../chunks/projectionUtils.js";import"../PopupTemplate.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/content/UtilityNetworkAssociationsContent.js";import"../popup/support/UtilityNetworkAssociationType.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils4.js";import"../symbols/edges/Edges3D.js";import"../chunks/materialUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils5.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"./2d/ViewState.js";import"../chunks/mat2d.js";import"../chunks/mat2df32.js";import"../chunks/mat2df64.js";import"../chunks/mat3.js";import"../chunks/mat3f32.js";import"../chunks/vec2f32.js";import"../geometry/support/normalizeUtils.js";import"../chunks/normalizeUtilsCommon.js";import"../chunks/simplify.js";import"../chunks/utils9.js";import"../chunks/utils10.js";import"../chunks/vec3.js";import"../chunks/capabilities2.js";import"../chunks/debugFlags.js";import"../chunks/QueueProcessor.js";import"../chunks/quickselect.js";import"../chunks/definitions.js";import"../chunks/HighlightOptions.js";import"../chunks/HighlightDefaults.js";import"../chunks/enums.js";import"../chunks/Texture.js";import"../chunks/GLObjectType.js";import"../chunks/featureTechniqueUtils.js";import"../chunks/imageUtils.js";import"./ui/UI.js";import"../chunks/themeUtils.js";import"../widgets/Attribution.js";import"../widgets/Widget.js";import"../chunks/uuid.js";import"../chunks/componentsUtils.js";import"../chunks/jsxWidgetSupport.js";import"../widgets/Attribution/AttributionViewModel.js";import"../chunks/globalCss.js";import"../chunks/accessibleHandler.js";import"../chunks/messageBundle.js";import"../chunks/jsxFactory.js";import"../widgets/Compass.js";import"../widgets/Compass/CompassViewModel.js";import"../chunks/duration.js";import"../chunks/utils22.js";import"../widgets/support/GoTo.js";import"../widgets/NavigationToggle.js";import"../widgets/NavigationToggle/NavigationToggleViewModel.js";import"../widgets/Zoom.js";import"../widgets/Zoom/ZoomViewModel.js";import"../chunks/Version.js";import"../chunks/Version2.js";class ae{constructor(t){this._view=t,this.viewpoint=new e({targetGeometry:new K,scale:0,rotation:0})}get view(){return this._view}get size(){const[t,e]=this._view.size;return Math.sqrt(t*t+e*e)}get scale(){return this.viewpoint.scale}get rotation(){return this.viewpoint.rotation}get center(){return this.viewpoint.targetGeometry}get scaleToResolutionFactor(){return E(this.center.spatialReference)}pixelsPerPanAtZoom(t){return 1/(t*this.scaleToResolutionFactor)}zoomAtPixelsPerPan(t){return 1/(t*this.scaleToResolutionFactor)}pixelsPerRotate(){return this.size/2}compareTo(t,e){e.pan=$(this.center,t.center);let i=Math.abs(t.rotation-this.rotation);i=i>=180?360-i:i,e.rotate=q(i),e.sourceZoom=this.scale,e.targetZoom=t.scale}interpolate(t,e,i){const{pan:s,rotate:o,zoom:n,zoomOffset:a}=i,{center:r}=this;r.spatialReference=t.center.spatialReference,r.x=H(t.center.x,e.center.x,s),r.y=H(t.center.y,e.center.y,s),this.viewpoint.scale=H(t.scale,e.scale+a,n);let l=t.rotation;const p=e.rotation;Math.abs(p-l)>=180&&(l+=360*(l<p?1:-1)),this.viewpoint.rotation=H(l,p,o)}copyFrom(t){N(this.viewpoint,t.viewpoint),this._view=t.view}}class re{constructor(t){this._view=t,this._animation=new W((()=>new ae(this._view))),this._current=new ae(this._view)}get _source(){return this._animation.definition.source}get _target(){return this._animation.definition.target}get duration(){return this._animation.time}get animation(){return this._animation}update(t,e,i={}){N(this._current.viewpoint,t),N(this._source.viewpoint,t),N(this._target.viewpoint,e),this._animation.update(this._source,this._target,i)}applyRatio(t,e){this._animation.cameraAt(e,this._current),N(t,this._current.viewpoint)}}let le=class extends x{constructor(t){super(t),this._animation=null,this._destinationViewState=new O,this.updateFunction=null,this.easing=z.ease,this.viewpoint=new e({targetGeometry:new K,scale:0,rotation:0}),this._updateTask=D({postRender:this._postRender.bind(this)}),this._updateTask.pause(),this._transition=new re(t.view)}destroy(){this._updateTask=l(this._updateTask)}get animation(){return this._animation}set animation(t){this._animation=t,this.view.animation=t}animate(t,e,i){this.stop();const s=this.viewpoint;N(s,e);const o=("string"==typeof i?.easing?U(i.easing):i?.easing)||this.easing,a=t.target;this._transition.update(this.viewpoint,a,{apex:{maximumDistance:Math.min(64*Math.min(e.scale,a.scale),this.view.constraints.effectiveMinScale),desiredSlope:5e-8},duration:i?.duration,maxDuration:"auto"===i?.animationMode?L(1/0):i?.maxDuration??B.maxDuration,speedFactor:i?.speedFactor,easing:"function"==typeof o?t=>o(t):void 0}),"auto"===i?.animationMode&&(this._destinationViewState.copy(this.view.state),this._destinationViewState.viewpoint=a,function(t,e,i,s){if(null!=e?.duration)return!0;const{time:o,isLinear:a}=t,r=e?.speedFactor||1,l=e?.maxDuration??B.maxDuration/r;if(n("esri-goto-debug")&&(console.log("speed factor:",r),console.log("adjusted duration:\t\t",o),console.log("adjusted max duration:\t",l),console.log("is linear:",a)),o>l)return n("esri-goto-debug")&&console.warn(`failed "auto" heuristic: animations must be shorter than ${l/1e3}s`),!1;if(a){const t=1.5,e=C(),a=P(...s.toScreen(e,...i.center)),p=P(...i.toScreen(e,...s.center)),h=null!=p&&p.x>-(t-.5)*i.size[0]&&p.x<(t+.5)*i.size[0]&&p.y>-(t-.5)*i.size[1]&&p.y<(t+.5)*i.size[1],c=null!=a&&a.x>-(t-.5)*s.size[0]&&a.x<(t+.5)*s.size[0]&&a.y>-(t-.5)*s.size[1]&&a.y<(t+.5)*s.size[1];if(n("esri-goto-debug")&&(console.log(`dest is within ${t} screens at start view:`,h),console.log(`start is within ${t} screens at dest view:`,c)),o>2e3/r&&!h&&!c)return n("esri-goto-debug")&&console.warn(`failed "auto" heuristic: linear animations must be...\n  - shorter than ${2/r}s, or\n  - shorter than ${l/1e3}s and the destination is close enough to the starting screen, or\n  - shorter than ${l/1e3}s and the start point is close enough to the destination screen`),!1}return!0}(this._transition.animation,i,this.view.state,this._destinationViewState)||this._transition.update(this.viewpoint,a,{duration:L(0)}));const r=()=>{this.animation===t&&this._updateTask&&("finished"===t.state&&(this._transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return t.when(r,r),this._startTime=performance.now(),this._updateTask.resume(),this.animation=t,t}animateContinuous(t,e){this.stop(),this.updateFunction=e,this.viewpoint=t;const i=new I({target:t.clone()}),s=()=>{this.animation===i&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return i.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=i,i}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(t){const e=this.animation;if(e&&e.state!==I.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,t.deltaTime),this.animation?.update(this.viewpoint);else{const t=performance.now()-this._startTime,e=this._transition.duration,i=e>0?t/e:1,s=i>=1;this._transition.applyRatio(this.viewpoint,i),s&&this.animation?.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};t([w()],le.prototype,"easing",void 0),t([w()],le.prototype,"view",void 0),t([w()],le.prototype,"viewpoint",void 0),le=t([v("esri.views.2d.AnimationManager")],le);const pe=le;class he{constructor(t){this.view=t,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this._scheduler=yt(),this.stationary=!0,this.prepare=()=>{this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions,this._updateParameters.targetState.copy(this.view.state),null==this.view.animation?.target||mt(this.view.animation.target)||(this._updateParameters.targetState.viewpoint=this.view.animation.target))},this.update=t=>{if(this._updateRequested=!1,this.view?.destroyed)return;const{allLayerViews:e,graphicsView:i,labelManager:s,state:{id:o}}=this.view;e.forEach(this._updateLayerView,this),null!=s&&(s.lastUpdateId!==o&&(s.viewChange(),s.lastUpdateId=o),s.updateRequested&&s.processUpdate(this._updateParameters)),null!=i&&(i.lastUpdateId!==o&&(i.viewChange(),i.lastUpdateId=o),i.updateRequested&&i.processUpdate(this._updateParameters)),this.view.graphicsTileStore.setViewState(this._updateParameters.state),this.view.animation?this._scheduler.state=wt.ANIMATING:this.view.interacting?this._scheduler.state=wt.INTERACTING:this._scheduler.state=wt.IDLE,this._scheduler.updateBudget(t)&&this._scheduler.frame()}}destroy(){this.stop(),this._scheduler.destroy()}get scheduler(){return this._scheduler}start(){if(this._frameTaskHandle)return;const t=this.view;this.stationary=t.stationary,this._updateParameters={state:t.state,targetState:new O,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:t.renderingOptions},this._stationaryHandle=h((()=>t.stationary),(t=>{this.stationary=t,this.requestFrame()})),this._frameTaskHandle=D(this),this.requestUpdate()}stop(){this._frameTaskHandle&&(this._updateRequested=!1,this._stationaryHandle?.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(t){if(!t.attached)return void this.requestUpdate();const e=this.view.state,i=t.lastUpdateId;null!=i&&(this.stationary||t.moving)||(t.moving=!0),i!==e.id&&t.viewChange(),this.stationary&&t.moving&&(t.moving=!1,t.moveEnd()),t.lastUpdateId=e.id,t.updateRequested&&t.processUpdate(this._updateParameters),"layerViews"in t&&t.layerViews?.forEach(this._updateLayerView,this)}}let ce=class extends x{constructor(t){super(t),this._gotoTask=null}destroy(){this._gotoTask=null}async goTo(t,e){if(!t)return void r.getLogger(this).error("#goTo()","target cannot be null or undefined");const i=new I;this.view.animation=i,await c((()=>this.view.ready),e);const s={...e,animate:e?.animate??!ft(),animationMode:e?.animationMode??"auto"},{extent:o,spatialReference:n,size:a,viewpoint:l,constraints:p,padding:h,allLayerViews:m}=this.view,u=Z(t,{extent:o,spatialReference:n,size:a,viewpoint:l,constraints:p,padding:h,allLayerViews:m,pickClosestTarget:e?.pickClosestTarget??!0});return i?.update(u),this._gotoTask={},s.animate?this._gotoAnimated(u,s):this._gotoImmediate(u,s)}_gotoImmediate(t,e){const i=this._gotoTask,s=this.view.animation,n=t.then((t=>{if(ut(e),i!==this._gotoTask)throw new o("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=s.target=t,s.finish()}));return this._cancellableGoTo(i,s,n,e)}_gotoAnimated(t,e){const i=this._gotoTask,s=this.view.animation;if(!s)return Promise.resolve();const n=t.then((t=>{if(ut(e),i!==this._gotoTask)throw new o("view:goto-interrupted","Goto was interrupted");return s.update(t),this.view.animationManager.animate(s,this.view.viewpoint,e),s.when().then((()=>{}),(()=>{}))}));return this._cancellableGoTo(i,s,n,e)}_cancellableGoTo(t,e,i,s){const o=()=>t===this._gotoTask;return dt(i,s).finally((()=>{o()&&(e.done||e.stop())}))}};function me(){return Promise.all([import("../chunks/webglDeps.js"),import("../chunks/mapViewDeps.js")])}t([w({constructOnly:!0})],ce.prototype,"view",void 0),ce=t([v("esri.views.2d.GoToManager")],ce);const ue=()=>me().then((()=>import("../chunks/TileLayerView2D.js"))),de=()=>me().then((()=>import("../chunks/FeatureLayerView2D.js").then((t=>t.a)))),ge={"base-dynamic":()=>me().then((()=>import("../chunks/BaseDynamicLayerView2D.js"))),"base-tile":ue,"bing-maps":ue,catalog:()=>me().then((()=>import("../chunks/CatalogLayerView2D.js"))),"catalog-dynamic-group":()=>me().then((()=>import("../chunks/CatalogDynamicGroupLayerView2D.js"))),"catalog-footprint":()=>me().then((()=>import("../chunks/CatalogFootprintLayerView2D.js"))),csv:de,"geo-rss":()=>me().then((()=>import("../chunks/GeoRSSLayerView2D.js"))),feature:de,geojson:de,parquet:de,graphics:()=>me().then((()=>import("../chunks/GraphicsLayerView2D.js"))),group:()=>me().then((()=>import("../chunks/GroupLayerView2D.js"))),imagery:()=>me().then((()=>import("../chunks/ImageryLayerView2D.js"))),"imagery-tile":()=>me().then((()=>import("../chunks/ImageryTileLayerView2D.js"))),kml:()=>me().then((()=>import("../chunks/KMLLayerView2D.js"))),"knowledge-graph":()=>me().then((()=>import("../chunks/KnowledgeGraphLayerView2D.js"))),"link-chart":()=>me().then((()=>import("../chunks/KnowledgeGraphLayerView2D.js"))),"knowledge-graph-sublayer":de,"map-image":()=>me().then((()=>import("../chunks/MapImageLayerView2D.js"))),"map-notes":()=>me().then((()=>import("../chunks/MapNotesLayerView2D.js"))),media:()=>me().then((()=>import("../chunks/MediaLayerView2D.js"))),"ogc-feature":()=>me().then((()=>import("../chunks/OGCFeatureLayerView2D.js"))),"open-street-map":ue,"oriented-imagery":de,route:()=>me().then((()=>import("../chunks/RouteLayerView2D.js"))),stream:()=>me().then((()=>import("../chunks/StreamLayerView2D.js"))),"subtype-group":()=>me().then((()=>import("../chunks/SubtypeGroupLayerView2D.js"))),tile:ue,"vector-tile":()=>me().then((()=>import("../chunks/VectorTileLayerView2D.js"))),video:()=>me().then((()=>import("../chunks/VideoLayerView2D.js"))),wcs:()=>me().then((()=>import("../chunks/ImageryTileLayerView2D.js"))),"web-tile":ue,wfs:de,wms:()=>me().then((()=>import("../chunks/WMSLayerView2D.js"))),wmts:()=>me().then((()=>import("../chunks/WMTSLayerView2D.js"))),"line-of-sight":null,"base-elevation":null,"building-scene":null,dimension:null,elevation:null,focusArea:null,"integrated-mesh":null,"integrated-mesh-3dtiles":null,"point-cloud":null,viewshed:null,voxel:null,scene:null,unknown:null,unsupported:null};var ye;let we=ye=class extends(_t(x)){constructor(t){super(t),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(null==this.geometry||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return j(this.geometry,this.spatialReference)}catch(t){return r.getLogger(this).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:t}),null}return this.geometry}constrain(t,e){if(null==this.normalizedGeometry)return t;const i=t.targetGeometry;if("extent"===this.normalizedGeometry.type?kt(this.normalizedGeometry,i):bt(this.normalizedGeometry,i))return t;const{coordinate:s}=function(t,e){const{spatialReference:i}=e,s=[e.x,e.y];let o=Number.POSITIVE_INFINITY,n=0,a=0;const r=[0,0],l="extent"===t.type?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:t.rings;for(const t of l)for(let e=0;e<t.length-1;e++){St(r,s,t,e);const i=Mt(s,r);i<o&&(o=i,n=r[0],a=r[1])}return{coordinate:new K({x:n,y:a,spatialReference:i}),distance:o}}(this.normalizedGeometry,i);return s?(t.targetGeometry=s,t):t}clone(){return new ye({geometry:this.geometry?.clone(),spatialReference:this.spatialReference?.clone()})}};var fe;t([w({constructOnly:!0})],we.prototype,"geometry",void 0),t([w({readOnly:!0})],we.prototype,"normalizedGeometry",null),t([w({constructOnly:!0})],we.prototype,"spatialReference",void 0),we=ye=t([v("esri.views.2d.constraints.GeometryConstraint")],we);let ve=fe=class extends(_t(x)){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(t,e){return this.enabled&&e?(this.rotationEnabled||(t.rotation=e.rotation),t):t}clone(){return new fe({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};t([w()],ve.prototype,"enabled",void 0),t([w()],ve.prototype,"rotationEnabled",void 0),ve=fe=t([v("esri.views.2d.constraints.RotationConstraint")],ve);const _e=ve;var je;let ke=je=class extends(_t(x)){constructor(t){super(t),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let t,{lods:e,minScale:i,maxScale:s,minZoom:o,maxZoom:n}=this,a=-1,r=-1,l=!1,p=!1;if(0!==i&&0!==s&&i<s&&([i,s]=[s,i]),!e?.length)return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",s);e=e.map((t=>t.clone())),e.sort(((t,e)=>e.scale-t.scale)),e.forEach(((t,e)=>t.level=e));for(const o of e)!l&&i>0&&i>=o.scale&&(a=o.level,l=!0),!p&&s>0&&s>=o.scale&&(r=t?t.level:-1,p=!0),t=o;-1===o&&(o=0===i?0:a),-1===n&&(n=0===s?e.length-1:r),o=Math.max(o,0),o=Math.min(o,e.length-1),n=Math.max(n,0),n=Math.min(n,e.length-1),o>n&&([o,n]=[n,o]),i=e[o].scale,s=e[n].scale,e.splice(0,o),e.splice(n-o+1,e.length),e.forEach(((t,e)=>{this._lodByScale[t.scale]=t,this._scales[e]=t.scale})),this._set("effectiveLODs",e),this._set("effectiveMinZoom",o),this._set("effectiveMaxZoom",n),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",s)}constrain(t,e){if(e&&t.scale===e.scale)return t;const i=this.effectiveMinScale,s=this.effectiveMaxScale,o=t.targetGeometry,n=e&&e.targetGeometry,a=0!==s&&t.scale<s,r=0!==i&&t.scale>i;if(a||r){const a=r?i:s;if(e&&n){const i=(a-e.scale)/(t.scale-e.scale);o.x=n.x+(o.x-n.x)*i,o.y=n.y+(o.y-n.y)*i}t.scale=a}return this.snapToZoom&&this.effectiveLODs&&(t.scale=this._getClosestScale(t.scale)),t}fit(t){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(t,null);const e=this.scaleToZoom(t.scale),i=Math.abs(e-Math.floor(e));return t.scale=this.zoomToScale(i>.99?Math.round(e):Math.floor(e)),t}zoomToScale(t){if(!this.effectiveLODs)return 0;t-=this.effectiveMinZoom,t=Math.max(0,t);const e=this._scales;if(t<=0)return e[0];if(t>=e.length)return e[e.length-1];const i=Math.floor(t),s=Math.ceil(t);return e[i]+(t-i)*(e[s]-e[i])}scaleToZoom(t){if(!this.effectiveLODs)return-1;const e=this._scales;let i,s;if(t>=e[0])return this.effectiveMinZoom;if(t<=e[e.length-1])return this.effectiveMaxZoom;for(let o=0;o<e.length-1;o++){if(i=e[o],s=e[o+1],s===t)return o+this.effectiveMinZoom+1;if(i>t&&s<t)return o+this.effectiveMinZoom+1-(t-s)/(i-s)}return-1}snapToClosestScale(t){if(!this.effectiveLODs)return t;const e=this.scaleToZoom(t);return this.zoomToScale(Math.round(e))}snapToNextScale(t,e=.5){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i+1)}snapToPreviousScale(t,e=2){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i-1)}clone(){return new je({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(t){return this._lodByScale[t]||(t=this._scales.reduce(((e,i)=>Math.abs(i-t)<=Math.abs(e-t)?i:e),this._scales[0])),this._lodByScale[t].scale}};t([w({readOnly:!0})],ke.prototype,"effectiveLODs",void 0),t([w({readOnly:!0})],ke.prototype,"effectiveMinZoom",void 0),t([w({readOnly:!0})],ke.prototype,"effectiveMaxZoom",void 0),t([w({readOnly:!0})],ke.prototype,"effectiveMinScale",void 0),t([w({readOnly:!0})],ke.prototype,"effectiveMaxScale",void 0),t([w()],ke.prototype,"lods",void 0),t([w()],ke.prototype,"minZoom",void 0),t([w()],ke.prototype,"maxZoom",void 0),t([w()],ke.prototype,"minScale",void 0),t([w()],ke.prototype,"maxScale",void 0),t([w()],ke.prototype,"snapToZoom",void 0),ke=je=t([v("esri.views.2d.constraints.ZoomConstraint")],ke);const be=ke,Me={base:null,key:"type",typeMap:{extent:jt,polygon:Tt}};let Se=class extends x{constructor(t){super(t),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0,this.customConstraints=new i}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(t){t?this._set("geometry",t):this._set("geometry",null)}get version(){return`${this._zoom?.uid}/${this._rotation?.uid}/${this._geometry?.uid}`}get _geometry(){const t=this._get("_geometry");return t&&this.geometry===t.geometry&&this.view?.constraintsInfo.spatialReference===t.spatialReference?t:new we({geometry:this.geometry,spatialReference:this.view?.constraintsInfo.spatialReference})}get _rotation(){return new _e({rotationEnabled:this.rotationEnabled})}get _zoom(){const t=this._get("_zoom"),e=this.lods||this.view?.constraintsInfo.lods,i=this.minZoom,s=this.maxZoom,o=this.minScale,n=this.maxScale,a=this.snapToZoom;return t&&t.lods===e&&t.minZoom===i&&t.maxZoom===s&&t.minScale===o&&t.maxScale===n&&t.snapToZoom===a?t:new be({lods:e,minZoom:i,maxZoom:s,minScale:o,maxScale:n,snapToZoom:a})}canZoomInTo(t){const e=this.effectiveMaxScale;return 0===e||t>=e}canZoomOutTo(t){const e=this.effectiveMinScale;return 0===e||t<=e}constrain(t,e){return this._zoom.constrain(t,e),this._rotation.constrain(t,e),this._geometry.constrain(t,e),this.customConstraints.forEach((i=>i.constrain(t,e))),t}constrainByGeometry(t){return this._geometry.constrain(t),this.customConstraints.forEach((e=>e.applyPanConstraint?.(t))),t}fit(t){return this._zoom.fit(t)}zoomToScale(t){return this._zoom.zoomToScale(t)}scaleToZoom(t){return this._zoom.scaleToZoom(t)}snapScale(t){return this._zoom.snapToClosestScale(t)}snapToNextScale(t){return this._zoom.snapToNextScale(t)}snapToPreviousScale(t){return this._zoom.snapToPreviousScale(t)}};t([w({readOnly:!0})],Se.prototype,"effectiveLODs",null),t([w({readOnly:!0})],Se.prototype,"effectiveMinScale",null),t([w({readOnly:!0})],Se.prototype,"effectiveMaxScale",null),t([w({readOnly:!0})],Se.prototype,"effectiveMinZoom",null),t([w({readOnly:!0})],Se.prototype,"effectiveMaxZoom",null),t([w({types:Me,value:null})],Se.prototype,"geometry",null),t([w({type:[vt]})],Se.prototype,"lods",void 0),t([w()],Se.prototype,"minScale",void 0),t([w()],Se.prototype,"maxScale",void 0),t([w()],Se.prototype,"minZoom",void 0),t([w()],Se.prototype,"maxZoom",void 0),t([w()],Se.prototype,"rotationEnabled",void 0),t([w()],Se.prototype,"snapToZoom",void 0),t([w({type:i})],Se.prototype,"customConstraints",void 0),t([w()],Se.prototype,"view",void 0),t([w({readOnly:!0})],Se.prototype,"version",null),t([w({type:we,readOnly:!0})],Se.prototype,"_geometry",null),t([w({type:_e})],Se.prototype,"_rotation",null),t([w({readOnly:!0,type:be})],Se.prototype,"_zoom",null),Se=t([v("esri.views.2d.MapViewConstraints")],Se);const Te=Se;class Ve extends Lt{constructor(t,e){super(!0),this._view=t,this.registerIncoming("double-click",e,(t=>this._handleDoubleClick(t,e)))}_handleDoubleClick(t,e){Y(t.data,"primary")&&(t.stopPropagation(),e?this._view.mapViewNavigation.zoomOut([t.data.x,t.data.y]):this._view.mapViewNavigation.zoomIn([t.data.x,t.data.y]))}}class xe extends Lt{constructor(t,e,i){super(!0),this.view=t,this.pointerType=e,this.registerIncoming("double-tap-drag",i,(t=>this._handleDoubleTapDrag(t)))}_handleDoubleTapDrag(t){const{data:e}=t,{pointerType:i}=e;if(i!==this.pointerType)return;t.stopPropagation();const{action:s,delta:o}=e,{view:n}=this,{mapViewNavigation:a}=n;switch(s){case"begin":{const{scale:t}=n;this._startScale=t,this._currentScale=t,this._previousDelta=o,a.begin();break}case"update":{if(this._previousDelta.y===o.y)return;this._previousDelta=o;const t=1.015**o.y,e=this._startScale*t,i=e/this._currentScale;a.setViewpointImmediate(i),this._currentScale=e;break}case"end":{const{constraints:t}=n,{effectiveLODs:e,snapToZoom:i}=t;if(!i||!e)return void a.end();const s=t.snapScale(this._currentScale),r=(o.y>0?Math.max(s,t.snapToPreviousScale(this._startScale)):Math.min(s,t.snapToNextScale(this._startScale)))/this._currentScale;a.zoom(r).then((()=>{a.end()}));break}}}}class De extends Lt{constructor(t,e,i){super(!0),this.view=t,this.pointerAction=e,this.registerIncoming("drag",i,(t=>this._handleDrag(t))),this.registerIncoming("pointer-down",(()=>this.stopMomentumNavigation()))}onInstall(t){super.onInstall(t),this._dragEventSeparator=new Q({start:(t,e)=>{this.view.mapViewNavigation.pan.begin(this.view,e.data),e.stopPropagation()},update:(t,e)=>{this.view.mapViewNavigation.pan.update(this.view,e.data),e.stopPropagation()},end:(t,e)=>{this.view.mapViewNavigation.pan.end(this.view,e.data),e.stopPropagation()},condition:(t,e)=>1===t&&Y(e.data,this.pointerAction)})}_handleDrag(t){const e=this.view.mapViewNavigation;e.pinch.zoomMomentum||e.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(t)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}}class Le extends Lt{constructor(t,e,i){super(!0),this._view=t,this.pointerAction=e;const s=this._view.mapViewNavigation;this._dragEventSeparator=new Q({start:(t,e)=>{s.rotate.begin(this._view,e.data),e.stopPropagation()},update:(t,e)=>{s.rotate.update(this._view,e.data),e.stopPropagation()},end:(t,e)=>{s.rotate.end(),e.stopPropagation()},condition:(t,e)=>1===t&&Y(e.data,this.pointerAction)}),this.registerIncoming("drag",i,(t=>this._dragEventSeparator.handle(t)))}}class Pe extends Lt{constructor(t){super(!0),this._view=t,this._frameTask=null,this._watchHandles=new It,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",(t=>this._handleGamePadEvent(t))),this._handle.pause()}onInstall(t){super.onInstall(t),this._watchHandles.add([h((()=>this._view.navigation.gamepad?.enabled),(t=>{t?(this._handle.resume(),this._frameTask||(this._frameTask=D({update:t=>this._frameUpdate(t.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))}),m)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(t){const e=this._view.navigation.gamepad.device;e&&t.data.device!==e||this._currentDevice&&this._currentDevice!==t.data.device||("end"===t.data.action?(this._currentDevice=null,X(this._transformation)):(this._currentDevice=t.data.device,J(t.data,this._view.navigation.gamepad,this._transformation)))}_frameUpdate(t){const e=this._transformation;if(tt(e))return;const i=this._view.viewpoint.clone(),s=this._view.navigation.gamepad.velocityFactor,o=Ie*s*t;A(i,i,[e.translation[0]*o,-e.translation[1]*o]);const n=1+e.translation[2]*Oe*t,a=this._view.constraints.rotationEnabled?-e.heading*Ce*t:0,r=this._view.size,l=[r[0]/2,r[1]];G(i,i,n,a,l,r);const p=this._view.constraints.constrain(i,this._view.viewpoint);this._view.viewpoint=p}}const Ce=.06,Ie=.7,Oe=6e-4;class Re extends Lt{constructor(t,e,i){super(!0),this.view=t,this.keys=e,this._isSticky=!1,this._pressedKeys=new Set,this._timeout=void 0,this._currentDirection=void 0,this._stickyKeyDuration=200,this._handleKey=t=>{const e=this._keyMap[t.data.key];if(t.modifiers.has("Meta")||t.modifiers.has("Control"))return void this._stopMovement();if(null==e)return;t.stopPropagation(),t.preventDefault();const i="key-down"===t.type;if(this._pressedKeys[i?"add":"delete"](e),i){if(this._direction===e)return;this._direction=e,this._isSticky=!1,this._setTimeout((()=>{this._isSticky&&this._handlePopKey()}))}else{const t=void 0===this._timeout,e=this._pressedKeys.size>0;t||e?this._handlePopKey():this._isSticky=!0}},this._handlePopKey=()=>{this._direction=Array.from(this._pressedKeys).pop(),null==this._direction&&this._stopMovement()},this._stopMovement=()=>{this._isSticky=!1,this._direction=void 0,this._pressedKeys.clear(),this._setTimeout(void 0)},this._keyMap={[e.left]:"left",[e.right]:"right",[e.up]:"up",[e.down]:"down"},this.registerIncoming("key-down",i,this._handleKey),this.registerIncoming("key-up",i,this._handleKey),this.registerIncoming("blur",i,this._stopMovement),this._visibilityHandle=et((t=>t?null:this._stopMovement()))}onUninstall(){this._stopMovement(),this._visibilityHandle?.remove()}get _direction(){return this._currentDirection}set _direction(t){const e=null!=this._currentDirection;if(null!=t){if(e||this.view.mapViewNavigation.begin(),this._currentDirection!==t)switch(t){case"left":this.view.mapViewNavigation.continuousPanLeft();break;case"right":this.view.mapViewNavigation.continuousPanRight();break;case"up":this.view.mapViewNavigation.continuousPanUp();break;case"down":this.view.mapViewNavigation.continuousPanDown()}}else e&&this.view.mapViewNavigation.stop();this._currentDirection=t}_setTimeout(t){clearTimeout(this._timeout),this._timeout=void 0===t?void 0:setTimeout((()=>{this._timeout=void 0,t()}),this._stickyKeyDuration)}}class ze extends Lt{constructor(t,e,i){super(!0),this.view=t,this.keys=e,this._pressed=!1,this._keyToDirection={[e.clockwiseOption1]:"clockwise",[e.clockwiseOption2]:"clockwise",[e.counterClockwiseOption1]:"counterClockwise",[e.counterClockwiseOption2]:"counterClockwise",[e.resetOption1]:"reset",[e.resetOption2]:"reset"},this.registerIncoming("key-down",i,(t=>this._handleKeyDown(t))),this.registerIncoming("key-up",i,(t=>this._handleKeyUp(t))),this.registerIncoming("blur",i,(()=>this._handleStop())),this._visibilityHandle=et((t=>t?null:this._handleStop()))}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}_handleKeyDown(t){t.data.repeat||this._handleKey(t,!0)}_handleKeyUp(t){this._handleKey(t,!1)}_handleStop(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(t,e){const i=t.modifiers;if(i.size>0&&!i.has("Shift")||!this.view.constraints.rotationEnabled)return;const s=this._keyToDirection[t.data.key];if(this._pressed=null!=s,this._pressed){if(t.preventDefault(),e)switch(this.view.mapViewNavigation.begin(),s){case"clockwise":this.view.mapViewNavigation.continuousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continuousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();t.stopPropagation()}}}var Ue;!function(t){t[t.IN=0]="IN",t[t.OUT=1]="OUT"}(Ue||(Ue={}));class Ee extends Lt{constructor(t,e,i){super(!0),this.view=t,this.keys=e,this._keysToZoomAction={},this.registerIncoming("key-down",i,(t=>this._handleKeyDown(t))),e.zoomIn.forEach((t=>this._keysToZoomAction[t]=Ue.IN)),e.zoomOut.forEach((t=>this._keysToZoomAction[t]=Ue.OUT))}_handleKeyDown(t){this._handleKey(t)}_handleKey(t){const e=t.modifiers;if(e.size>0&&!e.has("Shift"))return;const{key:i}=t.data;if(!(i in this._keysToZoomAction))return;const s=this._keysToZoomAction[i],{mapViewNavigation:o}=this.view;let n=null;switch(s){case Ue.IN:n=o.zoomIn();break;case Ue.OUT:n=o.zoomOut();break;default:return}o.begin(),n.then((()=>o.end())),t.stopPropagation()}}class Ne extends Lt{constructor(t,e){super(!0),this._view=t,this._canZoom=!0,this.registerIncoming("mouse-wheel",e,(t=>this._handleMouseWheel(t)))}_handleMouseWheel(t){if(!this._view.navigation.mouseWheelZoomEnabled)return;if(t.preventDefault(),t.stopPropagation(),!this._canZoom)return;const e=this._view.mapViewNavigation,{x:i,y:s,deltaY:o}=t.data,n=1/.6**(1/60*o),a=e.zoom(n,[i,s]);a&&(this._canZoom=!1,a.catch((()=>{})).then((()=>{this._canZoom=!0,e.end()})))}}class Ze extends Lt{constructor(t){super(!0),this.view=t,this.registerIncoming("drag",(t=>this._handleDrag(t))),this.registerIncoming("pointer-down",(()=>this._stopMomentumNavigation()));const e=this.view.mapViewNavigation;this._dragEventSeparator=new Q({start:(t,i)=>{e.pinch.begin(this.view,i.data),i.stopPropagation()},update:(t,i)=>{e.pinch.update(this.view,i.data),i.stopPropagation()},end:(t,i)=>{e.pinch.end(this.view),i.stopPropagation()},condition:t=>t>=2})}_handleDrag(t){this._dragEventSeparator.handle(t)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}}class Ae extends Lt{constructor(t=it.maximumDoubleClickDelay,e=it.maximumDoubleClickDistance,i=it.maximumDoubleTouchDelay,s=it.maximumDoubleTouchDistance,o=gt){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=e,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=o,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=P(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new Q({start:(t,e)=>this._dragStart(t,e),update:(t,e)=>this._dragUpdate(e),end:(t,e)=>this._dragEnd(e)}),this.registerIncoming("drag",(t=>this._dragEventSeparator.handle(t))),this.registerIncoming("pointer-down",(t=>this._handlePointerDown(t))),this.registerIncoming("pointer-up",(()=>this._handlePointerUp()))}onUninstall(){this._pointerState.forEach((t=>{t.doubleTapTimeout=l(t.doubleTapTimeout)}))}get hasPendingInputs(){for(const t of this._pointerState.values())if(null!=t.doubleTapTimeout)return!0;return!1}_clearPointerDown(t){const e=this._pointerState.get(t);e&&(e.doubleTapTimeout=l(e.doubleTapTimeout),this._pointerState.delete(t),this.refreshHasPendingInputs())}_dragStart(t,e){if(!this._doubleTapDragReady||1!==t)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:i,modifiers:s}=e,{center:o}=i;this._dragStartCenter=o;const n=Ge("begin",P(0,0),i);this._doubleTapDrag.emit(n,void 0,s),e.stopPropagation()}_dragUpdate(t){if(!this._doubleTapDragActive)return;const{data:e,modifiers:i}=t,{center:s}=e,o=Ge("update",P(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),e);this._doubleTapDrag.emit(o,void 0,i),t.stopPropagation()}_dragEnd(t){if(!this._doubleTapDragActive)return;const{data:e,modifiers:i}=t,{center:s}=e,o=Ge("end",P(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),e);this._doubleTapDrag.emit(o,void 0,i),this._doubleTapDragActive=!1,t.stopPropagation()}_handlePointerDown(t){const{data:e}=t,i=ot(e),s=this._pointerState.get(i),{pointerType:o}=e.native;if(s){const n="touch"===o?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(i),st(s.event.data,e)>n?this._storePointerDown(t):this._doubleTapDragReady=!0}else this._storePointerDown(t)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(t){const{data:e}=t,{pointerType:i}=e.native,s=ot(e),o="touch"===i?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,n=this._clock.setTimeout((()=>this._clearPointerDown(s)),o);this._pointerState.set(s,{event:t,doubleTapTimeout:n}),this.refreshHasPendingInputs()}}function Ge(t,e,i){const{button:s,buttons:o,pointer:n,pointers:a,pointerType:r,timestamp:l}=i;return{action:t,delta:e,button:s,buttons:o,pointer:n,pointers:a,pointerType:r,timestamp:l}}const Fe={left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},qe={zoomIn:["=","+"],zoomOut:["-","_"]},He={clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"};let Ke=class extends x{initialize(){const t=()=>this.view?.ready;this.addHandles([u((()=>!t()),(()=>this._disconnect())),u(t,(()=>this._connect()))])}destroy(){this._disconnect()}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}isModifierKeyDown(t){return this._inputManager?.isModifierKeyDown(t)??!1}_disconnect(){this.view.viewEvents.disconnect(),this._inputManager=p(this._inputManager)}_connect(){const t=this.view.surface,e=new nt(t,this.view.input),i=[new at,new rt,new lt,new pt(this.view.navigation),new Ae],s=new Pt({eventSource:e,recognizers:i});s.installHandlers("prevent-context-menu",[new ht],Ct.INTERNAL),s.installHandlers("navigation",[new Ze(this.view),new Pe(this.view),new Ne(this.view),new Ve(this.view),new Ve(this.view,["Control"]),new De(this.view,"primary"),new Re(this.view,Fe),new Ee(this.view,qe),new ze(this.view,He),new Le(this.view,"secondary"),new xe(this.view,"touch")],Ct.INTERNAL),this.view.viewEvents.connect(s),this._source=e,this._inputManager=s,h((()=>this.view?.navigation?.browserTouchPanEnabled),(t=>{this._source&&(this._source.browserTouchPanningEnabled=!t)}),m)}get test(){}};t([w()],Ke.prototype,"view",void 0),t([w()],Ke.prototype,"latestPointerType",null),t([w()],Ke.prototype,"latestPointerLocation",null),t([w()],Ke.prototype,"multiTouchActive",null),Ke=t([v("esri.views.2d.input.MapViewInputManager")],Ke);const $e=Ke,Be={added:[],removed:[]},We=new Set,Ye=new Dt(0,0,0,0);class Qe extends Rt{constructor(t){super(),this._tiles=new Map,this._index=zt(9,n("esri-csp-restrictions")?t=>({minX:t.bounds[0],minY:t.bounds[1],maxX:t.bounds[2],maxY:t.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=t}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(t){return this._tiles.has(t)}get(t){return this._tiles.get(t)}getIntersectingTiles(t){if(!t||0===Ut(t)||0===Et(t))return[];const e=function(t,e){const i=Zt(e);if(!i)return null;const[s,o]=i.valid;return t[2]>o?[Nt([t[0],t[1],o,t[3]]),Nt([s,t[1],s+t[2]-o,t[3]])]:t[0]<s?[Nt([s,t[1],t[2],t[3]]),Nt([o-(s-t[0]),t[1],o,t[3]])]:null}(t,this.tileScheme.spatialReference);return null!=e?[...new Set([...this.boundsIntersections(e[0]),...this.boundsIntersections(e[1])])]:this.boundsIntersections(t)}boundsIntersections(t){return this._index.search({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]})}updateTiles(t){const e={added:[],removed:[]};for(const i of t.added)if(!this.has(i)){const t=new At(this.tileScheme,i);this._tiles.set(i,t),this._index.insert(t),e.added.push(t)}for(const i of t.removed)if(this.has(i)){const t=this.get(i);this._tiles.delete(i),this._index.remove(t),e.removed.push(t)}this.tiles.length=0,this._tiles.forEach((t=>this.tiles.push(t))),(e.added.length||e.removed.length)&&this.emit("update",e)}setViewState(t){const e=this.tileScheme.getTileCoverage(t,0);if(!e)return;const{spans:i,lodInfo:s}=e,{level:o}=s;if(i.length>0)for(const{row:t,colFrom:e,colTo:n}of i)for(let i=e;i<=n;i++){const e=Ye.set(o,t,s.normalizeCol(i),s.getWorldForColumn(i)).id;if(We.add(e),!this.has(e)){const t=new At(this.tileScheme,e);this._tiles.set(e,t),this._index.insert(t),this.tiles.push(t),Be.added.push(t)}}for(let t=this.tiles.length-1;t>=0;t--){const e=this.tiles[t];We.has(e.id)||(this._tiles.delete(e.id),this.tiles.splice(t,1),this._index.remove(e),Be.removed.push(e))}(Be.added.length||Be.removed.length)&&this.emit("update",Be),Vt.pool.release(e),We.clear(),Be.added.length=0,Be.removed.length=0}}function Xe(t,e,i,s,o,n){return a=>{if(a instanceof Wt){if(a.layer===t)n?.();else{const e=t.allLayerViews.find((t=>t.layer===a.layer));e&&o?.(e)}s(ti(a))}else if("layer"in a&&"element"in a);else if("subtype-sublayer"===a.type){const e=t.allLayerViews.find((t=>t.layer===a.parent));e&&i(a,e)}else{const i=t.allLayerViews.find((t=>t.layer===a));i&&e(i)}}}function Je(t,e){if(t)if(Ot(t))for(const i of t)if(Ot(i))for(const t of i)e(t);else e(i);else e(t)}function ti(t){const e=t.getObjectId();return e?`${t.layer?.uid??t.sourceLayer?.uid??"MapView"}/${e}`:`"MapView/${t.uid}`}function ei({layer:t},e){"subtype-group"===t?.type&&t.sublayers.forEach((t=>{e(t)}))}const ii={flipY:!0,premultipliedAlpha:!0};function si(t,e){const i=function(t,e,i,s){t.ignorePadding&&(s={left:0,right:0,top:0,bottom:0});let o=null;null!=t.width&&null!=t.height?o=[t.width,t.height]:null==t.width&&null!=t.height?o=[t.height,t.height]:null!=t.width&&null==t.height?o=[t.width,t.width]:null==t.width&&null==t.height&&(o=null);const n=i[0]-(s.left+s.right),a=i[1]-(s.top+s.bottom);let r,l,p=t.area||{x:0,y:0,width:n,height:a};if(o){const t=n/a,e=o[0]/o[1];if(e>t){const t=p.width/e;p={x:p.x,y:Math.round(p.y+(p.height-t)/2),width:p.width,height:Math.round(t)}}else{const t=p.height*e;p={x:Math.round(p.x+(p.width-t)/2),y:p.y,width:Math.round(t),height:p.height}}}else o=[p.width,p.height];return o[0]>p.width?(r=Math.min(o[0]/p.width,e),l=o[0]/p.width/r):(r=1,l=o[0]/p.width),{cropArea:{x:Math.round((p.x+s.left)*r),y:Math.round((p.y+s.top)*r),width:Math.round(p.width*r),height:Math.round(p.height*r)},outputScale:l,resolutionScale:r}}(e||{},(s=t.stage,o=t.size,Math.min(4,ee(o,Math.min(4096,s.context.parameters.maxTextureSize)))),t.size,t.padding);var s,o;const n=function(t={},e){if(!t.layers)return;const i=[];return t.layers.forEach((t=>{const s=e.find((e=>e.layer.id===t.id));s?.container&&i.push(s.container)})),i}(e,t.allLayerViews);return t.stage.takeScreenshot(i,n,t.backgroundColor,e?.rotation)}let oi=class extends x{constructor(){super(...arguments),this._timer=void 0}get stationary(){return!this._timer}flip(){this._timestamp=performance.now(),null==this._timer&&(this._timer=setInterval((()=>{performance.now()-this._timestamp>=160&&this.clear()}),160))}clear(){this._timer&&(clearInterval(this._timer),this._timer=void 0)}};t([w()],oi.prototype,"_timer",void 0),t([w()],oi.prototype,"stationary",null),oi=t([v("esri.views.2d.support.StationaryManager")],oi);let ni=class extends se{constructor(t){super(t),this.components=["attribution","zoom"]}};t([w()],ni.prototype,"components",void 0),ni=t([v("esri.views.ui.2d.DefaultUI2D")],ni);const ai=ni;let ri,li,pi,hi,ci,mi,ui,di=class extends(M(T(S(V)))){constructor(t){super(t),this._magnifierView=null,this._gridView=null,this.stage=null,this._resolveWhenReady=[],this.rootLayerViews=new s({getCollections:()=>[this.basemapView?.baseLayerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.fullOpacity=1,this.goToManager=new ce({view:this}),this.graphicsView=null,this.stateManager=new R({constraints:new Te({view:this})}),this.stationaryManager=new oi,this.labelManager=null,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.supersampleScreenshotsEnabled=!0,this.supportsGround=!1,this.frameTask=new he(this),this.floors=new i,this.grid=null,this.highlights=Ht(),this.inputManager=new $e({view:this}),this.map=null,this.spatialReferenceLocked=!1,this.timeline=new ie,this.type="2d",this.view2dType=null,this.ui=new ai,this.test={takeScreenshot:async t=>async function(t,e){const i=await si(t,e);return te(i,ii)}(this._getScreenshotView(t),t)},this.padding={top:0,right:0,bottom:0,left:0},this.addHandles([h((()=>this.viewpoint),(()=>this.stationaryManager.flip()),d),this.on("resize",(t=>this.stateManager.resize(t.width,t.height)))]),y()}destroy(){this.layerViewManager.clear(),this._set("preconditionsReady",!1),this.frameTask=p(this.frameTask),this.goToManager.destroy(),this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new Qe(this.featuresTilingScheme)}get constraintsInfo(){const t=this.defaultsFromMap?.tileInfo,e=this.spatialReference;return{lods:t?.spatialReference?.equals(e)?t.lods:null,spatialReference:e}}get state(){return this.stateManager.state}get initialExtentRequired(){if(!this.stateManager)return!1;const{scale:t,constraints:e,center:i,viewpoint:s,extent:o}=this;let n=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.viewpoint||o||(e?.effectiveLODs||(n=-1),i&&(0!==t||-1!==n)||null!=s?.targetGeometry&&("extent"===s.targetGeometry.type||s.scale)))}get defaultsFromMapSettings(){return{required:{extent:!1,heightModelInfo:!1,tileInfo:!0},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get scheduler(){return this.frameTask.scheduler}get typeSpecificPreconditionsReady(){const t=this._getDefaultViewpoint();if(!t)return!1;const e=t.targetGeometry,i=this.spatialReference;return k(e.spatialReference,i)}set animation(t){const e=this._get("animation");if(t===e)return;if(e&&e.stop(),t!==this.animationManager.animation&&this.animationManager.stop(),!t||t.isFulfilled())return void this._set("animation",null);this._set("animation",t);const i=()=>{this.destroyed||t===this._get("animation")&&(this._set("animation",null),this.frameTask?.requestFrame())};t.when(i,i)}get background(){return oe(this.map)?this.map.initialViewProperties.background:null}set background(t){this._override("background",t)}get center(){return this.stateManager?.center??null}set center(t){this.stateManager.center=t}get constraints(){return this.stateManager?.constraints}set constraints(t){t.view=this;const e=this.stateManager.constraints;this.stateManager.constraints=t,e?.destroy()}get extent(){return this.stateManager?.extent??null}set extent(t){this.stateManager.extent=t}get highlightOptions(){return Kt(this)}set highlightOptions(t){$t(this,t)}get padding(){return this.stateManager?.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}get rendering(){return this.stage?.renderRequested??!1}get resizeAlign(){return this.stateManager.resizeAlign}set resizeAlign(t){this.stateManager.resizeAlign=t}get resolution(){return this.stateManager.resolution??0}get rotation(){return this.stateManager.rotation??0}set rotation(t){const{rotationEnabled:e}=this.constraints;this.constraints.rotationEnabled=!0,this.stateManager.rotation=t,this.constraints.rotationEnabled=e}get scale(){return this.stateManager?.scale??0}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get stationary(){return!this.animation&&!this.navigating&&!this.resizing&&this.stationaryManager.stationary}get tileInfo(){return this.featuresTilingScheme?.tileInfo}get updating(){const t=!(!this.magnifier.visible||null===this.magnifier.position||!this._magnifierView?.updatingHandles.updating),e=!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||!0===this.layerViewManager.updating||!0===this.labelManager.updating||!0===this.graphicsView.updating||this.allLayerViews.some((t=>!t.destroyed&&!("layerViews"in t)&&!0===t.updating))||t);if(n("esri-2d-log-updating")){const i=this.allLayerViews.reduce(((t,e)=>({...t,[`${e.layer.id}(${e.layer.type})`]:!e.destroyed&&!("layerViews"in e)&&e.updating})),{});console.log(`Updating MapView: ${e}\n-> Null LayerViewManager: ${!this.layerViewManager}\n-> Null LabelManager: ${!this.labelManager}\n-> Null GraphicsView: ${!this.graphicsView}\n-> layerViewManager.updating: ${this.layerViewManager?.updating}\n-> labelManager.updating: ${this.labelManager?.updating}\n-> graphicsView.updating: ${this.graphicsView?.updating}\n-> allLayerViews: ${JSON.stringify(i)}\n-> updatingMagnifier: ${t}\n`)}return e}get viewpoint(){return this.stateManager.viewpoint??null}set viewpoint(t){this.stateManager.viewpoint=t,this.frameTask.requestFrame()}get visibleArea(){const t=this.stateManager.visibleArea;return t?new Tt({rings:[t.map((t=>[t[0],t[1]]))],spatialReference:this.spatialReference}):t}get zoom(){return this.stateManager.zoom??-1}set zoom(t){this.stateManager.zoom=t}get navigating(){return this.mapViewNavigation?.interacting??!1}goTo(t,e){return this.goToManager.goTo(t,e)}async hitTest(t,e){return async function(t,e,i){const s=Yt(e)?Qt(t,e):e;if(!t.ready||isNaN(s.x)||isNaN(s.y))return{screenPoint:s,results:[]};let o=new Set;const n=new Set;let r=!1,l=null,p=null;i?.include?Je(i.include,Xe(t,(t=>{o.add(t),ei(t,(t=>n.add(t)))}),((t,e)=>{n.add(t),o.add(e)}),(t=>{l||(l=new Set),l.add(t)}),(t=>o.add(t)),(()=>r=!0))):(r=!0,o=new Set(t.allLayerViews),o.forEach((t=>{ei(t,(t=>n.add(t)))}))),i?.exclude&&Je(i.exclude,Xe(t,(t=>{o.delete(t),ei(t,(t=>n.delete(t)))}),(t=>n.delete(t)),(t=>{p||(p=new Set),p.add(t)})));const h=t.toMap(s),c=t.allLayerViews.filter((e=>!e.suspended&&o.has(e)&&e.clips.every((e=>qt(t,e,s,h))))).reverse();let m=[...r?t.graphicsView.hitTest(h).map((t=>({type:"graphic",graphic:t,layer:null,mapPoint:h}))):[],...await Promise.all(c.map((t=>t.hitTest(h,s))).toArray())].filter(a).flat().filter(a);return m=m.filter((t=>"graphic"!==t.type||"subtype-group"!==t.layer?.type||n.has(t.graphic.layer))),l&&(m=m.filter((t=>!("graphic"in t)||!t.graphic||l?.has(ti(t.graphic))))),p&&(m=m.filter((t=>!("graphic"in t)||!t.graphic||!p?.has(ti(t.graphic))))),{screenPoint:s,results:m}}(this,t,e)}async takeScreenshot(t){return async function(t,e){const i=await si(t,e),{format:s,quality:o}=Xt(e?.format,e?.quality);return Jt(i,{format:s,quality:o},ii)}(this._getScreenshotView(t),t)}toMap(t){if(!this.ready)return null;const e=Yt(t)?Qt(this,t):t;return this.stateManager.toMap(e)}toScreen(t,e){return this.stateManager.toScreen(t,e)}on(t,e,i,s){return this.inputManager&&this.viewEvents.on(t,e,i,s)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}whenLayerView(t){return super.whenLayerView(t)}graphicChanged(t){this.graphicsView&&this.graphicsView.graphicUpdateHandler(t)}whenReady(){return new Promise((t=>{this.ready?t(this):this._resolveWhenReady.push(t)}))}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties.spatialReference||this.defaultsFromMap?.spatialReference||null}getDefaultTimeZone(){return oe(this.map)?this.map.initialViewProperties.timeZone:null}getDefaultTimeExtent(){return oe(this.map)?this.map.initialViewProperties.timeExtent:null}hasLayerViewModule(t){return(t=>null!=ge[t.type])(t)}importLayerView(t){return(t=>{const e=ge[t.type];if(null==e)throw function(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new o(`${i}:view-not-supported`,`${e} is not supported in 2D`)}(t);return e(t)})(t)}pixelSizeAt(){return this.ready?this.resolution:(r.getLogger(this).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}async popupHitTest(t){const e=this.toMap(t),i=await this.hitTest(t),s=this.allLayerViews.toArray().filter((i=>i.clips.every((i=>qt(this,i,t,e))))).reverse(),o=new globalThis.Map(s.map((t=>[t.layer.uid,t]))),n=[];let a=0,r=0;for(;a<i.results.length||r<s.length;){const t=i.results.at(a);if(t&&"graphic"!==t.type){++a;continue}const l=o.get((t?.layer??t?.graphic.layer)?.uid);if((!t||l)&&r<s.length&&s.at(r)!==l){const t=s.at(r);"fetchPopupFeaturesAtLocation"in t&&n.push({mapPoint:e,layerView:t}),++r}else t&&(n.push({graphic:t.graphic,layerView:l}),++a)}return{hits:n,location:e}}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}async validate(){let t=ct(this.type);if(n("safari")&&n("safari")<9&&(t=new o("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:n("safari")})),null!=t)throw r.getLogger(this).warn("#validate()",t.message),t}loadAsyncDependencies(){return async function(){const[,{GraphicsView2D:t,GraphicContainer:e,LabelManager:i,MapViewNavigation:s,MagnifierView2D:o,GridView2D:n,Stage:a}]=await Promise.all([import("../chunks/webglDeps.js"),import("../chunks/mapViewDeps.js")]);li=t,pi=e,hi=i,ci=s,mi=o,ui=n,ri=a}()}_getDefaultViewpoint(){const{constraints:t,initialExtent:i,map:s,padding:o,size:n}=this;if(!t)return null;const a=s&&"initialViewProperties"in s?s.initialViewProperties:void 0,r=this.stateManager.getUserStartupOptions(this.size),l=a?.viewpoint,p=l?.targetGeometry?.extent??i,h=p?.center,c=l?.rotation??0,m=l?.scale||p&&F(p,[n[0]-o.left-o.right,n[1]-o.top-o.bottom]),u=r.center??h,d=r.rotation??c,g=r.scale??m;return u&&g?new e({targetGeometry:u,scale:g,rotation:d}):null}_startup(){this.timeline.begin("MapView Startup");const t=this._getDefaultViewpoint();this.stateManager.startup(t,this.size,this.spatialReference,this.defaultsFromMap.extent?.center),this.graphics.owner=this;const e=new ri(this.surface,{canvas:this.renderCanvas,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline});this.stage=e,this._magnifierView=new mi,this._magnifierView.magnifier=this.magnifier,this._gridView=new ui;const i=new hi({view:this});this._set("labelManager",i);const s=new pe({view:this});this._set("animationManager",s);const o=new ci({view:this,animationManager:s});this._set("mapViewNavigation",o),this._setupSpatialReferenceDependentProperties(),this.addHandles([this.rootLayerViews.on("change",(()=>this._updateStageChildren())),e.on("webgl-error",(t=>this.fatalError=t.error)),h((()=>this.stationary),(t=>e.stationary=t),g),h((()=>this.background),(t=>{e.backgroundColor=t?.color,this._magnifierView.backgroundColor=t?.color}),g),h((()=>this.magnifier),(t=>this._magnifierView.magnifier=t),g),h((()=>this.grid),(t=>this._gridView.grid=t),g),h((()=>this.renderingOptions),(t=>e.renderingOptions=t),g),h((()=>this.highlights.items.map((t=>({name:t.name,options:{fillColor:t.options.color,haloColor:t.options.haloColor,fillOpacity:t.options.fillOpacity,haloOpacity:t.options.haloOpacity,haloWidth:t.options.haloWidth,haloBlur:t.options.haloBlur}})))),(()=>{e.highlightGradient=Gt(e.highlightGradient,this.highlights.items)}),g),h((()=>this.state.id),(()=>e.state=this.state),g)],"map-view"),this._updateStageChildren();const n=this._resolveWhenReady;this._resolveWhenReady=[],n.forEach((t=>t(this))),this.timeline.end("MapView Startup"),this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.removeHandles("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animation=null,this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._gridView.destroy(),this.stage.destroy(),this.stage=null,this._set("graphicsView",null),this._magnifierView=null,this._gridView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask.stop(),this.stationaryManager.clear(),this._set("ready",!1),this.stateManager.teardown()}_updateStageChildren(){this.stage.removeAllChildren(),this.rootLayerViews.forEach((t=>{this.stage.addChild(t.container)}));const t=this.graphicsView;this.stage.addChild(t.container),this.stage.addChild(this._magnifierView),this.stage.addChild(this._gridView)}_setupSpatialReferenceDependentProperties(){const t=new xt(b.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",t);const e=new li({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new pi(t)});this._set("graphicsView",e)}_destroySpatialReferenceDependentProperties(){const t=this.graphicsView;this._set("graphicsView",null),t.destroy(),this._set("featuresTilingScheme",null)}_getScreenshotView(t){const{allLayerViews:e,padding:i,size:s,stage:o}=this;return{allLayerViews:e,backgroundColor:t?.ignoreBackground?null:this.background?.color,padding:i,size:s,stage:o}}_spatialReferenceChanged(t){if(this.ready){this.frameTask.stop();for(const t of this.allLayerViews)t.processDetach();this._destroySpatialReferenceDependentProperties(),this.stateManager.changeSpatialReference(t),this.stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(const t of this.allLayerViews)t.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}}};di.type="2d",t([w({readOnly:!0})],di.prototype,"animationManager",void 0),t([w({constructOnly:!0})],di.prototype,"deactivatedWebGLExtensions",void 0),t([w({constructOnly:!0})],di.prototype,"debugWebGLExtensions",void 0),t([w({readOnly:!0})],di.prototype,"featuresTilingScheme",void 0),t([w({readOnly:!0})],di.prototype,"fullOpacity",void 0),t([w()],di.prototype,"goToManager",void 0),t([w({readOnly:!0})],di.prototype,"graphicsTileStore",null),t([w()],di.prototype,"graphicsView",void 0),t([w()],di.prototype,"stateManager",void 0),t([w()],di.prototype,"constraintsInfo",null),t([w({readOnly:!0})],di.prototype,"state",null),t([w()],di.prototype,"initialExtentRequired",null),t([w()],di.prototype,"labelManager",void 0),t([w({readOnly:!0})],di.prototype,"mapViewNavigation",void 0),t([w({constructOnly:!0})],di.prototype,"renderCanvas",void 0),t([w()],di.prototype,"renderingOptions",void 0),t([w({constructOnly:!0})],di.prototype,"supersampleScreenshotsEnabled",void 0),t([w({readOnly:!0})],di.prototype,"supportsGround",void 0),t([w()],di.prototype,"defaultsFromMapSettings",null),t([w({readOnly:!0})],di.prototype,"typeSpecificPreconditionsReady",null),t([w()],di.prototype,"animation",null),t([w({type:ne})],di.prototype,"background",null),t([w()],di.prototype,"center",null),t([w({type:Te})],di.prototype,"constraints",null),t([w()],di.prototype,"extent",null),t([w()],di.prototype,"floors",void 0),t([w()],di.prototype,"grid",void 0),t([w({type:Ft})],di.prototype,"highlightOptions",null),t([w({type:i.ofType(Bt)})],di.prototype,"highlights",void 0),t([w({readOnly:!0})],di.prototype,"inputManager",void 0),t([w()],di.prototype,"map",void 0),t([w()],di.prototype,"padding",null),t([w({readOnly:!0})],di.prototype,"rendering",null),t([w()],di.prototype,"resizeAlign",null),t([w({readOnly:!0})],di.prototype,"resolution",null),t([w()],di.prototype,"rotation",null),t([w()],di.prototype,"scale",null),t([w({constructOnly:!0})],di.prototype,"spatialReferenceLocked",void 0),t([w()],di.prototype,"stationary",null),t([w({readOnly:!0})],di.prototype,"tileInfo",null),t([w({type:ie,readOnly:!0})],di.prototype,"timeline",void 0),t([w({readOnly:!0})],di.prototype,"type",void 0),t([w({readOnly:!0})],di.prototype,"updating",null),t([w({readOnly:!0})],di.prototype,"view2dType",void 0),t([w()],di.prototype,"viewpoint",null),t([w({readOnly:!0})],di.prototype,"visibleArea",null),t([w()],di.prototype,"zoom",null),t([w({readOnly:!0})],di.prototype,"navigating",null),t([w(),f((t=>t instanceof se?t:_(ai,t)))],di.prototype,"ui",void 0),di=t([v("esri.views.View2D")],di);const gi=di;export{gi as default};
