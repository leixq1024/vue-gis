/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import e from"../../core/Evented.js";import{o as n,throwIfNotAbortError as i,throwIfAborted as o,after as s}from"../../core/promiseUtils.js";import{d as r}from"../../chunks/maybe.js";import{watch as l,when as a,syncAndInitial as c,initial as u,sync as d}from"../../core/reactiveUtils.js";import{i as p,c as h}from"../../chunks/screenUtils.js";import{property as m}from"../../core/accessorSupport/decorators/property.js";import"../../core/lang.js";import"../../chunks/Logger.js";import{subclass as f}from"../../core/accessorSupport/decorators/subclass.js";import{s as v}from"../../chunks/themeUtils.js";import"../../core/Error.js";import g from"../../widgets/Widget.js";import{c as _,a as y}from"../../chunks/widgetUtils.js";import{t as k,a as b}from"../../chunks/jsxFactory.js";import{p as w}from"../../chunks/a11yUtils.js";import{m as j}from"../../chunks/memoize.js";import{waitAnimationFrame as x,waitTick as C}from"../../core/scheduling.js";import{u as T}from"../../chunks/unitFormatUtils.js";import{aq as I,ar as E,as as M}from"../../chunks/unitUtils.js";import{g as D}from"../../chunks/getDefaultUnitForView.js";import{t as $}from"../../chunks/keybindings.js";import{C as P}from"../../chunks/Cyclical.js";import{g as S,h as O,i as U,j as A,k as L,f as V}from"../../chunks/quantityFormatUtils.js";import{e as R,c as F,t as z}from"../../chunks/quantityUtils.js";import{isLoaded as H,fromLatitudeLongitude as X,fromLongitude as Y,fromLatitude as B}from"../../geometry/coordinateFormatter.js";import{p as K,f as N}from"../../chunks/number.js";import{a as q}from"../../chunks/angularMeasurementUtils.js";import{l as G}from"../../chunks/componentsUtils.js";import{m as Q}from"../../chunks/messageBundle.js";import{d as W}from"../../chunks/directionModeIcons.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/metadata.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/ObservableBase.js";import"../../chunks/tracking.js";import"../../config.js";import"../../chunks/ensureType.js";import"../../chunks/asyncUtils.js";import"../../core/Collection.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../intl.js";import"../../chunks/date.js";import"../../chunks/jsonMap.js";import"../../chunks/locale.js";import"../../chunks/datetime.js";import"../../chunks/substitute.js";import"../../chunks/messages.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../core/JSONSupport.js";import"../../chunks/assets.js";import"../../chunks/domUtils.js";import"../../core/Promise.js";import"../../chunks/uuid.js";import"../../core/accessorSupport/decorators/cast.js";import"../../chunks/projector.js";import"../../chunks/jsxWidgetSupport.js";import"../../chunks/ByteSizeUnit.js";import"../../chunks/mathUtils.js";import"../../portal/Portal.js";import"../../core/Loadable.js";import"../../chunks/reader.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../geometry/SpatialReference.js";import"../../chunks/writer.js";import"../../geometry/Point.js";import"../../geometry/support/webMercatorUtils.js";import"../../portal/PortalGroup.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../../chunks/InputManager.js";import"../../chunks/Queue.js";import"../../core/signal.js";import"../../chunks/vec2.js";import"../../chunks/common.js";import"../../chunks/vec2f64.js";import"../../chunks/vec3.js";import"../../chunks/vec3f64.js";import"../../chunks/projectVectorToVector.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/coordsUtils.js";import"../../chunks/Axis.js";import"../../chunks/extentUtils.js";import"../../chunks/boundsUtils.js";import"../../chunks/aaBoundingRect.js";import"../../geometry/Polyline.js";import"../../chunks/projectBuffer.js";import"../../chunks/geodesicConstants.js";import"../../chunks/projectPointToVector.js";import"../../geometry/projection.js";import"../../geometry/support/GeographicTransformation.js";import"../../geometry/support/GeographicTransformationStep.js";import"../../chunks/zscale.js";import"../../chunks/dehydratedPoint.js";import"../../geometry/support/geodesicUtils.js";import"../../geometry.js";import"../../chunks/typeUtils.js";import"../../geometry/support/jsonUtils.js";const Z="esri-tooltip",J=`${Z}-content`,tt=`${Z}-content--input`,et=`${Z}-content__header`,nt=`${Z}-content__header__spacer`,it=`${Z}-content__header__actions`,ot=`${Z}-draw-header-actions`,st=`${Z}-table`,rt=`${Z}-help-message`,lt=`${Z}-help-message__text`,at=`${Z}-help-message__icon`,ct=`${Z}-field`,ut={base:ct,inputMode:`${ct}--input`,title:`${ct}__title`,value:`${ct}__value`};let dt=class extends g{constructor(){super(...arguments),this.hidden=!1,this.mode="feedback"}render(){return k("div",{class:this.classes({[ut.base]:!0,[ut.inputMode]:"input"===this.mode})},k("div",{class:ut.title,key:"title"},this.title),k("div",{class:ut.value,key:"value"},this.value))}};t([m()],dt.prototype,"hidden",void 0),t([m()],dt.prototype,"mode",void 0),t([m()],dt.prototype,"title",void 0),t([m()],dt.prototype,"value",void 0),dt=t([f("esri.views.interactive.tooltip.components.TooltipField")],dt);const pt={base:`${Z}-value-by-value`};let ht=class extends g{constructor(){super(...arguments),this.divider="×"}render(){return k("div",{class:pt.base},k("span",null,this.left),k("span",null,this.divider),k("span",null,this.right))}};function mt(t,e){return{angleRelative:ft,direction:vt,directionRelative:gt,directionRelativeBilateral:_t,latitudeDecimalDegrees:kt,longitudeDecimalDegrees:yt,area:(n,i)=>S(t,n,i??e.area),length:(n,i,o)=>O(t,n,i??e.length,o),lengthRelative:(n,i)=>U(t,n,i??e.length),totalLength:(n,i)=>O(t,n,i??e.length),verticalLength:(n,i)=>A(t,n,i??e.verticalLength),verticalLengthRelative:(n,i)=>L(t,n,i??e.verticalLength),percentage:Ct,scalar:It,scale:Tt}}function ft(t){return N(t,{signDisplay:"exceptZero",...Et(1)})}function vt(t){return V(t,t.rotationType,1)}function gt(t){const e=q(t);return N(e,{style:"unit",unitDisplay:"narrow",unit:"degree",signDisplay:e>0?"never":"exceptZero",...Et(1)})}function _t(t){return V(t,t.rotationType,1)}function yt(t){return jt(t,Rt)}function kt(t){return jt(t,Ft)}function bt(t){return xt(t,Rt)}function wt(t){return xt(t,Ft)}function jt(t,e){return V(z(t,"degrees"),"geographic",6,e,!1)}function xt(t,e){const n=e.normalize(z(t,"degrees").value,void 0,!1);return It(R(n),6)}function Ct(t){return N(t.value,{style:"percent"})}function Tt(t){return N(t,{style:"percent",maximumFractionDigits:0})}function It(t,e){return N(t.value,Et(e))}function Et(t){return{minimumFractionDigits:t,maximumFractionDigits:t}}function Mt({createQuantity:t,sanitize:e}){return(n,i)=>{if(null==n)return null;e&&(n=e(n));const o=K(n);return null==o?null:t(o,i)}}function Dt(t){return t.replaceAll(/[*^~°º]/g,"")}t([m()],ht.prototype,"left",void 0),t([m()],ht.prototype,"divider",void 0),t([m()],ht.prototype,"right",void 0),ht=t([f("esri.views.interactive.tooltip.components.ValueByValue")],ht);const $t=t=>{let e=`[-+]?[0-9${t.thousands}]+`;return""!==t.decimal&&(e+=`${t.decimal}[0-9]+`),new RegExp(`^(${e}\\s*)${t.separator}(\\s*${e})$`,"i")},Pt=[];for(const t of[",","\\|","\\s+"])for(const e of["\\.",",",""])for(const n of["",",","\\."," ","\\s+"])t!==e&&t!==n&&e!==n&&Pt.push({separator:t,decimal:e,thousands:n,pattern:$t({decimal:e,thousands:n,separator:t})});function St(t){for(const{decimal:e,thousands:n,pattern:i}of Pt){i.lastIndex=0;const o=t.match(i);if(!o)continue;const s=K(Ot(o[1],e,n)),r=K(Ot(o[2],e,n));if(null!=s&&null!=r)return{x:R(s),y:R(r)}}return null}function Ot(t,e,n){let i=t.replaceAll(/[\s+]/g,"");return""!==n&&(i=i.replaceAll(n,"")),""!==e&&(i=i.replaceAll(e,".")),i}function Ut(t){if(!t||null!=K(t)||!H())return null;const e=X(t),n=Vt(e?.latitude),i=Vt(e?.longitude);return null!=i&&null!=n?{latitude:n,longitude:i}:null}function At(t){return Vt(Y(t))}function Lt(t){return Vt(B(t))}function Vt(t){return null!=t?F(t,"degrees","geographic"):null}const Rt=new P(-180,180),Ft=new P(-90,90),zt=Symbol("dragHandles");let Ht=class extends g{constructor(){super(...arguments),this._focusAbortController=new AbortController,this._transitionInfo=null,this._mode="feedback",this._getFormatters=j(mt),this._onHeaderPointerDown=t=>{const e=t.target;e instanceof HTMLElement&&"calcite-button"!==e?.tagName?.toLowerCase()&&(this.removeHandles(zt),e.setPointerCapture(t.pointerId),this.tooltip.onDragStart(t.clientX,t.clientY),this.addHandles([n(e,"pointermove",(({clientX:t,clientY:e})=>{this.tooltip.onDrag(t,e)})),n(e,["pointerup","pointercancel"],(n=>{this.removeHandles(zt),e.releasePointerCapture(t.pointerId),this.tooltip.onDragEnd()})),n(e,"touchstart",(t=>t.preventDefault()))],zt))},this._onDiscard=()=>{this.destroyed||(this.tooltip.emit("discard"),this.info.clearInputValues(),this.exitInputMode())},this._onCommit=(t,e)=>{if(this.destroyed)return;if(this.tooltip.emit("commit",{type:e}),"commit-and-exit"===e)return void this.exitInputMode();if("commit-on-blur"===e)return;const n=this._getFocusableElements(),i=n.length,o=n.indexOf(t);if(-1===o)return void this.exitInputMode();const s=((o+("commit-and-next"===e?1:-1))%i+i)%i;Xt(n.at(s))},this._onKeyDown=t=>{switch(t.code){case $.next:return this._onNextKey(t);case $.discard:return t.stopPropagation(),this._onDiscard()}}}get mode(){return this._mode}get _displayUnits(){const{displayUnits:t}=this.info.sketchOptions.values,e=D(this.tooltip.view);return{length:t.length??e,verticalLength:t.verticalLength??e,area:t.area??e}}get _inputUnitInfos(){const t=this._messagesUnits,e=e=>({unit:e,abbreviation:T(t,e,"abbr")}),{inputUnits:n}=this.info.sketchOptions.values,i=D(this.tooltip.view),o=n.length??i,s=n.verticalLength??i,r=n.area??i;return{length:e(I(o)),verticalLength:e(E(s)),area:e(M(r)),angle:e("degrees")}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const{visibleElements:t}=this.info.sketchOptions.tooltips,e=this._renderedContent,n=this._renderedActions,i=this._renderedHelpMessage,o=e.length>0,s=o||!!i,r="input"===this.mode;return k("div",{class:_(J,r&&tt),onkeydown:this._onKeyDown,tabIndex:-1},r&&s&&t.header?k("div",{class:et,"data-testid":"tooltip-header",key:"header",onpointerdown:this._onHeaderPointerDown},k("calcite-button",{appearance:"transparent","data-testid":"tooltip-back-button",iconFlipRtl:"both",iconStart:"chevron-left",key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),n.length>0?k(b,null,k("div",{class:nt,key:"spacer"}),k("div",{class:it,key:"actions"},n)):null):null,o?k("div",{class:st,key:"content"},...e):null,i)}destroy(){this._focusAbortController.abort(),this._transitionInfo?.transition.skipTransition()}_renderActions(){return null}loadDependencies(){return G({button:()=>import("../../chunks/calcite-button.js"),icon:()=>import("../../chunks/calcite-icon.js"),input:()=>import("../../chunks/calcite-input.js")})}async enterInputMode(t,e){try{await this._transitionTo("input",e),await this._focusField(t)}catch(t){i(t)}}async exitInputMode({focusOnView:t=!0}={}){try{const{container:e,info:n}=this;n.clearInputValues();const i=t?e?.closest(".esri-view")?.querySelector(".esri-view-surface"):null;await this._transitionTo("feedback"),i instanceof HTMLElement&&i.focus()}catch(t){i(t)}}_onNextKey(t){const e=this._getFocusableElements(),n=e.at(0),i=e.at(-1);n&&i&&(t.shiftKey?document.activeElement===n&&(t.preventDefault(),t.stopPropagation(),Xt(i)):document.activeElement===i&&(t.preventDefault(),t.stopPropagation(),Xt(n)))}get _renderedContent(){return Yt(this._renderContent())}get _renderedActions(){return Yt(this._renderActions())}get _renderedHelpMessage(){const{sketchOptions:t,visibleElements:e}=this.info;if(!e.helpMessage)return null;const n=t.tooltips.helpMessage??this._defaultHelpMessage;if(!n)return null;const i=t.tooltips.helpMessageIcon??"information";return k("div",{class:rt,key:"help-message"},i?k("calcite-icon",{class:at,icon:i,scale:"s"}):null,k("div",{class:lt},n))}get _defaultHelpMessage(){const{helpMessage:t,viewType:e}=this.info;if(null==t)return null;const n="3d"===e?"helpMessages3d":"helpMessages2d";return this._messagesTooltip?.sketch?.[n]?.[t]}async _focusField(t){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;const{signal:e}=this._focusAbortController;await this._waitForInputs(),o(e);const n=this._getFocusableInputs(),i=t?n.find((e=>e.getAttribute("data-field-name")===t)):n.at(0);await Xt(i)}async _transitionTo(t,e){if(this._mode===t&&!this._transitionInfo)return;if(this._transitionInfo?.mode===t)return this._transitionInfo.transition.finished;this._transitionInfo?.transition.skipTransition();const n=async()=>{this.destroyed||(this._mode=t,await C(),this.destroyed||(this.renderNow(),await C(),this.destroyed||e?.()))};if(!this.domNode?.firstChild||!document.startViewTransition||w())return void await n();this.autoRenderingEnabled=!1;const i=this._transitionInfo={transition:document.startViewTransition((async()=>{this.destroyed||i!==this._transitionInfo||(this.autoRenderingEnabled=!0,await n())})),mode:t};try{await i.transition.finished}finally{i===this._transitionInfo&&(this._transitionInfo=null)}}async _waitForInputs(){const t=()=>Array.from(this.domNode?.querySelectorAll("calcite-input")??[]);for(;0===t().length;)await s(Bt);await x()}_getFocusableInputs(){return Array.from(this.domNode?.querySelectorAll("calcite-input:not([read-only]):not([disabled])")??[])}_getFocusableElements(){const t=this.domNode?.querySelector(`.${ot}`);return[...Array.from(t?.querySelectorAll(`.${it} calcite-button:not([disabled])`)??[]),...this._getFocusableInputs()]}};async function Xt(t){await(t?.setFocus())}function Yt(t){return(Array.isArray(t)?t:[t]).flat(10).filter((t=>!!t))}t([Q("esri/core/t9n/Units"),m()],Ht.prototype,"_messagesUnits",void 0),t([Q("esri/views/interactive/tooltip/t9n/Tooltip"),m()],Ht.prototype,"_messagesTooltip",void 0),t([m()],Ht.prototype,"info",void 0),t([m()],Ht.prototype,"tooltip",void 0),t([m()],Ht.prototype,"_mode",void 0),t([m()],Ht.prototype,"mode",null),t([m()],Ht.prototype,"_displayUnits",null),t([m()],Ht.prototype,"_inputUnitInfos",null),t([m()],Ht.prototype,"_formatters",null),t([m()],Ht.prototype,"fieldContext",null),t([m()],Ht.prototype,"_renderedContent",null),t([m()],Ht.prototype,"_renderedActions",null),t([m()],Ht.prototype,"_renderedHelpMessage",null),t([m()],Ht.prototype,"_defaultHelpMessage",null),Ht=t([f("esri.views.interactive.tooltip.content.TooltipContent")],Ht);const Bt=20;let Kt=class extends Ht{_renderContent(){const{area:t,radius:e,xSize:n,ySize:i,visibleElements:o}=this.info,s=this._messagesTooltip.sketch,r=this._formatters;return k(b,null,o.radius&&null!=e?k(dt,{title:s.radius,value:r.length(e)}):null,o.size&&null!=n&&null!=i?k(dt,{title:s.size,value:k(ht,{left:r.length(n),right:r.length(i)})}):null,o.area?k(dt,{title:s.area,value:r.area(t)}):null)}};Kt=t([f("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],Kt);const Nt=`${Z}-editable-field`,qt={base:Nt,inputMode:`${Nt}--input`,feedbackMode:`${Nt}--feedback`,readOnly:`${Nt}--read-only`,locked:`${Nt}--locked`,title:`${Nt}__title`,value:`${Nt}__value`,valueContent:`${Nt}__value__content`,valueContentReadOnly:`${Nt}__value__content--read-only`,lockIcon:`${Nt}__lock-icon`,input:`${Nt}__input`,inputSuffix:`${Nt}__input-suffix`,button:`${Nt}__button`},Gt="lock";let Qt=class extends g{constructor(){super(...arguments),this._input=null,this._lock=null,this._onLockClick=()=>{this.field.toggleLock(this.context)},this._onLockAfterCreate=t=>{this._lock=t},this._onLockAfterRemoved=()=>{this._lock=null},this._onKeyDown=t=>{t.key===$.discard&&"input"===this.mode&&this._input&&this.context.onDiscard(this._input)},this._onInputKeyDown=t=>{const e=this._input;if(e)switch(t.key){case $.commit:return this.field.onCommit("commit-and-exit",e,this.context);case $.next:{t.preventDefault(),t.stopPropagation();const n=t.shiftKey?"commit-and-previous":"commit-and-next";return this.field.onCommit(n,e,this.context)}}},this._onInput=t=>{this.field.onInput(t.target.value)},this._onInputBlur=t=>{const e=this._input;e&&t.relatedTarget!==this._lock&&this.field.onCommit("commit-on-blur",e,this.context)},this._selectText=()=>{const t=()=>{this._input===document.activeElement&&this._input?.selectText()};t(),x().then(t)},this._onAfterCreate=t=>{this._input=t,t.addEventListener("paste",this._onPaste),t.addEventListener("beforeinput",this._onBeforeInput)},this._onAfterRemoved=t=>{t.removeEventListener("paste",this._onPaste),t.removeEventListener("beforeinput",this._onBeforeInput)},this._onPaste=t=>{const e=t.clipboardData?.getData("text");e&&null!=this.field.parse(e,this.context)&&(t.stopPropagation(),this.field.onInput(e))},this._onBeforeInput=t=>{("historyUndo"===t.inputType||"historyRedo"===t.inputType)&&!this.field.dirty&&t.preventDefault()}}initialize(){this.addHandles(l((()=>this._rawDisplayValue),(()=>{const{committed:t,inputValue:e}=this.field;t||e||this._input!==document.activeElement||this._selectText()})))}loadDependencies(){return G({button:()=>import("../../chunks/calcite-button.js"),icon:()=>import("../../chunks/calcite-icon.js"),input:()=>import("../../chunks/calcite-input.js")})}render(){const{field:t,mode:e}=this,n="input"===e,{locked:i,readOnly:o}=t;return k("div",{class:this.classes({[qt.base]:!0,[qt.feedbackMode]:"feedback"===e,[qt.inputMode]:"input"===e,[qt.locked]:i,[qt.readOnly]:o})},k("div",{class:qt.title,key:"title"},this._title),k("div",{class:qt.value,key:"value",onkeydown:this._onKeyDown},n?this._renderValueInputMode():this._renderValueFeedbackMode()))}get _formattedValue(){return this.field.getFormattedValue(this.context)||Wt}get _rawDisplayValue(){return this.field.getRawDisplayValue(this.context)}get _suffix(){return this.field.getSuffix(this.context)}get _title(){const{title:t}=this.field;return"string"==typeof t?t:t(this.context)}_renderValueFeedbackMode(){return k(b,null,k("div",{class:qt.valueContent,key:"value-feedback"},this._formattedValue),this.field.locked&&"input"!==this.mode?k("calcite-icon",{class:qt.lockIcon,icon:Gt,key:"icon",scale:"s"}):null)}_renderValueInputMode(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return k("div",{class:this.classes(qt.valueContent,qt.valueContentReadOnly),key:"value-read-only"},this._formattedValue)}_renderValueWritable(){const{field:t}=this,{name:e,invalid:n,locked:i}=t,o=this.context?.messages.sketch??{},s=i?o.unlockConstraint:o.lockConstraint;return k(b,null,k("calcite-input",{afterCreate:this._onAfterCreate,afterRemoved:this._onAfterRemoved,class:qt.input,"data-field-name":e,"data-testid":`tooltip-field-${e}`,key:"input",onblur:this._onInputBlur,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",status:n?"invalid":"idle",type:"text",value:this._rawDisplayValue??Wt,onCalciteInputInput:this._onInput}),k("div",{class:qt.inputSuffix,key:"suffix"},this._suffix),t.lockable?k("calcite-button",{afterCreate:this._onLockAfterCreate,afterRemoved:this._onLockAfterRemoved,alignment:"center",appearance:"transparent",class:qt.button,"data-testid":`tooltip-field-${e}-lock`,iconStart:i?Gt:"unlock",key:"lock",kind:"neutral",label:s,onclick:this._onLockClick,scale:"s",tabIndex:-1,title:s}):k("div",{key:"lock-empty"}))}};t([m()],Qt.prototype,"field",void 0),t([m()],Qt.prototype,"context",void 0),t([m()],Qt.prototype,"mode",void 0),t([m()],Qt.prototype,"_input",void 0),t([m()],Qt.prototype,"_lock",void 0),t([m()],Qt.prototype,"_formattedValue",null),t([m()],Qt.prototype,"_rawDisplayValue",null),t([m()],Qt.prototype,"_suffix",null),t([m()],Qt.prototype,"_title",null),Qt=t([f("esri.views.interactive.tooltip.components.TooltipEditableField")],Qt);const Wt="—";function Zt(t){const e=t.fields.filter((t=>!0===t?.visible));return 0===e.length?null:k(b,null,e.map((e=>k(Qt,{context:t.context,field:e,key:e.id,mode:t.mode}))))}let Jt=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return k(Zt,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0,i.orientation?e.orientation:void 0,i.scale?e.scale:void 0],mode:n})}};Jt=t([f("esri.views.interactive.tooltip.content.TooltipContentDrawMesh")],Jt);let te=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{elevation:i,visibleElements:o}=e;return k(Zt,{context:t,fields:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0,o.elevation?i:void 0],mode:n})}};te=t([f("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],te);let ee=class extends g{constructor(t){super(t),this.visibleElements={}}render(){return k("div",{class:ot},this._isElementVisible("direction")?k(ne,{messages:this.messages,sketchOptions:this.sketchOptions}):null)}loadDependencies(){return G({button:()=>import("../../chunks/calcite-button.js"),dropdown:()=>import("../../chunks/calcite-dropdown.js"),"dropdown-item":()=>import("../../chunks/calcite-dropdown-item.js"),"dropdown-group":()=>import("../../chunks/calcite-dropdown-group.js")})}_isElementVisible(t){return this.visibleElements?.[t]??this.sketchOptions.tooltips.visibleElements[t]}};function ne(t){const{directionMode:e}=t.sketchOptions.values,n=t.messages?.sketch,i=n?.directionModeSelect?.title,o="absolute",s="relative";return k("calcite-dropdown",{key:"direction-mode",placement:"bottom-end",scale:"s",widthScale:"s",onCalciteDropdownSelect:e=>{const n=e.target.selectedItems?.[0]?.getAttribute("data-mode");t.sketchOptions.values.directionMode=n??"absolute"}},k("calcite-button",{alignment:"end",appearance:"transparent",iconStart:W[e],kind:"neutral",label:i,scale:"s",slot:"trigger",title:i}),k("calcite-dropdown-group",{selectionMode:"single"},k("calcite-dropdown-item",{"data-mode":s,"data-testid":"tooltip-direction-mode-relative",iconStart:W.relative,key:"relative",selected:e===s},n?.directionModeSelect?.relative),k("calcite-dropdown-item",{"data-mode":o,"data-testid":"tooltip-direction-mode-absolute",iconStart:W.absolute,key:"absolute",selected:e===o},n?.directionModeSelect?.absolute)))}t([Q("esri/views/interactive/tooltip/t9n/Tooltip"),m()],ee.prototype,"messages",void 0),t([m()],ee.prototype,"sketchOptions",void 0),t([m()],ee.prototype,"visibleElements",void 0),ee=t([f("esri.views.interactive.tooltip.components.DrawHeaderActions")],ee);let ie=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{xyMode:i,visibleElements:o}=e;return k(Zt,{context:t,fields:[..."direction-distance"===i?[o.direction?e.direction:void 0,o.distance?e.distance:void 0]:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0],o.elevation?e.elevation:void 0,o.area?e.area:void 0],mode:n})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return k(ee,{sketchOptions:e,visibleElements:{direction:"direction-distance"===t}})}};ie=t([f("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],ie);let oe=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{xyMode:i,visibleElements:o}=e;return k(Zt,{context:t,fields:[..."direction-distance"===i?[o.direction?e.direction:void 0,o.distance?e.distance:void 0]:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0],o.elevation?e.elevation:void 0,o.totalLength?e.totalLength:void 0],mode:n})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return k(ee,{sketchOptions:e,visibleElements:{direction:"direction-distance"===t}})}};oe=t([f("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],oe);let se=class extends Ht{_renderContent(){const{area:t,xSize:e,ySize:n,visibleElements:i}=this.info,o=this._messagesTooltip.sketch,s=this._formatters;return k(b,null,i.size&&null!=e&&null!=n?k(dt,{title:o.size,value:k(ht,{left:s.length(e),right:s.length(n)})}):null,i.area?k(dt,{title:o.area,value:s.area(t)}):null)}};se=t([f("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],se);let re=class extends Ht{_renderContent(){const{angle:t,visibleElements:e}=this.info,n=this._messagesTooltip.sketch;return k(b,null,e.rotation?k(dt,{title:n.rotation,value:this._formatters.angleRelative(t)}):null)}};re=t([f("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],re);let le=class extends Ht{_renderContent(){const t=this.info,{visibleElements:e}=t,n=this._messagesTooltip.sketch,i=this._formatters;return k(b,null,e.size?k(dt,{title:n.size,value:k(ht,{left:i.length(t.xSize),right:i.length(t.ySize)})}):null,e.scale?k(dt,{title:n.scale,value:k(ht,{left:i.scale(t.xScale),right:i.scale(t.yScale)})}):null)}};le=t([f("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],le);let ae=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return k(Zt,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0],mode:n})}};ae=t([f("esri.views.interactive.tooltip.content.TooltipContentMovePoint")],ae);let ce=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return k(Zt,{context:t,fields:[i.distance?e.distance:void 0,i.area?e.area:void 0,i.totalLength?e.totalLength:void 0],mode:n})}};ce=t([f("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],ce);let ue=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return k(Zt,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0,i.area&&"polygon"===e.geometryType?e.area:null,i.totalLength&&"polyline"===e.geometryType?e.totalLength:null],mode:n})}};ue=t([f("esri.views.interactive.tooltip.content.TooltipContentSelectedVertex")],ue);let de=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return k(Zt,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0,i.orientation?e.orientation:void 0,i.scale?e.scale:void 0],mode:n})}};de=t([f("esri.views.interactive.tooltip.content.TooltipContentTransformMesh")],de);let pe=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return k(Zt,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0,i.orientation?e.orientation:void 0,i.size?e.size:void 0],mode:n})}};pe=t([f("esri.views.interactive.tooltip.content.TooltipContentTransformPoint")],pe);let he=class extends Ht{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch,i=this._formatters;return k(b,null,e.distance?k(dt,{title:n.distance,value:i.length(t.distance)}):null)}};he=t([f("esri.views.interactive.tooltip.content.TooltipContentTranslate")],he);let me=class extends Ht{_renderContent(){const{distance:t,elevation:e,area:n,totalLength:i,visibleElements:o}=this.info,s=this._messagesTooltip.sketch,r=this._formatters;return k(b,null,o.distance?k(dt,{title:s.distance,value:r.length(t)}):null,o.elevation&&null!=e?.actual?k(dt,{title:s.elevation,value:r.verticalLength(e.actual)}):null,o.area&&null!=n?k(dt,{title:s.area,value:r.area(n)}):null,o.totalLength&&null!=i?k(dt,{title:s.totalLength,value:r.length(i)}):null)}};me=t([f("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],me);let fe=class extends Ht{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch,i=this._formatters;return k(b,null,e.distance?k(dt,{title:n.distance,value:i.length(t.distance)}):null)}};fe=t([f("esri.views.interactive.tooltip.content.TooltipContentTranslateXY")],fe);let ve=class extends Ht{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch;return k(b,null,e.distance?k(dt,{title:n.distance,value:this._formatters.verticalLengthRelative(t.distance)}):null)}};ve=t([f("esri.views.interactive.tooltip.content.TooltipContentTranslateZ")],ve);const ge={base:`${Z}`,ltr:`${Z}--ltr`,rtl:`${Z}--rtl`,debug:`${Z}--debug`};let _e=class extends e.EventedAccessor{constructor(t){super(t),this.info=null,this.options=null,this.position=null,this.content=null,this._focused=!1,this.outerContainer=document.createElement("div"),this.debug=!1,this._lastPosition=null,this._rtl=!1,this._prevXY=[0,0]}initialize(){const{outerContainer:t}=this;this.addHandles([l((()=>this.view.overlay?.surface),(e=>{t.remove(),e?.appendChild(t),this._rtl=y(e)}),c),l((()=>this.info),((e,n)=>{if(null!=this.content&&null!=e&&null!=n&&e.type===n.type)this.content.info=e;else{r(this.content);const n=function(t,e){if(null==e)return null;const n=document.createElement("div");switch(e.type){case"draw-point":return new te({tooltip:t,info:e,container:n});case"draw-polygon":return new ie({tooltip:t,info:e,container:n});case"draw-polyline":return new oe({tooltip:t,info:e,container:n});case"draw-mesh":return new Jt({tooltip:t,info:e,container:n});case"draw-rectangle":return new se({tooltip:t,info:e,container:n});case"draw-circle":return new Kt({tooltip:t,info:e,container:n});case"extent-rotate":return new re({tooltip:t,info:e,container:n});case"extent-scale":return new le({tooltip:t,info:e,container:n});case"move-point":return new ae({tooltip:t,info:e,container:n});case"selected-vertex":return new ue({tooltip:t,info:e,container:n});case"transform-point":return new pe({tooltip:t,info:e,container:n});case"transform-mesh":return new de({tooltip:t,info:e,container:n});case"translate":return new he({tooltip:t,info:e,container:n});case"translate-vertex":return new me({tooltip:t,info:e,container:n});case"translate-z":return new ve({tooltip:t,info:e,container:n});case"translate-xy":return new fe({tooltip:t,info:e,container:n});case"reshape-edge-offset":return new ce({tooltip:t,info:e,container:n})}}(this,e);n?(this.content=n,n.container&&t.appendChild(n.container),this.exitInputMode()):this.content=null}}),c),l((()=>({container:this.outerContainer,style:this._outerContainerStyle})),(({container:t,style:e})=>{Object.assign(t.style,e)}),u),l((()=>({outerContainer:this.outerContainer,placement:this.effectivePlacement,effectiveOffset:this._effectiveOffset,rtl:this._rtl,debug:this.debug})),(({outerContainer:t,placement:e,effectiveOffset:n,rtl:i,debug:o})=>{const{classList:s}=t;s.add(ge.base),s.toggle(ge.rtl,i),s.toggle(ge.ltr,!i),s.toggle(ge.debug,o),this.outerContainer.style.setProperty("--offset",`${n}px`),v(t),function({classList:t},e){ye.forEach((e=>t.remove(e))),t.add(ke(e))}(t,e)}),u),a((()=>"feedback"===this.mode),(()=>{this.position=null,this._clearOverride("effectivePlacement")}),d),n(this.outerContainer,"paste",(t=>{this.emit("paste",t)})),n(this.outerContainer,["focusin","focusout"],(()=>{setTimeout((()=>{this._focused=this.content?.container?.contains(document.activeElement)??!1}))}))])}destroy(){this.info=null,this.content=r(this.content),this.outerContainer.remove()}get mode(){return this.content?.mode??"feedback"}get focused(){return this._focused}get visible(){return"none"!==this._outerContainerStyle.display}get contentContainer(){return this.content?.container}get effectivePlacement(){const t=this.options?.placement;return"auto"===t?"bottom-end":t??"bottom-end"}get _screenPoint(){const{inputManager:t}=this.view;return t?.multiTouchActive?null:t?.latestPointerLocation}get _effectiveOffset(){return this.options?.offset??20}get _outerContainerStyle(){const t=this.position??this._screenPoint;return this._lastPosition=p(t),null!=t&&null!=this.content?{display:"block",transform:`translate(${Math.round(t.x)}px, ${Math.round(t.y)}px)`}:{display:"none",transform:"none"}}clear(){this.info=null}async enterInputMode(t){const e=this.position??this._lastPosition??this._screenPoint,n=this.position=p(e),{effectivePlacement:i}=this;this._override("effectivePlacement",i),await(this.content?.enterInputMode(t,(()=>{n&&(this.position=function(t,e,n,i){if(!t||!i.container)return e;const o=t.getBoundingClientRect(),{left:s,top:r}=i.container.getBoundingClientRect();let{x:l,y:a}=e;const c=o.left-s-n;c<0&&(l-=c);const u=o.right-s+n-i.width;u>0&&(l-=u);const d=o.top-r-n;d<0&&(a-=d);const p=o.bottom-r+n-i.height;return p>0&&(a-=p),h(l,a)}(this.contentContainer,n,this._effectiveOffset,this.view),Object.assign(this.outerContainer.style,this._outerContainerStyle))})))}async exitInputMode(t){await(this.content?.exitInputMode(t))}onDragStart(t,e){this._prevXY=[t,e]}onDrag(t,e){const n=t-this._prevXY[0],i=e-this._prevXY[1];this._prevXY=[t,e];const{position:o}=this;if(o){const{view:s}=this,r=t-s.position[0],l=e-s.position[1];if(r<0||r>s.width||l<0||l>s.height-16)return;this.position=h(o.x+n,o.y+i)}}onDragEnd(){this._prevXY=[0,0]}};t([m({nonNullable:!0})],_e.prototype,"view",void 0),t([m()],_e.prototype,"info",void 0),t([m()],_e.prototype,"options",void 0),t([m()],_e.prototype,"position",void 0),t([m()],_e.prototype,"content",void 0),t([m({readOnly:!0})],_e.prototype,"mode",null),t([m()],_e.prototype,"_focused",void 0),t([m({readOnly:!0})],_e.prototype,"focused",null),t([m({readOnly:!0})],_e.prototype,"outerContainer",void 0),t([m({readOnly:!0})],_e.prototype,"contentContainer",null),t([m({readOnly:!0})],_e.prototype,"effectivePlacement",null),t([m()],_e.prototype,"debug",void 0),t([m()],_e.prototype,"_lastPosition",void 0),t([m()],_e.prototype,"_screenPoint",null),t([m()],_e.prototype,"_rtl",void 0),t([m()],_e.prototype,"_effectiveOffset",null),t([m()],_e.prototype,"_outerContainerStyle",null),_e=t([f("esri.views.interactive.Tooltip")],_e);const ye=["top","bottom","leading","trailing"].flatMap((t=>[ke(`${t}-start`),ke(t),ke(`${t}-end`)]));function ke(t){return`${ge.base}--${t}`}const be=_e;export{St as a,At as b,Lt as c,wt as d,be as default,Vt as e,bt as f,Mt as m,Ut as p,Dt as s};
